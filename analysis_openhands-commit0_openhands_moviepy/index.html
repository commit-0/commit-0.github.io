
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.37">
    
    
      
        <title>Analysis openhands commit0 openhands moviepy - Commit-0</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8c3ca2c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#openhands-moviepy" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Commit-0" class="md-header__button md-logo" aria-label="Commit-0" data-md-component="logo">
      
  <img src="../logo2.webp" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Commit-0
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Analysis openhands commit0 openhands moviepy
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Commit-0" class="md-nav__button md-logo" aria-label="Commit-0" data-md-component="logo">
      
  <img src="../logo2.webp" alt="logo">

    </a>
    Commit-0
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../setupdist/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Commit0
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Agent
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Leaderboard
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pytest-summary-for-test-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Pytest Summary for test tests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#failed-pytests" class="md-nav__link">
    <span class="md-ellipsis">
      Failed pytests:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Failed pytests:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test_audioclipspytest_audio_coreader" class="md-nav__link">
    <span class="md-ellipsis">
      test_AudioClips.py::test_audio_coreader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_audioclipspytest_audioclip_concat" class="md-nav__link">
    <span class="md-ellipsis">
      test_AudioClips.py::test_audioclip_concat
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_audioclipspytest_audioclip_with_file_concat" class="md-nav__link">
    <span class="md-ellipsis">
      test_AudioClips.py::test_audioclip_with_file_concat
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_audioclipspytest_audiofileclip_concat" class="md-nav__link">
    <span class="md-ellipsis">
      test_AudioClips.py::test_audiofileclip_concat
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_ffmpeg_readerpytest_ffmpeg_parse_infos" class="md-nav__link">
    <span class="md-ellipsis">
      test_ffmpeg_reader.py::test_ffmpeg_parse_infos
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_ffmpeg_readerpytest_ffmpeg_parse_infos_for_i926" class="md-nav__link">
    <span class="md-ellipsis">
      test_ffmpeg_reader.py::test_ffmpeg_parse_infos_for_i926
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_toolspytest_sys_write_flush" class="md-nav__link">
    <span class="md-ellipsis">
      test_tools.py::test_sys_write_flush
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patch-diff" class="md-nav__link">
    <span class="md-ellipsis">
      Patch diff
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<p><a href="/analysis_openhands-commit0_openhands">back to OpenHands summary</a></p>
<h1 id="openhands-moviepy"><strong>OpenHands</strong>: moviepy</h1>
<h2 id="pytest-summary-for-test-tests">Pytest Summary for test <code>tests</code></h2>
<table>
<thead>
<tr>
<th style="text-align: left;">status</th>
<th style="text-align: center;">count</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">failed</td>
<td style="text-align: center;">7</td>
</tr>
<tr>
<td style="text-align: left;">passed</td>
<td style="text-align: center;">21</td>
</tr>
<tr>
<td style="text-align: left;">total</td>
<td style="text-align: center;">28</td>
</tr>
<tr>
<td style="text-align: left;">collected</td>
<td style="text-align: center;">28</td>
</tr>
</tbody>
</table>
<h2 id="failed-pytests">Failed pytests:</h2>
<h3 id="test_audioclipspytest_audio_coreader">test_AudioClips.py::test_audio_coreader</h3>
<details><summary> <pre>test_AudioClips.py::test_audio_coreader</pre></summary><pre>
@skip_if_windows
    def test_audio_coreader():
>       sound = AudioFileClip("media/crunching.mp3")

tests/test_AudioClips.py:22: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
moviepy/audio/io/AudioFileClip.py:65: in __init__
    self.reader = FFMPEG_AudioReader(filename, fps=fps, nbytes=nbytes, buffersize=buffersize)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <moviepy.audio.io.readers.FFMPEG_AudioReader object at 0x7f613e9c21a0>
filename = 'media/crunching.mp3', buffersize = 200000, print_infos = False
fps = 44100, nbytes = 2, nchannels = 2

    def __init__(self, filename, buffersize, print_infos=False, fps=44100, nbytes=2, nchannels=2):
        self.filename = filename
        self.nbytes = nbytes
        self.fps = fps
        self.f = 's%dle' % (8 * nbytes)
        self.acodec = 'pcm_s%dle' % (8 * nbytes)
        self.nchannels = nchannels
        infos = ffmpeg_parse_infos(filename)
>       self.duration = infos['duration']
E       TypeError: 'NoneType' object is not subscriptable

moviepy/audio/io/readers.py:47: TypeError
</pre>
</details>
<h3 id="test_audioclipspytest_audioclip_concat">test_AudioClips.py::test_audioclip_concat</h3>
<details><summary> <pre>test_AudioClips.py::test_audioclip_concat</pre></summary><pre>
def test_audioclip_concat():
        make_frame_440 = lambda t: [sin(440 * 2 * pi * t)]
        make_frame_880 = lambda t: [sin(880 * 2 * pi * t)]

        clip1 = AudioClip(make_frame_440, duration=1, fps=44100)
        clip2 = AudioClip(make_frame_880, duration=2, fps=22050)

        concat_clip = concatenate_audioclips((clip1, clip2))
        # concatenate_audioclips should return a clip with an fps of the greatest
        # fps passed into it
>       assert concat_clip.fps == 44100
E       AttributeError: 'NoneType' object has no attribute 'fps'

tests/test_AudioClips.py:42: AttributeError
</pre>
</details>
<h3 id="test_audioclipspytest_audioclip_with_file_concat">test_AudioClips.py::test_audioclip_with_file_concat</h3>
<details><summary> <pre>test_AudioClips.py::test_audioclip_with_file_concat</pre></summary><pre>
@skip_if_windows
    def test_audioclip_with_file_concat():
        make_frame_440 = lambda t: [sin(440 * 2 * pi * t)]
        clip1 = AudioClip(make_frame_440, duration=1, fps=44100)

>       clip2 = AudioFileClip("media/crunching.mp3")

tests/test_AudioClips.py:55: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
moviepy/audio/io/AudioFileClip.py:65: in __init__
    self.reader = FFMPEG_AudioReader(filename, fps=fps, nbytes=nbytes, buffersize=buffersize)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <moviepy.audio.io.readers.FFMPEG_AudioReader object at 0x7f613a195c30>
filename = 'media/crunching.mp3', buffersize = 200000, print_infos = False
fps = 44100, nbytes = 2, nchannels = 2

    def __init__(self, filename, buffersize, print_infos=False, fps=44100, nbytes=2, nchannels=2):
        self.filename = filename
        self.nbytes = nbytes
        self.fps = fps
        self.f = 's%dle' % (8 * nbytes)
        self.acodec = 'pcm_s%dle' % (8 * nbytes)
        self.nchannels = nchannels
        infos = ffmpeg_parse_infos(filename)
>       self.duration = infos['duration']
E       TypeError: 'NoneType' object is not subscriptable

moviepy/audio/io/readers.py:47: TypeError
</pre>
</details>
<h3 id="test_audioclipspytest_audiofileclip_concat">test_AudioClips.py::test_audiofileclip_concat</h3>
<details><summary> <pre>test_AudioClips.py::test_audiofileclip_concat</pre></summary><pre>
def test_audiofileclip_concat():
>       sound = AudioFileClip("media/crunching.mp3")

tests/test_AudioClips.py:67: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
moviepy/audio/io/AudioFileClip.py:65: in __init__
    self.reader = FFMPEG_AudioReader(filename, fps=fps, nbytes=nbytes, buffersize=buffersize)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <moviepy.audio.io.readers.FFMPEG_AudioReader object at 0x7f613e954dc0>
filename = 'media/crunching.mp3', buffersize = 200000, print_infos = False
fps = 44100, nbytes = 2, nchannels = 2

    def __init__(self, filename, buffersize, print_infos=False, fps=44100, nbytes=2, nchannels=2):
        self.filename = filename
        self.nbytes = nbytes
        self.fps = fps
        self.f = 's%dle' % (8 * nbytes)
        self.acodec = 'pcm_s%dle' % (8 * nbytes)
        self.nchannels = nchannels
        infos = ffmpeg_parse_infos(filename)
>       self.duration = infos['duration']
E       TypeError: 'NoneType' object is not subscriptable

moviepy/audio/io/readers.py:47: TypeError
</pre>
</details>
<h3 id="test_ffmpeg_readerpytest_ffmpeg_parse_infos">test_ffmpeg_reader.py::test_ffmpeg_parse_infos</h3>
<details><summary> <pre>test_ffmpeg_reader.py::test_ffmpeg_parse_infos</pre></summary><pre>
def test_ffmpeg_parse_infos():
        d=ffmpeg_parse_infos("media/big_buck_bunny_432_433.webm")
>       assert d['duration'] == 1.0
E       TypeError: 'NoneType' object is not subscriptable

tests/test_ffmpeg_reader.py:12: TypeError
</pre>
</details>
<h3 id="test_ffmpeg_readerpytest_ffmpeg_parse_infos_for_i926">test_ffmpeg_reader.py::test_ffmpeg_parse_infos_for_i926</h3>
<details><summary> <pre>test_ffmpeg_reader.py::test_ffmpeg_parse_infos_for_i926</pre></summary><pre>
def test_ffmpeg_parse_infos_for_i926():
        d = ffmpeg_parse_infos("tests/resource/sintel_with_15_chapters.mp4")
>       assert d['audio_found']
E       TypeError: 'NoneType' object is not subscriptable

tests/test_ffmpeg_reader.py:29: TypeError
</pre>
</details>
<h3 id="test_toolspytest_sys_write_flush">test_tools.py::test_sys_write_flush</h3>
<details><summary> <pre>test_tools.py::test_sys_write_flush</pre></summary><pre>
def test_sys_write_flush():
        """Test for sys_write-flush function. Check that stdout has no content after flushing."""
        tools.sys_write_flush("hello world")

        file = sys.stdout.read()
>       assert file == b""
E       AssertionError: assert '' == b''

tests/test_tools.py:62: AssertionError
</pre>
</details>

<h2 id="patch-diff">Patch diff</h2>
<div class="highlight"><pre><span></span><code><span class="gh">diff --git a/moviepy/Clip.py b/moviepy/Clip.py</span>
<span class="gh">index da22c72..a997734 100644</span>
<span class="gd">--- a/moviepy/Clip.py</span>
<span class="gi">+++ b/moviepy/Clip.py</span>
<span class="gu">@@ -40,6 +40,7 @@ class Clip:</span>
<span class="w"> </span>        self.memoize = False
<span class="w"> </span>        self.memoized_t = None
<span class="w"> </span>        self.memoize_frame = None
<span class="gi">+        self.make_frame = None</span>

<span class="w"> </span>    def copy(self):
<span class="w"> </span>        &quot;&quot;&quot; Shallow copy of the clip. 
<span class="gu">@@ -51,7 +52,12 @@ class Clip:</span>
<span class="w"> </span>        there is an outplace transformation of the clip (clip.resize,
<span class="w"> </span>        clip.subclip, etc.)
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        newclip = copy(self)</span>
<span class="gi">+        if hasattr(self, &#39;audio&#39;):</span>
<span class="gi">+            newclip.audio = copy(self.audio)</span>
<span class="gi">+        if hasattr(self, &#39;mask&#39;):</span>
<span class="gi">+            newclip.mask = copy(self.mask)</span>
<span class="gi">+        return newclip</span>

<span class="w"> </span>    @convert_to_seconds([&#39;t&#39;])
<span class="w"> </span>    def get_frame(self, t):
<span class="gu">@@ -59,7 +65,19 @@ class Clip:</span>
<span class="w"> </span>        Gets a numpy array representing the RGB picture of the clip at time t
<span class="w"> </span>        or (mono or stereo) value for a sound clip
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        if self.make_frame is None:</span>
<span class="gi">+            raise ValueError(&quot;No make_frame attribute in this clip.&quot;)</span>
<span class="gi">+</span>
<span class="gi">+        if self.memoize:</span>
<span class="gi">+            if t == self.memoized_t:</span>
<span class="gi">+                return self.memoized_frame</span>
<span class="gi">+            else:</span>
<span class="gi">+                frame = self.make_frame(t)</span>
<span class="gi">+                self.memoized_t = t</span>
<span class="gi">+                self.memoized_frame = frame</span>
<span class="gi">+                return frame</span>
<span class="gi">+        else:</span>
<span class="gi">+            return self.make_frame(t)</span>

<span class="w"> </span>    def fl(self, fun, apply_to=None, keep_duration=True):
<span class="w"> </span>        &quot;&quot;&quot; General processing of a clip.
<span class="gu">@@ -98,7 +116,31 @@ class Clip:</span>
<span class="w"> </span>        &gt;&gt;&gt; newclip = clip.fl(fl, apply_to=&#39;mask&#39;)

<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        newclip = self.copy()</span>
<span class="gi">+</span>
<span class="gi">+        if not hasattr(newclip, &#39;make_frame&#39;):</span>
<span class="gi">+            newclip.make_frame = None</span>
<span class="gi">+</span>
<span class="gi">+        def make_frame(t):</span>
<span class="gi">+            return fun(self.get_frame, t)</span>
<span class="gi">+</span>
<span class="gi">+        newclip.make_frame = make_frame</span>
<span class="gi">+</span>
<span class="gi">+        if not keep_duration:</span>
<span class="gi">+            newclip.duration = None</span>
<span class="gi">+</span>
<span class="gi">+        if apply_to is not None:</span>
<span class="gi">+            if isinstance(apply_to, str):</span>
<span class="gi">+                apply_to = [apply_to]</span>
<span class="gi">+</span>
<span class="gi">+            for attr in apply_to:</span>
<span class="gi">+                if hasattr(newclip, attr):</span>
<span class="gi">+                    a = getattr(newclip, attr)</span>
<span class="gi">+                    if a is not None:</span>
<span class="gi">+                        new_a = a.fl(fun, keep_duration=keep_duration)</span>
<span class="gi">+                        setattr(newclip, attr, new_a)</span>
<span class="gi">+</span>
<span class="gi">+        return newclip</span>

<span class="w"> </span>    def fl_time(self, t_func, apply_to=None, keep_duration=False):
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -131,7 +173,7 @@ class Clip:</span>
<span class="w"> </span>        &gt;&gt;&gt; newclip = clip.fl_time(lambda: 3-t)

<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self.fl(lambda gf, t: gf(t_func(t)), apply_to, keep_duration)</span>

<span class="w"> </span>    def fx(self, func, *args, **kwargs):
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -154,7 +196,7 @@ class Clip:</span>
<span class="w"> </span>        &gt;&gt;&gt; resize( volumex( mirrorx( clip ), 0.5), 0.3)

<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return func(self, *args, **kwargs)</span>

<span class="w"> </span>    @apply_to_mask
<span class="w"> </span>    @apply_to_audio
<span class="gu">@@ -178,7 +220,11 @@ class Clip:</span>
<span class="w"> </span>        These changes are also applied to the ``audio`` and ``mask``
<span class="w"> </span>        clips of the current clip, if they exist.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        self.start = t</span>
<span class="gi">+        if (self.duration is not None) and change_end:</span>
<span class="gi">+            self.end = t + self.duration</span>
<span class="gi">+        elif (self.end is not None) and not change_end:</span>
<span class="gi">+            self.duration = self.end - self.start</span>

<span class="w"> </span>    @apply_to_mask
<span class="w"> </span>    @apply_to_audio
<span class="gu">@@ -192,7 +238,12 @@ class Clip:</span>
<span class="w"> </span>        Also sets the duration of the mask and audio, if any,
<span class="w"> </span>        of the returned clip.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        self.end = t</span>
<span class="gi">+        if self.start is None:</span>
<span class="gi">+            if self.duration is not None:</span>
<span class="gi">+                self.start = t - self.duration</span>
<span class="gi">+        else:</span>
<span class="gi">+            self.duration = self.end - self.start</span>

<span class="w"> </span>    @apply_to_mask
<span class="w"> </span>    @apply_to_audio
<span class="gu">@@ -209,7 +260,13 @@ class Clip:</span>
<span class="w"> </span>        be modified in function of the duration and the preset end
<span class="w"> </span>        of the clip.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        self.duration = t</span>
<span class="gi">+        if change_end:</span>
<span class="gi">+            self.end = None if (t is None) else (self.start + t)</span>
<span class="gi">+        else:</span>
<span class="gi">+            if self.end is None:</span>
<span class="gi">+                raise ValueError(&quot;Can&#39;t change start of clip with undefined end.&quot;)</span>
<span class="gi">+            self.start = self.end - t</span>

<span class="w"> </span>    @outplace
<span class="w"> </span>    def set_make_frame(self, make_frame):
<span class="gu">@@ -217,23 +274,26 @@ class Clip:</span>
<span class="w"> </span>        Sets a ``make_frame`` attribute for the clip. Useful for setting
<span class="w"> </span>        arbitrary/complicated videoclips.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        self.make_frame = make_frame</span>

<span class="w"> </span>    @outplace
<span class="w"> </span>    def set_fps(self, fps):
<span class="w"> </span>        &quot;&quot;&quot; Returns a copy of the clip with a new default fps for functions like
<span class="w"> </span>        write_videofile, iterframe, etc. &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        self.fps = fps</span>

<span class="w"> </span>    @outplace
<span class="w"> </span>    def set_ismask(self, ismask):
<span class="w"> </span>        &quot;&quot;&quot; Says wheter the clip is a mask or not (ismask is a boolean)&quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        self.ismask = ismask</span>

<span class="w"> </span>    @outplace
<span class="w"> </span>    def set_memoize(self, memoize):
<span class="w"> </span>        &quot;&quot;&quot; Sets wheter the clip should keep the last frame read in memory &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        self.memoize = memoize</span>
<span class="gi">+        if not memoize:</span>
<span class="gi">+            self.memoized_t = None</span>
<span class="gi">+            self.memoized_frame = None</span>

<span class="w"> </span>    @convert_to_seconds([&#39;t&#39;])
<span class="w"> </span>    def is_playing(self, t):
<span class="gu">@@ -246,7 +306,24 @@ class Clip:</span>
<span class="w"> </span>        theclip, else returns a vector [b_1, b_2, b_3...] where b_i
<span class="w"> </span>        is true iff tti is in the clip.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        if isinstance(t, np.ndarray):</span>
<span class="gi">+            # Array case</span>
<span class="gi">+            tmin, tmax = t.min(), t.max()</span>
<span class="gi">+            </span>
<span class="gi">+            if (self.end is not None) and (tmin &gt;= self.end):</span>
<span class="gi">+                return False</span>
<span class="gi">+            </span>
<span class="gi">+            if tmax &lt; self.start:</span>
<span class="gi">+                return False</span>
<span class="gi">+            </span>
<span class="gi">+            # All times are in the clip</span>
<span class="gi">+            result = (t &gt;= self.start)</span>
<span class="gi">+            if self.end is not None:</span>
<span class="gi">+                result = result &amp; (t &lt;= self.end)</span>
<span class="gi">+            return result</span>
<span class="gi">+        else:</span>
<span class="gi">+            # Single time case</span>
<span class="gi">+            return (t &gt;= self.start) and ((self.end is None) or (t &lt;= self.end))</span>

<span class="w"> </span>    @convert_to_seconds([&#39;t_start&#39;, &#39;t_end&#39;])
<span class="w"> </span>    @apply_to_mask
<span class="gu">@@ -272,7 +349,30 @@ class Clip:</span>
<span class="w"> </span>        subclips of ``mask`` and ``audio`` the original clip, if
<span class="w"> </span>        they exist.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        if t_start &lt; 0:</span>
<span class="gi">+            # Make this more intuitive</span>
<span class="gi">+            if self.duration is None:</span>
<span class="gi">+                raise ValueError(&quot;Subclip with negative times can only be&quot;</span>
<span class="gi">+                               &quot; extracted from clips with a duration&quot;)</span>
<span class="gi">+            t_start = self.duration + t_start</span>
<span class="gi">+</span>
<span class="gi">+        if t_end is None:</span>
<span class="gi">+            t_end = self.duration</span>
<span class="gi">+        elif t_end &lt; 0:</span>
<span class="gi">+            if self.duration is None:</span>
<span class="gi">+                raise ValueError(&quot;Subclip with negative times can only be&quot;</span>
<span class="gi">+                               &quot; extracted from clips with a duration&quot;)</span>
<span class="gi">+            t_end = self.duration + t_end</span>
<span class="gi">+</span>
<span class="gi">+        newclip = self.copy()</span>
<span class="gi">+</span>
<span class="gi">+        if t_start is None:</span>
<span class="gi">+            t_start = 0</span>
<span class="gi">+        newclip.start = t_start</span>
<span class="gi">+        newclip.end = t_end</span>
<span class="gi">+        newclip.duration = t_end - t_start</span>
<span class="gi">+</span>
<span class="gi">+        return newclip</span>

<span class="w"> </span>    @apply_to_mask
<span class="w"> </span>    @apply_to_audio
<span class="gu">@@ -290,7 +390,22 @@ class Clip:</span>
<span class="w"> </span>        The resulting clip&#39;s ``audio`` and ``mask`` will also be cutout
<span class="w"> </span>        if they exist.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        newclip = self.copy()</span>
<span class="gi">+        if tb is None:</span>
<span class="gi">+            tb = self.duration</span>
<span class="gi">+        </span>
<span class="gi">+        def make_frame(t):</span>
<span class="gi">+            if t &lt; ta:</span>
<span class="gi">+                return self.get_frame(t)</span>
<span class="gi">+            else:</span>
<span class="gi">+                return self.get_frame(t + (tb - ta))</span>
<span class="gi">+        </span>
<span class="gi">+        newclip.make_frame = make_frame</span>
<span class="gi">+        </span>
<span class="gi">+        if self.duration is not None:</span>
<span class="gi">+            newclip.duration = self.duration - (tb - ta)</span>
<span class="gi">+        </span>
<span class="gi">+        return newclip</span>

<span class="w"> </span>    @requires_duration
<span class="w"> </span>    @use_clip_fps_by_default
<span class="gu">@@ -319,13 +434,50 @@ class Clip:</span>
<span class="w"> </span>        &gt;&gt;&gt; print ( [frame[0,:,0].max()
<span class="w"> </span>                     for frame in myclip.iter_frames()])
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        logger = proglog.default_bar_logger(logger)</span>
<span class="gi">+        </span>
<span class="gi">+        if fps is None:</span>
<span class="gi">+            fps = self.fps</span>
<span class="gi">+            </span>
<span class="gi">+        if fps is None:</span>
<span class="gi">+            raise ValueError(&quot;No fps attribute specified&quot;)</span>
<span class="gi">+            </span>
<span class="gi">+        # Compute the total number of frames</span>
<span class="gi">+        total_frames = int(self.duration * fps)</span>
<span class="gi">+        times = np.linspace(0, self.duration, total_frames + 1)[:-1]</span>
<span class="gi">+        </span>
<span class="gi">+        if dtype is not None:</span>
<span class="gi">+            def get_frame(t):</span>
<span class="gi">+                frame = self.get_frame(t)</span>
<span class="gi">+                if dtype != frame.dtype:</span>
<span class="gi">+                    return frame.astype(dtype)</span>
<span class="gi">+                return frame</span>
<span class="gi">+        else:</span>
<span class="gi">+            get_frame = self.get_frame</span>
<span class="gi">+            </span>
<span class="gi">+        logger.new_bar_segment(total_frames)</span>
<span class="gi">+        </span>
<span class="gi">+        for i, t in enumerate(times):</span>
<span class="gi">+            logger.bar_update(i)</span>
<span class="gi">+            frame = get_frame(t)</span>
<span class="gi">+            if with_times:</span>
<span class="gi">+                yield t, frame</span>
<span class="gi">+            else:</span>
<span class="gi">+                yield frame</span>
<span class="gi">+                </span>
<span class="gi">+        logger.bar_close()</span>

<span class="w"> </span>    def close(self):
<span class="w"> </span>        &quot;&quot;&quot; 
<span class="w"> </span>            Release any resources that are in use.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        if hasattr(self, &#39;audio&#39;) and self.audio is not None:</span>
<span class="gi">+            self.audio.close()</span>
<span class="gi">+        if hasattr(self, &#39;mask&#39;) and self.mask is not None:</span>
<span class="gi">+            self.mask.close()</span>
<span class="gi">+        if hasattr(self, &#39;make_frame&#39;):</span>
<span class="gi">+            self.make_frame = None</span>
<span class="gi">+        self.memoized_frame = None</span>

<span class="w"> </span>    def __enter__(self):
<span class="w"> </span>        return self
<span class="gh">diff --git a/moviepy/config.py b/moviepy/config.py</span>
<span class="gh">index 985e1ff..100fcb1 100644</span>
<span class="gd">--- a/moviepy/config.py</span>
<span class="gi">+++ b/moviepy/config.py</span>
<span class="gu">@@ -2,6 +2,16 @@ import os</span>
<span class="w"> </span>import subprocess as sp
<span class="w"> </span>from .compat import DEVNULL
<span class="w"> </span>from .config_defaults import FFMPEG_BINARY, IMAGEMAGICK_BINARY
<span class="gi">+</span>
<span class="gi">+def try_cmd(cmd):</span>
<span class="gi">+    &quot;&quot;&quot;Try to execute a command and return (success, stderr output).&quot;&quot;&quot;</span>
<span class="gi">+    try:</span>
<span class="gi">+        process = sp.Popen(cmd, stdout=DEVNULL, stderr=sp.PIPE)</span>
<span class="gi">+        _, error = process.communicate()</span>
<span class="gi">+        success = process.returncode == 0</span>
<span class="gi">+        return success, error</span>
<span class="gi">+    except Exception as e:</span>
<span class="gi">+        return False, str(e)</span>
<span class="w"> </span>if os.name == &#39;nt&#39;:
<span class="w"> </span>    try:
<span class="w"> </span>        import winreg as wr
<span class="gu">@@ -44,11 +54,30 @@ else:</span>

<span class="w"> </span>def get_setting(varname):
<span class="w"> </span>    &quot;&quot;&quot; Returns the value of a configuration variable. &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    if varname == &quot;FFMPEG_BINARY&quot;:</span>
<span class="gi">+        return FFMPEG_BINARY</span>
<span class="gi">+    elif varname == &quot;IMAGEMAGICK_BINARY&quot;:</span>
<span class="gi">+        return IMAGEMAGICK_BINARY</span>
<span class="gi">+    else:</span>
<span class="gi">+        raise ValueError(f&quot;Unknown setting {varname}&quot;)</span>

<span class="w"> </span>def change_settings(new_settings=None, filename=None):
<span class="w"> </span>    &quot;&quot;&quot; Changes the value of configuration variables.&quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    global FFMPEG_BINARY, IMAGEMAGICK_BINARY</span>
<span class="gi">+    </span>
<span class="gi">+    if new_settings is None:</span>
<span class="gi">+        new_settings = {}</span>
<span class="gi">+    </span>
<span class="gi">+    if filename is not None:</span>
<span class="gi">+        # Load settings from file</span>
<span class="gi">+        with open(filename) as f:</span>
<span class="gi">+            exec(f.read(), globals())</span>
<span class="gi">+    </span>
<span class="gi">+    # Update with new settings</span>
<span class="gi">+    if &quot;FFMPEG_BINARY&quot; in new_settings:</span>
<span class="gi">+        FFMPEG_BINARY = new_settings[&quot;FFMPEG_BINARY&quot;]</span>
<span class="gi">+    if &quot;IMAGEMAGICK_BINARY&quot; in new_settings:</span>
<span class="gi">+        IMAGEMAGICK_BINARY = new_settings[&quot;IMAGEMAGICK_BINARY&quot;]</span>
<span class="w"> </span>if __name__ == &#39;__main__&#39;:
<span class="w"> </span>    if try_cmd([FFMPEG_BINARY])[0]:
<span class="w"> </span>        print(&#39;MoviePy : ffmpeg successfully found.&#39;)
<span class="gh">diff --git a/moviepy/decorators.py b/moviepy/decorators.py</span>
<span class="gh">index d7484af..6c47edb 100644</span>
<span class="gd">--- a/moviepy/decorators.py</span>
<span class="gi">+++ b/moviepy/decorators.py</span>
<span class="gu">@@ -7,29 +7,42 @@ from moviepy.tools import cvsecs</span>
<span class="w"> </span>@decorator.decorator
<span class="w"> </span>def outplace(f, clip, *a, **k):
<span class="w"> </span>    &quot;&quot;&quot; Applies f(clip.copy(), *a, **k) and returns clip.copy()&quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    newclip = clip.copy()</span>
<span class="gi">+    f(newclip, *a, **k)</span>
<span class="gi">+    return newclip</span>

<span class="w"> </span>@decorator.decorator
<span class="w"> </span>def convert_masks_to_RGB(f, clip, *a, **k):
<span class="w"> </span>    &quot;&quot;&quot; If the clip is a mask, convert it to RGB before running the function &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    if clip.ismask:</span>
<span class="gi">+        clip = clip.rgb_mode()</span>
<span class="gi">+    return f(clip, *a, **k)</span>

<span class="w"> </span>@decorator.decorator
<span class="w"> </span>def apply_to_mask(f, clip, *a, **k):
<span class="w"> </span>    &quot;&quot;&quot; This decorator will apply the same function f to the mask of
<span class="w"> </span>        the clip created with f &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    newclip = f(clip, *a, **k)</span>
<span class="gi">+    if getattr(clip, &#39;mask&#39;, None) is not None:</span>
<span class="gi">+        newclip.mask = f(clip.mask, *a, **k)</span>
<span class="gi">+    return newclip</span>

<span class="w"> </span>@decorator.decorator
<span class="w"> </span>def apply_to_audio(f, clip, *a, **k):
<span class="w"> </span>    &quot;&quot;&quot; This decorator will apply the function f to the audio of
<span class="w"> </span>        the clip created with f &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    newclip = f(clip, *a, **k)</span>
<span class="gi">+    if getattr(clip, &#39;audio&#39;, None) is not None:</span>
<span class="gi">+        newclip.audio = f(clip.audio, *a, **k)</span>
<span class="gi">+    return newclip</span>

<span class="w"> </span>@decorator.decorator
<span class="w"> </span>def requires_duration(f, clip, *a, **k):
<span class="w"> </span>    &quot;&quot;&quot; Raise an error if the clip has no duration.&quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    if clip.duration is None:</span>
<span class="gi">+        raise ValueError(&quot;Attribute &#39;duration&#39; not set&quot;)</span>
<span class="gi">+    else:</span>
<span class="gi">+        return f(clip, *a, **k)</span>

<span class="w"> </span>@decorator.decorator
<span class="w"> </span>def audio_video_fx(f, clip, *a, **k):
<span class="gu">@@ -39,22 +52,44 @@ def audio_video_fx(f, clip, *a, **k):</span>
<span class="w"> </span>    can be also used on a video clip, at which case it returns a
<span class="w"> </span>    videoclip with unmodified video and modified audio.
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    if hasattr(clip, &#39;audio&#39;):</span>
<span class="gi">+        newclip = clip.copy()</span>
<span class="gi">+        if clip.audio is not None:</span>
<span class="gi">+            newclip.audio = f(clip.audio, *a, **k)</span>
<span class="gi">+        return newclip</span>
<span class="gi">+    else:</span>
<span class="gi">+        return f(clip, *a, **k)</span>

<span class="w"> </span>def preprocess_args(fun, varnames):
<span class="w"> </span>    &quot;&quot;&quot; Applies fun to variables in varnames before launching the function &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    def wrapper(f, *a, **kw):</span>
<span class="gi">+        if hasattr(f, &#39;__code__&#39;):</span>
<span class="gi">+            names = f.__code__.co_varnames</span>
<span class="gi">+        else:</span>
<span class="gi">+            names = getattr(f, &#39;func&#39;, f).__code__.co_varnames</span>
<span class="gi">+        </span>
<span class="gi">+        new_a = [fun(arg) if (name in varnames) and (arg is not None)</span>
<span class="gi">+                else arg</span>
<span class="gi">+                for (arg, name) in zip(a, names)]</span>
<span class="gi">+        new_kw = {k: fun(v) if k in varnames else v</span>
<span class="gi">+                 for (k, v) in kw.items()}</span>
<span class="gi">+        return f(*new_a, **new_kw)</span>
<span class="gi">+    return decorator.decorator(wrapper)</span>

<span class="w"> </span>def convert_to_seconds(varnames):
<span class="w"> </span>    &quot;&quot;&quot;Converts the specified variables to seconds&quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    return preprocess_args(cvsecs, varnames)</span>

<span class="w"> </span>@decorator.decorator
<span class="w"> </span>def add_mask_if_none(f, clip, *a, **k):
<span class="w"> </span>    &quot;&quot;&quot; Add a mask to the clip if there is none. &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    if clip.mask is None:</span>
<span class="gi">+        clip = clip.add_mask()</span>
<span class="gi">+    return f(clip, *a, **k)</span>

<span class="w"> </span>@decorator.decorator
<span class="w"> </span>def use_clip_fps_by_default(f, clip, *a, **k):
<span class="w"> </span>    &quot;&quot;&quot; Will use clip.fps if no fps=... is provided in **k &quot;&quot;&quot;
<span class="gd">-    pass</span>
\ No newline at end of file
<span class="gi">+    if &#39;fps&#39; not in k and hasattr(clip, &#39;fps&#39;) and clip.fps is not None:</span>
<span class="gi">+        k[&#39;fps&#39;] = clip.fps</span>
<span class="gi">+    return f(clip, *a, **k)</span>
\ No newline at end of file
<span class="gh">diff --git a/moviepy/tools.py b/moviepy/tools.py</span>
<span class="gh">index 50c37e9..afda8e9 100644</span>
<span class="gd">--- a/moviepy/tools.py</span>
<span class="gi">+++ b/moviepy/tools.py</span>
<span class="gu">@@ -10,23 +10,54 @@ from .compat import DEVNULL</span>

<span class="w"> </span>def sys_write_flush(s):
<span class="w"> </span>    &quot;&quot;&quot; Writes and flushes without delay a text in the console &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    if isinstance(s, bytes):</span>
<span class="gi">+        sys.stdout.buffer.write(s)</span>
<span class="gi">+    else:</span>
<span class="gi">+        sys.stdout.write(s)</span>
<span class="gi">+    sys.stdout.flush()</span>

<span class="w"> </span>def verbose_print(verbose, s):
<span class="w"> </span>    &quot;&quot;&quot; Only prints s (with sys_write_flush) if verbose is True.&quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    if verbose:</span>
<span class="gi">+        sys_write_flush(s)</span>

<span class="w"> </span>def subprocess_call(cmd, logger=&#39;bar&#39;, errorprint=True):
<span class="w"> </span>    &quot;&quot;&quot; Executes the given subprocess command.

<span class="w"> </span>    Set logger to None or a custom Proglog logger to avoid printings.
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    if logger == &#39;bar&#39;:</span>
<span class="gi">+        logger = proglog.default_bar_logger(&#39;bar&#39;)</span>
<span class="gi">+    </span>
<span class="gi">+    try:</span>
<span class="gi">+        popen_params = {</span>
<span class="gi">+            &quot;stdout&quot;: DEVNULL,</span>
<span class="gi">+            &quot;stderr&quot;: sp.PIPE,</span>
<span class="gi">+            &quot;stdin&quot;: DEVNULL</span>
<span class="gi">+        }</span>
<span class="gi">+        </span>
<span class="gi">+        proc = sp.Popen(cmd, **popen_params)</span>
<span class="gi">+        </span>
<span class="gi">+        out, err = proc.communicate()</span>
<span class="gi">+        </span>
<span class="gi">+        if proc.returncode:</span>
<span class="gi">+            if errorprint and err is not None:</span>
<span class="gi">+                sys_write_flush(err.decode(&#39;utf8&#39;))</span>
<span class="gi">+            raise IOError(err.decode(&#39;utf8&#39;))</span>
<span class="gi">+        </span>
<span class="gi">+        return proc</span>
<span class="gi">+    except Exception as e:</span>
<span class="gi">+        if errorprint:</span>
<span class="gi">+            sys_write_flush(&quot;Moviepy Error: failed command:\n%s\n&quot; % &#39; &#39;.join(cmd))</span>
<span class="gi">+        raise IOError(&quot;Moviepy Error: failed command:\n%s\n&quot; % &#39; &#39;.join(cmd))</span>

<span class="w"> </span>def is_string(obj):
<span class="w"> </span>    &quot;&quot;&quot; Returns true if s is string or string-like object,
<span class="w"> </span>    compatible with Python 2 and Python 3.&quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    try:</span>
<span class="gi">+        return isinstance(obj, str)</span>
<span class="gi">+    except Exception:</span>
<span class="gi">+        return False</span>

<span class="w"> </span>def cvsecs(time):
<span class="w"> </span>    &quot;&quot;&quot; Will convert any time into seconds. 
<span class="gu">@@ -51,7 +82,39 @@ def cvsecs(time):</span>
<span class="w"> </span>    &gt;&gt;&gt; cvsecs(&#39;33.5&#39;)      # only secs
<span class="w"> </span>    33.5
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    if time is None:</span>
<span class="gi">+        return None</span>
<span class="gi">+        </span>
<span class="gi">+    if isinstance(time, (int, float)):</span>
<span class="gi">+        return float(time)</span>
<span class="gi">+    </span>
<span class="gi">+    if isinstance(time, (tuple, list)):</span>
<span class="gi">+        if len(time) == 1:</span>
<span class="gi">+            return float(time[0])</span>
<span class="gi">+        elif len(time) == 2:</span>
<span class="gi">+            return float(time[0]) * 60 + float(time[1])</span>
<span class="gi">+        elif len(time) == 3:</span>
<span class="gi">+            return float(time[0]) * 3600 + float(time[1]) * 60 + float(time[2])</span>
<span class="gi">+    </span>
<span class="gi">+    if isinstance(time, str):</span>
<span class="gi">+        # Handle comma as decimal separator</span>
<span class="gi">+        time = time.replace(&#39;,&#39;, &#39;.&#39;)</span>
<span class="gi">+        </span>
<span class="gi">+        if &#39;:&#39; not in time:</span>
<span class="gi">+            # Just seconds</span>
<span class="gi">+            return float(time)</span>
<span class="gi">+        </span>
<span class="gi">+        parts = time.split(&#39;:&#39;)</span>
<span class="gi">+        parts = [float(p) for p in parts]</span>
<span class="gi">+        </span>
<span class="gi">+        if len(parts) == 2:</span>
<span class="gi">+            # Minutes and seconds</span>
<span class="gi">+            return parts[0] * 60 + parts[1]</span>
<span class="gi">+        elif len(parts) == 3:</span>
<span class="gi">+            # Hours, minutes and seconds</span>
<span class="gi">+            return parts[0] * 3600 + parts[1] * 60 + parts[2]</span>
<span class="gi">+    </span>
<span class="gi">+    return time</span>

<span class="w"> </span>def deprecated_version_of(f, oldname, newname=None):
<span class="w"> </span>    &quot;&quot;&quot; Indicates that a function is deprecated and has a new name.
<span class="gu">@@ -78,7 +141,31 @@ def deprecated_version_of(f, oldname, newname=None):</span>
<span class="w"> </span>    &gt;&gt;&gt;
<span class="w"> </span>    &gt;&gt;&gt; Clip.to_file = deprecated_version_of(Clip.write_file, &#39;to_file&#39;)
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    if newname is None:</span>
<span class="gi">+        newname = f.__name__</span>
<span class="gi">+</span>
<span class="gi">+    warning = (&quot;The function ``%s`` is deprecated and is kept temporarily &quot;</span>
<span class="gi">+              &quot;for backwards compatibility.\nPlease use the new name &quot;</span>
<span class="gi">+              &quot;``%s`` instead.&quot;) % (oldname, newname)</span>
<span class="gi">+</span>
<span class="gi">+    def deprecated(*args, **kwargs):</span>
<span class="gi">+        warnings.warn(&quot;MoviePy: &quot; + warning, PendingDeprecationWarning)</span>
<span class="gi">+        return f(*args, **kwargs)</span>
<span class="gi">+</span>
<span class="gi">+    deprecated.__doc__ = warning</span>
<span class="gi">+</span>
<span class="gi">+    return deprecated</span>
<span class="w"> </span>extensions_dict = {&#39;mp4&#39;: {&#39;type&#39;: &#39;video&#39;, &#39;codec&#39;: [&#39;libx264&#39;, &#39;libmpeg4&#39;, &#39;aac&#39;]}, &#39;ogv&#39;: {&#39;type&#39;: &#39;video&#39;, &#39;codec&#39;: [&#39;libtheora&#39;]}, &#39;webm&#39;: {&#39;type&#39;: &#39;video&#39;, &#39;codec&#39;: [&#39;libvpx&#39;]}, &#39;avi&#39;: {&#39;type&#39;: &#39;video&#39;}, &#39;mov&#39;: {&#39;type&#39;: &#39;video&#39;}, &#39;ogg&#39;: {&#39;type&#39;: &#39;audio&#39;, &#39;codec&#39;: [&#39;libvorbis&#39;]}, &#39;mp3&#39;: {&#39;type&#39;: &#39;audio&#39;, &#39;codec&#39;: [&#39;libmp3lame&#39;]}, &#39;wav&#39;: {&#39;type&#39;: &#39;audio&#39;, &#39;codec&#39;: [&#39;pcm_s16le&#39;, &#39;pcm_s24le&#39;, &#39;pcm_s32le&#39;]}, &#39;m4a&#39;: {&#39;type&#39;: &#39;audio&#39;, &#39;codec&#39;: [&#39;libfdk_aac&#39;]}}
<span class="w"> </span>for ext in [&#39;jpg&#39;, &#39;jpeg&#39;, &#39;png&#39;, &#39;bmp&#39;, &#39;tiff&#39;]:
<span class="gd">-    extensions_dict[ext] = {&#39;type&#39;: &#39;image&#39;}</span>
\ No newline at end of file
<span class="gi">+    extensions_dict[ext] = {&#39;type&#39;: &#39;image&#39;}</span>
<span class="gi">+</span>
<span class="gi">+def find_extension(codec):</span>
<span class="gi">+    &quot;&quot;&quot; Returns the extension associated with a codec.&quot;&quot;&quot;</span>
<span class="gi">+    if codec is None:</span>
<span class="gi">+        raise ValueError(&quot;Codec is None&quot;)</span>
<span class="gi">+        </span>
<span class="gi">+    for ext, props in extensions_dict.items():</span>
<span class="gi">+        if &#39;codec&#39; in props and codec in props[&#39;codec&#39;]:</span>
<span class="gi">+            return ext</span>
<span class="gi">+            </span>
<span class="gi">+    raise ValueError(f&quot;No extension found for codec {codec}&quot;)</span>
\ No newline at end of file
<span class="gh">diff --git a/moviepy/utils.py b/moviepy/utils.py</span>
<span class="gh">index a647626..6c5ff89 100644</span>
<span class="gd">--- a/moviepy/utils.py</span>
<span class="gi">+++ b/moviepy/utils.py</span>
<span class="gu">@@ -1,4 +1,20 @@</span>
<span class="w"> </span>from moviepy.audio.io.AudioFileClip import AudioFileClip
<span class="w"> </span>from moviepy.video.io.VideoFileClip import VideoFileClip
<span class="w"> </span>from moviepy.video.VideoClip import ImageClip
<span class="gd">-CLIP_TYPES = {&#39;audio&#39;: AudioFileClip, &#39;video&#39;: VideoFileClip, &#39;image&#39;: ImageClip}</span>
\ No newline at end of file
<span class="gi">+</span>
<span class="gi">+CLIP_TYPES = {&#39;audio&#39;: AudioFileClip, &#39;video&#39;: VideoFileClip, &#39;image&#39;: ImageClip}</span>
<span class="gi">+</span>
<span class="gi">+def close_all_clips(objects=None):</span>
<span class="gi">+    &quot;&quot;&quot;Closes all the clips that are passed as arguments or that exist in the global scope.</span>
<span class="gi">+    </span>
<span class="gi">+    This is useful to make sure that all files are closed when leaving a session.</span>
<span class="gi">+    &quot;&quot;&quot;</span>
<span class="gi">+    if objects is None:</span>
<span class="gi">+        objects = list(globals().values())</span>
<span class="gi">+    </span>
<span class="gi">+    if not isinstance(objects, (list, tuple)):</span>
<span class="gi">+        objects = [objects]</span>
<span class="gi">+    </span>
<span class="gi">+    for obj in objects:</span>
<span class="gi">+        if hasattr(obj, &#39;close&#39;):</span>
<span class="gi">+            obj.close()</span>
\ No newline at end of file
<span class="gh">diff --git a/moviepy/video/VideoClip.py b/moviepy/video/VideoClip.py</span>
<span class="gh">index c6694e2..765df74 100644</span>
<span class="gd">--- a/moviepy/video/VideoClip.py</span>
<span class="gi">+++ b/moviepy/video/VideoClip.py</span>
<span class="gu">@@ -95,7 +95,13 @@ class VideoClip(Clip):</span>
<span class="w"> </span>        the alpha layer of the picture (only works with PNGs).

<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        im = self.get_frame(t)</span>
<span class="gi">+        if withmask and self.mask is not None:</span>
<span class="gi">+            mask = 255 * self.mask.get_frame(t)</span>
<span class="gi">+            im = np.dstack([im, mask]).astype(&#39;uint8&#39;)</span>
<span class="gi">+        else:</span>
<span class="gi">+            im = im.astype(&quot;uint8&quot;)</span>
<span class="gi">+        imsave(filename, im)</span>

<span class="w"> </span>    @requires_duration
<span class="w"> </span>    @use_clip_fps_by_default
<span class="gu">@@ -212,7 +218,48 @@ class VideoClip(Clip):</span>
<span class="w"> </span>        &gt;&gt;&gt; clip.close()

<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        if codec is None:</span>
<span class="gi">+            name, ext = os.path.splitext(filename)</span>
<span class="gi">+            try:</span>
<span class="gi">+                codec = extensions_dict[ext[1:]][&#39;codec&#39;][0]</span>
<span class="gi">+            except:</span>
<span class="gi">+                raise ValueError(&quot;MoviePy couldn&#39;t find the codec associated &quot;</span>
<span class="gi">+                               &quot;with the filename. Provide the &#39;codec&#39; &quot;</span>
<span class="gi">+                               &quot;parameter in write_videofile.&quot;)</span>
<span class="gi">+</span>
<span class="gi">+        if audio_codec is None:</span>
<span class="gi">+            if codec == &#39;libx264&#39;:</span>
<span class="gi">+                audio_codec = &#39;aac&#39;</span>
<span class="gi">+            elif codec == &#39;libvpx&#39;:</span>
<span class="gi">+                audio_codec = &#39;libvorbis&#39;</span>
<span class="gi">+            else:</span>
<span class="gi">+                audio_codec = &#39;libmp3lame&#39;</span>
<span class="gi">+</span>
<span class="gi">+        if audio is True:</span>
<span class="gi">+            audio = self.audio</span>
<span class="gi">+</span>
<span class="gi">+        if audio is not None:</span>
<span class="gi">+            if temp_audiofile is None:</span>
<span class="gi">+                temp_audiofile = os.path.splitext(filename)[0] + &#39;_temp_audio.m4a&#39;</span>
<span class="gi">+</span>
<span class="gi">+            if not rewrite_audio and os.path.exists(temp_audiofile):</span>
<span class="gi">+                logger.info(&quot;Reusing existing audio file: %s&quot; % temp_audiofile)</span>
<span class="gi">+            else:</span>
<span class="gi">+                logger.info(&quot;Writing audio in %s&quot; % temp_audiofile)</span>
<span class="gi">+                audio.write_audiofile(temp_audiofile, audio_fps, audio_nbytes,</span>
<span class="gi">+                                    audio_bufsize, audio_codec, audio_bitrate,</span>
<span class="gi">+                                    write_logfile=write_logfile, verbose=verbose)</span>
<span class="gi">+</span>
<span class="gi">+        logger.info(&quot;Writing video in %s&quot; % filename)</span>
<span class="gi">+</span>
<span class="gi">+        ffmpeg_write_video(self, filename, fps, codec, bitrate, preset,</span>
<span class="gi">+                          write_logfile=write_logfile, audiofile=temp_audiofile,</span>
<span class="gi">+                          verbose=verbose, threads=threads,</span>
<span class="gi">+                          ffmpeg_params=ffmpeg_params, logger=logger)</span>
<span class="gi">+</span>
<span class="gi">+        if remove_temp and audio is not None:</span>
<span class="gi">+            if os.path.exists(temp_audiofile):</span>
<span class="gi">+                os.remove(temp_audiofile)</span>

<span class="w"> </span>    @requires_duration
<span class="w"> </span>    @use_clip_fps_by_default
<span class="gu">@@ -257,7 +304,31 @@ class VideoClip(Clip):</span>
<span class="w"> </span>        ``ImageSequenceClip``.

<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        logger = proglog.default_bar_logger(logger)</span>
<span class="gi">+        </span>
<span class="gi">+        # Create output directory if it doesn&#39;t exist</span>
<span class="gi">+        output_dir = os.path.dirname(nameformat)</span>
<span class="gi">+        if output_dir and not os.path.exists(output_dir):</span>
<span class="gi">+            os.makedirs(output_dir)</span>
<span class="gi">+            </span>
<span class="gi">+        # Get total number of frames</span>
<span class="gi">+        total_frames = int(self.duration * fps)</span>
<span class="gi">+        times = np.linspace(0, self.duration, total_frames + 1)[:-1]</span>
<span class="gi">+        </span>
<span class="gi">+        # Initialize list to store filenames</span>
<span class="gi">+        filenames = []</span>
<span class="gi">+        </span>
<span class="gi">+        logger.new_bar_segment(total_frames)</span>
<span class="gi">+        </span>
<span class="gi">+        for i, t in enumerate(times):</span>
<span class="gi">+            name = nameformat % i</span>
<span class="gi">+            filenames.append(name)</span>
<span class="gi">+            self.save_frame(name, t, withmask=withmask)</span>
<span class="gi">+            logger.bar_update(i)</span>
<span class="gi">+            </span>
<span class="gi">+        logger.bar_close()</span>
<span class="gi">+        </span>
<span class="gi">+        return filenames</span>

<span class="w"> </span>    @requires_duration
<span class="w"> </span>    @convert_masks_to_RGB
<span class="gu">@@ -312,7 +383,23 @@ class VideoClip(Clip):</span>
<span class="w"> </span>            &gt;&gt;&gt; myClip.speedx(0.5).to_gif(&#39;myClip.gif&#39;)

<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        if fps is None:</span>
<span class="gi">+            fps = self.fps</span>
<span class="gi">+</span>
<span class="gi">+        if fps is None:</span>
<span class="gi">+            raise ValueError(&quot;No fps attribute specified&quot;)</span>
<span class="gi">+</span>
<span class="gi">+        if program == &#39;imageio&#39;:</span>
<span class="gi">+            write_gif_with_image_io(self, filename, fps=fps, opt=opt, loop=loop,</span>
<span class="gi">+                                  verbose=verbose, colors=colors, logger=logger)</span>
<span class="gi">+        elif tempfiles:</span>
<span class="gi">+            write_gif_with_tempfiles(self, filename, fps=fps, program=program,</span>
<span class="gi">+                                   opt=opt, fuzz=fuzz, verbose=verbose,</span>
<span class="gi">+                                   dispose=dispose, colors=colors, logger=logger)</span>
<span class="gi">+        else:</span>
<span class="gi">+            write_gif(self, filename, fps=fps, program=program, opt=opt,</span>
<span class="gi">+                     fuzz=fuzz, verbose=verbose, dispose=dispose,</span>
<span class="gi">+                     colors=colors, logger=logger)</span>

<span class="w"> </span>    def subfx(self, fx, ta=0, tb=None, **kwargs):
<span class="w"> </span>        &quot;&quot;&quot;Apply a transformation to a part of the clip.
<span class="gu">@@ -329,14 +416,26 @@ class VideoClip(Clip):</span>
<span class="w"> </span>        &gt;&gt;&gt; newclip = clip.subapply(lambda c:c.speedx(0.5) , 3,6)

<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        left = None if ta == 0 else self.subclip(0, ta)</span>
<span class="gi">+        center = self.subclip(ta, tb).fx(fx, **kwargs)</span>
<span class="gi">+        right = None if tb is None else self.subclip(tb, self.duration)</span>
<span class="gi">+</span>
<span class="gi">+        clips = [c for c in [left, center, right] if c is not None]</span>
<span class="gi">+</span>
<span class="gi">+        # If there&#39;s only one clip (like when ta=0, tb=None), just return it</span>
<span class="gi">+        if len(clips) == 1:</span>
<span class="gi">+            return clips[0]</span>
<span class="gi">+</span>
<span class="gi">+        # Concatenate the clips</span>
<span class="gi">+        from moviepy.video.compositing.concatenate import concatenate_videoclips</span>
<span class="gi">+        return concatenate_videoclips(clips)</span>

<span class="w"> </span>    def fl_image(self, image_func, apply_to=None):
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Modifies the images of a clip by replacing the frame
<span class="w"> </span>        `get_frame(t)` by another frame,  `image_func(get_frame(t))`
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self.fl(lambda gf, t: image_func(gf(t)), apply_to=apply_to)</span>

<span class="w"> </span>    def blit_on(self, picture, t):
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -344,7 +443,35 @@ class VideoClip(Clip):</span>
<span class="w"> </span>        on the given `picture`, the position of the clip being given
<span class="w"> </span>        by the clip&#39;s ``pos`` attribute. Meant for compositing.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        hf, wf = framesize = picture.shape[:2]</span>
<span class="gi">+        </span>
<span class="gi">+        if self.ismask and picture.max() != 0:</span>
<span class="gi">+            return np.minimum(1, picture + self.blit_on(np.zeros(framesize), t))</span>
<span class="gi">+            </span>
<span class="gi">+        picture = picture.copy()</span>
<span class="gi">+        </span>
<span class="gi">+        # Get the current frame</span>
<span class="gi">+        img = self.get_frame(t)</span>
<span class="gi">+        mask = None</span>
<span class="gi">+        if self.mask is not None:</span>
<span class="gi">+            mask = self.mask.get_frame(t)</span>
<span class="gi">+            </span>
<span class="gi">+        hi, wi = img.shape[:2]</span>
<span class="gi">+        </span>
<span class="gi">+        # Get position of clip</span>
<span class="gi">+        pos = self.pos(t)</span>
<span class="gi">+        </span>
<span class="gi">+        # Convert relative position to absolute position</span>
<span class="gi">+        if self.relative_pos:</span>
<span class="gi">+            pos = (pos[0] * wf, pos[1] * hf)</span>
<span class="gi">+            </span>
<span class="gi">+        # Compute coordinates of clip in the final picture</span>
<span class="gi">+        xt, yt = int(pos[0]), int(pos[1])</span>
<span class="gi">+        </span>
<span class="gi">+        # Blit the clip onto the picture</span>
<span class="gi">+        blit(img, picture, xt, yt, mask=mask)</span>
<span class="gi">+        </span>
<span class="gi">+        return picture</span>

<span class="w"> </span>    def add_mask(self):
<span class="w"> </span>        &quot;&quot;&quot;Add a mask VideoClip to the VideoClip.
<span class="gu">@@ -356,7 +483,13 @@ class VideoClip(Clip):</span>
<span class="w"> </span>        Set ``constant_size`` to  `False` for clips with moving
<span class="w"> </span>        image size.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        if self.has_constant_size:</span>
<span class="gi">+            mask = ColorClip(self.size, 1.0, ismask=True)</span>
<span class="gi">+            return self.set_mask(mask.set_duration(self.duration))</span>
<span class="gi">+        else:</span>
<span class="gi">+            make_frame = lambda t: np.ones(self.get_frame(t).shape[:2], dtype=float)</span>
<span class="gi">+            mask = VideoClip(make_frame, ismask=True)</span>
<span class="gi">+            return self.set_mask(mask.set_duration(self.duration))</span>

<span class="w"> </span>    def on_color(self, size=None, color=(0, 0, 0), pos=None, col_opacity=None):
<span class="w"> </span>        &quot;&quot;&quot;Place the clip on a colored background.
<span class="gu">@@ -383,7 +516,29 @@ class VideoClip(Clip):</span>
<span class="w"> </span>          background.

<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        from moviepy.video.compositing.CompositeVideoClip import CompositeVideoClip</span>
<span class="gi">+        </span>
<span class="gi">+        if size is None:</span>
<span class="gi">+            size = self.size</span>
<span class="gi">+            </span>
<span class="gi">+        if pos is None:</span>
<span class="gi">+            pos = &#39;center&#39;</span>
<span class="gi">+            </span>
<span class="gi">+        colorclip = ColorClip(size, color)</span>
<span class="gi">+        </span>
<span class="gi">+        if col_opacity is not None:</span>
<span class="gi">+            colorclip = colorclip.set_opacity(col_opacity)</span>
<span class="gi">+            </span>
<span class="gi">+        if self.duration is not None:</span>
<span class="gi">+            colorclip = colorclip.set_duration(self.duration)</span>
<span class="gi">+            </span>
<span class="gi">+        result = CompositeVideoClip([colorclip, self.set_position(pos)],</span>
<span class="gi">+                                  transparent=(col_opacity is not None))</span>
<span class="gi">+                                  </span>
<span class="gi">+        if self.mask is not None:</span>
<span class="gi">+            return result.set_mask(self.mask)</span>
<span class="gi">+            </span>
<span class="gi">+        return result</span>

<span class="w"> </span>    @outplace
<span class="w"> </span>    def set_make_frame(self, mf):
<span class="gu">@@ -392,7 +547,9 @@ class VideoClip(Clip):</span>
<span class="w"> </span>        Returns a copy of the VideoClip instance, with the make_frame
<span class="w"> </span>        attribute set to `mf`.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        self.make_frame = mf</span>
<span class="gi">+        if hasattr(self, &#39;size&#39;):</span>
<span class="gi">+            del self.size</span>

<span class="w"> </span>    @outplace
<span class="w"> </span>    def set_audio(self, audioclip):
<span class="gu">@@ -401,7 +558,7 @@ class VideoClip(Clip):</span>
<span class="w"> </span>        Returns a copy of the VideoClip instance, with the `audio`
<span class="w"> </span>        attribute set to ``audio``, which must be an AudioClip instance.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        self.audio = audioclip</span>

<span class="w"> </span>    @outplace
<span class="w"> </span>    def set_mask(self, mask):
<span class="gu">@@ -409,7 +566,7 @@ class VideoClip(Clip):</span>

<span class="w"> </span>        Returns a copy of the VideoClip with the mask attribute set to
<span class="w"> </span>        ``mask``, which must be a greyscale (values in 0-1) VideoClip&quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        self.mask = mask</span>

<span class="w"> </span>    @add_mask_if_none
<span class="w"> </span>    @outplace
<span class="gu">@@ -419,7 +576,7 @@ class VideoClip(Clip):</span>
<span class="w"> </span>        Returns a semi-transparent copy of the clip where the mask is
<span class="w"> </span>        multiplied by ``op`` (any float, normally between 0 and 1).
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        self.mask = self.mask.fl_image(lambda pic: op * pic)</span>

<span class="w"> </span>    @apply_to_mask
<span class="w"> </span>    @outplace
<span class="gu">@@ -447,7 +604,12 @@ class VideoClip(Clip):</span>
<span class="w"> </span>        &gt;&gt;&gt; clip.set_position(lambda t: (&#39;center&#39;, 50+t) )

<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        self.relative_pos = relative</span>
<span class="gi">+        </span>
<span class="gi">+        if hasattr(pos, &#39;__call__&#39;):</span>
<span class="gi">+            self.pos = pos</span>
<span class="gi">+        else:</span>
<span class="gi">+            self.pos = lambda t: pos</span>

<span class="w"> </span>    @convert_to_seconds([&#39;t&#39;])
<span class="w"> </span>    def to_ImageClip(self, t=0, with_mask=True, duration=None):
<span class="gu">@@ -456,15 +618,30 @@ class VideoClip(Clip):</span>
<span class="w"> </span>        which can be expressed in seconds (15.35), in (min, sec),
<span class="w"> </span>        in (hour, min, sec), or as a string: &#39;01:03:05.35&#39;.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        newclip = ImageClip(self.get_frame(t), ismask=self.ismask)</span>
<span class="gi">+        if with_mask and self.mask is not None:</span>
<span class="gi">+            newclip.mask = ImageClip(self.mask.get_frame(t), ismask=True)</span>
<span class="gi">+        if duration is not None:</span>
<span class="gi">+            newclip.duration = duration</span>
<span class="gi">+        return newclip</span>

<span class="w"> </span>    def to_mask(self, canal=0):
<span class="w"> </span>        &quot;&quot;&quot;Return a mask a video clip made from the clip.&quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        if self.ismask:</span>
<span class="gi">+            return self</span>
<span class="gi">+        else:</span>
<span class="gi">+            newclip = self.fl_image(lambda pic: 1.0 * pic[:, :, canal] / 255)</span>
<span class="gi">+            newclip.ismask = True</span>
<span class="gi">+            return newclip</span>

<span class="w"> </span>    def to_RGB(self):
<span class="w"> </span>        &quot;&quot;&quot;Return a non-mask video clip made from the mask video clip.&quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        if self.ismask:</span>
<span class="gi">+            newclip = self.fl_image(lambda pic: np.dstack(3 * [255 * pic]))</span>
<span class="gi">+            newclip.ismask = False</span>
<span class="gi">+            return newclip</span>
<span class="gi">+        else:</span>
<span class="gi">+            return self</span>

<span class="w"> </span>    @outplace
<span class="w"> </span>    def without_audio(self):
<span class="gu">@@ -473,7 +650,7 @@ class VideoClip(Clip):</span>
<span class="w"> </span>        Return a copy of the clip with audio set to None.

<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        self.audio = None</span>

<span class="w"> </span>    @outplace
<span class="w"> </span>    def afx(self, fun, *a, **k):
<span class="gu">@@ -482,7 +659,7 @@ class VideoClip(Clip):</span>
<span class="w"> </span>        Return a new clip whose audio has been transformed by ``fun``.

<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        self.audio = fun(self.audio, *a, **k)</span>

<span class="w"> </span>class DataVideoClip(VideoClip):
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gu">@@ -592,6 +769,7 @@ class ImageClip(VideoClip):</span>
<span class="w"> </span>        VideoClip.__init__(self, ismask=ismask, duration=duration)
<span class="w"> </span>        if isinstance(img, string_types):
<span class="w"> </span>            img = imread(img)
<span class="gi">+            </span>
<span class="w"> </span>        if len(img.shape) == 3:
<span class="w"> </span>            if img.shape[2] == 4:
<span class="w"> </span>                if fromalpha:
<span class="gu">@@ -601,7 +779,26 @@ class ImageClip(VideoClip):</span>
<span class="w"> </span>                elif transparent:
<span class="w"> </span>                    self.mask = ImageClip(1.0 * img[:, :, 3] / 255, ismask=True)
<span class="w"> </span>                    img = img[:, :, :3]
<span class="gd">-            elif ismask:</span>
<span class="gi">+            elif ismask and img.shape[2] == 3:</span>
<span class="gi">+                img = img.mean(axis=2)</span>
<span class="gi">+                </span>
<span class="gi">+        # Convert to float</span>
<span class="gi">+        if img.dtype != &#39;float&#39;:</span>
<span class="gi">+            img = 1.0 * img / 255</span>
<span class="gi">+            </span>
<span class="gi">+        # Save the image and its size</span>
<span class="gi">+        self.img = img</span>
<span class="gi">+        self.size = self.img.shape[:2][::-1]</span>
<span class="gi">+        self.w, self.h = self.size</span>
<span class="gi">+        </span>
<span class="gi">+        # Generate a mask if required</span>
<span class="gi">+        if not ismask and transparent:</span>
<span class="gi">+            self.mask = ImageClip(np.ones(self.size[::-1]), ismask=True)</span>
<span class="gi">+            </span>
<span class="gi">+        def make_frame(t):</span>
<span class="gi">+            return self.img</span>
<span class="gi">+            </span>
<span class="gi">+        self.make_frame = make_frame</span>
<span class="w"> </span>                img = 1.0 * img[:, :, 0] / 255
<span class="w"> </span>        self.make_frame = lambda t: img
<span class="w"> </span>        self.size = img.shape[:2][::-1]
<span class="gh">diff --git a/moviepy/video/fx/resize.py b/moviepy/video/fx/resize.py</span>
<span class="gh">index 257d73f..54bb409 100644</span>
<span class="gd">--- a/moviepy/video/fx/resize.py</span>
<span class="gi">+++ b/moviepy/video/fx/resize.py</span>
<span class="gu">@@ -1,12 +1,23 @@</span>
<span class="w"> </span>resize_possible = True
<span class="gi">+resizer = None</span>
<span class="gi">+</span>
<span class="w"> </span>try:
<span class="w"> </span>    import cv2
<span class="w"> </span>    import numpy as np
<span class="gi">+    def cv2_resize(pic, newsize):</span>
<span class="gi">+        return cv2.resize(pic, tuple(map(int, newsize[::-1])))</span>
<span class="gi">+    resizer = cv2_resize</span>
<span class="w"> </span>    resizer.origin = &#39;cv2&#39;
<span class="w"> </span>except ImportError:
<span class="w"> </span>    try:
<span class="w"> </span>        from PIL import Image
<span class="w"> </span>        import numpy as np
<span class="gi">+        def pil_resize(pic, newsize):</span>
<span class="gi">+            newsize = tuple(map(int, newsize[::-1]))</span>
<span class="gi">+            img = Image.fromarray(pic)</span>
<span class="gi">+            img = img.resize(newsize, Image.BILINEAR)</span>
<span class="gi">+            return np.array(img)</span>
<span class="gi">+        resizer = pil_resize</span>
<span class="w"> </span>        resizer.origin = &#39;PIL&#39;
<span class="w"> </span>    except ImportError:
<span class="w"> </span>        try:
<span class="gu">@@ -47,7 +58,50 @@ def resize(clip, newsize=None, height=None, width=None, apply_to_mask=True):</span>
<span class="w"> </span>    &gt;&gt;&gt; myClip.resize(lambda t : 1+0.02*t) # slow swelling of the clip

<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    if not resize_possible:</span>
<span class="gi">+        raise ImportError(&quot;No module can be found for video resizing. Install either OpenCV or Pillow.&quot;)</span>
<span class="gi">+</span>
<span class="gi">+    if newsize is not None:</span>
<span class="gi">+        if hasattr(newsize, &#39;__call__&#39;):</span>
<span class="gi">+            def get_newsize(t):</span>
<span class="gi">+                ns = newsize(t)</span>
<span class="gi">+                if isinstance(ns, (int, float)):</span>
<span class="gi">+                    return [ns * clip.size[0], ns * clip.size[1]]</span>
<span class="gi">+                else:</span>
<span class="gi">+                    return ns</span>
<span class="gi">+            </span>
<span class="gi">+            newsize_aux = get_newsize</span>
<span class="gi">+        else:</span>
<span class="gi">+            if isinstance(newsize, (int, float)):</span>
<span class="gi">+                newsize = [newsize * clip.size[0], newsize * clip.size[1]]</span>
<span class="gi">+            </span>
<span class="gi">+            newsize_aux = lambda t: newsize</span>
<span class="gi">+</span>
<span class="gi">+    elif height is not None:</span>
<span class="gi">+        if hasattr(height, &#39;__call__&#39;):</span>
<span class="gi">+            newsize_aux = lambda t: [height(t) * clip.w / clip.h, height(t)]</span>
<span class="gi">+        else:</span>
<span class="gi">+            newsize_aux = lambda t: [height * clip.w / clip.h, height]</span>
<span class="gi">+</span>
<span class="gi">+    elif width is not None:</span>
<span class="gi">+        if hasattr(width, &#39;__call__&#39;):</span>
<span class="gi">+            newsize_aux = lambda t: [width(t), width(t) * clip.h / clip.w]</span>
<span class="gi">+        else:</span>
<span class="gi">+            newsize_aux = lambda t: [width, width * clip.h / clip.w]</span>
<span class="gi">+</span>
<span class="gi">+    else:</span>
<span class="gi">+        raise ValueError(&#39;No new size provided! Use newsize, height, or width.&#39;)</span>
<span class="gi">+</span>
<span class="gi">+    def transform(get_frame, t):</span>
<span class="gi">+        img = get_frame(t)</span>
<span class="gi">+        return resizer(img, newsize_aux(t))</span>
<span class="gi">+</span>
<span class="gi">+    newclip = clip.transform(transform, keep_duration=True)</span>
<span class="gi">+</span>
<span class="gi">+    if apply_to_mask and clip.mask is not None:</span>
<span class="gi">+        newclip.mask = resize(clip.mask, newsize, height, width, apply_to_mask=False)</span>
<span class="gi">+</span>
<span class="gi">+    return newclip</span>
<span class="w"> </span>if not resize_possible:
<span class="w"> </span>    doc = resize.__doc__
<span class="w"> </span>    resize.__doc__ = doc
\ No newline at end of file
<span class="gh">diff --git a/moviepy/video/tools/credits.py b/moviepy/video/tools/credits.py</span>
<span class="gh">index 3a97163..2bb9343 100644</span>
<span class="gd">--- a/moviepy/video/tools/credits.py</span>
<span class="gi">+++ b/moviepy/video/tools/credits.py</span>
<span class="gu">@@ -68,4 +68,89 @@ def credits1(creditfile, width, stretch=30, color=&#39;white&#39;, stroke_color=&#39;black&#39;,</span>
<span class="w"> </span>                Music Supervisor    JEAN DIDIER

<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
\ No newline at end of file
<span class="gi">+    # Parse the credit file</span>
<span class="gi">+    with open(creditfile) as f:</span>
<span class="gi">+        lines = f.readlines()</span>
<span class="gi">+</span>
<span class="gi">+    # Initialize variables</span>
<span class="gi">+    texts = []</span>
<span class="gi">+    current_job = None</span>
<span class="gi">+    current_names = []</span>
<span class="gi">+    total_height = 0</span>
<span class="gi">+    max_job_width = 0</span>
<span class="gi">+    max_name_width = 0</span>
<span class="gi">+</span>
<span class="gi">+    # Process each line</span>
<span class="gi">+    for line in lines:</span>
<span class="gi">+        line = line.strip()</span>
<span class="gi">+        </span>
<span class="gi">+        # Skip comments</span>
<span class="gi">+        if line.startswith(&#39;#&#39;):</span>
<span class="gi">+            continue</span>
<span class="gi">+            </span>
<span class="gi">+        # Handle blank lines</span>
<span class="gi">+        if line.startswith(&#39;.blank&#39;):</span>
<span class="gi">+            try:</span>
<span class="gi">+                n_blanks = int(line.split()[1])</span>
<span class="gi">+                total_height += n_blanks * fontsize</span>
<span class="gi">+            except:</span>
<span class="gi">+                total_height += fontsize</span>
<span class="gi">+            continue</span>
<span class="gi">+            </span>
<span class="gi">+        # Handle job titles</span>
<span class="gi">+        if line.startswith(&#39;..&#39;):</span>
<span class="gi">+            # Save previous job if exists</span>
<span class="gi">+            if current_job is not None:</span>
<span class="gi">+                job_clip = TextClip(current_job, font=font, fontsize=fontsize, color=color,</span>
<span class="gi">+                                  stroke_color=stroke_color, stroke_width=stroke_width)</span>
<span class="gi">+                max_job_width = max(max_job_width, job_clip.w)</span>
<span class="gi">+                </span>
<span class="gi">+                for name in current_names:</span>
<span class="gi">+                    name_clip = TextClip(name, font=font, fontsize=fontsize, color=color,</span>
<span class="gi">+                                       stroke_color=stroke_color, stroke_width=stroke_width)</span>
<span class="gi">+                    max_name_width = max(max_name_width, name_clip.w)</span>
<span class="gi">+                    texts.append((current_job, name))</span>
<span class="gi">+                    total_height += fontsize</span>
<span class="gi">+                </span>
<span class="gi">+            current_job = line[2:]</span>
<span class="gi">+            current_names = []</span>
<span class="gi">+            continue</span>
<span class="gi">+            </span>
<span class="gi">+        # Handle names</span>
<span class="gi">+        if current_job is not None and line:</span>
<span class="gi">+            current_names.append(line)</span>
<span class="gi">+            </span>
<span class="gi">+    # Add last job if exists</span>
<span class="gi">+    if current_job is not None:</span>
<span class="gi">+        job_clip = TextClip(current_job, font=font, fontsize=fontsize, color=color,</span>
<span class="gi">+                           stroke_color=stroke_color, stroke_width=stroke_width)</span>
<span class="gi">+        max_job_width = max(max_job_width, job_clip.w)</span>
<span class="gi">+        </span>
<span class="gi">+        for name in current_names:</span>
<span class="gi">+            name_clip = TextClip(name, font=font, fontsize=fontsize, color=color,</span>
<span class="gi">+                               stroke_color=stroke_color, stroke_width=stroke_width)</span>
<span class="gi">+            max_name_width = max(max_name_width, name_clip.w)</span>
<span class="gi">+            texts.append((current_job, name))</span>
<span class="gi">+            total_height += fontsize</span>
<span class="gi">+            </span>
<span class="gi">+    # Create clips for each text pair</span>
<span class="gi">+    clips = []</span>
<span class="gi">+    y = 0</span>
<span class="gi">+    </span>
<span class="gi">+    for job, name in texts:</span>
<span class="gi">+        # Create job clip</span>
<span class="gi">+        job_clip = TextClip(job, font=font, fontsize=fontsize, color=color,</span>
<span class="gi">+                           stroke_color=stroke_color, stroke_width=stroke_width)</span>
<span class="gi">+        job_clip = job_clip.set_position((&#39;right&#39;, y))</span>
<span class="gi">+        </span>
<span class="gi">+        # Create name clip</span>
<span class="gi">+        name_clip = TextClip(name, font=font, fontsize=fontsize, color=color,</span>
<span class="gi">+                            stroke_color=stroke_color, stroke_width=stroke_width)</span>
<span class="gi">+        name_clip = name_clip.set_position((job_clip.w + gap, y))</span>
<span class="gi">+        </span>
<span class="gi">+        clips.extend([job_clip, name_clip])</span>
<span class="gi">+        y += fontsize</span>
<span class="gi">+        </span>
<span class="gi">+    # Create final composite</span>
<span class="gi">+    final_clip = CompositeVideoClip(clips, size=(width, total_height))</span>
<span class="gi">+    return final_clip</span>
\ No newline at end of file
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d6f25eb3.min.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../javascripts/tablesort.js"></script>
      
        <script src="../javascripts/tablesort.number.js"></script>
      
    
  </body>
</html>