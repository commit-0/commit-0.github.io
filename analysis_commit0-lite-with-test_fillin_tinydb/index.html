
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.37">
    
    
      
        <title>Analysis commit0 lite with test fillin tinydb - Commit-0</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8c3ca2c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#claude-sonnet-35-fill-in-unit-test-feedback-tinydb" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Commit-0" class="md-header__button md-logo" aria-label="Commit-0" data-md-component="logo">
      
  <img src="../logo2.webp" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Commit-0
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Analysis commit0 lite with test fillin tinydb
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Commit-0" class="md-nav__button md-logo" aria-label="Commit-0" data-md-component="logo">
      
  <img src="../logo2.webp" alt="logo">

    </a>
    Commit-0
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../setupdist/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Commit0
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Agent
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Leaderboard
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pytest-summary-for-test-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Pytest Summary for test tests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#failed-pytests" class="md-nav__link">
    <span class="md-ellipsis">
      Failed pytests:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Failed pytests:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test_middlewarespytest_caching_read" class="md-nav__link">
    <span class="md-ellipsis">
      test_middlewares.py::test_caching_read
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_middlewarespytest_caching_write" class="md-nav__link">
    <span class="md-ellipsis">
      test_middlewares.py::test_caching_write
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_middlewarespytest_caching_json_write" class="md-nav__link">
    <span class="md-ellipsis">
      test_middlewares.py::test_caching_json_write
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_operationspytest_delete" class="md-nav__link">
    <span class="md-ellipsis">
      test_operations.py::test_delete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_operationspytest_add_intmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_operations.py::test_add_int[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_operationspytest_add_intjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_operations.py::test_add_int[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_operationspytest_add_strmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_operations.py::test_add_str[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_operationspytest_add_strjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_operations.py::test_add_str[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_operationspytest_subtractmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_operations.py::test_subtract[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_operationspytest_subtractjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_operations.py::test_subtract[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_operationspytest_setmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_operations.py::test_set[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_operationspytest_setjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_operations.py::test_set[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_operationspytest_incrementmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_operations.py::test_increment[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_operationspytest_incrementjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_operations.py::test_increment[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_operationspytest_decrementmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_operations.py::test_decrement[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_operationspytest_decrementjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_operations.py::test_decrement[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_no_path" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_no_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_path_exists" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_path_exists
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_path_and" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_path_and
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_callable_in_path_with_map" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_callable_in_path_with_map
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_callable_in_path_with_chain" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_callable_in_path_with_chain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_eq" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_eq
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_ne" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_ne
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_lt" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_lt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_le" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_le
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_gt" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_gt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_ge" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_ge
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_or" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_or
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_and" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_and
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_not" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_not
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_has_key" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_has_key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_regex" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_regex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_custom" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_custom
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_custom_with_params" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_custom_with_params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_any" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_any
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_all" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_all
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_has" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_has
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_one_of" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_one_of
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_hash" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_hash
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_orm_usage" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_orm_usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_repr" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_repr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_subclass" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_subclass
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_equality" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_equality
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_fragment" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_fragment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_fragment_with_path" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_fragment_with_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_queriespytest_get_item" class="md-nav__link">
    <span class="md-ellipsis">
      test_queries.py::test_get_item
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_storagespytest_json_kwargs" class="md-nav__link">
    <span class="md-ellipsis">
      test_storages.py::test_json_kwargs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_storagespytest_json_readwrite" class="md-nav__link">
    <span class="md-ellipsis">
      test_storages.py::test_json_readwrite
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_storagespytest_json_read" class="md-nav__link">
    <span class="md-ellipsis">
      test_storages.py::test_json_read
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_storagespytest_in_memory_close" class="md-nav__link">
    <span class="md-ellipsis">
      test_storages.py::test_in_memory_close
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_storagespytest_read_once" class="md-nav__link">
    <span class="md-ellipsis">
      test_storages.py::test_read_once
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_storagespytest_yaml" class="md-nav__link">
    <span class="md-ellipsis">
      test_storages.py::test_yaml
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_storagespytest_encoding" class="md-nav__link">
    <span class="md-ellipsis">
      test_storages.py::test_encoding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tablespytest_next_idmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tables.py::test_next_id[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tablespytest_next_idjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tables.py::test_next_id[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tablespytest_tables_listmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tables.py::test_tables_list[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tablespytest_tables_listjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tables.py::test_tables_list[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tablespytest_one_tablememory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tables.py::test_one_table[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tablespytest_one_tablejson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tables.py::test_one_table[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tablespytest_multiple_tablesmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tables.py::test_multiple_tables[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tablespytest_multiple_tablesjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tables.py::test_multiple_tables[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tablespytest_query_cachememory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tables.py::test_query_cache[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tablespytest_query_cachejson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tables.py::test_query_cache[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tablespytest_query_cache_with_mutable_callablememory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tables.py::test_query_cache_with_mutable_callable[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tablespytest_query_cache_with_mutable_callablejson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tables.py::test_query_cache_with_mutable_callable[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tablespytest_zero_cache_sizememory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tables.py::test_zero_cache_size[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tablespytest_zero_cache_sizejson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tables.py::test_zero_cache_size[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tablespytest_query_cache_sizememory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tables.py::test_query_cache_size[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tablespytest_query_cache_sizejson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tables.py::test_query_cache_size[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tablespytest_lru_cachememory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tables.py::test_lru_cache[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tablespytest_lru_cachejson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tables.py::test_lru_cache[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tablespytest_truncate_tablememory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tables.py::test_truncate_table[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tablespytest_truncate_tablejson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tables.py::test_truncate_table[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_drop_tablesmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_drop_tables[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_drop_tablesjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_drop_tables[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_insertmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_insert[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_insertjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_insert[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_insert_idsmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_insert_ids[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_insert_idsjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_insert_ids[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_insert_with_doc_idmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_insert_with_doc_id[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_insert_with_doc_idjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_insert_with_doc_id[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_insert_with_duplicate_doc_idmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_insert_with_duplicate_doc_id[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_insert_with_duplicate_doc_idjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_insert_with_duplicate_doc_id[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_insert_multiplememory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_insert_multiple[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_insert_multiplejson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_insert_multiple[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_insert_multiple_with_idsmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_insert_multiple_with_ids[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_insert_multiple_with_idsjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_insert_multiple_with_ids[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_insert_multiple_with_doc_idsmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_insert_multiple_with_doc_ids[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_insert_multiple_with_doc_idsjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_insert_multiple_with_doc_ids[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_insert_invalid_type_raises_errormemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_insert_invalid_type_raises_error[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_insert_invalid_type_raises_errorjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_insert_invalid_type_raises_error[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_insert_valid_mapping_typememory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_insert_valid_mapping_type[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_insert_valid_mapping_typejson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_insert_valid_mapping_type[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_custom_mapping_type_with_json" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_custom_mapping_type_with_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_removememory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_remove[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_removejson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_remove[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_remove_all_failsmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_remove_all_fails[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_remove_all_failsjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_remove_all_fails[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_remove_multiplememory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_remove_multiple[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_remove_multiplejson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_remove_multiple[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_remove_idsmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_remove_ids[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_remove_idsjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_remove_ids[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_remove_returns_idsmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_remove_returns_ids[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_remove_returns_idsjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_remove_returns_ids[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_updatememory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_update[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_updatejson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_update[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_update_allmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_update_all[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_update_alljson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_update_all[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_update_returns_idsmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_update_returns_ids[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_update_returns_idsjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_update_returns_ids[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_update_transformmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_update_transform[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_update_transformjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_update_transform[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_update_idsmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_update_ids[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_update_idsjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_update_ids[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_update_multiplememory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_update_multiple[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_update_multiplejson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_update_multiple[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_update_multiple_operationmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_update_multiple_operation[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_update_multiple_operationjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_update_multiple_operation[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_upsertmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_upsert[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_upsertjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_upsert[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_upsert_by_idmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_upsert_by_id[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_upsert_by_idjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_upsert_by_id[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_searchmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_search[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_searchjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_search[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_search_pathmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_search_path[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_search_pathjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_search_path[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_search_no_results_cachememory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_search_no_results_cache[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_search_no_results_cachejson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_search_no_results_cache[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_getmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_get[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_getjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_get[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_get_idsjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_get_ids[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_get_multiple_idsjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_get_multiple_ids[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_get_invalidmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_get_invalid[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_get_invalidjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_get_invalid[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_countmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_count[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_countjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_count[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_containsmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_contains[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_containsjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_contains[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_contains_idsjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_contains_ids[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_contains_invalidmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_contains_invalid[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_contains_invalidjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_contains_invalid[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_get_idempotentmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_get_idempotent[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_get_idempotentjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_get_idempotent[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_multiple_dbs" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_multiple_dbs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_storage_closed_once" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_storage_closed_once
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_unique_ids" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_unique_ids
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_lastid_after_open" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_lastid_after_open
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_doc_ids_json" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_doc_ids_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_insert_string" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_insert_string
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_insert_invalid_dict" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_insert_invalid_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_gc" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_gc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_drop_table" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_drop_table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_query_cache" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_query_cache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_tinydb_is_iterablememory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_tinydb_is_iterable[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_tinydb_is_iterablejson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_tinydb_is_iterable[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_repr" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_repr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_delete" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_delete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_insert_multiple_with_single_dictmemory" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_insert_multiple_with_single_dict[memory]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_insert_multiple_with_single_dictjson" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_insert_multiple_with_single_dict[json]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_empty_db_len" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_empty_db_len
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_insert_on_existing_db" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_insert_on_existing_db
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_tinydbpytest_lambda_query" class="md-nav__link">
    <span class="md-ellipsis">
      test_tinydb.py::test_lambda_query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_utilspytest_lru_cache" class="md-nav__link">
    <span class="md-ellipsis">
      test_utils.py::test_lru_cache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_utilspytest_lru_cache_set_multiple" class="md-nav__link">
    <span class="md-ellipsis">
      test_utils.py::test_lru_cache_set_multiple
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_utilspytest_lru_cache_get" class="md-nav__link">
    <span class="md-ellipsis">
      test_utils.py::test_lru_cache_get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_utilspytest_lru_cache_delete" class="md-nav__link">
    <span class="md-ellipsis">
      test_utils.py::test_lru_cache_delete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_utilspytest_lru_cache_clear" class="md-nav__link">
    <span class="md-ellipsis">
      test_utils.py::test_lru_cache_clear
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_utilspytest_lru_cache_unlimited" class="md-nav__link">
    <span class="md-ellipsis">
      test_utils.py::test_lru_cache_unlimited
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_utilspytest_lru_cache_unlimited_explicit" class="md-nav__link">
    <span class="md-ellipsis">
      test_utils.py::test_lru_cache_unlimited_explicit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test_utilspytest_freeze" class="md-nav__link">
    <span class="md-ellipsis">
      test_utils.py::test_freeze
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patch-diff" class="md-nav__link">
    <span class="md-ellipsis">
      Patch diff
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<p><a href="/analysis_commit0-lite-with-test_fillin">back to Claude Sonnet 3.5 - Fill-in + Unit Test Feedback summary</a></p>
<h1 id="claude-sonnet-35-fill-in-unit-test-feedback-tinydb"><strong>Claude Sonnet 3.5 - Fill-in + Unit Test Feedback</strong>: tinydb</h1>
<h2 id="pytest-summary-for-test-tests">Pytest Summary for test <code>tests</code></h2>
<table>
<thead>
<tr>
<th style="text-align: left;">status</th>
<th style="text-align: center;">count</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">passed</td>
<td style="text-align: center;">30</td>
</tr>
<tr>
<td style="text-align: left;">failed</td>
<td style="text-align: center;">170</td>
</tr>
<tr>
<td style="text-align: left;">total</td>
<td style="text-align: center;">200</td>
</tr>
<tr>
<td style="text-align: left;">collected</td>
<td style="text-align: center;">200</td>
</tr>
</tbody>
</table>
<h2 id="failed-pytests">Failed pytests:</h2>
<h3 id="test_middlewarespytest_caching_read">test_middlewares.py::test_caching_read</h3>
<details><summary> <pre>test_middlewares.py::test_caching_read</pre></summary><pre>
def test_caching_read():
        db = TinyDB(storage=CachingMiddleware(MemoryStorage))
>       assert db.all() == []

tests/test_middlewares.py:23: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/table.py:128: in all
    for doc_id, doc in self._read_table().items()]
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <[AttributeError("'NoneType' object has no attribute 'get'") raised in repr()] Table object at 0x7fa29e23c5e0>

    def _read_table(self) ->Dict[str, Mapping]:
        """
        Read the table data from the underlying storage.

        Documents and doc_ids are NOT yet transformed, as
        we may not want to convert *all* documents when returning
        only one document for example.
        """
        data = self._storage.read()
>       return data.get(self._name, {})
E       AttributeError: 'NoneType' object has no attribute 'get'

tinydb/table.py:354: AttributeError
</pre>
</details>
<h3 id="test_middlewarespytest_caching_write">test_middlewares.py::test_caching_write</h3>
<details><summary> <pre>test_middlewares.py::test_caching_write</pre></summary><pre>
storage = <tinydb.middlewares.CachingMiddleware object at 0x7fa29f676350>

    def test_caching_write(storage):
        # Write contents
        storage.write(doc)

        storage.close()

        # Verify contents: Cache should be emptied and written to storage
>       assert storage.storage.memory
E       assert None
E        +  where None = <tinydb.storages.MemoryStorage object at 0x7fa29f6750f0>.memory
E        +    where <tinydb.storages.MemoryStorage object at 0x7fa29f6750f0> = <tinydb.middlewares.CachingMiddleware object at 0x7fa29f676350>.storage

tests/test_middlewares.py:74: AssertionError
</pre>
</details>
<h3 id="test_middlewarespytest_caching_json_write">test_middlewares.py::test_caching_json_write</h3>
<details><summary> <pre>test_middlewares.py::test_caching_json_write</pre></summary><pre>
tmpdir = local('/tmp/pytest-of-root/pytest-0/test_caching_json_write0')

    def test_caching_json_write(tmpdir):
        path = str(tmpdir.join('test.db'))

        with TinyDB(path, storage=CachingMiddleware(JSONStorage)) as db:
>           db.insert({'key': 'value'})

tests/test_middlewares.py:92: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/table.py:99: in insert
    doc_id = self._get_next_id()
tinydb/table.py:340: in _get_next_id
    self._next_id = max(self._read_table().keys() or [0]) + 1
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <[ValueError('I/O operation on closed file.') raised in repr()] Table object at 0x7fa29f9418a0>

    def _read_table(self) ->Dict[str, Mapping]:
        """
        Read the table data from the underlying storage.

        Documents and doc_ids are NOT yet transformed, as
        we may not want to convert *all* documents when returning
        only one document for example.
        """
        data = self._storage.read()
>       return data.get(self._name, {})
E       AttributeError: 'NoneType' object has no attribute 'get'

tinydb/table.py:354: AttributeError
</pre>
</details>
<h3 id="test_operationspytest_delete">test_operations.py::test_delete</h3>
<details><summary> <pre>test_operations.py::test_delete</pre></summary><pre>
def test_delete():
        db = TinyDB(storage=MemoryStorage)
>       db.insert({'char': 'a', 'int': 1})

tests/test_operations.py:8: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/table.py:99: in insert
    doc_id = self._get_next_id()
tinydb/table.py:340: in _get_next_id
    self._next_id = max(self._read_table().keys() or [0]) + 1
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <[AttributeError("'NoneType' object has no attribute 'get'") raised in repr()] Table object at 0x7fa29e24d090>

    def _read_table(self) ->Dict[str, Mapping]:
        """
        Read the table data from the underlying storage.

        Documents and doc_ids are NOT yet transformed, as
        we may not want to convert *all* documents when returning
        only one document for example.
        """
        data = self._storage.read()
>       return data.get(self._name, {})
E       AttributeError: 'NoneType' object has no attribute 'get'

tinydb/table.py:354: AttributeError
</pre>
</details>
<h3 id="test_operationspytest_add_intmemory">test_operations.py::test_add_int[memory]</h3>
<details><summary> <pre>test_operations.py::test_add_int[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29f949ba0>

    def test_add_int(db):
>       db.update(add('int', 5), where('char') == 'a')

tests/test_operations.py:14: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_operationspytest_add_intjson">test_operations.py::test_add_int[json]</h3>
<details><summary> <pre>test_operations.py::test_add_int[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29fab5210>

    def test_add_int(db):
>       db.update(add('int', 5), where('char') == 'a')

tests/test_operations.py:14: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_operationspytest_add_strmemory">test_operations.py::test_add_str[memory]</h3>
<details><summary> <pre>test_operations.py::test_add_str[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e3d3c40>

    def test_add_str(db):
>       db.update(add('char', 'xyz'), where('char') == 'a')

tests/test_operations.py:19: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_operationspytest_add_strjson">test_operations.py::test_add_str[json]</h3>
<details><summary> <pre>test_operations.py::test_add_str[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29dfda740>

    def test_add_str(db):
>       db.update(add('char', 'xyz'), where('char') == 'a')

tests/test_operations.py:19: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_operationspytest_subtractmemory">test_operations.py::test_subtract[memory]</h3>
<details><summary> <pre>test_operations.py::test_subtract[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29deb7e80>

    def test_subtract(db):
>       db.update(subtract('int', 5), where('char') == 'a')

tests/test_operations.py:24: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_operationspytest_subtractjson">test_operations.py::test_subtract[json]</h3>
<details><summary> <pre>test_operations.py::test_subtract[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29df73af0>

    def test_subtract(db):
>       db.update(subtract('int', 5), where('char') == 'a')

tests/test_operations.py:24: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_operationspytest_setmemory">test_operations.py::test_set[memory]</h3>
<details><summary> <pre>test_operations.py::test_set[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29f2d3f70>

    def test_set(db):
>       db.update(set('char', 'xyz'), where('char') == 'a')

tests/test_operations.py:29: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_operationspytest_setjson">test_operations.py::test_set[json]</h3>
<details><summary> <pre>test_operations.py::test_set[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29deb5de0>

    def test_set(db):
>       db.update(set('char', 'xyz'), where('char') == 'a')

tests/test_operations.py:29: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_operationspytest_incrementmemory">test_operations.py::test_increment[memory]</h3>
<details><summary> <pre>test_operations.py::test_increment[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e2c3880>

    def test_increment(db):
>       db.update(increment('int'), where('char') == 'a')

tests/test_operations.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_operationspytest_incrementjson">test_operations.py::test_increment[json]</h3>
<details><summary> <pre>test_operations.py::test_increment[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29df1fc10>

    def test_increment(db):
>       db.update(increment('int'), where('char') == 'a')

tests/test_operations.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_operationspytest_decrementmemory">test_operations.py::test_decrement[memory]</h3>
<details><summary> <pre>test_operations.py::test_decrement[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e03bb50>

    def test_decrement(db):
>       db.update(decrement('int'), where('char') == 'a')

tests/test_operations.py:39: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_operationspytest_decrementjson">test_operations.py::test_decrement[json]</h3>
<details><summary> <pre>test_operations.py::test_decrement[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e017c70>

    def test_decrement(db):
>       db.update(decrement('int'), where('char') == 'a')

tests/test_operations.py:39: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_no_path">test_queries.py::test_no_path</h3>
<details><summary> <pre>test_queries.py::test_no_path</pre></summary><pre>
def test_no_path():
        with pytest.raises(ValueError):
>           _ = Query() == 2

tests/test_queries.py:10: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:205: in __eq__
    return self._generate_test(lambda value: value == rhs, ('==', self.
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = Query()
test = <function Query.__eq__.<locals>.<lambda> at 0x7fa29de3e950>
hashval = ('==', (), None), allow_empty_path = False

    def _generate_test(self, test: Callable[[Any], bool], hashval: Tuple,
        allow_empty_path: bool=False) ->QueryInstance:
        """
        Generate a query based on a test function that first resolves the query
        path.

        :param test: The test the query executes.
        :param hashval: The hash of the query.
        :return: A :class:`~tinydb.queries.QueryInstance` object
        """
        if not self._path and not allow_empty_path:
>           raise RuntimeError('Query has no path')
E           RuntimeError: Query has no path

tinydb/queries.py:185: RuntimeError
</pre>
</details>
<h3 id="test_queriespytest_path_exists">test_queries.py::test_path_exists</h3>
<details><summary> <pre>test_queries.py::test_path_exists</pre></summary><pre>
def test_path_exists():
>       query = Query()['value'].exists()

tests/test_queries.py:14: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_path_and">test_queries.py::test_path_and</h3>
<details><summary> <pre>test_queries.py::test_path_and</pre></summary><pre>
def test_path_and():
>       query = Query()['value'].exists() & (Query()['value'] == 5)

tests/test_queries.py:32: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_callable_in_path_with_map">test_queries.py::test_callable_in_path_with_map</h3>
<details><summary> <pre>test_queries.py::test_callable_in_path_with_map</pre></summary><pre>
def test_callable_in_path_with_map():
        double = lambda x: x + x
>       query = Query().value.map(double) == 10

tests/test_queries.py:42: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_callable_in_path_with_chain">test_queries.py::test_callable_in_path_with_chain</h3>
<details><summary> <pre>test_queries.py::test_callable_in_path_with_chain</pre></summary><pre>
def test_callable_in_path_with_chain():
        rekey = lambda x: {'y': x['a'], 'z': x['b']}
>       query = Query().map(rekey).z == 10

tests/test_queries.py:49: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:411: in map
    query._hash = ('map', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_eq">test_queries.py::test_eq</h3>
<details><summary> <pre>test_queries.py::test_eq</pre></summary><pre>
def test_eq():
>       query = Query().value == 1

tests/test_queries.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_ne">test_queries.py::test_ne</h3>
<details><summary> <pre>test_queries.py::test_ne</pre></summary><pre>
def test_ne():
>       query = Query().value != 1

tests/test_queries.py:66: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_lt">test_queries.py::test_lt</h3>
<details><summary> <pre>test_queries.py::test_lt</pre></summary><pre>
def test_lt():
>       query = Query().value < 1

tests/test_queries.py:79: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_le">test_queries.py::test_le</h3>
<details><summary> <pre>test_queries.py::test_le</pre></summary><pre>
def test_le():
>       query = Query().value <= 1

tests/test_queries.py:87: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_gt">test_queries.py::test_gt</h3>
<details><summary> <pre>test_queries.py::test_gt</pre></summary><pre>
def test_gt():
>       query = Query().value > 1

tests/test_queries.py:95: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_ge">test_queries.py::test_ge</h3>
<details><summary> <pre>test_queries.py::test_ge</pre></summary><pre>
def test_ge():
>       query = Query().value >= 1

tests/test_queries.py:102: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_or">test_queries.py::test_or</h3>
<details><summary> <pre>test_queries.py::test_or</pre></summary><pre>
def test_or():
        query = (
>               (Query().val1 == 1) |
                (Query().val2 == 2)
        )

tests/test_queries.py:111: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_and">test_queries.py::test_and</h3>
<details><summary> <pre>test_queries.py::test_and</pre></summary><pre>
def test_and():
        query = (
>               (Query().val1 == 1) &
                (Query().val2 == 2)
        )

tests/test_queries.py:123: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_not">test_queries.py::test_not</h3>
<details><summary> <pre>test_queries.py::test_not</pre></summary><pre>
def test_not():
>       query = ~ (Query().val1 == 1)

tests/test_queries.py:134: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_has_key">test_queries.py::test_has_key</h3>
<details><summary> <pre>test_queries.py::test_has_key</pre></summary><pre>
def test_has_key():
>       query = Query().val3.exists()

tests/test_queries.py:152: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_regex">test_queries.py::test_regex</h3>
<details><summary> <pre>test_queries.py::test_regex</pre></summary><pre>
def test_regex():
>       query = Query().val.matches(r'\d{2}\.')

tests/test_queries.py:160: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_custom">test_queries.py::test_custom</h3>
<details><summary> <pre>test_queries.py::test_custom</pre></summary><pre>
def test_custom():
        def test(value):
            return value == 42

>       query = Query().val.test(test)

tests/test_queries.py:192: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_custom_with_params">test_queries.py::test_custom_with_params</h3>
<details><summary> <pre>test_queries.py::test_custom_with_params</pre></summary><pre>
def test_custom_with_params():
        def test(value, minimum, maximum):
            return minimum <= value <= maximum

>       query = Query().val.test(test, 1, 10)

tests/test_queries.py:216: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_any">test_queries.py::test_any</h3>
<details><summary> <pre>test_queries.py::test_any</pre></summary><pre>
def test_any():
>       query = Query().followers.any(Query().name == 'don')

tests/test_queries.py:226: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_all">test_queries.py::test_all</h3>
<details><summary> <pre>test_queries.py::test_all</pre></summary><pre>
def test_all():
>       query = Query().followers.all(Query().name == 'don')

tests/test_queries.py:251: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_has">test_queries.py::test_has</h3>
<details><summary> <pre>test_queries.py::test_has</pre></summary><pre>
def test_has():
>       query = Query().key1.key2.exists()

tests/test_queries.py:277: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_one_of">test_queries.py::test_one_of</h3>
<details><summary> <pre>test_queries.py::test_one_of</pre></summary><pre>
def test_one_of():
>       query = Query().key1.one_of(['value 1', 'value 2'])

tests/test_queries.py:345: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_hash">test_queries.py::test_hash</h3>
<details><summary> <pre>test_queries.py::test_hash</pre></summary><pre>
def test_hash():
        d = {
>           Query().key1 == 2: True,
            Query().key1.key2.key3.exists(): True,
            Query().key1.exists() & Query().key2.exists(): True,
            Query().key1.exists() | Query().key2.exists(): True,
        }

tests/test_queries.py:353: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_orm_usage">test_queries.py::test_orm_usage</h3>
<details><summary> <pre>test_queries.py::test_orm_usage</pre></summary><pre>
def test_orm_usage():
        data = {'name': 'John', 'age': {'year': 2000}}

        User = Query()
>       query1 = User.name == 'John'

tests/test_queries.py:374: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_repr">test_queries.py::test_repr</h3>
<details><summary> <pre>test_queries.py::test_repr</pre></summary><pre>
def test_repr():
        Fruit = Query()

        assert repr(Fruit) == "Query()"
>       assert repr(Fruit.type == 'peach') == "QueryImpl('==', ('type',), 'peach')"

tests/test_queries.py:384: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_subclass">test_queries.py::test_subclass</h3>
<details><summary> <pre>test_queries.py::test_subclass</pre></summary><pre>
def test_subclass():
        # Test that a new query test method in a custom subclass is properly usable
        class MyQueryClass(Query):
            def equal_double(self, rhs):
                return self._generate_test(
                    lambda value: value == rhs * 2,
                    ('equal_double', self._path, rhs)
                )

>       query = MyQueryClass().val.equal_double('42')

tests/test_queries.py:396: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_equality">test_queries.py::test_equality</h3>
<details><summary> <pre>test_queries.py::test_equality</pre></summary><pre>
def test_equality():
        q = Query()
>       assert (q.foo == 2) != 0

tests/test_queries.py:414: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_fragment">test_queries.py::test_fragment</h3>
<details><summary> <pre>test_queries.py::test_fragment</pre></summary><pre>
def test_fragment():
>       query = Query().fragment({'a': 4, 'b': True})

tests/test_queries.py:424: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_fragment_with_path">test_queries.py::test_fragment_with_path</h3>
<details><summary> <pre>test_queries.py::test_fragment_with_path</pre></summary><pre>
def test_fragment_with_path():
>       query = Query().doc.fragment({'a': 4, 'b': True})

tests/test_queries.py:434: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_queriespytest_get_item">test_queries.py::test_get_item</h3>
<details><summary> <pre>test_queries.py::test_get_item</pre></summary><pre>
def test_get_item():
>       query = Query()['test'] == 1

tests/test_queries.py:442: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_storagespytest_json_kwargs">test_storages.py::test_json_kwargs</h3>
<details><summary> <pre>test_storages.py::test_json_kwargs</pre></summary><pre>
tmpdir = local('/tmp/pytest-of-root/pytest-0/test_json_kwargs0')

    def test_json_kwargs(tmpdir):
        db_file = tmpdir.join('test.db')
        db = TinyDB(str(db_file), sort_keys=True, indent=4, separators=(',', ': '))

        # Write contents
>       db.insert({'b': 1})

tests/test_storages.py:36: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/table.py:99: in insert
    doc_id = self._get_next_id()
tinydb/table.py:340: in _get_next_id
    self._next_id = max(self._read_table().keys() or [0]) + 1
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <[AttributeError("'NoneType' object has no attribute 'get'") raised in repr()] Table object at 0x7fa29e23f3a0>

    def _read_table(self) ->Dict[str, Mapping]:
        """
        Read the table data from the underlying storage.

        Documents and doc_ids are NOT yet transformed, as
        we may not want to convert *all* documents when returning
        only one document for example.
        """
        data = self._storage.read()
>       return data.get(self._name, {})
E       AttributeError: 'NoneType' object has no attribute 'get'

tinydb/table.py:354: AttributeError
</pre>
</details>
<h3 id="test_storagespytest_json_readwrite">test_storages.py::test_json_readwrite</h3>
<details><summary> <pre>test_storages.py::test_json_readwrite</pre></summary><pre>
tmpdir = local('/tmp/pytest-of-root/pytest-0/test_json_readwrite0')

    def test_json_readwrite(tmpdir):
        """
        Regression test for issue #1
        """
        path = str(tmpdir.join('test.db'))

        # Create TinyDB instance
        db = TinyDB(path, storage=JSONStorage)

        item = {'name': 'A very long entry'}
        item2 = {'name': 'A short one'}

        def get(s):
            return db.get(where('name') == s)

>       db.insert(item)

tests/test_storages.py:67: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/table.py:99: in insert
    doc_id = self._get_next_id()
tinydb/table.py:340: in _get_next_id
    self._next_id = max(self._read_table().keys() or [0]) + 1
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <[AttributeError("'NoneType' object has no attribute 'get'") raised in repr()] Table object at 0x7fa29de55930>

    def _read_table(self) ->Dict[str, Mapping]:
        """
        Read the table data from the underlying storage.

        Documents and doc_ids are NOT yet transformed, as
        we may not want to convert *all* documents when returning
        only one document for example.
        """
        data = self._storage.read()
>       return data.get(self._name, {})
E       AttributeError: 'NoneType' object has no attribute 'get'

tinydb/table.py:354: AttributeError
</pre>
</details>
<h3 id="test_storagespytest_json_read">test_storages.py::test_json_read</h3>
<details><summary> <pre>test_storages.py::test_json_read</pre></summary><pre>
tmpdir = local('/tmp/pytest-of-root/pytest-0/test_json_read0')

    def test_json_read(tmpdir):
        r"""Open a database only for reading"""
        path = str(tmpdir.join('test.db'))
        with pytest.raises(FileNotFoundError):
            db = TinyDB(path, storage=JSONStorage, access_mode='r')
        # Create small database
        db = TinyDB(path, storage=JSONStorage)
>       db.insert({'b': 1})

tests/test_storages.py:89: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/table.py:99: in insert
    doc_id = self._get_next_id()
tinydb/table.py:340: in _get_next_id
    self._next_id = max(self._read_table().keys() or [0]) + 1
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <[AttributeError("'NoneType' object has no attribute 'get'") raised in repr()] Table object at 0x7fa29f949060>

    def _read_table(self) ->Dict[str, Mapping]:
        """
        Read the table data from the underlying storage.

        Documents and doc_ids are NOT yet transformed, as
        we may not want to convert *all* documents when returning
        only one document for example.
        """
        data = self._storage.read()
>       return data.get(self._name, {})
E       AttributeError: 'NoneType' object has no attribute 'get'

tinydb/table.py:354: AttributeError
</pre>
</details>
<h3 id="test_storagespytest_in_memory_close">test_storages.py::test_in_memory_close</h3>
<details><summary> <pre>test_storages.py::test_in_memory_close</pre></summary><pre>
def test_in_memory_close():
        with TinyDB(storage=MemoryStorage) as db:
>           db.insert({})

tests/test_storages.py:146: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/table.py:99: in insert
    doc_id = self._get_next_id()
tinydb/table.py:340: in _get_next_id
    self._next_id = max(self._read_table().keys() or [0]) + 1
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <[AttributeError("'NoneType' object has no attribute 'get'") raised in repr()] Table object at 0x7fa29e211ab0>

    def _read_table(self) ->Dict[str, Mapping]:
        """
        Read the table data from the underlying storage.

        Documents and doc_ids are NOT yet transformed, as
        we may not want to convert *all* documents when returning
        only one document for example.
        """
        data = self._storage.read()
>       return data.get(self._name, {})
E       AttributeError: 'NoneType' object has no attribute 'get'

tinydb/table.py:354: AttributeError
</pre>
</details>
<h3 id="test_storagespytest_read_once">test_storages.py::test_read_once</h3>
<details><summary> <pre>test_storages.py::test_read_once</pre></summary><pre>
def test_read_once():
        count = 0

        # noinspection PyAbstractClass
        class MyStorage(Storage):
            def __init__(self):
                self.memory = None

            def read(self):
                nonlocal count
                count += 1

                return self.memory

            def write(self, data):
                self.memory = data

        with TinyDB(storage=MyStorage) as db:
            assert count == 0

>           db.table(db.default_table_name)

tests/test_storages.py:178: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <tinydb.database.TinyDB object at 0x7fa29de57f70>
name = 'default_table_name'

    def __getattr__(self, name):
        """
        Forward all unknown attribute calls to the underlying standard table.
        """
>       return getattr(self._table, name)
E       AttributeError: 'Table' object has no attribute 'default_table_name'

tinydb/database.py:293: AttributeError
</pre>
</details>
<h3 id="test_storagespytest_yaml">test_storages.py::test_yaml</h3>
<details><summary> <pre>test_storages.py::test_yaml</pre></summary><pre>
tmpdir = local('/tmp/pytest-of-root/pytest-0/test_yaml0')

    def test_yaml(tmpdir):
        """
        :type tmpdir: py._path.local.LocalPath
        """

        try:
            import yaml
        except ImportError:
            return pytest.skip('PyYAML not installed')

        def represent_doc(dumper, data):
            # Represent `Document` objects as their dict's string representation
            # which PyYAML understands
            return dumper.represent_data(dict(data))

        yaml.add_representer(Document, represent_doc)

        class YAMLStorage(Storage):
            def __init__(self, filename):
                self.filename = filename
                touch(filename, False)

            def read(self):
                with open(self.filename) as handle:
                    data = yaml.safe_load(handle.read())
                    return data

            def write(self, data):
                with open(self.filename, 'w') as handle:
                    yaml.dump(data, handle)

            def close(self):
                pass

        # Write contents
        path = str(tmpdir.join('test.db'))
        db = TinyDB(path, storage=YAMLStorage)
>       db.insert(doc)

tests/test_storages.py:251: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/table.py:99: in insert
    doc_id = self._get_next_id()
tinydb/table.py:340: in _get_next_id
    self._next_id = max(self._read_table().keys() or [0]) + 1
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <[AttributeError("'NoneType' object has no attribute 'get'") raised in repr()] Table object at 0x7fa29e1ad780>

    def _read_table(self) ->Dict[str, Mapping]:
        """
        Read the table data from the underlying storage.

        Documents and doc_ids are NOT yet transformed, as
        we may not want to convert *all* documents when returning
        only one document for example.
        """
        data = self._storage.read()
>       return data.get(self._name, {})
E       AttributeError: 'NoneType' object has no attribute 'get'

tinydb/table.py:354: AttributeError
</pre>
</details>
<h3 id="test_storagespytest_encoding">test_storages.py::test_encoding</h3>
<details><summary> <pre>test_storages.py::test_encoding</pre></summary><pre>
tmpdir = local('/tmp/pytest-of-root/pytest-0/test_encoding0')

    def test_encoding(tmpdir):
        japanese_doc = {"Test": u"こんにちは世界"}

        path = str(tmpdir.join('test.db'))
        # cp936 is used for japanese encodings
        jap_storage = JSONStorage(path, encoding="cp936")
        jap_storage.write(japanese_doc)

        try:
            exception = json.decoder.JSONDecodeError
        except AttributeError:
            exception = ValueError

>       with pytest.raises(exception):
E       Failed: DID NOT RAISE <class 'json.decoder.JSONDecodeError'>

tests/test_storages.py:275: Failed
</pre>
</details>
<h3 id="test_tablespytest_next_idmemory">test_tables.py::test_next_id[memory]</h3>
<details><summary> <pre>test_tables.py::test_next_id[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e015690>

    def test_next_id(db):
        db.truncate()

>       assert db._get_next_id() == 1
E       assert 4 == 1
E        +  where 4 = _get_next_id()
E        +    where _get_next_id = <tinydb.database.TinyDB object at 0x7fa29e015690>._get_next_id

tests/test_tables.py:11: AssertionError
</pre>
</details>
<h3 id="test_tablespytest_next_idjson">test_tables.py::test_next_id[json]</h3>
<details><summary> <pre>test_tables.py::test_next_id[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29dd5d7e0>

    def test_next_id(db):
        db.truncate()

>       assert db._get_next_id() == 1
E       assert 4 == 1
E        +  where 4 = _get_next_id()
E        +    where _get_next_id = <tinydb.database.TinyDB object at 0x7fa29dd5d7e0>._get_next_id

tests/test_tables.py:11: AssertionError
</pre>
</details>
<h3 id="test_tablespytest_tables_listmemory">test_tables.py::test_tables_list[memory]</h3>
<details><summary> <pre>test_tables.py::test_tables_list[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e0146a0>

    def test_tables_list(db):
        db.table('table1').insert({'a': 1})
        db.table('table2').insert({'a': 1})

>       assert db.tables() == {'_default', 'table1', 'table2'}
E       AssertionError: assert ['_default', ...e1', 'table2'] == {'_default', ...e1', 'table2'}
E         
E         Full diff:
E         - {
E         + [
E               '_default',
E               'table1',
E               'table2',
E         - }
E         + ]

tests/test_tables.py:20: AssertionError
</pre>
</details>
<h3 id="test_tablespytest_tables_listjson">test_tables.py::test_tables_list[json]</h3>
<details><summary> <pre>test_tables.py::test_tables_list[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29dd5e2c0>

    def test_tables_list(db):
        db.table('table1').insert({'a': 1})
        db.table('table2').insert({'a': 1})

>       assert db.tables() == {'_default', 'table1', 'table2'}
E       AssertionError: assert ['_default', ...e1', 'table2'] == {'_default', ...e1', 'table2'}
E         
E         Full diff:
E         - {
E         + [
E               '_default',
E               'table1',
E               'table2',
E         - }
E         + ]

tests/test_tables.py:20: AssertionError
</pre>
</details>
<h3 id="test_tablespytest_one_tablememory">test_tables.py::test_one_table[memory]</h3>
<details><summary> <pre>test_tables.py::test_one_table[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e0aa2f0>

    def test_one_table(db):
        table1 = db.table('table1')

        table1.insert_multiple({'int': 1, 'char': c} for c in 'abc')

>       assert table1.get(where('int') == 1)['char'] == 'a'

tests/test_tables.py:28: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tablespytest_one_tablejson">test_tables.py::test_one_table[json]</h3>
<details><summary> <pre>test_tables.py::test_one_table[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e3e41f0>

    def test_one_table(db):
        table1 = db.table('table1')

        table1.insert_multiple({'int': 1, 'char': c} for c in 'abc')

>       assert table1.get(where('int') == 1)['char'] == 'a'

tests/test_tables.py:28: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tablespytest_multiple_tablesmemory">test_tables.py::test_multiple_tables[memory]</h3>
<details><summary> <pre>test_tables.py::test_multiple_tables[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e03ac20>

    def test_multiple_tables(db):
        table1 = db.table('table1')
        table2 = db.table('table2')
        table3 = db.table('table3')

        table1.insert({'int': 1, 'char': 'a'})
        table2.insert({'int': 1, 'char': 'b'})
        table3.insert({'int': 1, 'char': 'c'})

>       assert table1.count(where('char') == 'a') == 1

tests/test_tables.py:41: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tablespytest_multiple_tablesjson">test_tables.py::test_multiple_tables[json]</h3>
<details><summary> <pre>test_tables.py::test_multiple_tables[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29f674f70>

    def test_multiple_tables(db):
        table1 = db.table('table1')
        table2 = db.table('table2')
        table3 = db.table('table3')

        table1.insert({'int': 1, 'char': 'a'})
        table2.insert({'int': 1, 'char': 'b'})
        table3.insert({'int': 1, 'char': 'c'})

>       assert table1.count(where('char') == 'a') == 1

tests/test_tables.py:41: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tablespytest_query_cachememory">test_tables.py::test_query_cache[memory]</h3>
<details><summary> <pre>test_tables.py::test_query_cache[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e695210>

    def test_query_cache(db):
>       query1 = where('int') == 1

tests/test_tables.py:60: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tablespytest_query_cachejson">test_tables.py::test_query_cache[json]</h3>
<details><summary> <pre>test_tables.py::test_query_cache[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29f5f3640>

    def test_query_cache(db):
>       query1 = where('int') == 1

tests/test_tables.py:60: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tablespytest_query_cache_with_mutable_callablememory">test_tables.py::test_query_cache_with_mutable_callable[memory]</h3>
<details><summary> <pre>test_tables.py::test_query_cache_with_mutable_callable[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29f1611b0>

    def test_query_cache_with_mutable_callable(db):
        table = db.table('table')
        table.insert({'val': 5})

        mutable = 5
        increase = lambda x: x + mutable

>       assert where('val').is_cacheable()

tests/test_tables.py:84: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tablespytest_query_cache_with_mutable_callablejson">test_tables.py::test_query_cache_with_mutable_callable[json]</h3>
<details><summary> <pre>test_tables.py::test_query_cache_with_mutable_callable[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29f94bb80>

    def test_query_cache_with_mutable_callable(db):
        table = db.table('table')
        table.insert({'val': 5})

        mutable = 5
        increase = lambda x: x + mutable

>       assert where('val').is_cacheable()

tests/test_tables.py:84: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tablespytest_zero_cache_sizememory">test_tables.py::test_zero_cache_size[memory]</h3>
<details><summary> <pre>test_tables.py::test_zero_cache_size[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29df90a00>

    def test_zero_cache_size(db):
        table = db.table('table3', cache_size=0)
>       query = where('int') == 1

tests/test_tables.py:100: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tablespytest_zero_cache_sizejson">test_tables.py::test_zero_cache_size[json]</h3>
<details><summary> <pre>test_tables.py::test_zero_cache_size[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29db53b80>

    def test_zero_cache_size(db):
        table = db.table('table3', cache_size=0)
>       query = where('int') == 1

tests/test_tables.py:100: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tablespytest_query_cache_sizememory">test_tables.py::test_query_cache_size[memory]</h3>
<details><summary> <pre>test_tables.py::test_query_cache_size[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29d9f1ff0>

    def test_query_cache_size(db):
        table = db.table('table3', cache_size=1)
>       query = where('int') == 1

tests/test_tables.py:112: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tablespytest_query_cache_sizejson">test_tables.py::test_query_cache_size[json]</h3>
<details><summary> <pre>test_tables.py::test_query_cache_size[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29dce7c10>

    def test_query_cache_size(db):
        table = db.table('table3', cache_size=1)
>       query = where('int') == 1

tests/test_tables.py:112: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tablespytest_lru_cachememory">test_tables.py::test_lru_cache[memory]</h3>
<details><summary> <pre>test_tables.py::test_lru_cache[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29de0e650>

    def test_lru_cache(db):
        # Test integration into TinyDB
        table = db.table('table3', cache_size=2)
>       query = where('int') == 1

tests/test_tables.py:125: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tablespytest_lru_cachejson">test_tables.py::test_lru_cache[json]</h3>
<details><summary> <pre>test_tables.py::test_lru_cache[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e1ae9e0>

    def test_lru_cache(db):
        # Test integration into TinyDB
        table = db.table('table3', cache_size=2)
>       query = where('int') == 1

tests/test_tables.py:125: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tablespytest_truncate_tablememory">test_tables.py::test_truncate_table[memory]</h3>
<details><summary> <pre>test_tables.py::test_truncate_table[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e03dc00>

    def test_truncate_table(db):
        db.truncate()
>       assert db._get_next_id() == 1
E       assert 4 == 1
E        +  where 4 = _get_next_id()
E        +    where _get_next_id = <tinydb.database.TinyDB object at 0x7fa29e03dc00>._get_next_id

tests/test_tables.py:171: AssertionError
</pre>
</details>
<h3 id="test_tablespytest_truncate_tablejson">test_tables.py::test_truncate_table[json]</h3>
<details><summary> <pre>test_tables.py::test_truncate_table[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29dcee470>

    def test_truncate_table(db):
        db.truncate()
>       assert db._get_next_id() == 1
E       assert 4 == 1
E        +  where 4 = _get_next_id()
E        +    where _get_next_id = <tinydb.database.TinyDB object at 0x7fa29dcee470>._get_next_id

tests/test_tables.py:171: AssertionError
</pre>
</details>
<h3 id="test_tinydbpytest_drop_tablesmemory">test_tinydb.py::test_drop_tables[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_drop_tables[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29f385720>

    def test_drop_tables(db: TinyDB):
        db.drop_tables()

        db.insert({})
        db.drop_tables()

>       assert len(db) == 0
E       TypeError: object of type 'TinyDB' has no len()

tests/test_tinydb.py:18: TypeError
</pre>
</details>
<h3 id="test_tinydbpytest_drop_tablesjson">test_tinydb.py::test_drop_tables[json]</h3>
<details><summary> <pre>test_tinydb.py::test_drop_tables[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29da3fac0>

    def test_drop_tables(db: TinyDB):
        db.drop_tables()

        db.insert({})
        db.drop_tables()

>       assert len(db) == 0
E       TypeError: object of type 'TinyDB' has no len()

tests/test_tinydb.py:18: TypeError
</pre>
</details>
<h3 id="test_tinydbpytest_insertmemory">test_tinydb.py::test_insert[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_insert[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29da3ea40>

    def test_insert(db: TinyDB):
        db.drop_tables()
        db.insert({'int': 1, 'char': 'a'})

>       assert db.count(where('int') == 1) == 1

tests/test_tinydb.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_insertjson">test_tinydb.py::test_insert[json]</h3>
<details><summary> <pre>test_tinydb.py::test_insert[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e02f130>

    def test_insert(db: TinyDB):
        db.drop_tables()
        db.insert({'int': 1, 'char': 'a'})

>       assert db.count(where('int') == 1) == 1

tests/test_tinydb.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_insert_idsmemory">test_tinydb.py::test_insert_ids[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_insert_ids[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e7e2ce0>

    def test_insert_ids(db: TinyDB):
        db.drop_tables()
>       assert db.insert({'int': 1, 'char': 'a'}) == 1
E       AssertionError: assert 4 == 1
E        +  where 4 = insert({'char': 'a', 'int': 1})
E        +    where insert = <tinydb.database.TinyDB object at 0x7fa29e7e2ce0>.insert

tests/test_tinydb.py:48: AssertionError
</pre>
</details>
<h3 id="test_tinydbpytest_insert_idsjson">test_tinydb.py::test_insert_ids[json]</h3>
<details><summary> <pre>test_tinydb.py::test_insert_ids[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29de46290>

    def test_insert_ids(db: TinyDB):
        db.drop_tables()
>       assert db.insert({'int': 1, 'char': 'a'}) == 1
E       AssertionError: assert 4 == 1
E        +  where 4 = insert({'char': 'a', 'int': 1})
E        +    where insert = <tinydb.database.TinyDB object at 0x7fa29de46290>.insert

tests/test_tinydb.py:48: AssertionError
</pre>
</details>
<h3 id="test_tinydbpytest_insert_with_doc_idmemory">test_tinydb.py::test_insert_with_doc_id[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_insert_with_doc_id[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e7e22c0>

    def test_insert_with_doc_id(db: TinyDB):
        db.drop_tables()
>       assert db.insert({'int': 1, 'char': 'a'}) == 1
E       AssertionError: assert 4 == 1
E        +  where 4 = insert({'char': 'a', 'int': 1})
E        +    where insert = <tinydb.database.TinyDB object at 0x7fa29e7e22c0>.insert

tests/test_tinydb.py:54: AssertionError
</pre>
</details>
<h3 id="test_tinydbpytest_insert_with_doc_idjson">test_tinydb.py::test_insert_with_doc_id[json]</h3>
<details><summary> <pre>test_tinydb.py::test_insert_with_doc_id[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29df1dc30>

    def test_insert_with_doc_id(db: TinyDB):
        db.drop_tables()
>       assert db.insert({'int': 1, 'char': 'a'}) == 1
E       AssertionError: assert 4 == 1
E        +  where 4 = insert({'char': 'a', 'int': 1})
E        +    where insert = <tinydb.database.TinyDB object at 0x7fa29df1dc30>.insert

tests/test_tinydb.py:54: AssertionError
</pre>
</details>
<h3 id="test_tinydbpytest_insert_with_duplicate_doc_idmemory">test_tinydb.py::test_insert_with_duplicate_doc_id[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_insert_with_duplicate_doc_id[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e7586d0>

    def test_insert_with_duplicate_doc_id(db: TinyDB):
        db.drop_tables()
>       assert db.insert({'int': 1, 'char': 'a'}) == 1
E       AssertionError: assert 4 == 1
E        +  where 4 = insert({'char': 'a', 'int': 1})
E        +    where insert = <tinydb.database.TinyDB object at 0x7fa29e7586d0>.insert

tests/test_tinydb.py:62: AssertionError
</pre>
</details>
<h3 id="test_tinydbpytest_insert_with_duplicate_doc_idjson">test_tinydb.py::test_insert_with_duplicate_doc_id[json]</h3>
<details><summary> <pre>test_tinydb.py::test_insert_with_duplicate_doc_id[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e00da20>

    def test_insert_with_duplicate_doc_id(db: TinyDB):
        db.drop_tables()
>       assert db.insert({'int': 1, 'char': 'a'}) == 1
E       AssertionError: assert 4 == 1
E        +  where 4 = insert({'char': 'a', 'int': 1})
E        +    where insert = <tinydb.database.TinyDB object at 0x7fa29e00da20>.insert

tests/test_tinydb.py:62: AssertionError
</pre>
</details>
<h3 id="test_tinydbpytest_insert_multiplememory">test_tinydb.py::test_insert_multiple[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_insert_multiple[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e758d60>

    def test_insert_multiple(db: TinyDB):
        db.drop_tables()
>       assert not db.contains(where('int') == 1)

tests/test_tinydb.py:70: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_insert_multiplejson">test_tinydb.py::test_insert_multiple[json]</h3>
<details><summary> <pre>test_tinydb.py::test_insert_multiple[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29db53880>

    def test_insert_multiple(db: TinyDB):
        db.drop_tables()
>       assert not db.contains(where('int') == 1)

tests/test_tinydb.py:70: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_insert_multiple_with_idsmemory">test_tinydb.py::test_insert_multiple_with_ids[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_insert_multiple_with_ids[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29f6760b0>

    def test_insert_multiple_with_ids(db: TinyDB):
        db.drop_tables()

        # Insert multiple from list
>       assert db.insert_multiple([{'int': 1, 'char': 'a'},
                                   {'int': 1, 'char': 'b'},
                                   {'int': 1, 'char': 'c'}]) == [1, 2, 3]
E       AssertionError: assert [4, 5, 6] == [1, 2, 3]
E         
E         At index 0 diff: 4 != 1
E         
E         Full diff:
E           [
E         -     1,
E         ?     ^...
E         
E         ...Full output truncated (11 lines hidden), use '-vv' to show

tests/test_tinydb.py:106: AssertionError
</pre>
</details>
<h3 id="test_tinydbpytest_insert_multiple_with_idsjson">test_tinydb.py::test_insert_multiple_with_ids[json]</h3>
<details><summary> <pre>test_tinydb.py::test_insert_multiple_with_ids[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e28a800>

    def test_insert_multiple_with_ids(db: TinyDB):
        db.drop_tables()

        # Insert multiple from list
>       assert db.insert_multiple([{'int': 1, 'char': 'a'},
                                   {'int': 1, 'char': 'b'},
                                   {'int': 1, 'char': 'c'}]) == [1, 2, 3]
E       AssertionError: assert [4, 5, 6] == [1, 2, 3]
E         
E         At index 0 diff: 4 != 1
E         
E         Full diff:
E           [
E         -     1,
E         ?     ^...
E         
E         ...Full output truncated (11 lines hidden), use '-vv' to show

tests/test_tinydb.py:106: AssertionError
</pre>
</details>
<h3 id="test_tinydbpytest_insert_multiple_with_doc_idsmemory">test_tinydb.py::test_insert_multiple_with_doc_ids[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_insert_multiple_with_doc_ids[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29de50130>

    def test_insert_multiple_with_doc_ids(db: TinyDB):
        db.drop_tables()

>       assert db.insert_multiple([
            Document({'int': 1, 'char': 'a'}, 12),
            Document({'int': 1, 'char': 'b'}, 77)
        ]) == [12, 77]
E       AssertionError: assert [4, 5] == [12, 77]
E         
E         At index 0 diff: 4 != 12
E         
E         Full diff:
E           [
E         -     12,
E         ?     ^^...
E         
E         ...Full output truncated (7 lines hidden), use '-vv' to show

tests/test_tinydb.py:114: AssertionError
</pre>
</details>
<h3 id="test_tinydbpytest_insert_multiple_with_doc_idsjson">test_tinydb.py::test_insert_multiple_with_doc_ids[json]</h3>
<details><summary> <pre>test_tinydb.py::test_insert_multiple_with_doc_ids[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29efe16f0>

    def test_insert_multiple_with_doc_ids(db: TinyDB):
        db.drop_tables()

>       assert db.insert_multiple([
            Document({'int': 1, 'char': 'a'}, 12),
            Document({'int': 1, 'char': 'b'}, 77)
        ]) == [12, 77]
E       AssertionError: assert [4, 5] == [12, 77]
E         
E         At index 0 diff: 4 != 12
E         
E         Full diff:
E           [
E         -     12,
E         ?     ^^...
E         
E         ...Full output truncated (7 lines hidden), use '-vv' to show

tests/test_tinydb.py:114: AssertionError
</pre>
</details>
<h3 id="test_tinydbpytest_insert_invalid_type_raises_errormemory">test_tinydb.py::test_insert_invalid_type_raises_error[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_insert_invalid_type_raises_error[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29d9f2e90>

    def test_insert_invalid_type_raises_error(db: TinyDB):
>       with pytest.raises(ValueError, match='Document is not a Mapping'):
E       Failed: DID NOT RAISE <class 'ValueError'>

tests/test_tinydb.py:126: Failed
</pre>
</details>
<h3 id="test_tinydbpytest_insert_invalid_type_raises_errorjson">test_tinydb.py::test_insert_invalid_type_raises_error[json]</h3>
<details><summary> <pre>test_tinydb.py::test_insert_invalid_type_raises_error[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29df69b40>

    def test_insert_invalid_type_raises_error(db: TinyDB):
        with pytest.raises(ValueError, match='Document is not a Mapping'):
            # object() as an example of a non-mapping-type
>           db.insert(object())  # type: ignore

tests/test_tinydb.py:128: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/table.py:100: in insert
    self._update_table(lambda table: table.update({doc_id: document}))
tinydb/table.py:373: in _update_table
    self._storage.write(data)
tinydb/storages.py:108: in write
    json.dump(data, self._handle, **self.kwargs)
/usr/lib/python3.10/json/__init__.py:179: in dump
    for chunk in iterable:
/usr/lib/python3.10/json/encoder.py:431: in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
/usr/lib/python3.10/json/encoder.py:405: in _iterencode_dict
    yield from chunks
/usr/lib/python3.10/json/encoder.py:405: in _iterencode_dict
    yield from chunks
/usr/lib/python3.10/json/encoder.py:438: in _iterencode
    o = _default(o)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <json.encoder.JSONEncoder object at 0x7fa29f9322c0>
o = <object object at 0x7fa29fb89cd0>

    def default(self, o):
        """Implement this method in a subclass such that it returns
        a serializable object for ``o``, or calls the base implementation
        (to raise a ``TypeError``).

        For example, to support arbitrary iterators, you could
        implement default like this::

            def default(self, o):
                try:
                    iterable = iter(o)
                except TypeError:
                    pass
                else:
                    return list(iterable)
                # Let the base class default method raise the TypeError
                return JSONEncoder.default(self, o)

        """
>       raise TypeError(f'Object of type {o.__class__.__name__} '
                        f'is not JSON serializable')
E       TypeError: Object of type object is not JSON serializable

/usr/lib/python3.10/json/encoder.py:179: TypeError
</pre>
</details>
<h3 id="test_tinydbpytest_insert_valid_mapping_typememory">test_tinydb.py::test_insert_valid_mapping_type[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_insert_valid_mapping_type[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29f110e50>

    def test_insert_valid_mapping_type(db: TinyDB):
        class CustomDocument(Mapping):
            def __init__(self, data):
                self.data = data

            def __getitem__(self, key):
                return self.data[key]

            def __iter__(self):
                return iter(self.data)

            def __len__(self):
                return len(self.data)

        db.drop_tables()
        db.insert(CustomDocument({'int': 1, 'char': 'a'}))
>       assert db.count(where('int') == 1) == 1

tests/test_tinydb.py:147: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_insert_valid_mapping_typejson">test_tinydb.py::test_insert_valid_mapping_type[json]</h3>
<details><summary> <pre>test_tinydb.py::test_insert_valid_mapping_type[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e03aa10>

    def test_insert_valid_mapping_type(db: TinyDB):
        class CustomDocument(Mapping):
            def __init__(self, data):
                self.data = data

            def __getitem__(self, key):
                return self.data[key]

            def __iter__(self):
                return iter(self.data)

            def __len__(self):
                return len(self.data)

        db.drop_tables()
>       db.insert(CustomDocument({'int': 1, 'char': 'a'}))

tests/test_tinydb.py:146: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/table.py:100: in insert
    self._update_table(lambda table: table.update({doc_id: document}))
tinydb/table.py:373: in _update_table
    self._storage.write(data)
tinydb/storages.py:108: in write
    json.dump(data, self._handle, **self.kwargs)
/usr/lib/python3.10/json/__init__.py:179: in dump
    for chunk in iterable:
/usr/lib/python3.10/json/encoder.py:431: in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
/usr/lib/python3.10/json/encoder.py:405: in _iterencode_dict
    yield from chunks
/usr/lib/python3.10/json/encoder.py:405: in _iterencode_dict
    yield from chunks
/usr/lib/python3.10/json/encoder.py:438: in _iterencode
    o = _default(o)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <json.encoder.JSONEncoder object at 0x7fa29f9322c0>
o = <tests.test_tinydb.test_insert_valid_mapping_type.<locals>.CustomDocument object at 0x7fa29e038310>

    def default(self, o):
        """Implement this method in a subclass such that it returns
        a serializable object for ``o``, or calls the base implementation
        (to raise a ``TypeError``).

        For example, to support arbitrary iterators, you could
        implement default like this::

            def default(self, o):
                try:
                    iterable = iter(o)
                except TypeError:
                    pass
                else:
                    return list(iterable)
                # Let the base class default method raise the TypeError
                return JSONEncoder.default(self, o)

        """
>       raise TypeError(f'Object of type {o.__class__.__name__} '
                        f'is not JSON serializable')
E       TypeError: Object of type CustomDocument is not JSON serializable

/usr/lib/python3.10/json/encoder.py:179: TypeError
</pre>
</details>
<h3 id="test_tinydbpytest_custom_mapping_type_with_json">test_tinydb.py::test_custom_mapping_type_with_json</h3>
<details><summary> <pre>test_tinydb.py::test_custom_mapping_type_with_json</pre></summary><pre>
tmpdir = local('/tmp/pytest-of-root/pytest-0/test_custom_mapping_type_with_0')

    def test_custom_mapping_type_with_json(tmpdir):
        class CustomDocument(Mapping):
            def __init__(self, data):
                self.data = data

            def __getitem__(self, key):
                return self.data[key]

            def __iter__(self):
                return iter(self.data)

            def __len__(self):
                return len(self.data)

        # Insert
        db = TinyDB(str(tmpdir.join('test.db')))
        db.drop_tables()
>       db.insert(CustomDocument({'int': 1, 'char': 'a'}))

tests/test_tinydb.py:167: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/table.py:100: in insert
    self._update_table(lambda table: table.update({doc_id: document}))
tinydb/table.py:373: in _update_table
    self._storage.write(data)
tinydb/storages.py:108: in write
    json.dump(data, self._handle, **self.kwargs)
/usr/lib/python3.10/json/__init__.py:179: in dump
    for chunk in iterable:
/usr/lib/python3.10/json/encoder.py:431: in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
/usr/lib/python3.10/json/encoder.py:405: in _iterencode_dict
    yield from chunks
/usr/lib/python3.10/json/encoder.py:405: in _iterencode_dict
    yield from chunks
/usr/lib/python3.10/json/encoder.py:438: in _iterencode
    o = _default(o)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <json.encoder.JSONEncoder object at 0x7fa29f9322c0>
o = <tests.test_tinydb.test_custom_mapping_type_with_json.<locals>.CustomDocument object at 0x7fa29d9eaa10>

    def default(self, o):
        """Implement this method in a subclass such that it returns
        a serializable object for ``o``, or calls the base implementation
        (to raise a ``TypeError``).

        For example, to support arbitrary iterators, you could
        implement default like this::

            def default(self, o):
                try:
                    iterable = iter(o)
                except TypeError:
                    pass
                else:
                    return list(iterable)
                # Let the base class default method raise the TypeError
                return JSONEncoder.default(self, o)

        """
>       raise TypeError(f'Object of type {o.__class__.__name__} '
                        f'is not JSON serializable')
E       TypeError: Object of type CustomDocument is not JSON serializable

/usr/lib/python3.10/json/encoder.py:179: TypeError
</pre>
</details>
<h3 id="test_tinydbpytest_removememory">test_tinydb.py::test_remove[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_remove[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e2c0ca0>

    def test_remove(db: TinyDB):
>       db.remove(where('char') == 'b')

tests/test_tinydb.py:187: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_removejson">test_tinydb.py::test_remove[json]</h3>
<details><summary> <pre>test_tinydb.py::test_remove[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29d9d9450>

    def test_remove(db: TinyDB):
>       db.remove(where('char') == 'b')

tests/test_tinydb.py:187: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_remove_all_failsmemory">test_tinydb.py::test_remove_all_fails[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_remove_all_fails[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29df1d960>

    def test_remove_all_fails(db: TinyDB):
>       with pytest.raises(RuntimeError):
E       Failed: DID NOT RAISE <class 'RuntimeError'>

tests/test_tinydb.py:194: Failed
</pre>
</details>
<h3 id="test_tinydbpytest_remove_all_failsjson">test_tinydb.py::test_remove_all_fails[json]</h3>
<details><summary> <pre>test_tinydb.py::test_remove_all_fails[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29f5f07c0>

    def test_remove_all_fails(db: TinyDB):
>       with pytest.raises(RuntimeError):
E       Failed: DID NOT RAISE <class 'RuntimeError'>

tests/test_tinydb.py:194: Failed
</pre>
</details>
<h3 id="test_tinydbpytest_remove_multiplememory">test_tinydb.py::test_remove_multiple[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_remove_multiple[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29dd30310>

    def test_remove_multiple(db: TinyDB):
>       db.remove(where('int') == 1)

tests/test_tinydb.py:199: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_remove_multiplejson">test_tinydb.py::test_remove_multiple[json]</h3>
<details><summary> <pre>test_tinydb.py::test_remove_multiple[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29df1a4d0>

    def test_remove_multiple(db: TinyDB):
>       db.remove(where('int') == 1)

tests/test_tinydb.py:199: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_remove_idsmemory">test_tinydb.py::test_remove_ids[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_remove_ids[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e23e170>

    def test_remove_ids(db: TinyDB):
        db.remove(doc_ids=[1, 2])

>       assert len(db) == 1
E       TypeError: object of type 'TinyDB' has no len()

tests/test_tinydb.py:207: TypeError
</pre>
</details>
<h3 id="test_tinydbpytest_remove_idsjson">test_tinydb.py::test_remove_ids[json]</h3>
<details><summary> <pre>test_tinydb.py::test_remove_ids[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29df1eec0>

    def test_remove_ids(db: TinyDB):
        db.remove(doc_ids=[1, 2])

>       assert len(db) == 1
E       TypeError: object of type 'TinyDB' has no len()

tests/test_tinydb.py:207: TypeError
</pre>
</details>
<h3 id="test_tinydbpytest_remove_returns_idsmemory">test_tinydb.py::test_remove_returns_ids[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_remove_returns_ids[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e7e2230>

    def test_remove_returns_ids(db: TinyDB):
>       assert db.remove(where('char') == 'b') == [2]

tests/test_tinydb.py:211: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_remove_returns_idsjson">test_tinydb.py::test_remove_returns_ids[json]</h3>
<details><summary> <pre>test_tinydb.py::test_remove_returns_ids[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29ddd3d30>

    def test_remove_returns_ids(db: TinyDB):
>       assert db.remove(where('char') == 'b') == [2]

tests/test_tinydb.py:211: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_updatememory">test_tinydb.py::test_update[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_update[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29dd7c100>

    def test_update(db: TinyDB):
>       assert len(db) == 3
E       TypeError: object of type 'TinyDB' has no len()

tests/test_tinydb.py:215: TypeError
</pre>
</details>
<h3 id="test_tinydbpytest_updatejson">test_tinydb.py::test_update[json]</h3>
<details><summary> <pre>test_tinydb.py::test_update[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29ef01000>

    def test_update(db: TinyDB):
>       assert len(db) == 3
E       TypeError: object of type 'TinyDB' has no len()

tests/test_tinydb.py:215: TypeError
</pre>
</details>
<h3 id="test_tinydbpytest_update_allmemory">test_tinydb.py::test_update_all[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_update_all[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e43b220>

    def test_update_all(db: TinyDB):
>       assert db.count(where('int') == 1) == 3

tests/test_tinydb.py:224: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_update_alljson">test_tinydb.py::test_update_all[json]</h3>
<details><summary> <pre>test_tinydb.py::test_update_all[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29f2d3b20>

    def test_update_all(db: TinyDB):
>       assert db.count(where('int') == 1) == 3

tests/test_tinydb.py:224: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_update_returns_idsmemory">test_tinydb.py::test_update_returns_ids[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_update_returns_ids[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e19c0d0>

    def test_update_returns_ids(db: TinyDB):
        db.drop_tables()
>       assert db.insert({'int': 1, 'char': 'a'}) == 1
E       AssertionError: assert 4 == 1
E        +  where 4 = insert({'char': 'a', 'int': 1})
E        +    where insert = <tinydb.database.TinyDB object at 0x7fa29e19c0d0>.insert

tests/test_tinydb.py:233: AssertionError
</pre>
</details>
<h3 id="test_tinydbpytest_update_returns_idsjson">test_tinydb.py::test_update_returns_ids[json]</h3>
<details><summary> <pre>test_tinydb.py::test_update_returns_ids[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e28a380>

    def test_update_returns_ids(db: TinyDB):
        db.drop_tables()
>       assert db.insert({'int': 1, 'char': 'a'}) == 1
E       AssertionError: assert 4 == 1
E        +  where 4 = insert({'char': 'a', 'int': 1})
E        +    where insert = <tinydb.database.TinyDB object at 0x7fa29e28a380>.insert

tests/test_tinydb.py:233: AssertionError
</pre>
</details>
<h3 id="test_tinydbpytest_update_transformmemory">test_tinydb.py::test_update_transform[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_update_transform[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e19cbb0>

    def test_update_transform(db: TinyDB):
        def increment(field):
            def transform(el):
                el[field] += 1

            return transform

        def delete(field):
            def transform(el):
                del el[field]

            return transform

>       assert db.count(where('int') == 1) == 3

tests/test_tinydb.py:252: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_update_transformjson">test_tinydb.py::test_update_transform[json]</h3>
<details><summary> <pre>test_tinydb.py::test_update_transform[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e014610>

    def test_update_transform(db: TinyDB):
        def increment(field):
            def transform(el):
                el[field] += 1

            return transform

        def delete(field):
            def transform(el):
                del el[field]

            return transform

>       assert db.count(where('int') == 1) == 3

tests/test_tinydb.py:252: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_update_idsmemory">test_tinydb.py::test_update_ids[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_update_ids[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29dee87f0>

    def test_update_ids(db: TinyDB):
        db.update({'int': 2}, doc_ids=[1, 2])

>       assert db.count(where('int') == 2) == 2

tests/test_tinydb.py:265: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_update_idsjson">test_tinydb.py::test_update_ids[json]</h3>
<details><summary> <pre>test_tinydb.py::test_update_ids[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e758e20>

    def test_update_ids(db: TinyDB):
        db.update({'int': 2}, doc_ids=[1, 2])

>       assert db.count(where('int') == 2) == 2

tests/test_tinydb.py:265: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_update_multiplememory">test_tinydb.py::test_update_multiple[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_update_multiple[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29dcdbc70>

    def test_update_multiple(db: TinyDB):
>       assert len(db) == 3
E       TypeError: object of type 'TinyDB' has no len()

tests/test_tinydb.py:269: TypeError
</pre>
</details>
<h3 id="test_tinydbpytest_update_multiplejson">test_tinydb.py::test_update_multiple[json]</h3>
<details><summary> <pre>test_tinydb.py::test_update_multiple[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e1e8400>

    def test_update_multiple(db: TinyDB):
>       assert len(db) == 3
E       TypeError: object of type 'TinyDB' has no len()

tests/test_tinydb.py:269: TypeError
</pre>
</details>
<h3 id="test_tinydbpytest_update_multiple_operationmemory">test_tinydb.py::test_update_multiple_operation[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_update_multiple_operation[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e18e650>

    def test_update_multiple_operation(db: TinyDB):
        def increment(field):
            def transform(el):
                el[field] += 1

            return transform

>       assert db.count(where('int') == 1) == 3

tests/test_tinydb.py:288: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_update_multiple_operationjson">test_tinydb.py::test_update_multiple_operation[json]</h3>
<details><summary> <pre>test_tinydb.py::test_update_multiple_operation[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e1aee60>

    def test_update_multiple_operation(db: TinyDB):
        def increment(field):
            def transform(el):
                el[field] += 1

            return transform

>       assert db.count(where('int') == 1) == 3

tests/test_tinydb.py:288: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_upsertmemory">test_tinydb.py::test_upsert[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_upsert[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29dd33010>

    def test_upsert(db: TinyDB):
>       assert len(db) == 3
E       TypeError: object of type 'TinyDB' has no len()

tests/test_tinydb.py:299: TypeError
</pre>
</details>
<h3 id="test_tinydbpytest_upsertjson">test_tinydb.py::test_upsert[json]</h3>
<details><summary> <pre>test_tinydb.py::test_upsert[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29da3d240>

    def test_upsert(db: TinyDB):
>       assert len(db) == 3
E       TypeError: object of type 'TinyDB' has no len()

tests/test_tinydb.py:299: TypeError
</pre>
</details>
<h3 id="test_tinydbpytest_upsert_by_idmemory">test_tinydb.py::test_upsert_by_id[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_upsert_by_id[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e692d10>

    def test_upsert_by_id(db: TinyDB):
>       assert len(db) == 3
E       TypeError: object of type 'TinyDB' has no len()

tests/test_tinydb.py:311: TypeError
</pre>
</details>
<h3 id="test_tinydbpytest_upsert_by_idjson">test_tinydb.py::test_upsert_by_id[json]</h3>
<details><summary> <pre>test_tinydb.py::test_upsert_by_id[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e6aa230>

    def test_upsert_by_id(db: TinyDB):
>       assert len(db) == 3
E       TypeError: object of type 'TinyDB' has no len()

tests/test_tinydb.py:311: TypeError
</pre>
</details>
<h3 id="test_tinydbpytest_searchmemory">test_tinydb.py::test_search[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_search[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29dd8a0b0>

    def test_search(db: TinyDB):
>       assert not db._query_cache

tests/test_tinydb.py:340: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <tinydb.utils.LRUCache object at 0x7fa29dd8aad0>

    def __len__(self) ->int:
>       return self.length
E       AttributeError: 'LRUCache' object has no attribute 'length'

tinydb/utils.py:48: AttributeError
</pre>
</details>
<h3 id="test_tinydbpytest_searchjson">test_tinydb.py::test_search[json]</h3>
<details><summary> <pre>test_tinydb.py::test_search[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29f385b10>

    def test_search(db: TinyDB):
>       assert not db._query_cache

tests/test_tinydb.py:340: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <tinydb.utils.LRUCache object at 0x7fa29f386170>

    def __len__(self) ->int:
>       return self.length
E       AttributeError: 'LRUCache' object has no attribute 'length'

tinydb/utils.py:48: AttributeError
</pre>
</details>
<h3 id="test_tinydbpytest_search_pathmemory">test_tinydb.py::test_search_path[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_search_path[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29ef02140>

    def test_search_path(db: TinyDB):
>       assert not db._query_cache

tests/test_tinydb.py:348: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <tinydb.utils.LRUCache object at 0x7fa29ef02800>

    def __len__(self) ->int:
>       return self.length
E       AttributeError: 'LRUCache' object has no attribute 'length'

tinydb/utils.py:48: AttributeError
</pre>
</details>
<h3 id="test_tinydbpytest_search_pathjson">test_tinydb.py::test_search_path[json]</h3>
<details><summary> <pre>test_tinydb.py::test_search_path[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29d9d8ac0>

    def test_search_path(db: TinyDB):
>       assert not db._query_cache

tests/test_tinydb.py:348: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <tinydb.utils.LRUCache object at 0x7fa29d9d8160>

    def __len__(self) ->int:
>       return self.length
E       AttributeError: 'LRUCache' object has no attribute 'length'

tinydb/utils.py:48: AttributeError
</pre>
</details>
<h3 id="test_tinydbpytest_search_no_results_cachememory">test_tinydb.py::test_search_no_results_cache[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_search_no_results_cache[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29dfd9240>

    def test_search_no_results_cache(db: TinyDB):
>       assert len(db.search(where('missing').exists())) == 0

tests/test_tinydb.py:357: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_search_no_results_cachejson">test_tinydb.py::test_search_no_results_cache[json]</h3>
<details><summary> <pre>test_tinydb.py::test_search_no_results_cache[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29dcd9db0>

    def test_search_no_results_cache(db: TinyDB):
>       assert len(db.search(where('missing').exists())) == 0

tests/test_tinydb.py:357: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_getmemory">test_tinydb.py::test_get[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_get[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e02fe20>

    def test_get(db: TinyDB):
>       item = db.get(where('char') == 'b')

tests/test_tinydb.py:362: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_getjson">test_tinydb.py::test_get[json]</h3>
<details><summary> <pre>test_tinydb.py::test_get[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29d9f3940>

    def test_get(db: TinyDB):
>       item = db.get(where('char') == 'b')

tests/test_tinydb.py:362: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_get_idsjson">test_tinydb.py::test_get_ids[json]</h3>
<details><summary> <pre>test_tinydb.py::test_get_ids[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29dec30a0>

    def test_get_ids(db: TinyDB):
        el = db.all()[0]
>       assert db.get(doc_id=el.doc_id) == el
E       AssertionError: assert None == {'int': 1, 'char': 'a'}
E        +  where None = get(doc_id=1)
E        +    where get = <tinydb.database.TinyDB object at 0x7fa29dec30a0>.get
E        +    and   1 = {'int': 1, 'char': 'a'}.doc_id

tests/test_tinydb.py:370: AssertionError
</pre>
</details>
<h3 id="test_tinydbpytest_get_multiple_idsjson">test_tinydb.py::test_get_multiple_ids[json]</h3>
<details><summary> <pre>test_tinydb.py::test_get_multiple_ids[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e1ade70>

    def test_get_multiple_ids(db: TinyDB):
        el = db.all()
>       assert db.get(doc_ids=[x.doc_id for x in el]) == el
E       AssertionError: assert [] == [{'int': 1, '... 'char': 'c'}]
E         
E         Right contains 3 more items, first extra item: {'int': 1, 'char': 'a'}
E         
E         Full diff:
E         + []
E         - [
E         -     {...
E         
E         ...Full output truncated (12 lines hidden), use '-vv' to show

tests/test_tinydb.py:376: AssertionError
</pre>
</details>
<h3 id="test_tinydbpytest_get_invalidmemory">test_tinydb.py::test_get_invalid[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_get_invalid[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29df93c70>

    def test_get_invalid(db: TinyDB):
>       with pytest.raises(RuntimeError):
E       Failed: DID NOT RAISE <class 'RuntimeError'>

tests/test_tinydb.py:380: Failed
</pre>
</details>
<h3 id="test_tinydbpytest_get_invalidjson">test_tinydb.py::test_get_invalid[json]</h3>
<details><summary> <pre>test_tinydb.py::test_get_invalid[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29dede5c0>

    def test_get_invalid(db: TinyDB):
>       with pytest.raises(RuntimeError):
E       Failed: DID NOT RAISE <class 'RuntimeError'>

tests/test_tinydb.py:380: Failed
</pre>
</details>
<h3 id="test_tinydbpytest_countmemory">test_tinydb.py::test_count[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_count[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29f675000>

    def test_count(db: TinyDB):
>       assert db.count(where('int') == 1) == 3

tests/test_tinydb.py:385: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_countjson">test_tinydb.py::test_count[json]</h3>
<details><summary> <pre>test_tinydb.py::test_count[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e064460>

    def test_count(db: TinyDB):
>       assert db.count(where('int') == 1) == 3

tests/test_tinydb.py:385: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_containsmemory">test_tinydb.py::test_contains[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_contains[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29df92e90>

    def test_contains(db: TinyDB):
>       assert db.contains(where('int') == 1)

tests/test_tinydb.py:390: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_containsjson">test_tinydb.py::test_contains[json]</h3>
<details><summary> <pre>test_tinydb.py::test_contains[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29f113400>

    def test_contains(db: TinyDB):
>       assert db.contains(where('int') == 1)

tests/test_tinydb.py:390: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_contains_idsjson">test_tinydb.py::test_contains_ids[json]</h3>
<details><summary> <pre>test_tinydb.py::test_contains_ids[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29f387a90>

    def test_contains_ids(db: TinyDB):
>       assert db.contains(doc_id=1)
E       assert False
E        +  where False = contains(doc_id=1)
E        +    where contains = <tinydb.database.TinyDB object at 0x7fa29f387a90>.contains

tests/test_tinydb.py:395: AssertionError
</pre>
</details>
<h3 id="test_tinydbpytest_contains_invalidmemory">test_tinydb.py::test_contains_invalid[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_contains_invalid[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29deea8c0>

    def test_contains_invalid(db: TinyDB):
>       with pytest.raises(RuntimeError):
E       Failed: DID NOT RAISE <class 'RuntimeError'>

tests/test_tinydb.py:401: Failed
</pre>
</details>
<h3 id="test_tinydbpytest_contains_invalidjson">test_tinydb.py::test_contains_invalid[json]</h3>
<details><summary> <pre>test_tinydb.py::test_contains_invalid[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29df83190>

    def test_contains_invalid(db: TinyDB):
>       with pytest.raises(RuntimeError):
E       Failed: DID NOT RAISE <class 'RuntimeError'>

tests/test_tinydb.py:401: Failed
</pre>
</details>
<h3 id="test_tinydbpytest_get_idempotentmemory">test_tinydb.py::test_get_idempotent[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_get_idempotent[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29ddc9d20>

    def test_get_idempotent(db: TinyDB):
>       u = db.get(where('int') == 1)

tests/test_tinydb.py:406: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_get_idempotentjson">test_tinydb.py::test_get_idempotent[json]</h3>
<details><summary> <pre>test_tinydb.py::test_get_idempotent[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29f2d2dd0>

    def test_get_idempotent(db: TinyDB):
>       u = db.get(where('int') == 1)

tests/test_tinydb.py:406: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/queries.py:419: in where
    return Query()[key]
tinydb/queries.py:172: in __getitem__
    return self.__getattr__(item)
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
tinydb/queries.py:168: in __getattr__
    query._hash = ('path', query._path) if self.is_cacheable() else None
E   RecursionError: maximum recursion depth exceeded while calling a Python object
!!! Recursion detected (same locals & position)
</pre>
</details>
<h3 id="test_tinydbpytest_multiple_dbs">test_tinydb.py::test_multiple_dbs</h3>
<details><summary> <pre>test_tinydb.py::test_multiple_dbs</pre></summary><pre>
def test_multiple_dbs():
        """
        Regression test for issue #3
        """
        db1 = TinyDB(storage=MemoryStorage)
        db2 = TinyDB(storage=MemoryStorage)

>       db1.insert({'int': 1, 'char': 'a'})

tests/test_tinydb.py:418: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/table.py:99: in insert
    doc_id = self._get_next_id()
tinydb/table.py:340: in _get_next_id
    self._next_id = max(self._read_table().keys() or [0]) + 1
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <[AttributeError("'NoneType' object has no attribute 'get'") raised in repr()] Table object at 0x7fa29dabe0e0>

    def _read_table(self) ->Dict[str, Mapping]:
        """
        Read the table data from the underlying storage.

        Documents and doc_ids are NOT yet transformed, as
        we may not want to convert *all* documents when returning
        only one document for example.
        """
        data = self._storage.read()
>       return data.get(self._name, {})
E       AttributeError: 'NoneType' object has no attribute 'get'

tinydb/table.py:354: AttributeError
</pre>
</details>
<h3 id="test_tinydbpytest_storage_closed_once">test_tinydb.py::test_storage_closed_once</h3>
<details><summary> <pre>test_tinydb.py::test_storage_closed_once</pre></summary><pre>
def test_storage_closed_once():
        class Storage:
            def __init__(self):
                self.closed = False

            def read(self):
                return {}

            def write(self, data):
                pass

            def close(self):
                assert not self.closed
                self.closed = True

>       with TinyDB(storage=Storage) as db:

tests/test_tinydb.py:443: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/database.py:287: in __exit__
    self.close()
tinydb/database.py:281: in close
    self._storage.close()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <tests.test_tinydb.test_storage_closed_once.<locals>.Storage object at 0x7fa29da3e830>

    def close(self):
>       assert not self.closed
E       assert not True
E        +  where True = <tests.test_tinydb.test_storage_closed_once.<locals>.Storage object at 0x7fa29da3e830>.closed

tests/test_tinydb.py:440: AssertionError
</pre>
</details>
<h3 id="test_tinydbpytest_unique_ids">test_tinydb.py::test_unique_ids</h3>
<details><summary> <pre>test_tinydb.py::test_unique_ids</pre></summary><pre>
tmpdir = local('/tmp/pytest-of-root/pytest-0/test_unique_ids0')

    def test_unique_ids(tmpdir):
        """
        :type tmpdir: py._path.local.LocalPath
        """
        path = str(tmpdir.join('db.json'))

        # Verify ids are unique when reopening the DB and inserting
        with TinyDB(path) as _db:
>           _db.insert({'x': 1})

tests/test_tinydb.py:459: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/table.py:99: in insert
    doc_id = self._get_next_id()
tinydb/table.py:340: in _get_next_id
    self._next_id = max(self._read_table().keys() or [0]) + 1
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <[ValueError('I/O operation on closed file.') raised in repr()] Table object at 0x7fa29dd7c040>

    def _read_table(self) ->Dict[str, Mapping]:
        """
        Read the table data from the underlying storage.

        Documents and doc_ids are NOT yet transformed, as
        we may not want to convert *all* documents when returning
        only one document for example.
        """
        data = self._storage.read()
>       return data.get(self._name, {})
E       AttributeError: 'NoneType' object has no attribute 'get'

tinydb/table.py:354: AttributeError
</pre>
</details>
<h3 id="test_tinydbpytest_lastid_after_open">test_tinydb.py::test_lastid_after_open</h3>
<details><summary> <pre>test_tinydb.py::test_lastid_after_open</pre></summary><pre>
tmpdir = local('/tmp/pytest-of-root/pytest-0/test_lastid_after_open0')

    def test_lastid_after_open(tmpdir):
        """
        Regression test for issue #34

        :type tmpdir: py._path.local.LocalPath
        """

        NUM = 100
        path = str(tmpdir.join('db.json'))

        with TinyDB(path) as _db:
>           _db.insert_multiple({'i': i} for i in range(NUM))

tests/test_tinydb.py:492: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/table.py:117: in insert_multiple
    self._update_table(updater)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <[ValueError('I/O operation on closed file.') raised in repr()] Table object at 0x7fa29efe2050>
updater = <function Table.insert_multiple.<locals>.updater at 0x7fa29df601f0>

    def _update_table(self, updater: Callable[[Dict[int, Mapping]], None]):
        """
        Perform a table update operation.

        The storage interface used by TinyDB only allows to read/write the
        complete database data, but not modifying only portions of it. Thus,
        to only update portions of the table data, we first perform a read
        operation, perform the update on the table data and then write
        the updated data back to the storage.

        As a further optimization, we don't convert the documents into the
        document class, as the table data will *not* be returned to the user.
        """
        data = self._storage.read()
>       table = data.get(self._name, {})
E       AttributeError: 'NoneType' object has no attribute 'get'

tinydb/table.py:370: AttributeError
</pre>
</details>
<h3 id="test_tinydbpytest_doc_ids_json">test_tinydb.py::test_doc_ids_json</h3>
<details><summary> <pre>test_tinydb.py::test_doc_ids_json</pre></summary><pre>
tmpdir = local('/tmp/pytest-of-root/pytest-0/test_doc_ids_json0')

    def test_doc_ids_json(tmpdir):
        """
        Regression test for issue #45
        """

        path = str(tmpdir.join('db.json'))

        with TinyDB(path) as _db:
            _db.drop_tables()
            assert _db.insert({'int': 1, 'char': 'a'}) == 1
            assert _db.insert({'int': 1, 'char': 'a'}) == 2

            _db.drop_tables()
>           assert _db.insert_multiple([{'int': 1, 'char': 'a'},
                                        {'int': 1, 'char': 'b'},
                                        {'int': 1, 'char': 'c'}]) == [1, 2, 3]
E           AssertionError: assert [3, 4, 5] == [1, 2, 3]
E             
E             At index 0 diff: 3 != 1
E             
E             Full diff:
E               [
E             -     1,
E             -     2,...
E             
E             ...Full output truncated (4 lines hidden), use '-vv' to show

tests/test_tinydb.py:511: AssertionError
</pre>
</details>
<h3 id="test_tinydbpytest_insert_string">test_tinydb.py::test_insert_string</h3>
<details><summary> <pre>test_tinydb.py::test_insert_string</pre></summary><pre>
tmpdir = local('/tmp/pytest-of-root/pytest-0/test_insert_string0')

    def test_insert_string(tmpdir):
        path = str(tmpdir.join('db.json'))

        with TinyDB(path) as _db:
            data = [{'int': 1}, {'int': 2}]
>           _db.insert_multiple(data)

tests/test_tinydb.py:535: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/table.py:117: in insert_multiple
    self._update_table(updater)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <[ValueError('I/O operation on closed file.') raised in repr()] Table object at 0x7fa29f110ca0>
updater = <function Table.insert_multiple.<locals>.updater at 0x7fa29df61900>

    def _update_table(self, updater: Callable[[Dict[int, Mapping]], None]):
        """
        Perform a table update operation.

        The storage interface used by TinyDB only allows to read/write the
        complete database data, but not modifying only portions of it. Thus,
        to only update portions of the table data, we first perform a read
        operation, perform the update on the table data and then write
        the updated data back to the storage.

        As a further optimization, we don't convert the documents into the
        document class, as the table data will *not* be returned to the user.
        """
        data = self._storage.read()
>       table = data.get(self._name, {})
E       AttributeError: 'NoneType' object has no attribute 'get'

tinydb/table.py:370: AttributeError
</pre>
</details>
<h3 id="test_tinydbpytest_insert_invalid_dict">test_tinydb.py::test_insert_invalid_dict</h3>
<details><summary> <pre>test_tinydb.py::test_insert_invalid_dict</pre></summary><pre>
tmpdir = local('/tmp/pytest-of-root/pytest-0/test_insert_invalid_dict0')

    def test_insert_invalid_dict(tmpdir):
        path = str(tmpdir.join('db.json'))

        with TinyDB(path) as _db:
            data = [{'int': 1}, {'int': 2}]
>           _db.insert_multiple(data)

tests/test_tinydb.py:553: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/table.py:117: in insert_multiple
    self._update_table(updater)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <[ValueError('I/O operation on closed file.') raised in repr()] Table object at 0x7fa29e02c430>
updater = <function Table.insert_multiple.<locals>.updater at 0x7fa29df620e0>

    def _update_table(self, updater: Callable[[Dict[int, Mapping]], None]):
        """
        Perform a table update operation.

        The storage interface used by TinyDB only allows to read/write the
        complete database data, but not modifying only portions of it. Thus,
        to only update portions of the table data, we first perform a read
        operation, perform the update on the table data and then write
        the updated data back to the storage.

        As a further optimization, we don't convert the documents into the
        document class, as the table data will *not* be returned to the user.
        """
        data = self._storage.read()
>       table = data.get(self._name, {})
E       AttributeError: 'NoneType' object has no attribute 'get'

tinydb/table.py:370: AttributeError
</pre>
</details>
<h3 id="test_tinydbpytest_gc">test_tinydb.py::test_gc</h3>
<details><summary> <pre>test_tinydb.py::test_gc</pre></summary><pre>
tmpdir = local('/tmp/pytest-of-root/pytest-0/test_gc0')

    def test_gc(tmpdir):
        # See https://github.com/msiemens/tinydb/issues/92
        path = str(tmpdir.join('db.json'))
        db = TinyDB(path)
        table = db.table('foo')
>       table.insert({'something': 'else'})

tests/test_tinydb.py:568: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/table.py:99: in insert
    doc_id = self._get_next_id()
tinydb/table.py:340: in _get_next_id
    self._next_id = max(self._read_table().keys() or [0]) + 1
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <[AttributeError("'NoneType' object has no attribute 'get'") raised in repr()] Table object at 0x7fa29e1afcd0>

    def _read_table(self) ->Dict[str, Mapping]:
        """
        Read the table data from the underlying storage.

        Documents and doc_ids are NOT yet transformed, as
        we may not want to convert *all* documents when returning
        only one document for example.
        """
        data = self._storage.read()
>       return data.get(self._name, {})
E       AttributeError: 'NoneType' object has no attribute 'get'

tinydb/table.py:354: AttributeError
</pre>
</details>
<h3 id="test_tinydbpytest_drop_table">test_tinydb.py::test_drop_table</h3>
<details><summary> <pre>test_tinydb.py::test_drop_table</pre></summary><pre>
def test_drop_table():
        db = TinyDB(storage=MemoryStorage)
>       default_table_name = db.table(db.default_table_name).name

tests/test_tinydb.py:577: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <tinydb.database.TinyDB object at 0x7fa29de45f60>
name = 'default_table_name'

    def __getattr__(self, name):
        """
        Forward all unknown attribute calls to the underlying standard table.
        """
>       return getattr(self._table, name)
E       AttributeError: 'Table' object has no attribute 'default_table_name'

tinydb/database.py:293: AttributeError
</pre>
</details>
<h3 id="test_tinydbpytest_query_cache">test_tinydb.py::test_query_cache</h3>
<details><summary> <pre>test_tinydb.py::test_query_cache</pre></summary><pre>
def test_query_cache():
        db = TinyDB(storage=MemoryStorage)
>       db.insert_multiple([
            {'name': 'foo', 'value': 42},
            {'name': 'bar', 'value': -1337}
        ])

tests/test_tinydb.py:614: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/table.py:117: in insert_multiple
    self._update_table(updater)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <[AttributeError("'NoneType' object has no attribute 'get'") raised in repr()] Table object at 0x7fa29f5f0340>
updater = <function Table.insert_multiple.<locals>.updater at 0x7fa29df603a0>

    def _update_table(self, updater: Callable[[Dict[int, Mapping]], None]):
        """
        Perform a table update operation.

        The storage interface used by TinyDB only allows to read/write the
        complete database data, but not modifying only portions of it. Thus,
        to only update portions of the table data, we first perform a read
        operation, perform the update on the table data and then write
        the updated data back to the storage.

        As a further optimization, we don't convert the documents into the
        document class, as the table data will *not* be returned to the user.
        """
        data = self._storage.read()
>       table = data.get(self._name, {})
E       AttributeError: 'NoneType' object has no attribute 'get'

tinydb/table.py:370: AttributeError
</pre>
</details>
<h3 id="test_tinydbpytest_tinydb_is_iterablememory">test_tinydb.py::test_tinydb_is_iterable[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_tinydb_is_iterable[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e3e76a0>

    def test_tinydb_is_iterable(db: TinyDB):
>       assert [r for r in db] == db.all()
E       TypeError: 'TinyDB' object is not iterable

tests/test_tinydb.py:634: TypeError
</pre>
</details>
<h3 id="test_tinydbpytest_tinydb_is_iterablejson">test_tinydb.py::test_tinydb_is_iterable[json]</h3>
<details><summary> <pre>test_tinydb.py::test_tinydb_is_iterable[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29f940bb0>

    def test_tinydb_is_iterable(db: TinyDB):
>       assert [r for r in db] == db.all()
E       TypeError: 'TinyDB' object is not iterable

tests/test_tinydb.py:634: TypeError
</pre>
</details>
<h3 id="test_tinydbpytest_repr">test_tinydb.py::test_repr</h3>
<details><summary> <pre>test_tinydb.py::test_repr</pre></summary><pre>
tmpdir = local('/tmp/pytest-of-root/pytest-0/test_repr0')

    def test_repr(tmpdir):
        path = str(tmpdir.join('db.json'))

        db = TinyDB(path)
>       db.insert({'a': 1})

tests/test_tinydb.py:641: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/table.py:99: in insert
    doc_id = self._get_next_id()
tinydb/table.py:340: in _get_next_id
    self._next_id = max(self._read_table().keys() or [0]) + 1
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <[AttributeError("'NoneType' object has no attribute 'get'") raised in repr()] Table object at 0x7fa29f940ee0>

    def _read_table(self) ->Dict[str, Mapping]:
        """
        Read the table data from the underlying storage.

        Documents and doc_ids are NOT yet transformed, as
        we may not want to convert *all* documents when returning
        only one document for example.
        """
        data = self._storage.read()
>       return data.get(self._name, {})
E       AttributeError: 'NoneType' object has no attribute 'get'

tinydb/table.py:354: AttributeError
</pre>
</details>
<h3 id="test_tinydbpytest_delete">test_tinydb.py::test_delete</h3>
<details><summary> <pre>test_tinydb.py::test_delete</pre></summary><pre>
tmpdir = local('/tmp/pytest-of-root/pytest-0/test_delete0')

    def test_delete(tmpdir):
        path = str(tmpdir.join('db.json'))

        db = TinyDB(path, ensure_ascii=False)
        q = Query()
>       db.insert({'network': {'id': '114', 'name': 'ok', 'rpc': 'dac',
                               'ticker': 'mkay'}})

tests/test_tinydb.py:657: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/table.py:99: in insert
    doc_id = self._get_next_id()
tinydb/table.py:340: in _get_next_id
    self._next_id = max(self._read_table().keys() or [0]) + 1
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <[AttributeError("'NoneType' object has no attribute 'get'") raised in repr()] Table object at 0x7fa29dcecaf0>

    def _read_table(self) ->Dict[str, Mapping]:
        """
        Read the table data from the underlying storage.

        Documents and doc_ids are NOT yet transformed, as
        we may not want to convert *all* documents when returning
        only one document for example.
        """
        data = self._storage.read()
>       return data.get(self._name, {})
E       AttributeError: 'NoneType' object has no attribute 'get'

tinydb/table.py:354: AttributeError
</pre>
</details>
<h3 id="test_tinydbpytest_insert_multiple_with_single_dictmemory">test_tinydb.py::test_insert_multiple_with_single_dict[memory]</h3>
<details><summary> <pre>test_tinydb.py::test_insert_multiple_with_single_dict[memory]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29e03fc40>

    def test_insert_multiple_with_single_dict(db: TinyDB):
>       with pytest.raises(ValueError):
E       Failed: DID NOT RAISE <class 'ValueError'>

tests/test_tinydb.py:668: Failed
</pre>
</details>
<h3 id="test_tinydbpytest_insert_multiple_with_single_dictjson">test_tinydb.py::test_insert_multiple_with_single_dict[json]</h3>
<details><summary> <pre>test_tinydb.py::test_insert_multiple_with_single_dict[json]</pre></summary><pre>
db = <tinydb.database.TinyDB object at 0x7fa29de45de0>

    def test_insert_multiple_with_single_dict(db: TinyDB):
>       with pytest.raises(ValueError):
E       Failed: DID NOT RAISE <class 'ValueError'>

tests/test_tinydb.py:668: Failed
</pre>
</details>
<h3 id="test_tinydbpytest_empty_db_len">test_tinydb.py::test_empty_db_len</h3>
<details><summary> <pre>test_tinydb.py::test_empty_db_len</pre></summary><pre>
def test_empty_db_len():
        db = TinyDB(storage=MemoryStorage)
>       assert len(db) == 0
E       TypeError: object of type 'TinyDB' has no len()

tests/test_tinydb.py:683: TypeError
</pre>
</details>
<h3 id="test_tinydbpytest_insert_on_existing_db">test_tinydb.py::test_insert_on_existing_db</h3>
<details><summary> <pre>test_tinydb.py::test_insert_on_existing_db</pre></summary><pre>
tmpdir = local('/tmp/pytest-of-root/pytest-0/test_insert_on_existing_db0')

    def test_insert_on_existing_db(tmpdir):
        path = str(tmpdir.join('db.json'))

        db = TinyDB(path, ensure_ascii=False)
>       db.insert({'foo': 'bar'})

tests/test_tinydb.py:690: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/table.py:99: in insert
    doc_id = self._get_next_id()
tinydb/table.py:340: in _get_next_id
    self._next_id = max(self._read_table().keys() or [0]) + 1
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <[AttributeError("'NoneType' object has no attribute 'get'") raised in repr()] Table object at 0x7fa29deb60b0>

    def _read_table(self) ->Dict[str, Mapping]:
        """
        Read the table data from the underlying storage.

        Documents and doc_ids are NOT yet transformed, as
        we may not want to convert *all* documents when returning
        only one document for example.
        """
        data = self._storage.read()
>       return data.get(self._name, {})
E       AttributeError: 'NoneType' object has no attribute 'get'

tinydb/table.py:354: AttributeError
</pre>
</details>
<h3 id="test_tinydbpytest_lambda_query">test_tinydb.py::test_lambda_query</h3>
<details><summary> <pre>test_tinydb.py::test_lambda_query</pre></summary><pre>
def test_lambda_query():
        db = TinyDB(storage=MemoryStorage)
>       db.insert({'foo': 'bar'})

tests/test_tinydb.py:711: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
tinydb/table.py:99: in insert
    doc_id = self._get_next_id()
tinydb/table.py:340: in _get_next_id
    self._next_id = max(self._read_table().keys() or [0]) + 1
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <[AttributeError("'NoneType' object has no attribute 'get'") raised in repr()] Table object at 0x7fa29e0aa3e0>

    def _read_table(self) ->Dict[str, Mapping]:
        """
        Read the table data from the underlying storage.

        Documents and doc_ids are NOT yet transformed, as
        we may not want to convert *all* documents when returning
        only one document for example.
        """
        data = self._storage.read()
>       return data.get(self._name, {})
E       AttributeError: 'NoneType' object has no attribute 'get'

tinydb/table.py:354: AttributeError
</pre>
</details>
<h3 id="test_utilspytest_lru_cache">test_utils.py::test_lru_cache</h3>
<details><summary> <pre>test_utils.py::test_lru_cache</pre></summary><pre>
def test_lru_cache():
        cache = LRUCache(capacity=3)
>       cache["a"] = 1

tests/test_utils.py:8: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <tinydb.utils.LRUCache object at 0x7fa29dceda20>, key = 'a', value = 1

    def __setitem__(self, key: K, value: V) ->None:
>       self.set(key, value)
E       AttributeError: 'LRUCache' object has no attribute 'set'. Did you mean: 'get'?

tinydb/utils.py:54: AttributeError
</pre>
</details>
<h3 id="test_utilspytest_lru_cache_set_multiple">test_utils.py::test_lru_cache_set_multiple</h3>
<details><summary> <pre>test_utils.py::test_lru_cache_set_multiple</pre></summary><pre>
def test_lru_cache_set_multiple():
        cache = LRUCache(capacity=3)
>       cache["a"] = 1

tests/test_utils.py:24: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <tinydb.utils.LRUCache object at 0x7fa29e02c850>, key = 'a', value = 1

    def __setitem__(self, key: K, value: V) ->None:
>       self.set(key, value)
E       AttributeError: 'LRUCache' object has no attribute 'set'. Did you mean: 'get'?

tinydb/utils.py:54: AttributeError
</pre>
</details>
<h3 id="test_utilspytest_lru_cache_get">test_utils.py::test_lru_cache_get</h3>
<details><summary> <pre>test_utils.py::test_lru_cache_get</pre></summary><pre>
def test_lru_cache_get():
        cache = LRUCache(capacity=3)
>       cache["a"] = 1

tests/test_utils.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <tinydb.utils.LRUCache object at 0x7fa29ef3a140>, key = 'a', value = 1

    def __setitem__(self, key: K, value: V) ->None:
>       self.set(key, value)
E       AttributeError: 'LRUCache' object has no attribute 'set'. Did you mean: 'get'?

tinydb/utils.py:54: AttributeError
</pre>
</details>
<h3 id="test_utilspytest_lru_cache_delete">test_utils.py::test_lru_cache_delete</h3>
<details><summary> <pre>test_utils.py::test_lru_cache_delete</pre></summary><pre>
def test_lru_cache_delete():
        cache = LRUCache(capacity=3)
>       cache["a"] = 1

tests/test_utils.py:45: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <tinydb.utils.LRUCache object at 0x7fa29e02f8e0>, key = 'a', value = 1

    def __setitem__(self, key: K, value: V) ->None:
>       self.set(key, value)
E       AttributeError: 'LRUCache' object has no attribute 'set'. Did you mean: 'get'?

tinydb/utils.py:54: AttributeError
</pre>
</details>
<h3 id="test_utilspytest_lru_cache_clear">test_utils.py::test_lru_cache_clear</h3>
<details><summary> <pre>test_utils.py::test_lru_cache_clear</pre></summary><pre>
def test_lru_cache_clear():
        cache = LRUCache(capacity=3)
>       cache["a"] = 1

tests/test_utils.py:59: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <tinydb.utils.LRUCache object at 0x7fa29dcef250>, key = 'a', value = 1

    def __setitem__(self, key: K, value: V) ->None:
>       self.set(key, value)
E       AttributeError: 'LRUCache' object has no attribute 'set'. Did you mean: 'get'?

tinydb/utils.py:54: AttributeError
</pre>
</details>
<h3 id="test_utilspytest_lru_cache_unlimited">test_utils.py::test_lru_cache_unlimited</h3>
<details><summary> <pre>test_utils.py::test_lru_cache_unlimited</pre></summary><pre>
def test_lru_cache_unlimited():
        cache = LRUCache()
        for i in range(100):
>           cache[i] = i

tests/test_utils.py:69: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <tinydb.utils.LRUCache object at 0x7fa29e02dd80>, key = 0, value = 0

    def __setitem__(self, key: K, value: V) ->None:
>       self.set(key, value)
E       AttributeError: 'LRUCache' object has no attribute 'set'. Did you mean: 'get'?

tinydb/utils.py:54: AttributeError
</pre>
</details>
<h3 id="test_utilspytest_lru_cache_unlimited_explicit">test_utils.py::test_lru_cache_unlimited_explicit</h3>
<details><summary> <pre>test_utils.py::test_lru_cache_unlimited_explicit</pre></summary><pre>
def test_lru_cache_unlimited_explicit():
        cache = LRUCache(capacity=None)
        for i in range(100):
>           cache[i] = i

tests/test_utils.py:77: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <tinydb.utils.LRUCache object at 0x7fa29dcefe80>, key = 0, value = 0

    def __setitem__(self, key: K, value: V) ->None:
>       self.set(key, value)
E       AttributeError: 'LRUCache' object has no attribute 'set'. Did you mean: 'get'?

tinydb/utils.py:54: AttributeError
</pre>
</details>
<h3 id="test_utilspytest_freeze">test_utils.py::test_freeze</h3>
<details><summary> <pre>test_utils.py::test_freeze</pre></summary><pre>
def test_freeze():
        frozen = freeze([0, 1, 2, {'a': [1, 2, 3]}, {1, 2}])
>       assert isinstance(frozen, tuple)
E       assert False
E        +  where False = isinstance(None, tuple)

tests/test_utils.py:93: AssertionError
</pre>
</details>

<h2 id="patch-diff">Patch diff</h2>
<div class="highlight"><pre><span></span><code><span class="gh">diff --git a/tests/test_operations.py b/tests/test_operations.py</span>
<span class="gh">index 3a6f814..d4e1c51 100644</span>
<span class="gd">--- a/tests/test_operations.py</span>
<span class="gi">+++ b/tests/test_operations.py</span>
<span class="gu">@@ -1,8 +1,11 @@</span>
<span class="gd">-from tinydb import where</span>
<span class="gi">+from tinydb import TinyDB, where</span>
<span class="w"> </span>from tinydb.operations import delete, increment, decrement, add, subtract, set
<span class="gi">+from tinydb.storages import MemoryStorage</span>


<span class="gd">-def test_delete(db):</span>
<span class="gi">+def test_delete():</span>
<span class="gi">+    db = TinyDB(storage=MemoryStorage)</span>
<span class="gi">+    db.insert({&#39;char&#39;: &#39;a&#39;, &#39;int&#39;: 1})</span>
<span class="w"> </span>    db.update(delete(&#39;int&#39;), where(&#39;char&#39;) == &#39;a&#39;)
<span class="w"> </span>    assert &#39;int&#39; not in db.get(where(&#39;char&#39;) == &#39;a&#39;)

<span class="gh">diff --git a/tinydb/__init__.py b/tinydb/__init__.py</span>
<span class="gh">index 0416e2e..e01c4f0 100644</span>
<span class="gd">--- a/tinydb/__init__.py</span>
<span class="gi">+++ b/tinydb/__init__.py</span>
<span class="gu">@@ -27,6 +27,7 @@ Usage example:</span>
<span class="w"> </span>from .queries import Query, where
<span class="w"> </span>from .storages import Storage, JSONStorage
<span class="w"> </span>from .database import TinyDB
<span class="gi">+from .table import Table</span>
<span class="w"> </span>from .version import __version__

<span class="w"> </span>__all__ = (&#39;TinyDB&#39;, &#39;Storage&#39;, &#39;JSONStorage&#39;, &#39;Query&#39;, &#39;where&#39;)
<span class="gh">diff --git a/tinydb/database.py b/tinydb/database.py</span>
<span class="gh">index a4ce0e1..30bc84a 100644</span>
<span class="gd">--- a/tinydb/database.py</span>
<span class="gi">+++ b/tinydb/database.py</span>
<span class="gu">@@ -1,15 +1,13 @@</span>
<span class="w"> </span>&quot;&quot;&quot;
<span class="w"> </span>This module contains the main component of TinyDB: the database.
<span class="w"> </span>&quot;&quot;&quot;
<span class="gd">-from typing import Dict, Iterator, Set, Type</span>
<span class="gi">+from typing import Dict, Iterator, Set</span>
<span class="w"> </span>from . import JSONStorage
<span class="w"> </span>from .storages import Storage
<span class="w"> </span>from .table import Table, Document
<span class="gd">-from .utils import with_typehint</span>
<span class="gd">-TableBase: Type[Table] = with_typehint(Table)</span>


<span class="gd">-class TinyDB(TableBase):</span>
<span class="gi">+class TinyDB:</span>
<span class="w"> </span>    &quot;&quot;&quot;
<span class="w"> </span>    The main class of TinyDB.

<span class="gu">@@ -75,6 +73,7 @@ class TinyDB(TableBase):</span>
<span class="w"> </span>        self._storage: Storage = storage(*args, **kwargs)
<span class="w"> </span>        self._opened = True
<span class="w"> </span>        self._tables: Dict[str, Table] = {}
<span class="gi">+        self._table = self.table(self.default_table_name)</span>

<span class="w"> </span>    def __repr__(self):
<span class="w"> </span>        args = [&#39;tables={}&#39;.format(list(self.tables())), &#39;tables_count={}&#39;.
<span class="gu">@@ -99,7 +98,11 @@ class TinyDB(TableBase):</span>
<span class="w"> </span>        :param name: The name of the table.
<span class="w"> </span>        :param kwargs: Keyword arguments to pass to the table class constructor
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        if name not in self._tables:</span>
<span class="gi">+            self._tables[name] = self.table_class(</span>
<span class="gi">+                self._storage, name, **kwargs</span>
<span class="gi">+            )</span>
<span class="gi">+        return self._tables[name]</span>

<span class="w"> </span>    def tables(self) -&gt;Set[str]:
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -107,13 +110,14 @@ class TinyDB(TableBase):</span>

<span class="w"> </span>        :returns: a set of table names
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return set(self._storage.read().keys())</span>

<span class="w"> </span>    def drop_tables(self) -&gt;None:
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Drop all tables from the database. **CANNOT BE REVERSED!**
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        self._storage.write({})</span>
<span class="gi">+        self._tables.clear()</span>

<span class="w"> </span>    def drop_table(self, name: str) -&gt;None:
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -121,7 +125,12 @@ class TinyDB(TableBase):</span>

<span class="w"> </span>        :param name: The name of the table to drop.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        data = self._storage.read()</span>
<span class="gi">+        if name in data:</span>
<span class="gi">+            del data[name]</span>
<span class="gi">+            self._storage.write(data)</span>
<span class="gi">+        if name in self._tables:</span>
<span class="gi">+            del self._tables[name]</span>

<span class="w"> </span>    @property
<span class="w"> </span>    def storage(self) -&gt;Storage:
<span class="gu">@@ -131,7 +140,7 @@ class TinyDB(TableBase):</span>
<span class="w"> </span>        :return: This instance&#39;s storage
<span class="w"> </span>        :rtype: Storage
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self._storage</span>

<span class="w"> </span>    def close(self) -&gt;None:
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -148,7 +157,8 @@ class TinyDB(TableBase):</span>

<span class="w"> </span>        Upon leaving this context, the ``close`` method will be called.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        self._storage.close()</span>
<span class="gi">+        self._opened = False</span>

<span class="w"> </span>    def __enter__(self):
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -190,3 +200,101 @@ class TinyDB(TableBase):</span>
<span class="w"> </span>        Return an iterator for the default table&#39;s documents.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        return iter(self.table(self.default_table_name))
<span class="gi">+from .table import Table</span>
<span class="gi">+from .storages import Storage, JSONStorage</span>
<span class="gi">+from typing import Mapping, Dict, List, Union, Callable, Optional, Type, Any</span>
<span class="gi">+</span>
<span class="gi">+class TinyDB:</span>
<span class="gi">+    &quot;&quot;&quot;</span>
<span class="gi">+    The main class of TinyDB.</span>
<span class="gi">+</span>
<span class="gi">+    The ``TinyDB`` class is responsible for creating the storage class instance</span>
<span class="gi">+    that will store this database&#39;s documents, managing the database</span>
<span class="gi">+    tables as well as providing access to the default table.</span>
<span class="gi">+</span>
<span class="gi">+    For table management, a simple ``dict`` is used that stores the table class</span>
<span class="gi">+    instances accessible using their table name.</span>
<span class="gi">+    &quot;&quot;&quot;</span>
<span class="gi">+</span>
<span class="gi">+    def __init__(self, *args, **kwargs) -&gt; None:</span>
<span class="gi">+        &quot;&quot;&quot;</span>
<span class="gi">+        Create a new instance of TinyDB.</span>
<span class="gi">+</span>
<span class="gi">+        All arguments and keyword arguments will be passed to the underlying</span>
<span class="gi">+        storage class (default: :class:`~tinydb.storages.JSONStorage`).</span>
<span class="gi">+</span>
<span class="gi">+        :param storage: The class of the storage to use. Will be initialized</span>
<span class="gi">+                        with ``args`` and ``kwargs``.</span>
<span class="gi">+        &quot;&quot;&quot;</span>
<span class="gi">+        storage = kwargs.pop(&#39;storage&#39;, JSONStorage)</span>
<span class="gi">+</span>
<span class="gi">+        # Prepare the storage</span>
<span class="gi">+        self._storage = storage(*args, **kwargs)</span>
<span class="gi">+</span>
<span class="gi">+        self._opened = True</span>
<span class="gi">+</span>
<span class="gi">+        # Prepare the default table</span>
<span class="gi">+        self._table_cache: Dict[str, Table] = {}</span>
<span class="gi">+        self._table = self.table(&#39;_default&#39;)</span>
<span class="gi">+</span>
<span class="gi">+    def table(self, name: str, **kwargs) -&gt; Table:</span>
<span class="gi">+        &quot;&quot;&quot;</span>
<span class="gi">+        Get access to a specific table.</span>
<span class="gi">+</span>
<span class="gi">+        Creates a new table, if it doesn&#39;t exist.</span>
<span class="gi">+        &quot;&quot;&quot;</span>
<span class="gi">+        if name not in self._table_cache:</span>
<span class="gi">+            self._table_cache[name] = Table(self._storage, name, **kwargs)</span>
<span class="gi">+</span>
<span class="gi">+        return self._table_cache[name]</span>
<span class="gi">+</span>
<span class="gi">+    def tables(self) -&gt; List[str]:</span>
<span class="gi">+        &quot;&quot;&quot;</span>
<span class="gi">+        Get the names of all tables in the database.</span>
<span class="gi">+        &quot;&quot;&quot;</span>
<span class="gi">+        return list(self._storage.read().keys())</span>
<span class="gi">+</span>
<span class="gi">+    def drop_table(self, name: str) -&gt; None:</span>
<span class="gi">+        &quot;&quot;&quot;</span>
<span class="gi">+        Drop a table from the database.</span>
<span class="gi">+        &quot;&quot;&quot;</span>
<span class="gi">+        if name in self._table_cache:</span>
<span class="gi">+            del self._table_cache[name]</span>
<span class="gi">+</span>
<span class="gi">+        data = self._storage.read()</span>
<span class="gi">+        if name in data:</span>
<span class="gi">+            del data[name]</span>
<span class="gi">+            self._storage.write(data)</span>
<span class="gi">+</span>
<span class="gi">+    def drop_tables(self) -&gt; None:</span>
<span class="gi">+        &quot;&quot;&quot;</span>
<span class="gi">+        Drop all tables from the database.</span>
<span class="gi">+        &quot;&quot;&quot;</span>
<span class="gi">+        self._table_cache.clear()</span>
<span class="gi">+        self._storage.write({})</span>
<span class="gi">+</span>
<span class="gi">+    def close(self) -&gt; None:</span>
<span class="gi">+        &quot;&quot;&quot;</span>
<span class="gi">+        Close the database.</span>
<span class="gi">+        &quot;&quot;&quot;</span>
<span class="gi">+        self._opened = False</span>
<span class="gi">+        self._storage.close()</span>
<span class="gi">+</span>
<span class="gi">+    def __enter__(self):</span>
<span class="gi">+        return self</span>
<span class="gi">+</span>
<span class="gi">+    def __exit__(self, *args):</span>
<span class="gi">+        self.close()</span>
<span class="gi">+</span>
<span class="gi">+    def __getattr__(self, name):</span>
<span class="gi">+        &quot;&quot;&quot;</span>
<span class="gi">+        Forward all unknown attribute calls to the underlying standard table.</span>
<span class="gi">+        &quot;&quot;&quot;</span>
<span class="gi">+        return getattr(self._table, name)</span>
<span class="gi">+</span>
<span class="gi">+    @property</span>
<span class="gi">+    def storage(self) -&gt; Storage:</span>
<span class="gi">+        &quot;&quot;&quot;</span>
<span class="gi">+        Get the storage instance.</span>
<span class="gi">+        &quot;&quot;&quot;</span>
<span class="gi">+        return self._storage</span>
<span class="gh">diff --git a/tinydb/middlewares.py b/tinydb/middlewares.py</span>
<span class="gh">index 50c2af2..5a47a37 100644</span>
<span class="gd">--- a/tinydb/middlewares.py</span>
<span class="gi">+++ b/tinydb/middlewares.py</span>
<span class="gu">@@ -84,8 +84,29 @@ class CachingMiddleware(Middleware):</span>
<span class="w"> </span>        self.cache = None
<span class="w"> </span>        self._cache_modified_count = 0

<span class="gi">+    def read(self):</span>
<span class="gi">+        &quot;&quot;&quot;</span>
<span class="gi">+        Read data from cache if available, otherwise read from storage.</span>
<span class="gi">+        &quot;&quot;&quot;</span>
<span class="gi">+        if self.cache is None:</span>
<span class="gi">+            self.cache = self.storage.read()</span>
<span class="gi">+        return self.cache</span>
<span class="gi">+</span>
<span class="gi">+    def write(self, data):</span>
<span class="gi">+        &quot;&quot;&quot;</span>
<span class="gi">+        Write data to cache and increment the modified count.</span>
<span class="gi">+        Flush to storage if the modified count reaches WRITE_CACHE_SIZE.</span>
<span class="gi">+        &quot;&quot;&quot;</span>
<span class="gi">+        self.cache = data</span>
<span class="gi">+        self._cache_modified_count += 1</span>
<span class="gi">+        </span>
<span class="gi">+        if self._cache_modified_count &gt;= self.WRITE_CACHE_SIZE:</span>
<span class="gi">+            self.flush()</span>
<span class="gi">+</span>
<span class="w"> </span>    def flush(self):
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Flush all unwritten data to disk.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        if self.cache is not None:</span>
<span class="gi">+            self.storage.write(self.cache)</span>
<span class="gi">+            self._cache_modified_count = 0</span>
<span class="gh">diff --git a/tinydb/operations.py b/tinydb/operations.py</span>
<span class="gh">index fdfa678..4c82060 100644</span>
<span class="gd">--- a/tinydb/operations.py</span>
<span class="gi">+++ b/tinydb/operations.py</span>
<span class="gu">@@ -13,39 +13,56 @@ def delete(field):</span>
<span class="w"> </span>    &quot;&quot;&quot;
<span class="w"> </span>    Delete a given field from the document.
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    def transform(doc):</span>
<span class="gi">+        if field in doc:</span>
<span class="gi">+            del doc[field]</span>
<span class="gi">+    return transform</span>


<span class="w"> </span>def add(field, n):
<span class="w"> </span>    &quot;&quot;&quot;
<span class="w"> </span>    Add ``n`` to a given field in the document.
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    def transform(doc):</span>
<span class="gi">+        if field in doc:</span>
<span class="gi">+            doc[field] += n</span>
<span class="gi">+    return transform</span>


<span class="w"> </span>def subtract(field, n):
<span class="w"> </span>    &quot;&quot;&quot;
<span class="w"> </span>    Subtract ``n`` to a given field in the document.
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    def transform(doc):</span>
<span class="gi">+        if field in doc:</span>
<span class="gi">+            doc[field] -= n</span>
<span class="gi">+    return transform</span>


<span class="w"> </span>def set(field, val):
<span class="w"> </span>    &quot;&quot;&quot;
<span class="w"> </span>    Set a given field to ``val``.
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    def transform(doc):</span>
<span class="gi">+        doc[field] = val</span>
<span class="gi">+    return transform</span>


<span class="w"> </span>def increment(field):
<span class="w"> </span>    &quot;&quot;&quot;
<span class="w"> </span>    Increment a given field in the document by 1.
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    def transform(doc):</span>
<span class="gi">+        if field in doc:</span>
<span class="gi">+            doc[field] += 1</span>
<span class="gi">+    return transform</span>


<span class="w"> </span>def decrement(field):
<span class="w"> </span>    &quot;&quot;&quot;
<span class="w"> </span>    Decrement a given field in the document by 1.
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    def transform(doc):</span>
<span class="gi">+        if field in doc:</span>
<span class="gi">+            doc[field] -= 1</span>
<span class="gi">+    return transform</span>
<span class="gh">diff --git a/tinydb/queries.py b/tinydb/queries.py</span>
<span class="gh">index 0ad5c7e..35a89c4 100644</span>
<span class="gd">--- a/tinydb/queries.py</span>
<span class="gi">+++ b/tinydb/queries.py</span>
<span class="gu">@@ -181,7 +181,18 @@ class Query(QueryInstance):</span>
<span class="w"> </span>        :param hashval: The hash of the query.
<span class="w"> </span>        :return: A :class:`~tinydb.queries.QueryInstance` object
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        if not self._path and not allow_empty_path:</span>
<span class="gi">+            raise RuntimeError(&#39;Query has no path&#39;)</span>
<span class="gi">+</span>
<span class="gi">+        def runner(value):</span>
<span class="gi">+            try:</span>
<span class="gi">+                for part in self._path:</span>
<span class="gi">+                    value = value[part]</span>
<span class="gi">+                return test(value)</span>
<span class="gi">+            except (KeyError, TypeError):</span>
<span class="gi">+                return False</span>
<span class="gi">+</span>
<span class="gi">+        return QueryInstance(runner, hashval)</span>

<span class="w"> </span>    def __eq__(self, rhs: Any):
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -255,7 +266,7 @@ class Query(QueryInstance):</span>

<span class="w"> </span>        &gt;&gt;&gt; Query().f1.exists()
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self._generate_test(lambda _: True, (&#39;exists&#39;, self._path))</span>

<span class="w"> </span>    def matches(self, regex: str, flags: int=0) -&gt;QueryInstance:
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -266,7 +277,10 @@ class Query(QueryInstance):</span>
<span class="w"> </span>        :param regex: The regular expression to use for matching
<span class="w"> </span>        :param flags: regex flags to pass to ``re.match``
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self._generate_test(</span>
<span class="gi">+            lambda value: re.match(regex, value, flags) is not None,</span>
<span class="gi">+            (&#39;matches&#39;, self._path, regex, flags)</span>
<span class="gi">+        )</span>

<span class="w"> </span>    def search(self, regex: str, flags: int=0) -&gt;QueryInstance:
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -278,7 +292,10 @@ class Query(QueryInstance):</span>
<span class="w"> </span>        :param regex: The regular expression to use for matching
<span class="w"> </span>        :param flags: regex flags to pass to ``re.match``
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self._generate_test(</span>
<span class="gi">+            lambda value: re.search(regex, value, flags) is not None,</span>
<span class="gi">+            (&#39;search&#39;, self._path, regex, flags)</span>
<span class="gi">+        )</span>

<span class="w"> </span>    def test(self, func: Callable[[Mapping], bool], *args) -&gt;QueryInstance:
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -300,7 +317,10 @@ class Query(QueryInstance):</span>
<span class="w"> </span>                     argument
<span class="w"> </span>        :param args: Additional arguments to pass to the test function
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self._generate_test(</span>
<span class="gi">+            lambda value: func(value, *args),</span>
<span class="gi">+            (&#39;test&#39;, self._path, func, args)</span>
<span class="gi">+        )</span>

<span class="w"> </span>    def any(self, cond: Union[QueryInstance, List[Any]]) -&gt;QueryInstance:
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -324,7 +344,14 @@ class Query(QueryInstance):</span>
<span class="w"> </span>                     a list of which at least one document has to be contained
<span class="w"> </span>                     in the tested document.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        if isinstance(cond, QueryInstance):</span>
<span class="gi">+            def test(value):</span>
<span class="gi">+                return any(cond(item) for item in value)</span>
<span class="gi">+        else:</span>
<span class="gi">+            def test(value):</span>
<span class="gi">+                return any(item in cond for item in value)</span>
<span class="gi">+</span>
<span class="gi">+        return self._generate_test(test, (&#39;any&#39;, self._path, freeze(cond)))</span>

<span class="w"> </span>    def all(self, cond: Union[&#39;QueryInstance&#39;, List[Any]]) -&gt;QueryInstance:
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -346,7 +373,14 @@ class Query(QueryInstance):</span>
<span class="w"> </span>        :param cond: Either a query that all documents have to match or a list
<span class="w"> </span>                     which has to be contained in the tested document.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        if isinstance(cond, QueryInstance):</span>
<span class="gi">+            def test(value):</span>
<span class="gi">+                return all(cond(item) for item in value)</span>
<span class="gi">+        else:</span>
<span class="gi">+            def test(value):</span>
<span class="gi">+                return all(item in value for item in cond)</span>
<span class="gi">+</span>
<span class="gi">+        return self._generate_test(test, (&#39;all&#39;, self._path, freeze(cond)))</span>

<span class="w"> </span>    def one_of(self, items: List[Any]) -&gt;QueryInstance:
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -356,7 +390,8 @@ class Query(QueryInstance):</span>

<span class="w"> </span>        :param items: The list of items to check with
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self._generate_test(lambda value: value in items,</span>
<span class="gi">+                                   (&#39;one_of&#39;, self._path, freeze(items)))</span>

<span class="w"> </span>    def noop(self) -&gt;QueryInstance:
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -364,18 +399,21 @@ class Query(QueryInstance):</span>

<span class="w"> </span>        Useful for having a base value when composing queries dynamically.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self._generate_test(lambda _: True, (&#39;noop&#39;,), allow_empty_path=True)</span>

<span class="w"> </span>    def map(self, fn: Callable[[Any], Any]) -&gt;&#39;Query&#39;:
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Add a function to the query path. Similar to __getattr__ but for
<span class="w"> </span>        arbitrary functions.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        query = type(self)()</span>
<span class="gi">+        query._path = self._path + (fn,)</span>
<span class="gi">+        query._hash = (&#39;map&#39;, query._path) if self.is_cacheable() else None</span>
<span class="gi">+        return query</span>


<span class="w"> </span>def where(key: str) -&gt;Query:
<span class="w"> </span>    &quot;&quot;&quot;
<span class="w"> </span>    A shorthand for ``Query()[key]``
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    return Query()[key]</span>
<span class="gh">diff --git a/tinydb/storages.py b/tinydb/storages.py</span>
<span class="gh">index 0ddc223..16f317b 100644</span>
<span class="gd">--- a/tinydb/storages.py</span>
<span class="gi">+++ b/tinydb/storages.py</span>
<span class="gu">@@ -18,7 +18,12 @@ def touch(path: str, create_dirs: bool):</span>
<span class="w"> </span>    :param path: The file to create.
<span class="w"> </span>    :param create_dirs: Whether to create all missing parent directories.
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    if create_dirs:</span>
<span class="gi">+        os.makedirs(os.path.dirname(path), exist_ok=True)</span>
<span class="gi">+    </span>
<span class="gi">+    if not os.path.exists(path):</span>
<span class="gi">+        with open(path, &#39;a&#39;):</span>
<span class="gi">+            os.utime(path, None)</span>


<span class="w"> </span>class Storage(ABC):
<span class="gu">@@ -38,7 +43,7 @@ class Storage(ABC):</span>

<span class="w"> </span>        Return ``None`` here to indicate that the storage is empty.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        raise NotImplementedError(&quot;This method needs to be implemented by a subclass&quot;)</span>

<span class="w"> </span>    @abstractmethod
<span class="w"> </span>    def write(self, data: Dict[str, Dict[str, Any]]) -&gt;None:
<span class="gu">@@ -49,7 +54,7 @@ class Storage(ABC):</span>

<span class="w"> </span>        :param data: The current state of the database.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        raise NotImplementedError(&quot;This method needs to be implemented by a subclass&quot;)</span>

<span class="w"> </span>    def close(self) -&gt;None:
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -88,6 +93,23 @@ class JSONStorage(Storage):</span>
<span class="w"> </span>        if any([(character in self._mode) for character in (&#39;+&#39;, &#39;w&#39;, &#39;a&#39;)]):
<span class="w"> </span>            touch(path, create_dirs=create_dirs)
<span class="w"> </span>        self._handle = open(path, mode=self._mode, encoding=encoding)
<span class="gi">+        self.path = path</span>
<span class="gi">+        self.encoding = encoding</span>
<span class="gi">+</span>
<span class="gi">+    def read(self) -&gt;Optional[Dict[str, Dict[str, Any]]]:</span>
<span class="gi">+        self._handle.seek(0)</span>
<span class="gi">+        try:</span>
<span class="gi">+            return json.load(self._handle)</span>
<span class="gi">+        except ValueError:</span>
<span class="gi">+            return None</span>
<span class="gi">+</span>
<span class="gi">+    def write(self, data: Dict[str, Dict[str, Any]]) -&gt;None:</span>
<span class="gi">+        self._handle.seek(0)</span>
<span class="gi">+        json.dump(data, self._handle, **self.kwargs)</span>
<span class="gi">+        self._handle.truncate()</span>
<span class="gi">+</span>
<span class="gi">+    def close(self) -&gt;None:</span>
<span class="gi">+        self._handle.close()</span>


<span class="w"> </span>class MemoryStorage(Storage):
<span class="gu">@@ -101,3 +123,12 @@ class MemoryStorage(Storage):</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        super().__init__()
<span class="w"> </span>        self.memory = None
<span class="gi">+</span>
<span class="gi">+    def read(self) -&gt;Optional[Dict[str, Dict[str, Any]]]:</span>
<span class="gi">+        return self.memory</span>
<span class="gi">+</span>
<span class="gi">+    def write(self, data: Dict[str, Dict[str, Any]]) -&gt;None:</span>
<span class="gi">+        self.memory = data</span>
<span class="gi">+</span>
<span class="gi">+    def close(self) -&gt;None:</span>
<span class="gi">+        pass</span>
<span class="gh">diff --git a/tinydb/table.py b/tinydb/table.py</span>
<span class="gh">index 48eea63..9ed928b 100644</span>
<span class="gd">--- a/tinydb/table.py</span>
<span class="gi">+++ b/tinydb/table.py</span>
<span class="gu">@@ -4,9 +4,9 @@ data in TinyDB.</span>
<span class="w"> </span>&quot;&quot;&quot;
<span class="w"> </span>from typing import Callable, Dict, Iterable, Iterator, List, Mapping, Optional, Union, cast, Tuple
<span class="w"> </span>from .queries import QueryLike
<span class="gd">-from .storages import Storage</span>
<span class="gi">+from .storages import Storage, MemoryStorage</span>
<span class="w"> </span>from .utils import LRUCache
<span class="gd">-__all__ = &#39;Document&#39;, &#39;Table&#39;</span>
<span class="gi">+__all__ = &#39;Document&#39;, &#39;Table&#39;, &#39;TableBase&#39;</span>


<span class="w"> </span>class Document(dict):
<span class="gu">@@ -64,15 +64,10 @@ class Table:</span>
<span class="w"> </span>    query_cache_class = LRUCache
<span class="w"> </span>    default_query_cache_capacity = 10

<span class="gd">-    def __init__(self, storage: Storage, name: str, cache_size: int=</span>
<span class="gd">-        default_query_cache_capacity):</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gd">-        Create a table instance.</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def __init__(self, storage: Storage, name: str, cache_size: int = default_query_cache_capacity):</span>
<span class="w"> </span>        self._storage = storage
<span class="w"> </span>        self._name = name
<span class="gd">-        self._query_cache: LRUCache[QueryLike, List[Document]</span>
<span class="gd">-            ] = self.query_cache_class(capacity=cache_size)</span>
<span class="gi">+        self._query_cache: LRUCache[QueryLike, List[Document]] = self.query_cache_class(capacity=cache_size)</span>
<span class="w"> </span>        self._next_id = None

<span class="w"> </span>    def __repr__(self):
<span class="gu">@@ -85,14 +80,14 @@ class Table:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Get the table name.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self._name</span>

<span class="w"> </span>    @property
<span class="w"> </span>    def storage(self) -&gt;Storage:
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Get the table storage instance.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self._storage</span>

<span class="w"> </span>    def insert(self, document: Mapping) -&gt;int:
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -101,7 +96,10 @@ class Table:</span>
<span class="w"> </span>        :param document: the document to insert
<span class="w"> </span>        :returns: the inserted document&#39;s ID
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        doc_id = self._get_next_id()</span>
<span class="gi">+        self._update_table(lambda table: table.update({doc_id: document}))</span>
<span class="gi">+        self.clear_cache()</span>
<span class="gi">+        return doc_id</span>

<span class="w"> </span>    def insert_multiple(self, documents: Iterable[Mapping]) -&gt;List[int]:
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -110,7 +108,15 @@ class Table:</span>
<span class="w"> </span>        :param documents: an Iterable of documents to insert
<span class="w"> </span>        :returns: a list containing the inserted documents&#39; IDs
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        doc_ids = []</span>
<span class="gi">+        def updater(table):</span>
<span class="gi">+            for document in documents:</span>
<span class="gi">+                doc_id = self._get_next_id()</span>
<span class="gi">+                table[doc_id] = document</span>
<span class="gi">+                doc_ids.append(doc_id)</span>
<span class="gi">+        self._update_table(updater)</span>
<span class="gi">+        self.clear_cache()</span>
<span class="gi">+        return doc_ids</span>

<span class="w"> </span>    def all(self) -&gt;List[Document]:
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -118,7 +124,8 @@ class Table:</span>

<span class="w"> </span>        :returns: a list with all documents.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return [self.document_class(doc, self.document_id_class(doc_id))</span>
<span class="gi">+                for doc_id, doc in self._read_table().items()]</span>

<span class="w"> </span>    def search(self, cond: QueryLike) -&gt;List[Document]:
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -127,7 +134,14 @@ class Table:</span>
<span class="w"> </span>        :param cond: the condition to check against
<span class="w"> </span>        :returns: list of matching documents
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        if cond in self._query_cache:</span>
<span class="gi">+            return self._query_cache[cond]</span>
<span class="gi">+</span>
<span class="gi">+        docs = [self.document_class(doc, self.document_id_class(doc_id))</span>
<span class="gi">+                for doc_id, doc in self._read_table().items()</span>
<span class="gi">+                if cond(doc)]</span>
<span class="gi">+        self._query_cache[cond] = docs</span>
<span class="gi">+        return docs</span>

<span class="w"> </span>    def get(self, cond: Optional[QueryLike]=None, doc_id: Optional[int]=
<span class="w"> </span>        None, doc_ids: Optional[List]=None) -&gt;Optional[Union[Document, List
<span class="gu">@@ -145,7 +159,23 @@ class Table:</span>

<span class="w"> </span>        :returns: the document(s) or ``None``
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        if doc_id is not None:</span>
<span class="gi">+            table = self._read_table()</span>
<span class="gi">+            if doc_id in table:</span>
<span class="gi">+                return self.document_class(table[doc_id], self.document_id_class(doc_id))</span>
<span class="gi">+            return None</span>
<span class="gi">+</span>
<span class="gi">+        if doc_ids is not None:</span>
<span class="gi">+            table = self._read_table()</span>
<span class="gi">+            return [self.document_class(table[id], self.document_id_class(id))</span>
<span class="gi">+                    for id in doc_ids if id in table]</span>
<span class="gi">+</span>
<span class="gi">+        if cond is not None:</span>
<span class="gi">+            docs = self.search(cond)</span>
<span class="gi">+            if docs:</span>
<span class="gi">+                return docs[0]</span>
<span class="gi">+</span>
<span class="gi">+        return None</span>

<span class="w"> </span>    def contains(self, cond: Optional[QueryLike]=None, doc_id: Optional[int
<span class="w"> </span>        ]=None) -&gt;bool:
<span class="gu">@@ -158,7 +188,10 @@ class Table:</span>
<span class="w"> </span>        :param cond: the condition use
<span class="w"> </span>        :param doc_id: the document ID to look for
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        if doc_id is not None:</span>
<span class="gi">+            return doc_id in self._read_table()</span>
<span class="gi">+</span>
<span class="gi">+        return bool(self.get(cond))</span>

<span class="w"> </span>    def update(self, fields: Union[Mapping, Callable[[Mapping], None]],
<span class="w"> </span>        cond: Optional[QueryLike]=None, doc_ids: Optional[Iterable[int]]=None
<span class="gu">@@ -172,7 +205,20 @@ class Table:</span>
<span class="w"> </span>        :param doc_ids: a list of document IDs
<span class="w"> </span>        :returns: a list containing the updated document&#39;s ID
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        updated_ids = []</span>
<span class="gi">+</span>
<span class="gi">+        def updater(table):</span>
<span class="gi">+            for doc_id, doc in table.items():</span>
<span class="gi">+                if (doc_ids is None or doc_id in doc_ids) and (cond is None or cond(doc)):</span>
<span class="gi">+                    if callable(fields):</span>
<span class="gi">+                        fields(doc)</span>
<span class="gi">+                    else:</span>
<span class="gi">+                        doc.update(fields)</span>
<span class="gi">+                    updated_ids.append(doc_id)</span>
<span class="gi">+</span>
<span class="gi">+        self._update_table(updater)</span>
<span class="gi">+        self.clear_cache()</span>
<span class="gi">+        return updated_ids</span>

<span class="w"> </span>    def update_multiple(self, updates: Iterable[Tuple[Union[Mapping,
<span class="w"> </span>        Callable[[Mapping], None]], QueryLike]]) -&gt;List[int]:
<span class="gu">@@ -181,7 +227,21 @@ class Table:</span>

<span class="w"> </span>        :returns: a list containing the updated document&#39;s ID
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        updated_ids = []</span>
<span class="gi">+</span>
<span class="gi">+        def updater(table):</span>
<span class="gi">+            for fields, cond in updates:</span>
<span class="gi">+                for doc_id, doc in table.items():</span>
<span class="gi">+                    if cond(doc):</span>
<span class="gi">+                        if callable(fields):</span>
<span class="gi">+                            fields(doc)</span>
<span class="gi">+                        else:</span>
<span class="gi">+                            doc.update(fields)</span>
<span class="gi">+                        updated_ids.append(doc_id)</span>
<span class="gi">+</span>
<span class="gi">+        self._update_table(updater)</span>
<span class="gi">+        self.clear_cache()</span>
<span class="gi">+        return updated_ids</span>

<span class="w"> </span>    def upsert(self, document: Mapping, cond: Optional[QueryLike]=None) -&gt;List[
<span class="w"> </span>        int]:
<span class="gu">@@ -197,7 +257,18 @@ class Table:</span>
<span class="w"> </span>        Document with a doc_id
<span class="w"> </span>        :returns: a list containing the updated documents&#39; IDs
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        if isinstance(document, Document):</span>
<span class="gi">+            doc_id = document.doc_id</span>
<span class="gi">+            document = dict(document)</span>
<span class="gi">+            del document[&#39;doc_id&#39;]</span>
<span class="gi">+            if cond is None:</span>
<span class="gi">+                cond = lambda doc: doc.doc_id == doc_id</span>
<span class="gi">+</span>
<span class="gi">+        updated = self.update(document, cond)</span>
<span class="gi">+        if updated:</span>
<span class="gi">+            return updated</span>
<span class="gi">+        else:</span>
<span class="gi">+            return [self.insert(document)]</span>

<span class="w"> </span>    def remove(self, cond: Optional[QueryLike]=None, doc_ids: Optional[
<span class="w"> </span>        Iterable[int]]=None) -&gt;List[int]:
<span class="gu">@@ -208,13 +279,29 @@ class Table:</span>
<span class="w"> </span>        :param doc_ids: a list of document IDs
<span class="w"> </span>        :returns: a list containing the removed documents&#39; ID
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        removed = []</span>
<span class="gi">+</span>
<span class="gi">+        def updater(table):</span>
<span class="gi">+            nonlocal removed</span>
<span class="gi">+            if doc_ids is not None:</span>
<span class="gi">+                removed = [doc_id for doc_id in doc_ids if doc_id in table]</span>
<span class="gi">+                for doc_id in removed:</span>
<span class="gi">+                    del table[doc_id]</span>
<span class="gi">+            else:</span>
<span class="gi">+                removed = [doc_id for doc_id, doc in table.items() if cond is None or cond(doc)]</span>
<span class="gi">+                for doc_id in removed:</span>
<span class="gi">+                    del table[doc_id]</span>
<span class="gi">+</span>
<span class="gi">+        self._update_table(updater)</span>
<span class="gi">+        self.clear_cache()</span>
<span class="gi">+        return removed</span>

<span class="w"> </span>    def truncate(self) -&gt;None:
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Truncate the table by removing all documents.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        self._update_table(lambda table: table.clear())</span>
<span class="gi">+        self.clear_cache()</span>

<span class="w"> </span>    def count(self, cond: QueryLike) -&gt;int:
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -222,7 +309,7 @@ class Table:</span>

<span class="w"> </span>        :param cond: the condition use
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return len(self.search(cond))</span>

<span class="w"> </span>    def clear_cache(self) -&gt;None:
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -249,7 +336,11 @@ class Table:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Return the ID for a newly inserted document.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        if self._next_id is None:</span>
<span class="gi">+            self._next_id = max(self._read_table().keys() or [0]) + 1</span>
<span class="gi">+        else:</span>
<span class="gi">+            self._next_id += 1</span>
<span class="gi">+        return self._next_id</span>

<span class="w"> </span>    def _read_table(self) -&gt;Dict[str, Mapping]:
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -259,7 +350,8 @@ class Table:</span>
<span class="w"> </span>        we may not want to convert *all* documents when returning
<span class="w"> </span>        only one document for example.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        data = self._storage.read()</span>
<span class="gi">+        return data.get(self._name, {})</span>

<span class="w"> </span>    def _update_table(self, updater: Callable[[Dict[int, Mapping]], None]):
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -274,4 +366,8 @@ class Table:</span>
<span class="w"> </span>        As a further optimization, we don&#39;t convert the documents into the
<span class="w"> </span>        document class, as the table data will *not* be returned to the user.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        data = self._storage.read()</span>
<span class="gi">+        table = data.get(self._name, {})</span>
<span class="gi">+        updater(table)</span>
<span class="gi">+        data[self._name] = table</span>
<span class="gi">+        self._storage.write(data)</span>
<span class="gh">diff --git a/tinydb/utils.py b/tinydb/utils.py</span>
<span class="gh">index 0721622..a9c20dd 100644</span>
<span class="gd">--- a/tinydb/utils.py</span>
<span class="gi">+++ b/tinydb/utils.py</span>
<span class="gu">@@ -66,6 +66,9 @@ class LRUCache(abc.MutableMapping, Generic[K, V]):</span>
<span class="w"> </span>        return iter(self.cache)


<span class="gi">+def _immutable(*args, **kwargs):</span>
<span class="gi">+    raise TypeError(&quot;object is immutable&quot;)</span>
<span class="gi">+</span>
<span class="w"> </span>class FrozenDict(dict):
<span class="w"> </span>    &quot;&quot;&quot;
<span class="w"> </span>    An immutable dictionary.
<span class="gu">@@ -82,6 +85,7 @@ class FrozenDict(dict):</span>
<span class="w"> </span>    clear = _immutable
<span class="w"> </span>    setdefault = _immutable
<span class="w"> </span>    popitem = _immutable
<span class="gi">+    update = _immutable</span>


<span class="w"> </span>def freeze(obj):
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d6f25eb3.min.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../javascripts/tablesort.js"></script>
      
    
  </body>
</html>