
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.37">
    
    
      
        <title>Analysis commit0 lite plain fillin voluptuous - Commit-0</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8c3ca2c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#claude-sonnet-35-fill-in-voluptuous" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Commit-0" class="md-header__button md-logo" aria-label="Commit-0" data-md-component="logo">
      
  <img src="../logo2.webp" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Commit-0
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Analysis commit0 lite plain fillin voluptuous
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Commit-0" class="md-nav__button md-logo" aria-label="Commit-0" data-md-component="logo">
      
  <img src="../logo2.webp" alt="logo">

    </a>
    Commit-0
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../setupdist/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Commit0
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Agent
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Leaderboard
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#failed-to-run-pytests-for-test-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Failed to run pytests for test tests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patch-diff" class="md-nav__link">
    <span class="md-ellipsis">
      Patch diff
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<p><a href="/analysis_commit0-lite-plain_fillin">back to Claude Sonnet 3.5 - Fill-in summary</a></p>
<h1 id="claude-sonnet-35-fill-in-voluptuous"><strong>Claude Sonnet 3.5 - Fill-in</strong>: voluptuous</h1>
<h2 id="failed-to-run-pytests-for-test-tests">Failed to run pytests for test <code>tests</code></h2>
<div class="highlight"><pre><span></span><code>Pytest collection failure.
</code></pre></div>
<h2 id="patch-diff">Patch diff</h2>
<div class="highlight"><pre><span></span><code><span class="gh">diff --git a/voluptuous/error.py b/voluptuous/error.py</span>
<span class="gh">index f72fbe7..135f37e 100644</span>
<span class="gd">--- a/voluptuous/error.py</span>
<span class="gi">+++ b/voluptuous/error.py</span>
<span class="gu">@@ -146,7 +146,7 @@ class LiteralInvalid(Invalid):</span>


<span class="w"> </span>class LengthInvalid(Invalid):
<span class="gd">-    pass</span>
<span class="gi">+    &quot;&quot;&quot;The value has an invalid length.&quot;&quot;&quot;</span>


<span class="w"> </span>class DatetimeInvalid(Invalid):
<span class="gu">@@ -158,22 +158,40 @@ class DateInvalid(Invalid):</span>


<span class="w"> </span>class InInvalid(Invalid):
<span class="gd">-    pass</span>
<span class="gi">+    &quot;&quot;&quot;The value is not in the required collection.&quot;&quot;&quot;</span>


<span class="w"> </span>class NotInInvalid(Invalid):
<span class="gd">-    pass</span>
<span class="gi">+    &quot;&quot;&quot;The value is in a collection it should not be in.&quot;&quot;&quot;</span>


<span class="w"> </span>class ExactSequenceInvalid(Invalid):
<span class="gd">-    pass</span>
<span class="gi">+    &quot;&quot;&quot;The sequence does not match exactly.&quot;&quot;&quot;</span>


<span class="w"> </span>class NotEnoughValid(Invalid):
<span class="w"> </span>    &quot;&quot;&quot;The value did not pass enough validations.&quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    def __init__(self, msg: str, path: typing.Optional[typing.List[typing.Hashable]] = None,</span>
<span class="gi">+                 error_message: typing.Optional[str] = None,</span>
<span class="gi">+                 error_type: typing.Optional[str] = None,</span>
<span class="gi">+                 expected: int = 0, actual: int = 0) -&gt; None:</span>
<span class="gi">+        super().__init__(msg, path, error_message, error_type)</span>
<span class="gi">+        self.expected = expected</span>
<span class="gi">+        self.actual = actual</span>
<span class="gi">+</span>
<span class="gi">+    def __str__(self) -&gt; str:</span>
<span class="gi">+        return f&quot;{super().__str__()} (expected at least {self.expected}, got {self.actual})&quot;</span>


<span class="w"> </span>class TooManyValid(Invalid):
<span class="w"> </span>    &quot;&quot;&quot;The value passed more than expected validations.&quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    def __init__(self, msg: str, path: typing.Optional[typing.List[typing.Hashable]] = None,</span>
<span class="gi">+                 error_message: typing.Optional[str] = None,</span>
<span class="gi">+                 error_type: typing.Optional[str] = None,</span>
<span class="gi">+                 expected: int = 0, actual: int = 0) -&gt; None:</span>
<span class="gi">+        super().__init__(msg, path, error_message, error_type)</span>
<span class="gi">+        self.expected = expected</span>
<span class="gi">+        self.actual = actual</span>
<span class="gi">+</span>
<span class="gi">+    def __str__(self) -&gt; str:</span>
<span class="gi">+        return f&quot;{super().__str__()} (expected at most {self.expected}, got {self.actual})&quot;</span>
<span class="gh">diff --git a/voluptuous/humanize.py b/voluptuous/humanize.py</span>
<span class="gh">index 2902871..fabb7d0 100644</span>
<span class="gd">--- a/voluptuous/humanize.py</span>
<span class="gi">+++ b/voluptuous/humanize.py</span>
<span class="gu">@@ -11,4 +11,29 @@ def humanize_error(data, validation_error: Invalid, max_sub_error_length:</span>
<span class="w"> </span>    Invalid and MultipleInvalid do not include the offending value in error messages,
<span class="w"> </span>    and MultipleInvalid.__str__ only provides the first error.
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    if isinstance(validation_error, MultipleInvalid):</span>
<span class="gi">+        errors = validation_error.errors</span>
<span class="gi">+    else:</span>
<span class="gi">+        errors = [validation_error]</span>
<span class="gi">+</span>
<span class="gi">+    error_messages = []</span>
<span class="gi">+    for error in errors:</span>
<span class="gi">+        path = &#39; -&gt; &#39;.join(str(p) for p in error.path) if error.path else &#39;root&#39;</span>
<span class="gi">+        value = get_value_from_path(data, error.path)</span>
<span class="gi">+        value_str = str(value)[:max_sub_error_length]</span>
<span class="gi">+        if len(str(value)) &gt; max_sub_error_length:</span>
<span class="gi">+            value_str += &#39;...&#39;</span>
<span class="gi">+        error_messages.append(f&quot;Error at {path}: {error.error_message}. Got: {value_str}&quot;)</span>
<span class="gi">+</span>
<span class="gi">+    return &#39;\n&#39;.join(error_messages)</span>
<span class="gi">+</span>
<span class="gi">+def get_value_from_path(data, path):</span>
<span class="gi">+    &quot;&quot;&quot;Helper function to get the value from the data using the error path.&quot;&quot;&quot;</span>
<span class="gi">+    for key in path:</span>
<span class="gi">+        if isinstance(data, (list, tuple)) and isinstance(key, int):</span>
<span class="gi">+            data = data[key] if 0 &lt;= key &lt; len(data) else None</span>
<span class="gi">+        elif isinstance(data, dict):</span>
<span class="gi">+            data = data.get(key)</span>
<span class="gi">+        else:</span>
<span class="gi">+            return None</span>
<span class="gi">+    return data</span>
<span class="gh">diff --git a/voluptuous/schema_builder.py b/voluptuous/schema_builder.py</span>
<span class="gh">index de2b53c..df86a0a 100644</span>
<span class="gd">--- a/voluptuous/schema_builder.py</span>
<span class="gi">+++ b/voluptuous/schema_builder.py</span>
<span class="gu">@@ -113,7 +113,21 @@ class Schema(object):</span>

<span class="w"> </span>        Note: only very basic inference is supported.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        def infer_type(value):</span>
<span class="gi">+            if isinstance(value, dict):</span>
<span class="gi">+                return {k: infer_type(v) for k, v in value.items()}</span>
<span class="gi">+            elif isinstance(value, list):</span>
<span class="gi">+                if value:</span>
<span class="gi">+                    return [infer_type(value[0])]</span>
<span class="gi">+                else:</span>
<span class="gi">+                    return list</span>
<span class="gi">+            elif isinstance(value, (int, float, str, bool)):</span>
<span class="gi">+                return type(value)</span>
<span class="gi">+            else:</span>
<span class="gi">+                return object</span>
<span class="gi">+</span>
<span class="gi">+        inferred_schema = infer_type(data)</span>
<span class="gi">+        return cls(inferred_schema, **kwargs)</span>

<span class="w"> </span>    def __eq__(self, other):
<span class="w"> </span>        if not isinstance(other, Schema):
<span class="gu">@@ -142,7 +156,34 @@ class Schema(object):</span>

<span class="w"> </span>    def _compile_mapping(self, schema, invalid_msg=None):
<span class="w"> </span>        &quot;&quot;&quot;Create validator for given mapping.&quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        def validate_mapping(path, data):</span>
<span class="gi">+            if not isinstance(data, dict):</span>
<span class="gi">+                raise er.Invalid(invalid_msg or &#39;expected a dictionary&#39;, path)</span>
<span class="gi">+</span>
<span class="gi">+            out = type(data)()</span>
<span class="gi">+            for key, value in data.items():</span>
<span class="gi">+                key_path = path + [key]</span>
<span class="gi">+                if key in schema:</span>
<span class="gi">+                    out[key] = schema[key](key_path, value)</span>
<span class="gi">+                elif isinstance(key, str) and key.startswith(&#39;$&#39;):</span>
<span class="gi">+                    out[key] = value</span>
<span class="gi">+                elif Any in schema:</span>
<span class="gi">+                    out[key] = schema[Any](key_path, value)</span>
<span class="gi">+                elif self.extra == ALLOW_EXTRA:</span>
<span class="gi">+                    out[key] = value</span>
<span class="gi">+                elif self.extra != REMOVE_EXTRA:</span>
<span class="gi">+                    raise er.Invalid(&#39;extra keys not allowed&#39;, key_path)</span>
<span class="gi">+</span>
<span class="gi">+            for key, validator in schema.items():</span>
<span class="gi">+                if isinstance(key, Required) and key.schema not in out:</span>
<span class="gi">+                    if key.default is not UNDEFINED:</span>
<span class="gi">+                        out[key.schema] = key.default()</span>
<span class="gi">+                    else:</span>
<span class="gi">+                        raise er.RequiredFieldInvalid(&#39;required key not provided&#39;, path + [key.schema])</span>
<span class="gi">+</span>
<span class="gi">+            return out</span>
<span class="gi">+</span>
<span class="gi">+        return validate_mapping</span>

<span class="w"> </span>    def _compile_object(self, schema):
<span class="w"> </span>        &quot;&quot;&quot;Validate an object.
<span class="gu">@@ -162,7 +203,27 @@ class Schema(object):</span>
<span class="w"> </span>            ...   validate(Structure(one=&#39;three&#39;))

<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        def validate_object(path, data):</span>
<span class="gi">+            if not isinstance(data, schema.cls):</span>
<span class="gi">+                raise er.Invalid(f&#39;expected {schema.cls.__name__}&#39;, path)</span>
<span class="gi">+</span>
<span class="gi">+            out = schema.cls()</span>
<span class="gi">+            for key, validator in schema.items():</span>
<span class="gi">+                if hasattr(data, key):</span>
<span class="gi">+                    value = getattr(data, key)</span>
<span class="gi">+                    try:</span>
<span class="gi">+                        setattr(out, key, validator(path + [key], value))</span>
<span class="gi">+                    except er.Invalid as e:</span>
<span class="gi">+                        raise er.Invalid(f&#39;not a valid value for object value&#39;, path + [key]) from e</span>
<span class="gi">+                elif isinstance(key, Required):</span>
<span class="gi">+                    if key.default is not UNDEFINED:</span>
<span class="gi">+                        setattr(out, key.schema, key.default())</span>
<span class="gi">+                    else:</span>
<span class="gi">+                        raise er.RequiredFieldInvalid(&#39;required attribute not provided&#39;, path + [key.schema])</span>
<span class="gi">+</span>
<span class="gi">+            return out</span>
<span class="gi">+</span>
<span class="gi">+        return validate_object</span>

<span class="w"> </span>    def _compile_dict(self, schema):
<span class="w"> </span>        &quot;&quot;&quot;Validate a dictionary.
<span class="gu">@@ -240,7 +301,48 @@ class Schema(object):</span>
<span class="w"> </span>         &quot;expected str for dictionary value @ data[&#39;adict&#39;][&#39;strfield&#39;]&quot;]

<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        def validate_dict(path, data):</span>
<span class="gi">+            if not isinstance(data, dict):</span>
<span class="gi">+                raise er.Invalid(&#39;expected a dictionary&#39;, path)</span>
<span class="gi">+</span>
<span class="gi">+            out = type(data)()</span>
<span class="gi">+            errors = []</span>
<span class="gi">+            for key, value in data.items():</span>
<span class="gi">+                key_path = path + [key]</span>
<span class="gi">+                if key in schema:</span>
<span class="gi">+                    try:</span>
<span class="gi">+                        out[key] = schema[key](key_path, value)</span>
<span class="gi">+                    except er.Invalid as e:</span>
<span class="gi">+                        errors.append(e)</span>
<span class="gi">+                elif isinstance(key, type):</span>
<span class="gi">+                    if any(isinstance(k, type) for k in schema):</span>
<span class="gi">+                        continue</span>
<span class="gi">+                    try:</span>
<span class="gi">+                        valid_key = next(k for k in schema if isinstance(k, type) and isinstance(key, k))</span>
<span class="gi">+                        out[key] = schema[valid_key](key_path, value)</span>
<span class="gi">+                    except StopIteration:</span>
<span class="gi">+                        if self.extra == ALLOW_EXTRA:</span>
<span class="gi">+                            out[key] = value</span>
<span class="gi">+                        elif self.extra != REMOVE_EXTRA:</span>
<span class="gi">+                            errors.append(er.Invalid(&#39;extra keys not allowed&#39;, key_path))</span>
<span class="gi">+                elif self.extra == ALLOW_EXTRA:</span>
<span class="gi">+                    out[key] = value</span>
<span class="gi">+                elif self.extra != REMOVE_EXTRA:</span>
<span class="gi">+                    errors.append(er.Invalid(&#39;extra keys not allowed&#39;, key_path))</span>
<span class="gi">+</span>
<span class="gi">+            for key in schema:</span>
<span class="gi">+                if isinstance(key, Required) and key not in out:</span>
<span class="gi">+                    if key.default is not UNDEFINED:</span>
<span class="gi">+                        out[key.schema] = key.default()</span>
<span class="gi">+                    else:</span>
<span class="gi">+                        errors.append(er.RequiredFieldInvalid(&#39;required key not provided&#39;, path + [key.schema]))</span>
<span class="gi">+</span>
<span class="gi">+            if errors:</span>
<span class="gi">+                raise er.MultipleInvalid(errors)</span>
<span class="gi">+</span>
<span class="gi">+            return out</span>
<span class="gi">+</span>
<span class="gi">+        return validate_dict</span>

<span class="w"> </span>    def _compile_sequence(self, schema, seq_type):
<span class="w"> </span>        &quot;&quot;&quot;Validate a sequence type.
<span class="gu">@@ -255,7 +357,28 @@ class Schema(object):</span>
<span class="w"> </span>        &gt;&gt;&gt; validator([1])
<span class="w"> </span>        [1]
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        def validate_sequence(path, data):</span>
<span class="gi">+            if not isinstance(data, seq_type):</span>
<span class="gi">+                raise er.Invalid(f&#39;expected a {seq_type.__name__}&#39;, path)</span>
<span class="gi">+</span>
<span class="gi">+            out = []</span>
<span class="gi">+            errors = []</span>
<span class="gi">+            for i, value in enumerate(data):</span>
<span class="gi">+                item_path = path + [i]</span>
<span class="gi">+                for validator in schema:</span>
<span class="gi">+                    try:</span>
<span class="gi">+                        out.append(validator(item_path, value))</span>
<span class="gi">+                        break</span>
<span class="gi">+                    except er.Invalid as e:</span>
<span class="gi">+                        if validator == schema[-1]:</span>
<span class="gi">+                            errors.append(e)</span>
<span class="gi">+</span>
<span class="gi">+            if errors:</span>
<span class="gi">+                raise er.MultipleInvalid(errors)</span>
<span class="gi">+</span>
<span class="gi">+            return seq_type(out)</span>
<span class="gi">+</span>
<span class="gi">+        return validate_sequence</span>

<span class="w"> </span>    def _compile_tuple(self, schema):
<span class="w"> </span>        &quot;&quot;&quot;Validate a tuple.
<span class="gu">@@ -270,7 +393,7 @@ class Schema(object):</span>
<span class="w"> </span>        &gt;&gt;&gt; validator((1,))
<span class="w"> </span>        (1,)
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self._compile_sequence(schema, tuple)</span>

<span class="w"> </span>    def _compile_list(self, schema):
<span class="w"> </span>        &quot;&quot;&quot;Validate a list.
<span class="gu">@@ -285,7 +408,7 @@ class Schema(object):</span>
<span class="w"> </span>        &gt;&gt;&gt; validator([1])
<span class="w"> </span>        [1]
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self._compile_sequence(schema, list)</span>

<span class="w"> </span>    def _compile_set(self, schema):
<span class="w"> </span>        &quot;&quot;&quot;Validate a set.
<span class="gu">@@ -300,7 +423,28 @@ class Schema(object):</span>
<span class="w"> </span>        &gt;&gt;&gt; with raises(er.MultipleInvalid, &#39;invalid value in set&#39;):
<span class="w"> </span>        ...   validator(set([&#39;a&#39;]))
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        def validate_set(path, data):</span>
<span class="gi">+            if not isinstance(data, set):</span>
<span class="gi">+                raise er.Invalid(&#39;expected a set&#39;, path)</span>
<span class="gi">+</span>
<span class="gi">+            out = set()</span>
<span class="gi">+            errors = []</span>
<span class="gi">+            for i, value in enumerate(data):</span>
<span class="gi">+                item_path = path + [i]</span>
<span class="gi">+                for validator in schema:</span>
<span class="gi">+                    try:</span>
<span class="gi">+                        out.add(validator(item_path, value))</span>
<span class="gi">+                        break</span>
<span class="gi">+                    except er.Invalid as e:</span>
<span class="gi">+                        if validator == schema[-1]:</span>
<span class="gi">+                            errors.append(e)</span>
<span class="gi">+</span>
<span class="gi">+            if errors:</span>
<span class="gi">+                raise er.MultipleInvalid(errors)</span>
<span class="gi">+</span>
<span class="gi">+            return out</span>
<span class="gi">+</span>
<span class="gi">+        return validate_set</span>

<span class="w"> </span>    def extend(self, schema: Schemable, required: typing.Optional[bool]=
<span class="w"> </span>        None, extra: typing.Optional[int]=None) -&gt;Schema:
<span class="gu">@@ -316,7 +460,17 @@ class Schema(object):</span>
<span class="w"> </span>        :param required: if set, overrides `required` of this `Schema`
<span class="w"> </span>        :param extra: if set, overrides `extra` of this `Schema`
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        if not isinstance(self.schema, dict) or not isinstance(schema, dict):</span>
<span class="gi">+            raise ValueError(&quot;Both schemas must be dictionary-based&quot;)</span>
<span class="gi">+</span>
<span class="gi">+        new_schema = self.schema.copy()</span>
<span class="gi">+        new_schema.update(schema)</span>
<span class="gi">+</span>
<span class="gi">+        return Schema(</span>
<span class="gi">+            new_schema,</span>
<span class="gi">+            required=self.required if required is None else required,</span>
<span class="gi">+            extra=self.extra if extra is None else extra</span>
<span class="gi">+        )</span>


<span class="w"> </span>def _compile_scalar(schema):
<span class="gu">@@ -707,4 +861,16 @@ def validate(*a, **kw) -&gt;typing.Callable:</span>
<span class="w"> </span>        ...   return arg1 * 2

<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    def decorator(func):</span>
<span class="gi">+        @wraps(func)</span>
<span class="gi">+        def wrapper(*args, **kwargs):</span>
<span class="gi">+            schema = Schema(dict(zip(func.__code__.co_varnames, a)), **kw)</span>
<span class="gi">+            bound_args = inspect.signature(func).bind(*args, **kwargs)</span>
<span class="gi">+            bound_args.apply_defaults()</span>
<span class="gi">+            validated_args = schema(dict(bound_args.arguments))</span>
<span class="gi">+            result = func(**validated_args)</span>
<span class="gi">+            if &#39;__return__&#39; in kw:</span>
<span class="gi">+                return Schema(kw[&#39;__return__&#39;])(result)</span>
<span class="gi">+            return result</span>
<span class="gi">+        return wrapper</span>
<span class="gi">+    return decorator</span>
<span class="gh">diff --git a/voluptuous/util.py b/voluptuous/util.py</span>
<span class="gh">index fe15b1a..a2c57d8 100644</span>
<span class="gd">--- a/voluptuous/util.py</span>
<span class="gi">+++ b/voluptuous/util.py</span>
<span class="gu">@@ -13,7 +13,7 @@ def Lower(v: str) -&gt;str:</span>
<span class="w"> </span>    &gt;&gt;&gt; s(&#39;HI&#39;)
<span class="w"> </span>    &#39;hi&#39;
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    return v.lower()</span>


<span class="w"> </span>def Upper(v: str) -&gt;str:
<span class="gu">@@ -23,7 +23,7 @@ def Upper(v: str) -&gt;str:</span>
<span class="w"> </span>    &gt;&gt;&gt; s(&#39;hi&#39;)
<span class="w"> </span>    &#39;HI&#39;
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    return v.upper()</span>


<span class="w"> </span>def Capitalize(v: str) -&gt;str:
<span class="gu">@@ -33,7 +33,7 @@ def Capitalize(v: str) -&gt;str:</span>
<span class="w"> </span>    &gt;&gt;&gt; s(&#39;hello world&#39;)
<span class="w"> </span>    &#39;Hello world&#39;
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    return v.capitalize()</span>


<span class="w"> </span>def Title(v: str) -&gt;str:
<span class="gu">@@ -43,7 +43,7 @@ def Title(v: str) -&gt;str:</span>
<span class="w"> </span>    &gt;&gt;&gt; s(&#39;hello world&#39;)
<span class="w"> </span>    &#39;Hello World&#39;
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    return v.title()</span>


<span class="w"> </span>def Strip(v: str) -&gt;str:
<span class="gu">@@ -53,7 +53,7 @@ def Strip(v: str) -&gt;str:</span>
<span class="w"> </span>    &gt;&gt;&gt; s(&#39;  hello world  &#39;)
<span class="w"> </span>    &#39;hello world&#39;
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    return v.strip()</span>


<span class="w"> </span>class DefaultTo(object):
<span class="gh">diff --git a/voluptuous/validators.py b/voluptuous/validators.py</span>
<span class="gh">index 88b50f6..41ef694 100644</span>
<span class="gd">--- a/voluptuous/validators.py</span>
<span class="gi">+++ b/voluptuous/validators.py</span>
<span class="gu">@@ -41,7 +41,13 @@ def truth(f: typing.Callable) -&gt;typing.Callable:</span>
<span class="w"> </span>    &gt;&gt;&gt; with raises(MultipleInvalid, &#39;not a valid value&#39;):
<span class="w"> </span>    ...   validate(&#39;/notavaliddir&#39;)
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    @wraps(f)</span>
<span class="gi">+    def wrapper(v):</span>
<span class="gi">+        t = f(v)</span>
<span class="gi">+        if not t:</span>
<span class="gi">+            raise ValueError</span>
<span class="gi">+        return v</span>
<span class="gi">+    return wrapper</span>


<span class="w"> </span>class Coerce(object):
<span class="gu">@@ -109,7 +115,7 @@ def IsTrue(v):</span>
<span class="w"> </span>    ... except MultipleInvalid as e:
<span class="w"> </span>    ...   assert isinstance(e.errors[0], TrueInvalid)
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    return bool(v)</span>


<span class="w"> </span>@message(&#39;value was not false&#39;, cls=FalseInvalid)
<span class="gu">@@ -129,7 +135,9 @@ def IsFalse(v):</span>
<span class="w"> </span>    ... except MultipleInvalid as e:
<span class="w"> </span>    ...   assert isinstance(e.errors[0], FalseInvalid)
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    if bool(v):</span>
<span class="gi">+        raise ValueError</span>
<span class="gi">+    return v</span>


<span class="w"> </span>@message(&#39;expected boolean&#39;, cls=BooleanInvalid)
<span class="gu">@@ -153,7 +161,18 @@ def Boolean(v):</span>
<span class="w"> </span>    ... except MultipleInvalid as e:
<span class="w"> </span>    ...   assert isinstance(e.errors[0], BooleanInvalid)
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    if isinstance(v, bool):</span>
<span class="gi">+        return v</span>
<span class="gi">+    if isinstance(v, str):</span>
<span class="gi">+        v = v.lower()</span>
<span class="gi">+        if v in (&#39;1&#39;, &#39;true&#39;, &#39;yes&#39;, &#39;on&#39;, &#39;enable&#39;):</span>
<span class="gi">+            return True</span>
<span class="gi">+        if v in (&#39;0&#39;, &#39;false&#39;, &#39;no&#39;, &#39;off&#39;, &#39;disable&#39;):</span>
<span class="gi">+            return False</span>
<span class="gi">+    try:</span>
<span class="gi">+        return bool(v)</span>
<span class="gi">+    except ValueError:</span>
<span class="gi">+        raise BooleanInvalid(&#39;expected boolean&#39;)</span>


<span class="w"> </span>class _WithSubValidators(object):
<span class="gu">@@ -213,6 +232,15 @@ class Any(_WithSubValidators):</span>
<span class="w"> </span>    &gt;&gt;&gt; with raises(MultipleInvalid, &quot;Expected 1 2 or 3&quot;):
<span class="w"> </span>    ...   validate(4)
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gi">+    def _run(self, v):</span>
<span class="gi">+        errors = []</span>
<span class="gi">+        for validator in self._compiled:</span>
<span class="gi">+            try:</span>
<span class="gi">+                return validator(v)</span>
<span class="gi">+            except Invalid as e:</span>
<span class="gi">+                errors.append(e)</span>
<span class="gi">+        else:</span>
<span class="gi">+            raise AnyInvalid(self.msg or errors)</span>


<span class="w"> </span>Or = Any
<span class="gu">@@ -255,6 +283,13 @@ class All(_WithSubValidators):</span>
<span class="w"> </span>    &gt;&gt;&gt; validate(&#39;10&#39;)
<span class="w"> </span>    10
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gi">+    def _run(self, v):</span>
<span class="gi">+        try:</span>
<span class="gi">+            for validator in self._compiled:</span>
<span class="gi">+                v = validator(v)</span>
<span class="gi">+        except Invalid as e:</span>
<span class="gi">+            raise AllInvalid(self.msg or str(e))</span>
<span class="gi">+        return v</span>


<span class="w"> </span>And = All
<span class="gu">@@ -340,7 +375,17 @@ def Email(v):</span>
<span class="w"> </span>    &gt;&gt;&gt; s(&#39;t@x.com&#39;)
<span class="w"> </span>    &#39;t@x.com&#39;
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    try:</span>
<span class="gi">+        if not isinstance(v, str):</span>
<span class="gi">+            raise ValueError</span>
<span class="gi">+        user_part, domain_part = v.rsplit(&#39;@&#39;, 1)</span>
<span class="gi">+        if not USER_REGEX.match(user_part):</span>
<span class="gi">+            raise ValueError</span>
<span class="gi">+        if not DOMAIN_REGEX.match(domain_part):</span>
<span class="gi">+            raise ValueError</span>
<span class="gi">+    except ValueError:</span>
<span class="gi">+        raise EmailInvalid(&#39;expected an email address&#39;)</span>
<span class="gi">+    return v</span>


<span class="w"> </span>@message(&#39;expected a fully qualified domain name URL&#39;, cls=UrlInvalid)
<span class="gu">@@ -353,7 +398,17 @@ def FqdnUrl(v):</span>
<span class="w"> </span>    &gt;&gt;&gt; s(&#39;http://w3.org&#39;)
<span class="w"> </span>    &#39;http://w3.org&#39;
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    try:</span>
<span class="gi">+        if not isinstance(v, str):</span>
<span class="gi">+            raise ValueError</span>
<span class="gi">+        parsed = urlparse.urlparse(v)</span>
<span class="gi">+        if not parsed.scheme or not parsed.netloc or parsed.netloc == &#39;localhost&#39;:</span>
<span class="gi">+            raise ValueError</span>
<span class="gi">+        if not DOMAIN_REGEX.match(parsed.netloc):</span>
<span class="gi">+            raise ValueError</span>
<span class="gi">+    except ValueError:</span>
<span class="gi">+        raise UrlInvalid(&#39;expected a fully qualified domain name URL&#39;)</span>
<span class="gi">+    return v</span>


<span class="w"> </span>@message(&#39;expected a URL&#39;, cls=UrlInvalid)
<span class="gu">@@ -366,7 +421,15 @@ def Url(v):</span>
<span class="w"> </span>    &gt;&gt;&gt; s(&#39;http://w3.org&#39;)
<span class="w"> </span>    &#39;http://w3.org&#39;
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    try:</span>
<span class="gi">+        if not isinstance(v, str):</span>
<span class="gi">+            raise ValueError</span>
<span class="gi">+        parsed = urlparse.urlparse(v)</span>
<span class="gi">+        if not parsed.scheme or not parsed.netloc:</span>
<span class="gi">+            raise ValueError</span>
<span class="gi">+    except ValueError:</span>
<span class="gi">+        raise UrlInvalid(&#39;expected a URL&#39;)</span>
<span class="gi">+    return v</span>


<span class="w"> </span>@message(&#39;Not a file&#39;, cls=FileInvalid)
<span class="gu">@@ -425,7 +488,11 @@ def Maybe(validator: Schemable, msg: typing.Optional[str]=None):</span>
<span class="w"> </span>    ...  s(&quot;string&quot;)

<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    def maybe_validator(v):</span>
<span class="gi">+        if v is None:</span>
<span class="gi">+            return v</span>
<span class="gi">+        return Schema(validator)(v)</span>
<span class="gi">+    return maybe_validator</span>


<span class="w"> </span>class Range(object):
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d6f25eb3.min.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../javascripts/tablesort.js"></script>
      
        <script src="../javascripts/tablesort.number.js"></script>
      
    
  </body>
</html>