
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.37">
    
    
      
        <title>Analysis commit0 all reference fastapi - Commit-0</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8c3ca2c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#reference-gold-fastapi" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Commit-0" class="md-header__button md-logo" aria-label="Commit-0" data-md-component="logo">
      
  <img src="../logo2.webp" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Commit-0
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Analysis commit0 all reference fastapi
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Commit-0" class="md-nav__button md-logo" aria-label="Commit-0" data-md-component="logo">
      
  <img src="../logo2.webp" alt="logo">

    </a>
    Commit-0
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../setupdist/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Commit0
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Agent
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Leaderboard
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pytest-summary-for-test-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Pytest Summary for test tests
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#failed-pytests" class="md-nav__link">
    <span class="md-ellipsis">
      Failed pytests:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Failed pytests:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test_openapi_examplespytest_openapi_schema" class="md-nav__link">
    <span class="md-ellipsis">
      test_openapi_examples.py::test_openapi_schema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#patch-diff" class="md-nav__link">
    <span class="md-ellipsis">
      Patch diff
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<p><a href="/analysis_commit0_all_reference">back to Reference (Gold) summary</a></p>
<h1 id="reference-gold-fastapi"><strong>Reference (Gold)</strong>: fastapi</h1>
<h2 id="pytest-summary-for-test-tests">Pytest Summary for test <code>tests</code></h2>
<table>
<thead>
<tr>
<th style="text-align: left;">status</th>
<th style="text-align: center;">count</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">passed</td>
<td style="text-align: center;">2013</td>
</tr>
<tr>
<td style="text-align: left;">skipped</td>
<td style="text-align: center;">75</td>
</tr>
<tr>
<td style="text-align: left;">failed</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: left;">total</td>
<td style="text-align: center;">2089</td>
</tr>
<tr>
<td style="text-align: left;">collected</td>
<td style="text-align: center;">2089</td>
</tr>
</tbody>
</table>
<h2 id="failed-pytests">Failed pytests:</h2>
<h3 id="test_openapi_examplespytest_openapi_schema">test_openapi_examples.py::test_openapi_schema</h3>
<details><summary> <pre>test_openapi_examples.py::test_openapi_schema</pre></summary><pre>
def test_openapi_schema():
        response = client.get("/openapi.json")
        assert response.status_code == 200, response.text
>       assert response.json() == {
            "openapi": "3.1.0",
            "info": {"title": "FastAPI", "version": "0.1.0"},
            "paths": {
                "/examples/": {
                    "post": {
                        "summary": "Examples",
                        "operationId": "examples_examples__post",
                        "requestBody": {
                            "content": {
                                "application/json": {
                                    "schema": {
                                        "allOf": [{"$ref": "#/components/schemas/Item"}],
                                        "title": "Item",
                                        "examples": [
                                            {"data": "Data in Body examples, example1"}
                                        ],
                                    },
                                    "examples": {
                                        "Example One": {
                                            "summary": "Example One Summary",
                                            "description": "Example One Description",
                                            "value": {
                                                "data": "Data in Body examples, example1"
                                            },
                                        },
                                        "Example Two": {
                                            "value": {
                                                "data": "Data in Body examples, example2"
                                            }
                                        },
                                    },
                                }
                            },
                            "required": True,
                        },
                        "responses": {
                            "200": {
                                "description": "Successful Response",
                                "content": {"application/json": {"schema": {}}},
                            },
                            "422": {
                                "description": "Validation Error",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "$ref": "#/components/schemas/HTTPValidationError"
                                        }
                                    }
                                },
                            },
                        },
                    }
                },
                "/path_examples/{item_id}": {
                    "get": {
                        "summary": "Path Examples",
                        "operationId": "path_examples_path_examples__item_id__get",
                        "parameters": [
                            {
                                "name": "item_id",
                                "in": "path",
                                "required": True,
                                "schema": {
                                    "type": "string",
                                    "examples": [
                                        "json_schema_item_1",
                                        "json_schema_item_2",
                                    ],
                                    "title": "Item Id",
                                },
                                "examples": {
                                    "Path One": {
                                        "summary": "Path One Summary",
                                        "description": "Path One Description",
                                        "value": "item_1",
                                    },
                                    "Path Two": {"value": "item_2"},
                                },
                            }
                        ],
                        "responses": {
                            "200": {
                                "description": "Successful Response",
                                "content": {"application/json": {"schema": {}}},
                            },
                            "422": {
                                "description": "Validation Error",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "$ref": "#/components/schemas/HTTPValidationError"
                                        }
                                    }
                                },
                            },
                        },
                    }
                },
                "/query_examples/": {
                    "get": {
                        "summary": "Query Examples",
                        "operationId": "query_examples_query_examples__get",
                        "parameters": [
                            {
                                "name": "data",
                                "in": "query",
                                "required": False,
                                "schema": IsDict(
                                    {
                                        "anyOf": [{"type": "string"}, {"type": "null"}],
                                        "examples": [
                                            "json_schema_query1",
                                            "json_schema_query2",
                                        ],
                                        "title": "Data",
                                    }
                                )
                                | IsDict(
                                    # TODO: remove when deprecating Pydantic v1
                                    {
                                        "examples": [
                                            "json_schema_query1",
                                            "json_schema_query2",
                                        ],
                                        "type": "string",
                                        "title": "Data",
                                    }
                                ),
                                "examples": {
                                    "Query One": {
                                        "summary": "Query One Summary",
                                        "description": "Query One Description",
                                        "value": "query1",
                                    },
                                    "Query Two": {"value": "query2"},
                                },
                            }
                        ],
                        "responses": {
                            "200": {
                                "description": "Successful Response",
                                "content": {"application/json": {"schema": {}}},
                            },
                            "422": {
                                "description": "Validation Error",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "$ref": "#/components/schemas/HTTPValidationError"
                                        }
                                    }
                                },
                            },
                        },
                    }
                },
                "/header_examples/": {
                    "get": {
                        "summary": "Header Examples",
                        "operationId": "header_examples_header_examples__get",
                        "parameters": [
                            {
                                "name": "data",
                                "in": "header",
                                "required": False,
                                "schema": IsDict(
                                    {
                                        "anyOf": [{"type": "string"}, {"type": "null"}],
                                        "examples": [
                                            "json_schema_header1",
                                            "json_schema_header2",
                                        ],
                                        "title": "Data",
                                    }
                                )
                                | IsDict(
                                    # TODO: remove when deprecating Pydantic v1
                                    {
                                        "type": "string",
                                        "examples": [
                                            "json_schema_header1",
                                            "json_schema_header2",
                                        ],
                                        "title": "Data",
                                    }
                                ),
                                "examples": {
                                    "Header One": {
                                        "summary": "Header One Summary",
                                        "description": "Header One Description",
                                        "value": "header1",
                                    },
                                    "Header Two": {"value": "header2"},
                                },
                            }
                        ],
                        "responses": {
                            "200": {
                                "description": "Successful Response",
                                "content": {"application/json": {"schema": {}}},
                            },
                            "422": {
                                "description": "Validation Error",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "$ref": "#/components/schemas/HTTPValidationError"
                                        }
                                    }
                                },
                            },
                        },
                    }
                },
                "/cookie_examples/": {
                    "get": {
                        "summary": "Cookie Examples",
                        "operationId": "cookie_examples_cookie_examples__get",
                        "parameters": [
                            {
                                "name": "data",
                                "in": "cookie",
                                "required": False,
                                "schema": IsDict(
                                    {
                                        "anyOf": [{"type": "string"}, {"type": "null"}],
                                        "examples": [
                                            "json_schema_cookie1",
                                            "json_schema_cookie2",
                                        ],
                                        "title": "Data",
                                    }
                                )
                                | IsDict(
                                    # TODO: remove when deprecating Pydantic v1
                                    {
                                        "type": "string",
                                        "examples": [
                                            "json_schema_cookie1",
                                            "json_schema_cookie2",
                                        ],
                                        "title": "Data",
                                    }
                                ),
                                "examples": {
                                    "Cookie One": {
                                        "summary": "Cookie One Summary",
                                        "description": "Cookie One Description",
                                        "value": "cookie1",
                                    },
                                    "Cookie Two": {"value": "cookie2"},
                                },
                            }
                        ],
                        "responses": {
                            "200": {
                                "description": "Successful Response",
                                "content": {"application/json": {"schema": {}}},
                            },
                            "422": {
                                "description": "Validation Error",
                                "content": {
                                    "application/json": {
                                        "schema": {
                                            "$ref": "#/components/schemas/HTTPValidationError"
                                        }
                                    }
                                },
                            },
                        },
                    }
                },
            },
            "components": {
                "schemas": {
                    "HTTPValidationError": {
                        "properties": {
                            "detail": {
                                "items": {"$ref": "#/components/schemas/ValidationError"},
                                "type": "array",
                                "title": "Detail",
                            }
                        },
                        "type": "object",
                        "title": "HTTPValidationError",
                    },
                    "Item": {
                        "properties": {"data": {"type": "string", "title": "Data"}},
                        "type": "object",
                        "required": ["data"],
                        "title": "Item",
                    },
                    "ValidationError": {
                        "properties": {
                            "loc": {
                                "items": {
                                    "anyOf": [{"type": "string"}, {"type": "integer"}]
                                },
                                "type": "array",
                                "title": "Location",
                            },
                            "msg": {"type": "string", "title": "Message"},
                            "type": {"type": "string", "title": "Error Type"},
                        },
                        "type": "object",
                        "required": ["loc", "msg", "type"],
                        "title": "ValidationError",
                    },
                }
            },
        }
E       AssertionError: assert {'components'...ples'}}, ...}} == {'components'...ples'}}, ...}}
E         
E         Omitting 3 identical items, use -vv to show
E         Differing items:
E         {'paths': {'/cookie_examples/': {'get': {'operationId': 'cookie_examples_cookie_examples__get', 'parameters': [{'examp...ccessful Response'}, '422': {'content': {...}, 'description': 'Validation Error'}}, 'summary': 'Path Examples'}}, ...}} != {'paths': {'/cookie_examples/': {'get': {'operationId': 'cookie_examples_cookie_examples__get', 'parameters': [{'examp...ccessful Response'}, '422': {'content': {...}, 'description': 'Validation Error'}}, 'summary': 'Path Examples'}}, ...}}
E         Use -v to get more diff

tests/test_openapi_examples.py:147: AssertionError
</pre>
</details>

<h2 id="patch-diff">Patch diff</h2>
<div class="highlight"><pre><span></span><code><span class="gh">diff --git a/fastapi/_compat.py b/fastapi/_compat.py</span>
<span class="gh">index 99ee773b..06b847b4 100644</span>
<span class="gd">--- a/fastapi/_compat.py</span>
<span class="gi">+++ b/fastapi/_compat.py</span>
<span class="gu">@@ -2,24 +2,56 @@ from collections import deque</span>
<span class="w"> </span>from copy import copy
<span class="w"> </span>from dataclasses import dataclass, is_dataclass
<span class="w"> </span>from enum import Enum
<span class="gd">-from typing import Any, Callable, Deque, Dict, FrozenSet, List, Mapping, Sequence, Set, Tuple, Type, Union</span>
<span class="gi">+from typing import (</span>
<span class="gi">+    Any,</span>
<span class="gi">+    Callable,</span>
<span class="gi">+    Deque,</span>
<span class="gi">+    Dict,</span>
<span class="gi">+    FrozenSet,</span>
<span class="gi">+    List,</span>
<span class="gi">+    Mapping,</span>
<span class="gi">+    Sequence,</span>
<span class="gi">+    Set,</span>
<span class="gi">+    Tuple,</span>
<span class="gi">+    Type,</span>
<span class="gi">+    Union,</span>
<span class="gi">+)</span>
<span class="gi">+</span>
<span class="w"> </span>from fastapi.exceptions import RequestErrorModel
<span class="w"> </span>from fastapi.types import IncEx, ModelNameMap, UnionType
<span class="w"> </span>from pydantic import BaseModel, create_model
<span class="w"> </span>from pydantic.version import VERSION as P_VERSION
<span class="w"> </span>from starlette.datastructures import UploadFile
<span class="w"> </span>from typing_extensions import Annotated, Literal, get_args, get_origin
<span class="gi">+</span>
<span class="gi">+# Reassign variable to make it reexported for mypy</span>
<span class="w"> </span>PYDANTIC_VERSION = P_VERSION
<span class="gd">-PYDANTIC_V2 = PYDANTIC_VERSION.startswith(&#39;2.&#39;)</span>
<span class="gd">-sequence_annotation_to_type = {Sequence: list, List: list, list: list,</span>
<span class="gd">-    Tuple: tuple, tuple: tuple, Set: set, set: set, FrozenSet: frozenset,</span>
<span class="gd">-    frozenset: frozenset, Deque: deque, deque: deque}</span>
<span class="gi">+PYDANTIC_V2 = PYDANTIC_VERSION.startswith(&quot;2.&quot;)</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+sequence_annotation_to_type = {</span>
<span class="gi">+    Sequence: list,</span>
<span class="gi">+    List: list,</span>
<span class="gi">+    list: list,</span>
<span class="gi">+    Tuple: tuple,</span>
<span class="gi">+    tuple: tuple,</span>
<span class="gi">+    Set: set,</span>
<span class="gi">+    set: set,</span>
<span class="gi">+    FrozenSet: frozenset,</span>
<span class="gi">+    frozenset: frozenset,</span>
<span class="gi">+    Deque: deque,</span>
<span class="gi">+    deque: deque,</span>
<span class="gi">+}</span>
<span class="gi">+</span>
<span class="w"> </span>sequence_types = tuple(sequence_annotation_to_type.keys())
<span class="gi">+</span>
<span class="w"> </span>if PYDANTIC_V2:
<span class="w"> </span>    from pydantic import PydanticSchemaGenerationError as PydanticSchemaGenerationError
<span class="w"> </span>    from pydantic import TypeAdapter
<span class="w"> </span>    from pydantic import ValidationError as ValidationError
<span class="gd">-    from pydantic._internal._schema_generation_shared import GetJsonSchemaHandler as GetJsonSchemaHandler</span>
<span class="gi">+    from pydantic._internal._schema_generation_shared import (  # type: ignore[attr-defined]</span>
<span class="gi">+        GetJsonSchemaHandler as GetJsonSchemaHandler,</span>
<span class="gi">+    )</span>
<span class="w"> </span>    from pydantic._internal._typing_extra import eval_type_lenient
<span class="w"> </span>    from pydantic._internal._utils import lenient_issubclass as lenient_issubclass
<span class="w"> </span>    from pydantic.fields import FieldInfo
<span class="gu">@@ -28,68 +60,577 @@ if PYDANTIC_V2:</span>
<span class="w"> </span>    from pydantic_core import CoreSchema as CoreSchema
<span class="w"> </span>    from pydantic_core import PydanticUndefined, PydanticUndefinedType
<span class="w"> </span>    from pydantic_core import Url as Url
<span class="gi">+</span>
<span class="w"> </span>    try:
<span class="gd">-        from pydantic_core.core_schema import with_info_plain_validator_function as with_info_plain_validator_function</span>
<span class="gd">-    except ImportError:</span>
<span class="gd">-        from pydantic_core.core_schema import general_plain_validator_function as with_info_plain_validator_function</span>
<span class="gi">+        from pydantic_core.core_schema import (</span>
<span class="gi">+            with_info_plain_validator_function as with_info_plain_validator_function,</span>
<span class="gi">+        )</span>
<span class="gi">+    except ImportError:  # pragma: no cover</span>
<span class="gi">+        from pydantic_core.core_schema import (</span>
<span class="gi">+            general_plain_validator_function as with_info_plain_validator_function,  # noqa: F401</span>
<span class="gi">+        )</span>
<span class="gi">+</span>
<span class="w"> </span>    Required = PydanticUndefined
<span class="w"> </span>    Undefined = PydanticUndefined
<span class="w"> </span>    UndefinedType = PydanticUndefinedType
<span class="w"> </span>    evaluate_forwardref = eval_type_lenient
<span class="w"> </span>    Validator = Any

<span class="gd">-</span>
<span class="w"> </span>    class BaseConfig:
<span class="w"> </span>        pass

<span class="gd">-</span>
<span class="w"> </span>    class ErrorWrapper(Exception):
<span class="w"> </span>        pass

<span class="gd">-</span>
<span class="w"> </span>    @dataclass
<span class="w"> </span>    class ModelField:
<span class="w"> </span>        field_info: FieldInfo
<span class="w"> </span>        name: str
<span class="gd">-        mode: Literal[&#39;validation&#39;, &#39;serialization&#39;] = &#39;validation&#39;</span>
<span class="gi">+        mode: Literal[&quot;validation&quot;, &quot;serialization&quot;] = &quot;validation&quot;</span>

<span class="gd">-        def __post_init__(self) -&gt;None:</span>
<span class="gd">-            self._type_adapter: TypeAdapter[Any] = TypeAdapter(Annotated[</span>
<span class="gd">-                self.field_info.annotation, self.field_info])</span>
<span class="gi">+        @property</span>
<span class="gi">+        def alias(self) -&gt; str:</span>
<span class="gi">+            a = self.field_info.alias</span>
<span class="gi">+            return a if a is not None else self.name</span>

<span class="gd">-        def __hash__(self) -&gt;int:</span>
<span class="gi">+        @property</span>
<span class="gi">+        def required(self) -&gt; bool:</span>
<span class="gi">+            return self.field_info.is_required()</span>
<span class="gi">+</span>
<span class="gi">+        @property</span>
<span class="gi">+        def default(self) -&gt; Any:</span>
<span class="gi">+            return self.get_default()</span>
<span class="gi">+</span>
<span class="gi">+        @property</span>
<span class="gi">+        def type_(self) -&gt; Any:</span>
<span class="gi">+            return self.field_info.annotation</span>
<span class="gi">+</span>
<span class="gi">+        def __post_init__(self) -&gt; None:</span>
<span class="gi">+            self._type_adapter: TypeAdapter[Any] = TypeAdapter(</span>
<span class="gi">+                Annotated[self.field_info.annotation, self.field_info]</span>
<span class="gi">+            )</span>
<span class="gi">+</span>
<span class="gi">+        def get_default(self) -&gt; Any:</span>
<span class="gi">+            if self.field_info.is_required():</span>
<span class="gi">+                return Undefined</span>
<span class="gi">+            return self.field_info.get_default(call_default_factory=True)</span>
<span class="gi">+</span>
<span class="gi">+        def validate(</span>
<span class="gi">+            self,</span>
<span class="gi">+            value: Any,</span>
<span class="gi">+            values: Dict[str, Any] = {},  # noqa: B006</span>
<span class="gi">+            *,</span>
<span class="gi">+            loc: Tuple[Union[int, str], ...] = (),</span>
<span class="gi">+        ) -&gt; Tuple[Any, Union[List[Dict[str, Any]], None]]:</span>
<span class="gi">+            try:</span>
<span class="gi">+                return (</span>
<span class="gi">+                    self._type_adapter.validate_python(value, from_attributes=True),</span>
<span class="gi">+                    None,</span>
<span class="gi">+                )</span>
<span class="gi">+            except ValidationError as exc:</span>
<span class="gi">+                return None, _regenerate_error_with_loc(</span>
<span class="gi">+                    errors=exc.errors(include_url=False), loc_prefix=loc</span>
<span class="gi">+                )</span>
<span class="gi">+</span>
<span class="gi">+        def serialize(</span>
<span class="gi">+            self,</span>
<span class="gi">+            value: Any,</span>
<span class="gi">+            *,</span>
<span class="gi">+            mode: Literal[&quot;json&quot;, &quot;python&quot;] = &quot;json&quot;,</span>
<span class="gi">+            include: Union[IncEx, None] = None,</span>
<span class="gi">+            exclude: Union[IncEx, None] = None,</span>
<span class="gi">+            by_alias: bool = True,</span>
<span class="gi">+            exclude_unset: bool = False,</span>
<span class="gi">+            exclude_defaults: bool = False,</span>
<span class="gi">+            exclude_none: bool = False,</span>
<span class="gi">+        ) -&gt; Any:</span>
<span class="gi">+            # What calls this code passes a value that already called</span>
<span class="gi">+            # self._type_adapter.validate_python(value)</span>
<span class="gi">+            return self._type_adapter.dump_python(</span>
<span class="gi">+                value,</span>
<span class="gi">+                mode=mode,</span>
<span class="gi">+                include=include,</span>
<span class="gi">+                exclude=exclude,</span>
<span class="gi">+                by_alias=by_alias,</span>
<span class="gi">+                exclude_unset=exclude_unset,</span>
<span class="gi">+                exclude_defaults=exclude_defaults,</span>
<span class="gi">+                exclude_none=exclude_none,</span>
<span class="gi">+            )</span>
<span class="gi">+</span>
<span class="gi">+        def __hash__(self) -&gt; int:</span>
<span class="gi">+            # Each ModelField is unique for our purposes, to allow making a dict from</span>
<span class="gi">+            # ModelField to its JSON Schema.</span>
<span class="w"> </span>            return id(self)
<span class="gi">+</span>
<span class="gi">+    def get_annotation_from_field_info(</span>
<span class="gi">+        annotation: Any, field_info: FieldInfo, field_name: str</span>
<span class="gi">+    ) -&gt; Any:</span>
<span class="gi">+        return annotation</span>
<span class="gi">+</span>
<span class="gi">+    def _normalize_errors(errors: Sequence[Any]) -&gt; List[Dict[str, Any]]:</span>
<span class="gi">+        return errors  # type: ignore[return-value]</span>
<span class="gi">+</span>
<span class="gi">+    def _model_rebuild(model: Type[BaseModel]) -&gt; None:</span>
<span class="gi">+        model.model_rebuild()</span>
<span class="gi">+</span>
<span class="gi">+    def _model_dump(</span>
<span class="gi">+        model: BaseModel, mode: Literal[&quot;json&quot;, &quot;python&quot;] = &quot;json&quot;, **kwargs: Any</span>
<span class="gi">+    ) -&gt; Any:</span>
<span class="gi">+        return model.model_dump(mode=mode, **kwargs)</span>
<span class="gi">+</span>
<span class="gi">+    def _get_model_config(model: BaseModel) -&gt; Any:</span>
<span class="gi">+        return model.model_config</span>
<span class="gi">+</span>
<span class="gi">+    def get_schema_from_model_field(</span>
<span class="gi">+        *,</span>
<span class="gi">+        field: ModelField,</span>
<span class="gi">+        schema_generator: GenerateJsonSchema,</span>
<span class="gi">+        model_name_map: ModelNameMap,</span>
<span class="gi">+        field_mapping: Dict[</span>
<span class="gi">+            Tuple[ModelField, Literal[&quot;validation&quot;, &quot;serialization&quot;]], JsonSchemaValue</span>
<span class="gi">+        ],</span>
<span class="gi">+        separate_input_output_schemas: bool = True,</span>
<span class="gi">+    ) -&gt; Dict[str, Any]:</span>
<span class="gi">+        override_mode: Union[Literal[&quot;validation&quot;], None] = (</span>
<span class="gi">+            None if separate_input_output_schemas else &quot;validation&quot;</span>
<span class="gi">+        )</span>
<span class="gi">+        # This expects that GenerateJsonSchema was already used to generate the definitions</span>
<span class="gi">+        json_schema = field_mapping[(field, override_mode or field.mode)]</span>
<span class="gi">+        if &quot;$ref&quot; not in json_schema:</span>
<span class="gi">+            # TODO remove when deprecating Pydantic v1</span>
<span class="gi">+            # Ref: https://github.com/pydantic/pydantic/blob/d61792cc42c80b13b23e3ffa74bc37ec7c77f7d1/pydantic/schema.py#L207</span>
<span class="gi">+            json_schema[&quot;title&quot;] = (</span>
<span class="gi">+                field.field_info.title or field.alias.title().replace(&quot;_&quot;, &quot; &quot;)</span>
<span class="gi">+            )</span>
<span class="gi">+        return json_schema</span>
<span class="gi">+</span>
<span class="gi">+    def get_compat_model_name_map(fields: List[ModelField]) -&gt; ModelNameMap:</span>
<span class="gi">+        return {}</span>
<span class="gi">+</span>
<span class="gi">+    def get_definitions(</span>
<span class="gi">+        *,</span>
<span class="gi">+        fields: List[ModelField],</span>
<span class="gi">+        schema_generator: GenerateJsonSchema,</span>
<span class="gi">+        model_name_map: ModelNameMap,</span>
<span class="gi">+        separate_input_output_schemas: bool = True,</span>
<span class="gi">+    ) -&gt; Tuple[</span>
<span class="gi">+        Dict[</span>
<span class="gi">+            Tuple[ModelField, Literal[&quot;validation&quot;, &quot;serialization&quot;]], JsonSchemaValue</span>
<span class="gi">+        ],</span>
<span class="gi">+        Dict[str, Dict[str, Any]],</span>
<span class="gi">+    ]:</span>
<span class="gi">+        override_mode: Union[Literal[&quot;validation&quot;], None] = (</span>
<span class="gi">+            None if separate_input_output_schemas else &quot;validation&quot;</span>
<span class="gi">+        )</span>
<span class="gi">+        inputs = [</span>
<span class="gi">+            (field, override_mode or field.mode, field._type_adapter.core_schema)</span>
<span class="gi">+            for field in fields</span>
<span class="gi">+        ]</span>
<span class="gi">+        field_mapping, definitions = schema_generator.generate_definitions(</span>
<span class="gi">+            inputs=inputs</span>
<span class="gi">+        )</span>
<span class="gi">+        return field_mapping, definitions  # type: ignore[return-value]</span>
<span class="gi">+</span>
<span class="gi">+    def is_scalar_field(field: ModelField) -&gt; bool:</span>
<span class="gi">+        from fastapi import params</span>
<span class="gi">+</span>
<span class="gi">+        return field_annotation_is_scalar(</span>
<span class="gi">+            field.field_info.annotation</span>
<span class="gi">+        ) and not isinstance(field.field_info, params.Body)</span>
<span class="gi">+</span>
<span class="gi">+    def is_sequence_field(field: ModelField) -&gt; bool:</span>
<span class="gi">+        return field_annotation_is_sequence(field.field_info.annotation)</span>
<span class="gi">+</span>
<span class="gi">+    def is_scalar_sequence_field(field: ModelField) -&gt; bool:</span>
<span class="gi">+        return field_annotation_is_scalar_sequence(field.field_info.annotation)</span>
<span class="gi">+</span>
<span class="gi">+    def is_bytes_field(field: ModelField) -&gt; bool:</span>
<span class="gi">+        return is_bytes_or_nonable_bytes_annotation(field.type_)</span>
<span class="gi">+</span>
<span class="gi">+    def is_bytes_sequence_field(field: ModelField) -&gt; bool:</span>
<span class="gi">+        return is_bytes_sequence_annotation(field.type_)</span>
<span class="gi">+</span>
<span class="gi">+    def copy_field_info(*, field_info: FieldInfo, annotation: Any) -&gt; FieldInfo:</span>
<span class="gi">+        cls = type(field_info)</span>
<span class="gi">+        merged_field_info = cls.from_annotation(annotation)</span>
<span class="gi">+        new_field_info = copy(field_info)</span>
<span class="gi">+        new_field_info.metadata = merged_field_info.metadata</span>
<span class="gi">+        new_field_info.annotation = merged_field_info.annotation</span>
<span class="gi">+        return new_field_info</span>
<span class="gi">+</span>
<span class="gi">+    def serialize_sequence_value(*, field: ModelField, value: Any) -&gt; Sequence[Any]:</span>
<span class="gi">+        origin_type = (</span>
<span class="gi">+            get_origin(field.field_info.annotation) or field.field_info.annotation</span>
<span class="gi">+        )</span>
<span class="gi">+        assert issubclass(origin_type, sequence_types)  # type: ignore[arg-type]</span>
<span class="gi">+        return sequence_annotation_to_type[origin_type](value)  # type: ignore[no-any-return]</span>
<span class="gi">+</span>
<span class="gi">+    def get_missing_field_error(loc: Tuple[str, ...]) -&gt; Dict[str, Any]:</span>
<span class="gi">+        error = ValidationError.from_exception_data(</span>
<span class="gi">+            &quot;Field required&quot;, [{&quot;type&quot;: &quot;missing&quot;, &quot;loc&quot;: loc, &quot;input&quot;: {}}]</span>
<span class="gi">+        ).errors(include_url=False)[0]</span>
<span class="gi">+        error[&quot;input&quot;] = None</span>
<span class="gi">+        return error  # type: ignore[return-value]</span>
<span class="gi">+</span>
<span class="gi">+    def create_body_model(</span>
<span class="gi">+        *, fields: Sequence[ModelField], model_name: str</span>
<span class="gi">+    ) -&gt; Type[BaseModel]:</span>
<span class="gi">+        field_params = {f.name: (f.field_info.annotation, f.field_info) for f in fields}</span>
<span class="gi">+        BodyModel: Type[BaseModel] = create_model(model_name, **field_params)  # type: ignore[call-overload]</span>
<span class="gi">+        return BodyModel</span>
<span class="gi">+</span>
<span class="w"> </span>else:
<span class="w"> </span>    from fastapi.openapi.constants import REF_PREFIX as REF_PREFIX
<span class="gd">-    from pydantic import AnyUrl as Url</span>
<span class="gd">-    from pydantic import BaseConfig as BaseConfig</span>
<span class="gd">-    from pydantic import ValidationError as ValidationError</span>
<span class="gd">-    from pydantic.class_validators import Validator as Validator</span>
<span class="gd">-    from pydantic.error_wrappers import ErrorWrapper as ErrorWrapper</span>
<span class="gi">+    from pydantic import AnyUrl as Url  # noqa: F401</span>
<span class="gi">+    from pydantic import (  # type: ignore[assignment]</span>
<span class="gi">+        BaseConfig as BaseConfig,  # noqa: F401</span>
<span class="gi">+    )</span>
<span class="gi">+    from pydantic import ValidationError as ValidationError  # noqa: F401</span>
<span class="gi">+    from pydantic.class_validators import (  # type: ignore[no-redef]</span>
<span class="gi">+        Validator as Validator,  # noqa: F401</span>
<span class="gi">+    )</span>
<span class="gi">+    from pydantic.error_wrappers import (  # type: ignore[no-redef]</span>
<span class="gi">+        ErrorWrapper as ErrorWrapper,  # noqa: F401</span>
<span class="gi">+    )</span>
<span class="w"> </span>    from pydantic.errors import MissingError
<span class="gd">-    from pydantic.fields import SHAPE_FROZENSET, SHAPE_LIST, SHAPE_SEQUENCE, SHAPE_SET, SHAPE_SINGLETON, SHAPE_TUPLE, SHAPE_TUPLE_ELLIPSIS</span>
<span class="gi">+    from pydantic.fields import (  # type: ignore[attr-defined]</span>
<span class="gi">+        SHAPE_FROZENSET,</span>
<span class="gi">+        SHAPE_LIST,</span>
<span class="gi">+        SHAPE_SEQUENCE,</span>
<span class="gi">+        SHAPE_SET,</span>
<span class="gi">+        SHAPE_SINGLETON,</span>
<span class="gi">+        SHAPE_TUPLE,</span>
<span class="gi">+        SHAPE_TUPLE_ELLIPSIS,</span>
<span class="gi">+    )</span>
<span class="w"> </span>    from pydantic.fields import FieldInfo as FieldInfo
<span class="gd">-    from pydantic.fields import ModelField as ModelField</span>
<span class="gd">-    from pydantic.fields import Required as Required</span>
<span class="gd">-    from pydantic.fields import Undefined as Undefined</span>
<span class="gd">-    from pydantic.fields import UndefinedType as UndefinedType</span>
<span class="gd">-    from pydantic.schema import field_schema, get_flat_models_from_fields, get_model_name_map, model_process_schema</span>
<span class="gd">-    from pydantic.schema import get_annotation_from_field_info as get_annotation_from_field_info</span>
<span class="gd">-    from pydantic.typing import evaluate_forwardref as evaluate_forwardref</span>
<span class="gd">-    from pydantic.utils import lenient_issubclass as lenient_issubclass</span>
<span class="gd">-    GetJsonSchemaHandler = Any</span>
<span class="gd">-    JsonSchemaValue = Dict[str, Any]</span>
<span class="gd">-    CoreSchema = Any</span>
<span class="gd">-    sequence_shapes = {SHAPE_LIST, SHAPE_SET, SHAPE_FROZENSET, SHAPE_TUPLE,</span>
<span class="gd">-        SHAPE_SEQUENCE, SHAPE_TUPLE_ELLIPSIS}</span>
<span class="gd">-    sequence_shape_to_type = {SHAPE_LIST: list, SHAPE_SET: set, SHAPE_TUPLE:</span>
<span class="gd">-        tuple, SHAPE_SEQUENCE: list, SHAPE_TUPLE_ELLIPSIS: list}</span>
<span class="gi">+    from pydantic.fields import (  # type: ignore[no-redef,attr-defined]</span>
<span class="gi">+        ModelField as ModelField,  # noqa: F401</span>
<span class="gi">+    )</span>
<span class="gi">+    from pydantic.fields import (  # type: ignore[no-redef,attr-defined]</span>
<span class="gi">+        Required as Required,  # noqa: F401</span>
<span class="gi">+    )</span>
<span class="gi">+    from pydantic.fields import (  # type: ignore[no-redef,attr-defined]</span>
<span class="gi">+        Undefined as Undefined,</span>
<span class="gi">+    )</span>
<span class="gi">+    from pydantic.fields import (  # type: ignore[no-redef, attr-defined]</span>
<span class="gi">+        UndefinedType as UndefinedType,  # noqa: F401</span>
<span class="gi">+    )</span>
<span class="gi">+    from pydantic.schema import (</span>
<span class="gi">+        field_schema,</span>
<span class="gi">+        get_flat_models_from_fields,</span>
<span class="gi">+        get_model_name_map,</span>
<span class="gi">+        model_process_schema,</span>
<span class="gi">+    )</span>
<span class="gi">+    from pydantic.schema import (  # type: ignore[no-redef]  # noqa: F401</span>
<span class="gi">+        get_annotation_from_field_info as get_annotation_from_field_info,</span>
<span class="gi">+    )</span>
<span class="gi">+    from pydantic.typing import (  # type: ignore[no-redef]</span>
<span class="gi">+        evaluate_forwardref as evaluate_forwardref,  # noqa: F401</span>
<span class="gi">+    )</span>
<span class="gi">+    from pydantic.utils import (  # type: ignore[no-redef]</span>
<span class="gi">+        lenient_issubclass as lenient_issubclass,  # noqa: F401</span>
<span class="gi">+    )</span>
<span class="gi">+</span>
<span class="gi">+    GetJsonSchemaHandler = Any  # type: ignore[assignment,misc]</span>
<span class="gi">+    JsonSchemaValue = Dict[str, Any]  # type: ignore[misc]</span>
<span class="gi">+    CoreSchema = Any  # type: ignore[assignment,misc]</span>

<span class="gi">+    sequence_shapes = {</span>
<span class="gi">+        SHAPE_LIST,</span>
<span class="gi">+        SHAPE_SET,</span>
<span class="gi">+        SHAPE_FROZENSET,</span>
<span class="gi">+        SHAPE_TUPLE,</span>
<span class="gi">+        SHAPE_SEQUENCE,</span>
<span class="gi">+        SHAPE_TUPLE_ELLIPSIS,</span>
<span class="gi">+    }</span>
<span class="gi">+    sequence_shape_to_type = {</span>
<span class="gi">+        SHAPE_LIST: list,</span>
<span class="gi">+        SHAPE_SET: set,</span>
<span class="gi">+        SHAPE_TUPLE: tuple,</span>
<span class="gi">+        SHAPE_SEQUENCE: list,</span>
<span class="gi">+        SHAPE_TUPLE_ELLIPSIS: list,</span>
<span class="gi">+    }</span>

<span class="w"> </span>    @dataclass
<span class="gd">-    class GenerateJsonSchema:</span>
<span class="gi">+    class GenerateJsonSchema:  # type: ignore[no-redef]</span>
<span class="w"> </span>        ref_template: str

<span class="gd">-</span>
<span class="gd">-    class PydanticSchemaGenerationError(Exception):</span>
<span class="gi">+    class PydanticSchemaGenerationError(Exception):  # type: ignore[no-redef]</span>
<span class="w"> </span>        pass
<span class="gi">+</span>
<span class="gi">+    def with_info_plain_validator_function(  # type: ignore[misc]</span>
<span class="gi">+        function: Callable[..., Any],</span>
<span class="gi">+        *,</span>
<span class="gi">+        ref: Union[str, None] = None,</span>
<span class="gi">+        metadata: Any = None,</span>
<span class="gi">+        serialization: Any = None,</span>
<span class="gi">+    ) -&gt; Any:</span>
<span class="gi">+        return {}</span>
<span class="gi">+</span>
<span class="gi">+    def get_model_definitions(</span>
<span class="gi">+        *,</span>
<span class="gi">+        flat_models: Set[Union[Type[BaseModel], Type[Enum]]],</span>
<span class="gi">+        model_name_map: Dict[Union[Type[BaseModel], Type[Enum]], str],</span>
<span class="gi">+    ) -&gt; Dict[str, Any]:</span>
<span class="gi">+        definitions: Dict[str, Dict[str, Any]] = {}</span>
<span class="gi">+        for model in flat_models:</span>
<span class="gi">+            m_schema, m_definitions, m_nested_models = model_process_schema(</span>
<span class="gi">+                model, model_name_map=model_name_map, ref_prefix=REF_PREFIX</span>
<span class="gi">+            )</span>
<span class="gi">+            definitions.update(m_definitions)</span>
<span class="gi">+            model_name = model_name_map[model]</span>
<span class="gi">+            if &quot;description&quot; in m_schema:</span>
<span class="gi">+                m_schema[&quot;description&quot;] = m_schema[&quot;description&quot;].split(&quot;\f&quot;)[0]</span>
<span class="gi">+            definitions[model_name] = m_schema</span>
<span class="gi">+        return definitions</span>
<span class="gi">+</span>
<span class="gi">+    def is_pv1_scalar_field(field: ModelField) -&gt; bool:</span>
<span class="gi">+        from fastapi import params</span>
<span class="gi">+</span>
<span class="gi">+        field_info = field.field_info</span>
<span class="gi">+        if not (</span>
<span class="gi">+            field.shape == SHAPE_SINGLETON  # type: ignore[attr-defined]</span>
<span class="gi">+            and not lenient_issubclass(field.type_, BaseModel)</span>
<span class="gi">+            and not lenient_issubclass(field.type_, dict)</span>
<span class="gi">+            and not field_annotation_is_sequence(field.type_)</span>
<span class="gi">+            and not is_dataclass(field.type_)</span>
<span class="gi">+            and not isinstance(field_info, params.Body)</span>
<span class="gi">+        ):</span>
<span class="gi">+            return False</span>
<span class="gi">+        if field.sub_fields:  # type: ignore[attr-defined]</span>
<span class="gi">+            if not all(</span>
<span class="gi">+                is_pv1_scalar_field(f)</span>
<span class="gi">+                for f in field.sub_fields  # type: ignore[attr-defined]</span>
<span class="gi">+            ):</span>
<span class="gi">+                return False</span>
<span class="gi">+        return True</span>
<span class="gi">+</span>
<span class="gi">+    def is_pv1_scalar_sequence_field(field: ModelField) -&gt; bool:</span>
<span class="gi">+        if (field.shape in sequence_shapes) and not lenient_issubclass(  # type: ignore[attr-defined]</span>
<span class="gi">+            field.type_, BaseModel</span>
<span class="gi">+        ):</span>
<span class="gi">+            if field.sub_fields is not None:  # type: ignore[attr-defined]</span>
<span class="gi">+                for sub_field in field.sub_fields:  # type: ignore[attr-defined]</span>
<span class="gi">+                    if not is_pv1_scalar_field(sub_field):</span>
<span class="gi">+                        return False</span>
<span class="gi">+            return True</span>
<span class="gi">+        if _annotation_is_sequence(field.type_):</span>
<span class="gi">+            return True</span>
<span class="gi">+        return False</span>
<span class="gi">+</span>
<span class="gi">+    def _normalize_errors(errors: Sequence[Any]) -&gt; List[Dict[str, Any]]:</span>
<span class="gi">+        use_errors: List[Any] = []</span>
<span class="gi">+        for error in errors:</span>
<span class="gi">+            if isinstance(error, ErrorWrapper):</span>
<span class="gi">+                new_errors = ValidationError(  # type: ignore[call-arg]</span>
<span class="gi">+                    errors=[error], model=RequestErrorModel</span>
<span class="gi">+                ).errors()</span>
<span class="gi">+                use_errors.extend(new_errors)</span>
<span class="gi">+            elif isinstance(error, list):</span>
<span class="gi">+                use_errors.extend(_normalize_errors(error))</span>
<span class="gi">+            else:</span>
<span class="gi">+                use_errors.append(error)</span>
<span class="gi">+        return use_errors</span>
<span class="gi">+</span>
<span class="gi">+    def _model_rebuild(model: Type[BaseModel]) -&gt; None:</span>
<span class="gi">+        model.update_forward_refs()</span>
<span class="gi">+</span>
<span class="gi">+    def _model_dump(</span>
<span class="gi">+        model: BaseModel, mode: Literal[&quot;json&quot;, &quot;python&quot;] = &quot;json&quot;, **kwargs: Any</span>
<span class="gi">+    ) -&gt; Any:</span>
<span class="gi">+        return model.dict(**kwargs)</span>
<span class="gi">+</span>
<span class="gi">+    def _get_model_config(model: BaseModel) -&gt; Any:</span>
<span class="gi">+        return model.__config__  # type: ignore[attr-defined]</span>
<span class="gi">+</span>
<span class="gi">+    def get_schema_from_model_field(</span>
<span class="gi">+        *,</span>
<span class="gi">+        field: ModelField,</span>
<span class="gi">+        schema_generator: GenerateJsonSchema,</span>
<span class="gi">+        model_name_map: ModelNameMap,</span>
<span class="gi">+        field_mapping: Dict[</span>
<span class="gi">+            Tuple[ModelField, Literal[&quot;validation&quot;, &quot;serialization&quot;]], JsonSchemaValue</span>
<span class="gi">+        ],</span>
<span class="gi">+        separate_input_output_schemas: bool = True,</span>
<span class="gi">+    ) -&gt; Dict[str, Any]:</span>
<span class="gi">+        # This expects that GenerateJsonSchema was already used to generate the definitions</span>
<span class="gi">+        return field_schema(  # type: ignore[no-any-return]</span>
<span class="gi">+            field, model_name_map=model_name_map, ref_prefix=REF_PREFIX</span>
<span class="gi">+        )[0]</span>
<span class="gi">+</span>
<span class="gi">+    def get_compat_model_name_map(fields: List[ModelField]) -&gt; ModelNameMap:</span>
<span class="gi">+        models = get_flat_models_from_fields(fields, known_models=set())</span>
<span class="gi">+        return get_model_name_map(models)  # type: ignore[no-any-return]</span>
<span class="gi">+</span>
<span class="gi">+    def get_definitions(</span>
<span class="gi">+        *,</span>
<span class="gi">+        fields: List[ModelField],</span>
<span class="gi">+        schema_generator: GenerateJsonSchema,</span>
<span class="gi">+        model_name_map: ModelNameMap,</span>
<span class="gi">+        separate_input_output_schemas: bool = True,</span>
<span class="gi">+    ) -&gt; Tuple[</span>
<span class="gi">+        Dict[</span>
<span class="gi">+            Tuple[ModelField, Literal[&quot;validation&quot;, &quot;serialization&quot;]], JsonSchemaValue</span>
<span class="gi">+        ],</span>
<span class="gi">+        Dict[str, Dict[str, Any]],</span>
<span class="gi">+    ]:</span>
<span class="gi">+        models = get_flat_models_from_fields(fields, known_models=set())</span>
<span class="gi">+        return {}, get_model_definitions(</span>
<span class="gi">+            flat_models=models, model_name_map=model_name_map</span>
<span class="gi">+        )</span>
<span class="gi">+</span>
<span class="gi">+    def is_scalar_field(field: ModelField) -&gt; bool:</span>
<span class="gi">+        return is_pv1_scalar_field(field)</span>
<span class="gi">+</span>
<span class="gi">+    def is_sequence_field(field: ModelField) -&gt; bool:</span>
<span class="gi">+        return field.shape in sequence_shapes or _annotation_is_sequence(field.type_)  # type: ignore[attr-defined]</span>
<span class="gi">+</span>
<span class="gi">+    def is_scalar_sequence_field(field: ModelField) -&gt; bool:</span>
<span class="gi">+        return is_pv1_scalar_sequence_field(field)</span>
<span class="gi">+</span>
<span class="gi">+    def is_bytes_field(field: ModelField) -&gt; bool:</span>
<span class="gi">+        return lenient_issubclass(field.type_, bytes)</span>
<span class="gi">+</span>
<span class="gi">+    def is_bytes_sequence_field(field: ModelField) -&gt; bool:</span>
<span class="gi">+        return field.shape in sequence_shapes and lenient_issubclass(field.type_, bytes)  # type: ignore[attr-defined]</span>
<span class="gi">+</span>
<span class="gi">+    def copy_field_info(*, field_info: FieldInfo, annotation: Any) -&gt; FieldInfo:</span>
<span class="gi">+        return copy(field_info)</span>
<span class="gi">+</span>
<span class="gi">+    def serialize_sequence_value(*, field: ModelField, value: Any) -&gt; Sequence[Any]:</span>
<span class="gi">+        return sequence_shape_to_type[field.shape](value)  # type: ignore[no-any-return,attr-defined]</span>
<span class="gi">+</span>
<span class="gi">+    def get_missing_field_error(loc: Tuple[str, ...]) -&gt; Dict[str, Any]:</span>
<span class="gi">+        missing_field_error = ErrorWrapper(MissingError(), loc=loc)  # type: ignore[call-arg]</span>
<span class="gi">+        new_error = ValidationError([missing_field_error], RequestErrorModel)</span>
<span class="gi">+        return new_error.errors()[0]  # type: ignore[return-value]</span>
<span class="gi">+</span>
<span class="gi">+    def create_body_model(</span>
<span class="gi">+        *, fields: Sequence[ModelField], model_name: str</span>
<span class="gi">+    ) -&gt; Type[BaseModel]:</span>
<span class="gi">+        BodyModel = create_model(model_name)</span>
<span class="gi">+        for f in fields:</span>
<span class="gi">+            BodyModel.__fields__[f.name] = f  # type: ignore[index]</span>
<span class="gi">+        return BodyModel</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def _regenerate_error_with_loc(</span>
<span class="gi">+    *, errors: Sequence[Any], loc_prefix: Tuple[Union[str, int], ...]</span>
<span class="gi">+) -&gt; List[Dict[str, Any]]:</span>
<span class="gi">+    updated_loc_errors: List[Any] = [</span>
<span class="gi">+        {**err, &quot;loc&quot;: loc_prefix + err.get(&quot;loc&quot;, ())}</span>
<span class="gi">+        for err in _normalize_errors(errors)</span>
<span class="gi">+    ]</span>
<span class="gi">+</span>
<span class="gi">+    return updated_loc_errors</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def _annotation_is_sequence(annotation: Union[Type[Any], None]) -&gt; bool:</span>
<span class="gi">+    if lenient_issubclass(annotation, (str, bytes)):</span>
<span class="gi">+        return False</span>
<span class="gi">+    return lenient_issubclass(annotation, sequence_types)</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def field_annotation_is_sequence(annotation: Union[Type[Any], None]) -&gt; bool:</span>
<span class="gi">+    return _annotation_is_sequence(annotation) or _annotation_is_sequence(</span>
<span class="gi">+        get_origin(annotation)</span>
<span class="gi">+    )</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def value_is_sequence(value: Any) -&gt; bool:</span>
<span class="gi">+    return isinstance(value, sequence_types) and not isinstance(value, (str, bytes))  # type: ignore[arg-type]</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def _annotation_is_complex(annotation: Union[Type[Any], None]) -&gt; bool:</span>
<span class="gi">+    return (</span>
<span class="gi">+        lenient_issubclass(annotation, (BaseModel, Mapping, UploadFile))</span>
<span class="gi">+        or _annotation_is_sequence(annotation)</span>
<span class="gi">+        or is_dataclass(annotation)</span>
<span class="gi">+    )</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def field_annotation_is_complex(annotation: Union[Type[Any], None]) -&gt; bool:</span>
<span class="gi">+    origin = get_origin(annotation)</span>
<span class="gi">+    if origin is Union or origin is UnionType:</span>
<span class="gi">+        return any(field_annotation_is_complex(arg) for arg in get_args(annotation))</span>
<span class="gi">+</span>
<span class="gi">+    return (</span>
<span class="gi">+        _annotation_is_complex(annotation)</span>
<span class="gi">+        or _annotation_is_complex(origin)</span>
<span class="gi">+        or hasattr(origin, &quot;__pydantic_core_schema__&quot;)</span>
<span class="gi">+        or hasattr(origin, &quot;__get_pydantic_core_schema__&quot;)</span>
<span class="gi">+    )</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def field_annotation_is_scalar(annotation: Any) -&gt; bool:</span>
<span class="gi">+    # handle Ellipsis here to make tuple[int, ...] work nicely</span>
<span class="gi">+    return annotation is Ellipsis or not field_annotation_is_complex(annotation)</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def field_annotation_is_scalar_sequence(annotation: Union[Type[Any], None]) -&gt; bool:</span>
<span class="gi">+    origin = get_origin(annotation)</span>
<span class="gi">+    if origin is Union or origin is UnionType:</span>
<span class="gi">+        at_least_one_scalar_sequence = False</span>
<span class="gi">+        for arg in get_args(annotation):</span>
<span class="gi">+            if field_annotation_is_scalar_sequence(arg):</span>
<span class="gi">+                at_least_one_scalar_sequence = True</span>
<span class="gi">+                continue</span>
<span class="gi">+            elif not field_annotation_is_scalar(arg):</span>
<span class="gi">+                return False</span>
<span class="gi">+        return at_least_one_scalar_sequence</span>
<span class="gi">+    return field_annotation_is_sequence(annotation) and all(</span>
<span class="gi">+        field_annotation_is_scalar(sub_annotation)</span>
<span class="gi">+        for sub_annotation in get_args(annotation)</span>
<span class="gi">+    )</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def is_bytes_or_nonable_bytes_annotation(annotation: Any) -&gt; bool:</span>
<span class="gi">+    if lenient_issubclass(annotation, bytes):</span>
<span class="gi">+        return True</span>
<span class="gi">+    origin = get_origin(annotation)</span>
<span class="gi">+    if origin is Union or origin is UnionType:</span>
<span class="gi">+        for arg in get_args(annotation):</span>
<span class="gi">+            if lenient_issubclass(arg, bytes):</span>
<span class="gi">+                return True</span>
<span class="gi">+    return False</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def is_uploadfile_or_nonable_uploadfile_annotation(annotation: Any) -&gt; bool:</span>
<span class="gi">+    if lenient_issubclass(annotation, UploadFile):</span>
<span class="gi">+        return True</span>
<span class="gi">+    origin = get_origin(annotation)</span>
<span class="gi">+    if origin is Union or origin is UnionType:</span>
<span class="gi">+        for arg in get_args(annotation):</span>
<span class="gi">+            if lenient_issubclass(arg, UploadFile):</span>
<span class="gi">+                return True</span>
<span class="gi">+    return False</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def is_bytes_sequence_annotation(annotation: Any) -&gt; bool:</span>
<span class="gi">+    origin = get_origin(annotation)</span>
<span class="gi">+    if origin is Union or origin is UnionType:</span>
<span class="gi">+        at_least_one = False</span>
<span class="gi">+        for arg in get_args(annotation):</span>
<span class="gi">+            if is_bytes_sequence_annotation(arg):</span>
<span class="gi">+                at_least_one = True</span>
<span class="gi">+                continue</span>
<span class="gi">+        return at_least_one</span>
<span class="gi">+    return field_annotation_is_sequence(annotation) and all(</span>
<span class="gi">+        is_bytes_or_nonable_bytes_annotation(sub_annotation)</span>
<span class="gi">+        for sub_annotation in get_args(annotation)</span>
<span class="gi">+    )</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def is_uploadfile_sequence_annotation(annotation: Any) -&gt; bool:</span>
<span class="gi">+    origin = get_origin(annotation)</span>
<span class="gi">+    if origin is Union or origin is UnionType:</span>
<span class="gi">+        at_least_one = False</span>
<span class="gi">+        for arg in get_args(annotation):</span>
<span class="gi">+            if is_uploadfile_sequence_annotation(arg):</span>
<span class="gi">+                at_least_one = True</span>
<span class="gi">+                continue</span>
<span class="gi">+        return at_least_one</span>
<span class="gi">+    return field_annotation_is_sequence(annotation) and all(</span>
<span class="gi">+        is_uploadfile_or_nonable_uploadfile_annotation(sub_annotation)</span>
<span class="gi">+        for sub_annotation in get_args(annotation)</span>
<span class="gi">+    )</span>
<span class="gh">diff --git a/fastapi/applications.py b/fastapi/applications.py</span>
<span class="gh">index 265d637e..4f5e6f1d 100644</span>
<span class="gd">--- a/fastapi/applications.py</span>
<span class="gi">+++ b/fastapi/applications.py</span>
<span class="gu">@@ -1,11 +1,32 @@</span>
<span class="w"> </span>from enum import Enum
<span class="gd">-from typing import Any, Awaitable, Callable, Coroutine, Dict, List, Optional, Sequence, Type, TypeVar, Union</span>
<span class="gi">+from typing import (</span>
<span class="gi">+    Any,</span>
<span class="gi">+    Awaitable,</span>
<span class="gi">+    Callable,</span>
<span class="gi">+    Coroutine,</span>
<span class="gi">+    Dict,</span>
<span class="gi">+    List,</span>
<span class="gi">+    Optional,</span>
<span class="gi">+    Sequence,</span>
<span class="gi">+    Type,</span>
<span class="gi">+    TypeVar,</span>
<span class="gi">+    Union,</span>
<span class="gi">+)</span>
<span class="gi">+</span>
<span class="w"> </span>from fastapi import routing
<span class="w"> </span>from fastapi.datastructures import Default, DefaultPlaceholder
<span class="gd">-from fastapi.exception_handlers import http_exception_handler, request_validation_exception_handler, websocket_request_validation_exception_handler</span>
<span class="gi">+from fastapi.exception_handlers import (</span>
<span class="gi">+    http_exception_handler,</span>
<span class="gi">+    request_validation_exception_handler,</span>
<span class="gi">+    websocket_request_validation_exception_handler,</span>
<span class="gi">+)</span>
<span class="w"> </span>from fastapi.exceptions import RequestValidationError, WebSocketRequestValidationError
<span class="w"> </span>from fastapi.logger import logger
<span class="gd">-from fastapi.openapi.docs import get_redoc_html, get_swagger_ui_html, get_swagger_ui_oauth2_redirect_html</span>
<span class="gi">+from fastapi.openapi.docs import (</span>
<span class="gi">+    get_redoc_html,</span>
<span class="gi">+    get_swagger_ui_html,</span>
<span class="gi">+    get_swagger_ui_oauth2_redirect_html,</span>
<span class="gi">+)</span>
<span class="w"> </span>from fastapi.openapi.utils import get_openapi
<span class="w"> </span>from fastapi.params import Depends
<span class="w"> </span>from fastapi.types import DecoratedCallable, IncEx
<span class="gu">@@ -20,7 +41,8 @@ from starlette.responses import HTMLResponse, JSONResponse, Response</span>
<span class="w"> </span>from starlette.routing import BaseRoute
<span class="w"> </span>from starlette.types import ASGIApp, Lifespan, Receive, Scope, Send
<span class="w"> </span>from typing_extensions import Annotated, Doc, deprecated
<span class="gd">-AppType = TypeVar(&#39;AppType&#39;, bound=&#39;FastAPI&#39;)</span>
<span class="gi">+</span>
<span class="gi">+AppType = TypeVar(&quot;AppType&quot;, bound=&quot;FastAPI&quot;)</span>


<span class="w"> </span>class FastAPI(Starlette):
<span class="gu">@@ -39,16 +61,25 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>    ```
<span class="w"> </span>    &quot;&quot;&quot;

<span class="gd">-    def __init__(self: AppType, *, debug: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self: AppType,</span>
<span class="gi">+        *,</span>
<span class="gi">+        debug: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Boolean indicating if debug tracebacks should be returned on server
<span class="w"> </span>                errors.

<span class="w"> </span>                Read more in the
<span class="w"> </span>                [Starlette docs for Applications](https://www.starlette.io/applications/#instantiating-the-application).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, routes: Annotated[Optional[List[BaseRoute]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        routes: Annotated[</span>
<span class="gi">+            Optional[List[BaseRoute]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                **Note**: you probably shouldn&#39;t use this parameter, it is inherited
<span class="w"> </span>                from Starlette and supported for compatibility.

<span class="gu">@@ -56,16 +87,21 @@ class FastAPI(Starlette):</span>

<span class="w"> </span>                A list of routes to serve incoming HTTP and WebSocket requests.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        ), deprecated(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+            deprecated(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                You normally wouldn&#39;t use this parameter with FastAPI, it is inherited
<span class="w"> </span>                from Starlette and supported for compatibility.

<span class="w"> </span>                In FastAPI, you normally would use the *path operation methods*,
<span class="w"> </span>                like `app.get()`, `app.post()`, etc.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, title: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        title: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The title of the API.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -81,8 +117,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                app = FastAPI(title=&quot;ChimichangApp&quot;)
<span class="w"> </span>                ```
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;FastAPI&#39;, summary: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;FastAPI&quot;,</span>
<span class="gi">+        summary: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A short summary of the API.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -98,8 +138,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                app = FastAPI(summary=&quot;Deadpond&#39;s favorite app. Nuff said.&quot;)
<span class="w"> </span>                ```
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &#39;&#39;&#39;</span>
<span class="w"> </span>                A description of the API. Supports Markdown (using
<span class="w"> </span>                [CommonMark syntax](https://commonmark.org/)).

<span class="gu">@@ -114,7 +158,7 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                from fastapi import FastAPI

<span class="w"> </span>                app = FastAPI(
<span class="gd">-                    description=&quot;&quot;\&quot;</span>
<span class="gi">+                    description=&quot;&quot;&quot;</span>
<span class="w"> </span>                                ChimichangApp API helps you do awesome stuff. 

<span class="w"> </span>                                ## Items
<span class="gu">@@ -128,12 +172,16 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                                * **Create users** (_not implemented_).
<span class="w"> </span>                                * **Read users** (_not implemented_).

<span class="gd">-                                &quot;&quot;\&quot;</span>
<span class="gi">+                                &quot;&quot;&quot;</span>
<span class="w"> </span>                )
<span class="w"> </span>                ```
<span class="gi">+                &#39;&#39;&#39;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;&quot;,</span>
<span class="gi">+        version: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;&#39;, version: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="w"> </span>                The version of the API.

<span class="w"> </span>                **Note** This is the version of your application, not the version of
<span class="gu">@@ -152,8 +200,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                app = FastAPI(version=&quot;0.0.1&quot;)
<span class="w"> </span>                ```
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;0.1.0&#39;, openapi_url: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;0.1.0&quot;,</span>
<span class="gi">+        openapi_url: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The URL where the OpenAPI schema will be served from.

<span class="w"> </span>                If you set it to `None`, no OpenAPI schema will be served publicly, and
<span class="gu">@@ -171,9 +223,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                app = FastAPI(openapi_url=&quot;/api/v1/openapi.json&quot;)
<span class="w"> </span>                ```
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;/openapi.json&#39;, openapi_tags: Annotated[Optional[List[Dict[str,</span>
<span class="gd">-        Any]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;/openapi.json&quot;,</span>
<span class="gi">+        openapi_tags: Annotated[</span>
<span class="gi">+            Optional[List[Dict[str, Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of tags used by OpenAPI, these are the same `tags` you can set
<span class="w"> </span>                in the *path operations*, like:

<span class="gu">@@ -228,9 +283,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                app = FastAPI(openapi_tags=tags_metadata)
<span class="w"> </span>                ```
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, servers: Annotated[Optional[List[Dict[str, Union[str, Any]</span>
<span class="gd">-        ]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        servers: Annotated[</span>
<span class="gi">+            Optional[List[Dict[str, Union[str, Any]]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A `list` of `dict`s with connectivity information to a target server.

<span class="w"> </span>                You would use it, for example, if your application is served from
<span class="gu">@@ -269,8 +327,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                )
<span class="w"> </span>                ```
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, dependencies: Annotated[Optional[Sequence[Depends]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        dependencies: Annotated[</span>
<span class="gi">+            Optional[Sequence[Depends]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of global dependencies, they will be applied to each
<span class="w"> </span>                *path operation*, including in sub-routers.

<span class="gu">@@ -287,8 +349,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                app = FastAPI(dependencies=[Depends(func_dep_1), Depends(func_dep_2)])
<span class="w"> </span>                ```
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, default_response_class: Annotated[Type[Response], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        default_response_class: Annotated[</span>
<span class="gi">+            Type[Response],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The default response class to be used.

<span class="w"> </span>                Read more in the
<span class="gu">@@ -303,8 +369,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                app = FastAPI(default_response_class=ORJSONResponse)
<span class="w"> </span>                ```
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(JSONResponse), redirect_slashes: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(JSONResponse),</span>
<span class="gi">+        redirect_slashes: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Whether to detect and redirect slashes in URLs when the client doesn&#39;t
<span class="w"> </span>                use the same format.

<span class="gu">@@ -324,8 +394,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                they will be automatically redirected with an HTTP status code of 307
<span class="w"> </span>                to `/items/`.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, docs_url: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        docs_url: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The path to the automatic interactive API documentation.
<span class="w"> </span>                It is handled in the browser by Swagger UI.

<span class="gu">@@ -344,8 +418,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                app = FastAPI(docs_url=&quot;/documentation&quot;, redoc_url=None)
<span class="w"> </span>                ```
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;/docs&#39;, redoc_url: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;/docs&quot;,</span>
<span class="gi">+        redoc_url: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The path to the alternative automatic interactive API documentation
<span class="w"> </span>                provided by ReDoc.

<span class="gu">@@ -364,9 +442,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                app = FastAPI(docs_url=&quot;/documentation&quot;, redoc_url=&quot;redocumentation&quot;)
<span class="w"> </span>                ```
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;/redoc&#39;, swagger_ui_oauth2_redirect_url: Annotated[Optional[str</span>
<span class="gd">-        ], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;/redoc&quot;,</span>
<span class="gi">+        swagger_ui_oauth2_redirect_url: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The OAuth2 redirect endpoint for the Swagger UI.

<span class="w"> </span>                By default it is `/docs/oauth2-redirect`.
<span class="gu">@@ -374,16 +455,23 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                This is only used if you use OAuth2 (with the &quot;Authorize&quot; button)
<span class="w"> </span>                with Swagger UI.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;/docs/oauth2-redirect&#39;, swagger_ui_init_oauth: Annotated[</span>
<span class="gd">-        Optional[Dict[str, Any]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;/docs/oauth2-redirect&quot;,</span>
<span class="gi">+        swagger_ui_init_oauth: Annotated[</span>
<span class="gi">+            Optional[Dict[str, Any]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                OAuth2 configuration for the Swagger UI, by default shown at `/docs`.

<span class="w"> </span>                Read more about the available configuration options in the
<span class="w"> </span>                [Swagger UI docs](https://swagger.io/docs/open-source-tools/swagger-ui/usage/oauth2/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, middleware: Annotated[Optional[Sequence[Middleware]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        middleware: Annotated[</span>
<span class="gi">+            Optional[Sequence[Middleware]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                List of middleware to be added when creating the application.

<span class="w"> </span>                In FastAPI you would normally do this with `app.add_middleware()`
<span class="gu">@@ -392,10 +480,17 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more in the
<span class="w"> </span>                [FastAPI docs for Middleware](https://fastapi.tiangolo.com/tutorial/middleware/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, exception_handlers: Annotated[Optional[Dict[Union[int,</span>
<span class="gd">-        Type[Exception]], Callable[[Request, Any], Coroutine[Any, Any,</span>
<span class="gd">-        Response]]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        exception_handlers: Annotated[</span>
<span class="gi">+            Optional[</span>
<span class="gi">+                Dict[</span>
<span class="gi">+                    Union[int, Type[Exception]],</span>
<span class="gi">+                    Callable[[Request, Any], Coroutine[Any, Any, Response]],</span>
<span class="gi">+                ]</span>
<span class="gi">+            ],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A dictionary with handlers for exceptions.

<span class="w"> </span>                In FastAPI, you would normally use the decorator
<span class="gu">@@ -404,18 +499,24 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more in the
<span class="w"> </span>                [FastAPI docs for Handling Errors](https://fastapi.tiangolo.com/tutorial/handling-errors/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, on_startup: Annotated[Optional[Sequence[Callable[[], Any]]</span>
<span class="gd">-        ], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        on_startup: Annotated[</span>
<span class="gi">+            Optional[Sequence[Callable[[], Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of startup event handler functions.

<span class="w"> </span>                You should instead use the `lifespan` handlers.

<span class="w"> </span>                Read more in the [FastAPI docs for `lifespan`](https://fastapi.tiangolo.com/advanced/events/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, on_shutdown: Annotated[Optional[Sequence[Callable[[], Any]</span>
<span class="gd">-        ]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        on_shutdown: Annotated[</span>
<span class="gi">+            Optional[Sequence[Callable[[], Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of shutdown event handler functions.

<span class="w"> </span>                You should instead use the `lifespan` handlers.
<span class="gu">@@ -423,16 +524,24 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more in the
<span class="w"> </span>                [FastAPI docs for `lifespan`](https://fastapi.tiangolo.com/advanced/events/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, lifespan: Annotated[Optional[Lifespan[AppType]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        lifespan: Annotated[</span>
<span class="gi">+            Optional[Lifespan[AppType]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A `Lifespan` context manager handler. This replaces `startup` and
<span class="w"> </span>                `shutdown` functions with a single context manager.

<span class="w"> </span>                Read more in the
<span class="w"> </span>                [FastAPI docs for `lifespan`](https://fastapi.tiangolo.com/advanced/events/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, terms_of_service: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        terms_of_service: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A URL to the Terms of Service for your API.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -446,9 +555,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                app = FastAPI(terms_of_service=&quot;http://example.com/terms/&quot;)
<span class="w"> </span>                ```
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, contact: Annotated[Optional[Dict[str, Union[str, Any]]],</span>
<span class="gd">-        Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        contact: Annotated[</span>
<span class="gi">+            Optional[Dict[str, Union[str, Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A dictionary with the contact information for the exposed API.

<span class="w"> </span>                It can contain several fields.
<span class="gu">@@ -476,9 +588,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                )
<span class="w"> </span>                ```
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, license_info: Annotated[Optional[Dict[str, Union[str, Any]</span>
<span class="gd">-        ]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        license_info: Annotated[</span>
<span class="gi">+            Optional[Dict[str, Union[str, Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A dictionary with the license information for the exposed API.

<span class="w"> </span>                It can contain several fields.
<span class="gu">@@ -507,18 +622,27 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                )
<span class="w"> </span>                ```
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, openapi_prefix: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        openapi_prefix: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A URL prefix for the OpenAPI URL.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        ), deprecated(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+            deprecated(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                &quot;openapi_prefix&quot; has been deprecated in favor of &quot;root_path&quot;, which
<span class="w"> </span>                follows more closely the ASGI standard, is simpler, and more
<span class="w"> </span>                automatic.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;&#39;, root_path: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;&quot;,</span>
<span class="gi">+        root_path: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A path prefix handled by a proxy that is not seen by the application
<span class="w"> </span>                but is seen by external clients, which affects things like Swagger UI.

<span class="gu">@@ -533,8 +657,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                app = FastAPI(root_path=&quot;/api/v1&quot;)
<span class="w"> </span>                ```
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;&#39;, root_path_in_servers: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;&quot;,</span>
<span class="gi">+        root_path_in_servers: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                To disable automatically generating the URLs in the `servers` field
<span class="w"> </span>                in the autogenerated OpenAPI using the `root_path`.

<span class="gu">@@ -549,9 +677,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                app = FastAPI(root_path_in_servers=False)
<span class="w"> </span>                ```
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, responses: Annotated[Optional[Dict[Union[int, str], Dict[</span>
<span class="gd">-        str, Any]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        responses: Annotated[</span>
<span class="gi">+            Optional[Dict[Union[int, str], Dict[str, Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Additional responses to be shown in OpenAPI.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -562,8 +693,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                And in the
<span class="w"> </span>                [FastAPI docs for Bigger Applications](https://fastapi.tiangolo.com/tutorial/bigger-applications/#include-an-apirouter-with-a-custom-prefix-tags-responses-and-dependencies).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, callbacks: Annotated[Optional[List[BaseRoute]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        callbacks: Annotated[</span>
<span class="gi">+            Optional[List[BaseRoute]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                OpenAPI callbacks that should apply to all *path operations*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -571,8 +706,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for OpenAPI Callbacks](https://fastapi.tiangolo.com/advanced/openapi-callbacks/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, webhooks: Annotated[Optional[routing.APIRouter], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        webhooks: Annotated[</span>
<span class="gi">+            Optional[routing.APIRouter],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Add OpenAPI webhooks. This is similar to `callbacks` but it doesn&#39;t
<span class="w"> </span>                depend on specific *path operations*.

<span class="gu">@@ -583,8 +722,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for OpenAPI Webhooks](https://fastapi.tiangolo.com/advanced/openapi-webhooks/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, deprecated: Annotated[Optional[bool], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        deprecated: Annotated[</span>
<span class="gi">+            Optional[bool],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Mark all *path operations* as deprecated. You probably don&#39;t need it,
<span class="w"> </span>                but it&#39;s available.

<span class="gu">@@ -593,8 +736,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, include_in_schema: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        include_in_schema: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                To include (or not) all the *path operations* in the generated OpenAPI.
<span class="w"> </span>                You probably don&#39;t need it, but it&#39;s available.

<span class="gu">@@ -603,18 +750,24 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Query Parameters and String Validations](https://fastapi.tiangolo.com/tutorial/query-params-str-validations/#exclude-from-openapi).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, swagger_ui_parameters: Annotated[Optional[Dict[str, Any]],</span>
<span class="gd">-        Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        swagger_ui_parameters: Annotated[</span>
<span class="gi">+            Optional[Dict[str, Any]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Parameters to configure Swagger UI, the autogenerated interactive API
<span class="w"> </span>                documentation (by default at `/docs`).

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Configure Swagger UI](https://fastapi.tiangolo.com/how-to/configure-swagger-ui/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, generate_unique_id_function: Annotated[Callable[[routing.</span>
<span class="gd">-        APIRoute], str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        generate_unique_id_function: Annotated[</span>
<span class="gi">+            Callable[[routing.APIRoute], str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Customize the function used to generate unique IDs for the *path
<span class="w"> </span>                operations* shown in the generated OpenAPI.

<span class="gu">@@ -624,9 +777,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(generate_unique_id), separate_input_output_schemas:</span>
<span class="gd">-        Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(generate_unique_id),</span>
<span class="gi">+        separate_input_output_schemas: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Whether to generate separate OpenAPI schemas for request body and
<span class="w"> </span>                response body when the results would be more precise.

<span class="gu">@@ -652,12 +808,18 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                In this case, there would be two different schemas, one for input and
<span class="w"> </span>                another one for output.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, **extra: Annotated[Any, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        **extra: Annotated[</span>
<span class="gi">+            Any,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Extra keyword arguments to be stored in the app, not used by FastAPI
<span class="w"> </span>                anywhere.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]) -&gt;None:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+    ) -&gt; None:</span>
<span class="w"> </span>        self.debug = debug
<span class="w"> </span>        self.title = title
<span class="w"> </span>        self.summary = summary
<span class="gu">@@ -677,8 +839,10 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>        self.servers = servers or []
<span class="w"> </span>        self.separate_input_output_schemas = separate_input_output_schemas
<span class="w"> </span>        self.extra = extra
<span class="gd">-        self.openapi_version: Annotated[str, Doc(</span>
<span class="gd">-            &quot;&quot;&quot;</span>
<span class="gi">+        self.openapi_version: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The version string of OpenAPI.

<span class="w"> </span>                FastAPI will generate OpenAPI version 3.1.0, and will output that as
<span class="gu">@@ -704,27 +868,37 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                app.openapi_version = &quot;3.0.2&quot;
<span class="w"> </span>                ```
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-            )] = &#39;3.1.0&#39;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;3.1.0&quot;</span>
<span class="w"> </span>        self.openapi_schema: Optional[Dict[str, Any]] = None
<span class="w"> </span>        if self.openapi_url:
<span class="w"> </span>            assert self.title, &quot;A title must be provided for OpenAPI, e.g.: &#39;My API&#39;&quot;
<span class="w"> </span>            assert self.version, &quot;A version must be provided for OpenAPI, e.g.: &#39;2.1.0&#39;&quot;
<span class="gi">+        # TODO: remove when discarding the openapi_prefix parameter</span>
<span class="w"> </span>        if openapi_prefix:
<span class="w"> </span>            logger.warning(
<span class="gd">-                &#39;&quot;openapi_prefix&quot; has been deprecated in favor of &quot;root_path&quot;, which follows more closely the ASGI standard, is simpler, and more automatic. Check the docs at https://fastapi.tiangolo.com/advanced/sub-applications/&#39;</span>
<span class="gd">-                )</span>
<span class="gd">-        self.webhooks: Annotated[routing.APIRouter, Doc(</span>
<span class="gd">-            &quot;&quot;&quot;</span>
<span class="gi">+                &#39;&quot;openapi_prefix&quot; has been deprecated in favor of &quot;root_path&quot;, which &#39;</span>
<span class="gi">+                &quot;follows more closely the ASGI standard, is simpler, and more &quot;</span>
<span class="gi">+                &quot;automatic. Check the docs at &quot;</span>
<span class="gi">+                &quot;https://fastapi.tiangolo.com/advanced/sub-applications/&quot;</span>
<span class="gi">+            )</span>
<span class="gi">+        self.webhooks: Annotated[</span>
<span class="gi">+            routing.APIRouter,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The `app.webhooks` attribute is an `APIRouter` with the *path
<span class="w"> </span>                operations* that will be used just for documentation of webhooks.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for OpenAPI Webhooks](https://fastapi.tiangolo.com/advanced/openapi-webhooks/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-            )] = webhooks or routing.APIRouter()</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = webhooks or routing.APIRouter()</span>
<span class="w"> </span>        self.root_path = root_path or openapi_prefix
<span class="gd">-        self.state: Annotated[State, Doc(</span>
<span class="gd">-            &quot;&quot;&quot;</span>
<span class="gi">+        self.state: Annotated[</span>
<span class="gi">+            State,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A state object for the application. This is the same object for the
<span class="w"> </span>                entire application, it doesn&#39;t change from request to request.

<span class="gu">@@ -736,10 +910,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [Starlette docs for Applications](https://www.starlette.io/applications/#storing-state-on-the-app-instance).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-            )] = State()</span>
<span class="gd">-        self.dependency_overrides: Annotated[Dict[Callable[..., Any],</span>
<span class="gd">-            Callable[..., Any]], Doc(</span>
<span class="gd">-            &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = State()</span>
<span class="gi">+        self.dependency_overrides: Annotated[</span>
<span class="gi">+            Dict[Callable[..., Any], Callable[..., Any]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A dictionary with overrides for the dependencies.

<span class="w"> </span>                Each key is the original dependency callable, and the value is the
<span class="gu">@@ -751,30 +927,43 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Testing Dependencies with Overrides](https://fastapi.tiangolo.com/advanced/testing-dependencies/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-            )] = {}</span>
<span class="gd">-        self.router: routing.APIRouter = routing.APIRouter(routes=routes,</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = {}</span>
<span class="gi">+        self.router: routing.APIRouter = routing.APIRouter(</span>
<span class="gi">+            routes=routes,</span>
<span class="w"> </span>            redirect_slashes=redirect_slashes,
<span class="gd">-            dependency_overrides_provider=self, on_startup=on_startup,</span>
<span class="gd">-            on_shutdown=on_shutdown, lifespan=lifespan,</span>
<span class="gd">-            default_response_class=default_response_class, dependencies=</span>
<span class="gd">-            dependencies, callbacks=callbacks, deprecated=deprecated,</span>
<span class="gd">-            include_in_schema=include_in_schema, responses=responses,</span>
<span class="gd">-            generate_unique_id_function=generate_unique_id_function)</span>
<span class="gd">-        self.exception_handlers: Dict[Any, Callable[[Request, Any], Union[</span>
<span class="gd">-            Response, Awaitable[Response]]]] = {</span>
<span class="gd">-            } if exception_handlers is None else dict(exception_handlers)</span>
<span class="gd">-        self.exception_handlers.setdefault(HTTPException,</span>
<span class="gd">-            http_exception_handler)</span>
<span class="gd">-        self.exception_handlers.setdefault(RequestValidationError,</span>
<span class="gd">-            request_validation_exception_handler)</span>
<span class="gd">-        self.exception_handlers.setdefault(WebSocketRequestValidationError,</span>
<span class="gd">-            websocket_request_validation_exception_handler)</span>
<span class="gd">-        self.user_middleware: List[Middleware] = [</span>
<span class="gd">-            ] if middleware is None else list(middleware)</span>
<span class="gi">+            dependency_overrides_provider=self,</span>
<span class="gi">+            on_startup=on_startup,</span>
<span class="gi">+            on_shutdown=on_shutdown,</span>
<span class="gi">+            lifespan=lifespan,</span>
<span class="gi">+            default_response_class=default_response_class,</span>
<span class="gi">+            dependencies=dependencies,</span>
<span class="gi">+            callbacks=callbacks,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            responses=responses,</span>
<span class="gi">+            generate_unique_id_function=generate_unique_id_function,</span>
<span class="gi">+        )</span>
<span class="gi">+        self.exception_handlers: Dict[</span>
<span class="gi">+            Any, Callable[[Request, Any], Union[Response, Awaitable[Response]]]</span>
<span class="gi">+        ] = {} if exception_handlers is None else dict(exception_handlers)</span>
<span class="gi">+        self.exception_handlers.setdefault(HTTPException, http_exception_handler)</span>
<span class="gi">+        self.exception_handlers.setdefault(</span>
<span class="gi">+            RequestValidationError, request_validation_exception_handler</span>
<span class="gi">+        )</span>
<span class="gi">+        self.exception_handlers.setdefault(</span>
<span class="gi">+            WebSocketRequestValidationError,</span>
<span class="gi">+            # Starlette still has incorrect type specification for the handlers</span>
<span class="gi">+            websocket_request_validation_exception_handler,  # type: ignore</span>
<span class="gi">+        )</span>
<span class="gi">+</span>
<span class="gi">+        self.user_middleware: List[Middleware] = (</span>
<span class="gi">+            [] if middleware is None else list(middleware)</span>
<span class="gi">+        )</span>
<span class="w"> </span>        self.middleware_stack: Union[ASGIApp, None] = None
<span class="w"> </span>        self.setup()

<span class="gd">-    def openapi(self) -&gt;Dict[str, Any]:</span>
<span class="gi">+    def openapi(self) -&gt; Dict[str, Any]:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Generate the OpenAPI schema of the application. This is called by FastAPI
<span class="w"> </span>        internally.
<span class="gu">@@ -788,32 +977,248 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>        Read more in the
<span class="w"> </span>        [FastAPI docs for OpenAPI](https://fastapi.tiangolo.com/how-to/extending-openapi/).
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        if not self.openapi_schema:</span>
<span class="gi">+            self.openapi_schema = get_openapi(</span>
<span class="gi">+                title=self.title,</span>
<span class="gi">+                version=self.version,</span>
<span class="gi">+                openapi_version=self.openapi_version,</span>
<span class="gi">+                summary=self.summary,</span>
<span class="gi">+                description=self.description,</span>
<span class="gi">+                terms_of_service=self.terms_of_service,</span>
<span class="gi">+                contact=self.contact,</span>
<span class="gi">+                license_info=self.license_info,</span>
<span class="gi">+                routes=self.routes,</span>
<span class="gi">+                webhooks=self.webhooks.routes,</span>
<span class="gi">+                tags=self.openapi_tags,</span>
<span class="gi">+                servers=self.servers,</span>
<span class="gi">+                separate_input_output_schemas=self.separate_input_output_schemas,</span>
<span class="gi">+            )</span>
<span class="gi">+        return self.openapi_schema</span>
<span class="gi">+</span>
<span class="gi">+    def setup(self) -&gt; None:</span>
<span class="gi">+        if self.openapi_url:</span>
<span class="gi">+            urls = (server_data.get(&quot;url&quot;) for server_data in self.servers)</span>
<span class="gi">+            server_urls = {url for url in urls if url}</span>
<span class="gi">+</span>
<span class="gi">+            async def openapi(req: Request) -&gt; JSONResponse:</span>
<span class="gi">+                root_path = req.scope.get(&quot;root_path&quot;, &quot;&quot;).rstrip(&quot;/&quot;)</span>
<span class="gi">+                if root_path not in server_urls:</span>
<span class="gi">+                    if root_path and self.root_path_in_servers:</span>
<span class="gi">+                        self.servers.insert(0, {&quot;url&quot;: root_path})</span>
<span class="gi">+                        server_urls.add(root_path)</span>
<span class="gi">+                return JSONResponse(self.openapi())</span>
<span class="gi">+</span>
<span class="gi">+            self.add_route(self.openapi_url, openapi, include_in_schema=False)</span>
<span class="gi">+        if self.openapi_url and self.docs_url:</span>
<span class="gi">+</span>
<span class="gi">+            async def swagger_ui_html(req: Request) -&gt; HTMLResponse:</span>
<span class="gi">+                root_path = req.scope.get(&quot;root_path&quot;, &quot;&quot;).rstrip(&quot;/&quot;)</span>
<span class="gi">+                openapi_url = root_path + self.openapi_url</span>
<span class="gi">+                oauth2_redirect_url = self.swagger_ui_oauth2_redirect_url</span>
<span class="gi">+                if oauth2_redirect_url:</span>
<span class="gi">+                    oauth2_redirect_url = root_path + oauth2_redirect_url</span>
<span class="gi">+                return get_swagger_ui_html(</span>
<span class="gi">+                    openapi_url=openapi_url,</span>
<span class="gi">+                    title=f&quot;{self.title} - Swagger UI&quot;,</span>
<span class="gi">+                    oauth2_redirect_url=oauth2_redirect_url,</span>
<span class="gi">+                    init_oauth=self.swagger_ui_init_oauth,</span>
<span class="gi">+                    swagger_ui_parameters=self.swagger_ui_parameters,</span>
<span class="gi">+                )</span>
<span class="gi">+</span>
<span class="gi">+            self.add_route(self.docs_url, swagger_ui_html, include_in_schema=False)</span>
<span class="gi">+</span>
<span class="gi">+            if self.swagger_ui_oauth2_redirect_url:</span>
<span class="gi">+</span>
<span class="gi">+                async def swagger_ui_redirect(req: Request) -&gt; HTMLResponse:</span>
<span class="gi">+                    return get_swagger_ui_oauth2_redirect_html()</span>
<span class="gi">+</span>
<span class="gi">+                self.add_route(</span>
<span class="gi">+                    self.swagger_ui_oauth2_redirect_url,</span>
<span class="gi">+                    swagger_ui_redirect,</span>
<span class="gi">+                    include_in_schema=False,</span>
<span class="gi">+                )</span>
<span class="gi">+        if self.openapi_url and self.redoc_url:</span>
<span class="gi">+</span>
<span class="gi">+            async def redoc_html(req: Request) -&gt; HTMLResponse:</span>
<span class="gi">+                root_path = req.scope.get(&quot;root_path&quot;, &quot;&quot;).rstrip(&quot;/&quot;)</span>
<span class="gi">+                openapi_url = root_path + self.openapi_url</span>
<span class="gi">+                return get_redoc_html(</span>
<span class="gi">+                    openapi_url=openapi_url, title=f&quot;{self.title} - ReDoc&quot;</span>
<span class="gi">+                )</span>

<span class="gd">-    async def __call__(self, scope: Scope, receive: Receive, send: Send</span>
<span class="gd">-        ) -&gt;None:</span>
<span class="gi">+            self.add_route(self.redoc_url, redoc_html, include_in_schema=False)</span>
<span class="gi">+</span>
<span class="gi">+    async def __call__(self, scope: Scope, receive: Receive, send: Send) -&gt; None:</span>
<span class="w"> </span>        if self.root_path:
<span class="gd">-            scope[&#39;root_path&#39;] = self.root_path</span>
<span class="gi">+            scope[&quot;root_path&quot;] = self.root_path</span>
<span class="w"> </span>        await super().__call__(scope, receive, send)

<span class="gd">-    def websocket(self, path: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def add_api_route(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: str,</span>
<span class="gi">+        endpoint: Callable[..., Coroutine[Any, Any, Response]],</span>
<span class="gi">+        *,</span>
<span class="gi">+        response_model: Any = Default(None),</span>
<span class="gi">+        status_code: Optional[int] = None,</span>
<span class="gi">+        tags: Optional[List[Union[str, Enum]]] = None,</span>
<span class="gi">+        dependencies: Optional[Sequence[Depends]] = None,</span>
<span class="gi">+        summary: Optional[str] = None,</span>
<span class="gi">+        description: Optional[str] = None,</span>
<span class="gi">+        response_description: str = &quot;Successful Response&quot;,</span>
<span class="gi">+        responses: Optional[Dict[Union[int, str], Dict[str, Any]]] = None,</span>
<span class="gi">+        deprecated: Optional[bool] = None,</span>
<span class="gi">+        methods: Optional[List[str]] = None,</span>
<span class="gi">+        operation_id: Optional[str] = None,</span>
<span class="gi">+        response_model_include: Optional[IncEx] = None,</span>
<span class="gi">+        response_model_exclude: Optional[IncEx] = None,</span>
<span class="gi">+        response_model_by_alias: bool = True,</span>
<span class="gi">+        response_model_exclude_unset: bool = False,</span>
<span class="gi">+        response_model_exclude_defaults: bool = False,</span>
<span class="gi">+        response_model_exclude_none: bool = False,</span>
<span class="gi">+        include_in_schema: bool = True,</span>
<span class="gi">+        response_class: Union[Type[Response], DefaultPlaceholder] = Default(</span>
<span class="gi">+            JSONResponse</span>
<span class="gi">+        ),</span>
<span class="gi">+        name: Optional[str] = None,</span>
<span class="gi">+        openapi_extra: Optional[Dict[str, Any]] = None,</span>
<span class="gi">+        generate_unique_id_function: Callable[[routing.APIRoute], str] = Default(</span>
<span class="gi">+            generate_unique_id</span>
<span class="gi">+        ),</span>
<span class="gi">+    ) -&gt; None:</span>
<span class="gi">+        self.router.add_api_route(</span>
<span class="gi">+            path,</span>
<span class="gi">+            endpoint=endpoint,</span>
<span class="gi">+            response_model=response_model,</span>
<span class="gi">+            status_code=status_code,</span>
<span class="gi">+            tags=tags,</span>
<span class="gi">+            dependencies=dependencies,</span>
<span class="gi">+            summary=summary,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            response_description=response_description,</span>
<span class="gi">+            responses=responses,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            methods=methods,</span>
<span class="gi">+            operation_id=operation_id,</span>
<span class="gi">+            response_model_include=response_model_include,</span>
<span class="gi">+            response_model_exclude=response_model_exclude,</span>
<span class="gi">+            response_model_by_alias=response_model_by_alias,</span>
<span class="gi">+            response_model_exclude_unset=response_model_exclude_unset,</span>
<span class="gi">+            response_model_exclude_defaults=response_model_exclude_defaults,</span>
<span class="gi">+            response_model_exclude_none=response_model_exclude_none,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            response_class=response_class,</span>
<span class="gi">+            name=name,</span>
<span class="gi">+            openapi_extra=openapi_extra,</span>
<span class="gi">+            generate_unique_id_function=generate_unique_id_function,</span>
<span class="gi">+        )</span>
<span class="gi">+</span>
<span class="gi">+    def api_route(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: str,</span>
<span class="gi">+        *,</span>
<span class="gi">+        response_model: Any = Default(None),</span>
<span class="gi">+        status_code: Optional[int] = None,</span>
<span class="gi">+        tags: Optional[List[Union[str, Enum]]] = None,</span>
<span class="gi">+        dependencies: Optional[Sequence[Depends]] = None,</span>
<span class="gi">+        summary: Optional[str] = None,</span>
<span class="gi">+        description: Optional[str] = None,</span>
<span class="gi">+        response_description: str = &quot;Successful Response&quot;,</span>
<span class="gi">+        responses: Optional[Dict[Union[int, str], Dict[str, Any]]] = None,</span>
<span class="gi">+        deprecated: Optional[bool] = None,</span>
<span class="gi">+        methods: Optional[List[str]] = None,</span>
<span class="gi">+        operation_id: Optional[str] = None,</span>
<span class="gi">+        response_model_include: Optional[IncEx] = None,</span>
<span class="gi">+        response_model_exclude: Optional[IncEx] = None,</span>
<span class="gi">+        response_model_by_alias: bool = True,</span>
<span class="gi">+        response_model_exclude_unset: bool = False,</span>
<span class="gi">+        response_model_exclude_defaults: bool = False,</span>
<span class="gi">+        response_model_exclude_none: bool = False,</span>
<span class="gi">+        include_in_schema: bool = True,</span>
<span class="gi">+        response_class: Type[Response] = Default(JSONResponse),</span>
<span class="gi">+        name: Optional[str] = None,</span>
<span class="gi">+        openapi_extra: Optional[Dict[str, Any]] = None,</span>
<span class="gi">+        generate_unique_id_function: Callable[[routing.APIRoute], str] = Default(</span>
<span class="gi">+            generate_unique_id</span>
<span class="gi">+        ),</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="gi">+        def decorator(func: DecoratedCallable) -&gt; DecoratedCallable:</span>
<span class="gi">+            self.router.add_api_route(</span>
<span class="gi">+                path,</span>
<span class="gi">+                func,</span>
<span class="gi">+                response_model=response_model,</span>
<span class="gi">+                status_code=status_code,</span>
<span class="gi">+                tags=tags,</span>
<span class="gi">+                dependencies=dependencies,</span>
<span class="gi">+                summary=summary,</span>
<span class="gi">+                description=description,</span>
<span class="gi">+                response_description=response_description,</span>
<span class="gi">+                responses=responses,</span>
<span class="gi">+                deprecated=deprecated,</span>
<span class="gi">+                methods=methods,</span>
<span class="gi">+                operation_id=operation_id,</span>
<span class="gi">+                response_model_include=response_model_include,</span>
<span class="gi">+                response_model_exclude=response_model_exclude,</span>
<span class="gi">+                response_model_by_alias=response_model_by_alias,</span>
<span class="gi">+                response_model_exclude_unset=response_model_exclude_unset,</span>
<span class="gi">+                response_model_exclude_defaults=response_model_exclude_defaults,</span>
<span class="gi">+                response_model_exclude_none=response_model_exclude_none,</span>
<span class="gi">+                include_in_schema=include_in_schema,</span>
<span class="gi">+                response_class=response_class,</span>
<span class="gi">+                name=name,</span>
<span class="gi">+                openapi_extra=openapi_extra,</span>
<span class="gi">+                generate_unique_id_function=generate_unique_id_function,</span>
<span class="gi">+            )</span>
<span class="gi">+            return func</span>
<span class="gi">+</span>
<span class="gi">+        return decorator</span>
<span class="gi">+</span>
<span class="gi">+    def add_api_websocket_route(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: str,</span>
<span class="gi">+        endpoint: Callable[..., Any],</span>
<span class="gi">+        name: Optional[str] = None,</span>
<span class="gi">+        *,</span>
<span class="gi">+        dependencies: Optional[Sequence[Depends]] = None,</span>
<span class="gi">+    ) -&gt; None:</span>
<span class="gi">+        self.router.add_api_websocket_route(</span>
<span class="gi">+            path,</span>
<span class="gi">+            endpoint,</span>
<span class="gi">+            name=name,</span>
<span class="gi">+            dependencies=dependencies,</span>
<span class="gi">+        )</span>
<span class="gi">+</span>
<span class="gi">+    def websocket(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                WebSocket path.
<span class="gd">-                &quot;&quot;&quot;)], name:</span>
<span class="gd">-        Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A name for the WebSocket. Only used internally.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, *, dependencies: Annotated[Optional[Sequence[Depends]],</span>
<span class="gd">-        Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        *,</span>
<span class="gi">+        dependencies: Annotated[</span>
<span class="gi">+            Optional[Sequence[Depends]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of dependencies (using `Depends()`) to be used for this
<span class="w"> </span>                WebSocket.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for WebSockets](https://fastapi.tiangolo.com/advanced/websockets/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None) -&gt;Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Decorate a WebSocket function.

<span class="gu">@@ -835,13 +1240,27 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                await websocket.send_text(f&quot;Message text was: {data}&quot;)
<span class="w"> </span>        ```
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>

<span class="gd">-    def include_router(self, router: Annotated[routing.APIRouter, Doc(</span>
<span class="gd">-        &#39;The `APIRouter` to include.&#39;)], *, prefix: Annotated[str, Doc(</span>
<span class="gd">-        &#39;An optional path prefix for the router.&#39;)]=&#39;&#39;, tags: Annotated[</span>
<span class="gd">-        Optional[List[Union[str, Enum]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+        def decorator(func: DecoratedCallable) -&gt; DecoratedCallable:</span>
<span class="gi">+            self.add_api_websocket_route(</span>
<span class="gi">+                path,</span>
<span class="gi">+                func,</span>
<span class="gi">+                name=name,</span>
<span class="gi">+                dependencies=dependencies,</span>
<span class="gi">+            )</span>
<span class="gi">+            return func</span>
<span class="gi">+</span>
<span class="gi">+        return decorator</span>
<span class="gi">+</span>
<span class="gi">+    def include_router(</span>
<span class="gi">+        self,</span>
<span class="gi">+        router: Annotated[routing.APIRouter, Doc(&quot;The `APIRouter` to include.&quot;)],</span>
<span class="gi">+        *,</span>
<span class="gi">+        prefix: Annotated[str, Doc(&quot;An optional path prefix for the router.&quot;)] = &quot;&quot;,</span>
<span class="gi">+        tags: Annotated[</span>
<span class="gi">+            Optional[List[Union[str, Enum]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of tags to be applied to all the *path operations* in this
<span class="w"> </span>                router.

<span class="gu">@@ -850,8 +1269,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, dependencies: Annotated[Optional[Sequence[Depends]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        dependencies: Annotated[</span>
<span class="gi">+            Optional[Sequence[Depends]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of dependencies (using `Depends()`) to be applied to all the
<span class="w"> </span>                *path operations* in this router.

<span class="gu">@@ -874,9 +1297,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                )
<span class="w"> </span>                ```
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, responses: Annotated[Optional[Dict[Union[int, str], Dict[</span>
<span class="gd">-        str, Any]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        responses: Annotated[</span>
<span class="gi">+            Optional[Dict[Union[int, str], Dict[str, Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Additional responses to be shown in OpenAPI.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -887,8 +1313,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                And in the
<span class="w"> </span>                [FastAPI docs for Bigger Applications](https://fastapi.tiangolo.com/tutorial/bigger-applications/#include-an-apirouter-with-a-custom-prefix-tags-responses-and-dependencies).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, deprecated: Annotated[Optional[bool], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        deprecated: Annotated[</span>
<span class="gi">+            Optional[bool],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Mark all the *path operations* in this router as deprecated.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -908,8 +1338,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                )
<span class="w"> </span>                ```
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, include_in_schema: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        include_in_schema: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Include (or not) all the *path operations* in this router in the
<span class="w"> </span>                generated OpenAPI schema.

<span class="gu">@@ -930,8 +1364,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                )
<span class="w"> </span>                ```
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, default_response_class: Annotated[Type[Response], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        default_response_class: Annotated[</span>
<span class="gi">+            Type[Response],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Default response class to be used for the *path operations* in this
<span class="w"> </span>                router.

<span class="gu">@@ -954,9 +1392,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                )
<span class="w"> </span>                ```
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(JSONResponse), callbacks: Annotated[Optional[List[</span>
<span class="gd">-        BaseRoute]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(JSONResponse),</span>
<span class="gi">+        callbacks: Annotated[</span>
<span class="gi">+            Optional[List[BaseRoute]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                List of *path operations* that will be used as OpenAPI callbacks.

<span class="w"> </span>                This is only for OpenAPI documentation, the callbacks won&#39;t be used
<span class="gu">@@ -967,9 +1408,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for OpenAPI Callbacks](https://fastapi.tiangolo.com/advanced/openapi-callbacks/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, generate_unique_id_function: Annotated[Callable[[routing.</span>
<span class="gd">-        APIRoute], str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        generate_unique_id_function: Annotated[</span>
<span class="gi">+            Callable[[routing.APIRoute], str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Customize the function used to generate unique IDs for the *path
<span class="w"> </span>                operations* shown in the generated OpenAPI.

<span class="gu">@@ -979,7 +1423,9 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(generate_unique_id)) -&gt;None:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(generate_unique_id),</span>
<span class="gi">+    ) -&gt; None:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Include an `APIRouter` in the same app.

<span class="gu">@@ -998,16 +1444,36 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>        app.include_router(users_router)
<span class="w"> </span>        ```
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        self.router.include_router(</span>
<span class="gi">+            router,</span>
<span class="gi">+            prefix=prefix,</span>
<span class="gi">+            tags=tags,</span>
<span class="gi">+            dependencies=dependencies,</span>
<span class="gi">+            responses=responses,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            default_response_class=default_response_class,</span>
<span class="gi">+            callbacks=callbacks,</span>
<span class="gi">+            generate_unique_id_function=generate_unique_id_function,</span>
<span class="gi">+        )</span>

<span class="gd">-    def get(self, path: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def get(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The URL path to be used for this *path operation*.

<span class="w"> </span>                For example, in `http://example.com/items`, the path is `/items`.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], *, response_model: Annotated[Any, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        *,</span>
<span class="gi">+        response_model: Annotated[</span>
<span class="gi">+            Any,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The type to use for the response.

<span class="w"> </span>                It could be any valid Pydantic *field* type. So, it doesn&#39;t have to
<span class="gu">@@ -1036,8 +1502,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model](https://fastapi.tiangolo.com/tutorial/response-model/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(None), status_code: Annotated[Optional[int], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(None),</span>
<span class="gi">+        status_code: Annotated[</span>
<span class="gi">+            Optional[int],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The default status code to be used for the response.

<span class="w"> </span>                You could override the status code by returning a response directly.
<span class="gu">@@ -1045,8 +1515,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Status Code](https://fastapi.tiangolo.com/tutorial/response-status-code/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, tags: Annotated[Optional[List[Union[str, Enum]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        tags: Annotated[</span>
<span class="gi">+            Optional[List[Union[str, Enum]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of tags to be applied to the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -1054,16 +1528,24 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/#tags).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, dependencies: Annotated[Optional[Sequence[Depends]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        dependencies: Annotated[</span>
<span class="gi">+            Optional[Sequence[Depends]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of dependencies (using `Depends()`) to be applied to the
<span class="w"> </span>                *path operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Dependencies in path operation decorators](https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-in-path-operation-decorators/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, summary: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        summary: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A summary for the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -1071,8 +1553,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A description for the *path operation*.

<span class="w"> </span>                If not provided, it will be extracted automatically from the docstring
<span class="gu">@@ -1085,27 +1571,42 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_description: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_description: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The description for the default response.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;Successful Response&#39;, responses: Annotated[Optional[Dict[Union[</span>
<span class="gd">-        int, str], Dict[str, Any]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;Successful Response&quot;,</span>
<span class="gi">+        responses: Annotated[</span>
<span class="gi">+            Optional[Dict[Union[int, str], Dict[str, Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Additional responses that could be returned by this *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, deprecated: Annotated[Optional[bool], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        deprecated: Annotated[</span>
<span class="gi">+            Optional[bool],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Mark this *path operation* as deprecated.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, operation_id: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        operation_id: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Custom operation ID to be used by this *path operation*.

<span class="w"> </span>                By default, it is generated automatically.
<span class="gu">@@ -1120,32 +1621,48 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_include: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_include: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to include only certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_exclude: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_exclude: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to exclude certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_by_alias: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_by_alias: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response model
<span class="w"> </span>                should be serialized by alias when an alias is used.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_model_exclude_unset: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_model_exclude_unset: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that were not set and
<span class="w"> </span>                have their default values. This is different from
<span class="gu">@@ -1158,8 +1675,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_defaults: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_defaults: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that have the same value
<span class="w"> </span>                as the default. This is different from `response_model_exclude_unset`
<span class="gu">@@ -1171,8 +1692,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_none: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_none: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data should
<span class="w"> </span>                exclude fields set to `None`.

<span class="gu">@@ -1184,8 +1709,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_exclude_none).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, include_in_schema: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        include_in_schema: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Include this *path operation* in the generated OpenAPI schema.

<span class="w"> </span>                This affects the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -1193,8 +1722,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Query Parameters and String Validations](https://fastapi.tiangolo.com/tutorial/query-params-str-validations/#exclude-from-openapi).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_class: Annotated[Type[Response], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_class: Annotated[</span>
<span class="gi">+            Type[Response],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Response class to be used for this *path operation*.

<span class="w"> </span>                This will not be used if you return a response directly.
<span class="gu">@@ -1202,12 +1735,20 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Custom Response - HTML, Stream, File, others](https://fastapi.tiangolo.com/advanced/custom-response/#redirectresponse).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(JSONResponse), name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(JSONResponse),</span>
<span class="gi">+        name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Name for this *path operation*. Only used internally.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, callbacks: Annotated[Optional[List[BaseRoute]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        callbacks: Annotated[</span>
<span class="gi">+            Optional[List[BaseRoute]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                List of *path operations* that will be used as OpenAPI callbacks.

<span class="w"> </span>                This is only for OpenAPI documentation, the callbacks won&#39;t be used
<span class="gu">@@ -1218,17 +1759,24 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for OpenAPI Callbacks](https://fastapi.tiangolo.com/advanced/openapi-callbacks/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, openapi_extra: Annotated[Optional[Dict[str, Any]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        openapi_extra: Annotated[</span>
<span class="gi">+            Optional[Dict[str, Any]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Extra metadata to be included in the OpenAPI schema for this *path
<span class="w"> </span>                operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Advanced Configuration](https://fastapi.tiangolo.com/advanced/path-operation-advanced-configuration/#custom-openapi-path-operation-schema).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, generate_unique_id_function: Annotated[Callable[[routing.</span>
<span class="gd">-        APIRoute], str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        generate_unique_id_function: Annotated[</span>
<span class="gi">+            Callable[[routing.APIRoute], str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Customize the function used to generate unique IDs for the *path
<span class="w"> </span>                operations* shown in the generated OpenAPI.

<span class="gu">@@ -1238,8 +1786,9 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(generate_unique_id)) -&gt;Callable[[DecoratedCallable],</span>
<span class="gd">-        DecoratedCallable]:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(generate_unique_id),</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Add a *path operation* using an HTTP GET operation.

<span class="gu">@@ -1255,16 +1804,49 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>            return [{&quot;name&quot;: &quot;Empanada&quot;}, {&quot;name&quot;: &quot;Arepa&quot;}]
<span class="w"> </span>        ```
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self.router.get(</span>
<span class="gi">+            path,</span>
<span class="gi">+            response_model=response_model,</span>
<span class="gi">+            status_code=status_code,</span>
<span class="gi">+            tags=tags,</span>
<span class="gi">+            dependencies=dependencies,</span>
<span class="gi">+            summary=summary,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            response_description=response_description,</span>
<span class="gi">+            responses=responses,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            operation_id=operation_id,</span>
<span class="gi">+            response_model_include=response_model_include,</span>
<span class="gi">+            response_model_exclude=response_model_exclude,</span>
<span class="gi">+            response_model_by_alias=response_model_by_alias,</span>
<span class="gi">+            response_model_exclude_unset=response_model_exclude_unset,</span>
<span class="gi">+            response_model_exclude_defaults=response_model_exclude_defaults,</span>
<span class="gi">+            response_model_exclude_none=response_model_exclude_none,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            response_class=response_class,</span>
<span class="gi">+            name=name,</span>
<span class="gi">+            callbacks=callbacks,</span>
<span class="gi">+            openapi_extra=openapi_extra,</span>
<span class="gi">+            generate_unique_id_function=generate_unique_id_function,</span>
<span class="gi">+        )</span>

<span class="gd">-    def put(self, path: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def put(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The URL path to be used for this *path operation*.

<span class="w"> </span>                For example, in `http://example.com/items`, the path is `/items`.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], *, response_model: Annotated[Any, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        *,</span>
<span class="gi">+        response_model: Annotated[</span>
<span class="gi">+            Any,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The type to use for the response.

<span class="w"> </span>                It could be any valid Pydantic *field* type. So, it doesn&#39;t have to
<span class="gu">@@ -1293,8 +1875,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model](https://fastapi.tiangolo.com/tutorial/response-model/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(None), status_code: Annotated[Optional[int], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(None),</span>
<span class="gi">+        status_code: Annotated[</span>
<span class="gi">+            Optional[int],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The default status code to be used for the response.

<span class="w"> </span>                You could override the status code by returning a response directly.
<span class="gu">@@ -1302,8 +1888,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Status Code](https://fastapi.tiangolo.com/tutorial/response-status-code/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, tags: Annotated[Optional[List[Union[str, Enum]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        tags: Annotated[</span>
<span class="gi">+            Optional[List[Union[str, Enum]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of tags to be applied to the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -1311,16 +1901,24 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/#tags).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, dependencies: Annotated[Optional[Sequence[Depends]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        dependencies: Annotated[</span>
<span class="gi">+            Optional[Sequence[Depends]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of dependencies (using `Depends()`) to be applied to the
<span class="w"> </span>                *path operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Dependencies in path operation decorators](https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-in-path-operation-decorators/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, summary: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        summary: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A summary for the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -1328,8 +1926,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A description for the *path operation*.

<span class="w"> </span>                If not provided, it will be extracted automatically from the docstring
<span class="gu">@@ -1342,27 +1944,42 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_description: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_description: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The description for the default response.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;Successful Response&#39;, responses: Annotated[Optional[Dict[Union[</span>
<span class="gd">-        int, str], Dict[str, Any]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;Successful Response&quot;,</span>
<span class="gi">+        responses: Annotated[</span>
<span class="gi">+            Optional[Dict[Union[int, str], Dict[str, Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Additional responses that could be returned by this *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, deprecated: Annotated[Optional[bool], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        deprecated: Annotated[</span>
<span class="gi">+            Optional[bool],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Mark this *path operation* as deprecated.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, operation_id: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        operation_id: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Custom operation ID to be used by this *path operation*.

<span class="w"> </span>                By default, it is generated automatically.
<span class="gu">@@ -1377,32 +1994,48 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_include: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_include: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to include only certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_exclude: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_exclude: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to exclude certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_by_alias: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_by_alias: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response model
<span class="w"> </span>                should be serialized by alias when an alias is used.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_model_exclude_unset: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_model_exclude_unset: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that were not set and
<span class="w"> </span>                have their default values. This is different from
<span class="gu">@@ -1415,8 +2048,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_defaults: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_defaults: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that have the same value
<span class="w"> </span>                as the default. This is different from `response_model_exclude_unset`
<span class="gu">@@ -1428,8 +2065,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_none: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_none: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data should
<span class="w"> </span>                exclude fields set to `None`.

<span class="gu">@@ -1441,8 +2082,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_exclude_none).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, include_in_schema: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        include_in_schema: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Include this *path operation* in the generated OpenAPI schema.

<span class="w"> </span>                This affects the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -1450,8 +2095,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Query Parameters and String Validations](https://fastapi.tiangolo.com/tutorial/query-params-str-validations/#exclude-from-openapi).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_class: Annotated[Type[Response], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_class: Annotated[</span>
<span class="gi">+            Type[Response],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Response class to be used for this *path operation*.

<span class="w"> </span>                This will not be used if you return a response directly.
<span class="gu">@@ -1459,12 +2108,20 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Custom Response - HTML, Stream, File, others](https://fastapi.tiangolo.com/advanced/custom-response/#redirectresponse).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(JSONResponse), name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(JSONResponse),</span>
<span class="gi">+        name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Name for this *path operation*. Only used internally.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, callbacks: Annotated[Optional[List[BaseRoute]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        callbacks: Annotated[</span>
<span class="gi">+            Optional[List[BaseRoute]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                List of *path operations* that will be used as OpenAPI callbacks.

<span class="w"> </span>                This is only for OpenAPI documentation, the callbacks won&#39;t be used
<span class="gu">@@ -1475,17 +2132,24 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for OpenAPI Callbacks](https://fastapi.tiangolo.com/advanced/openapi-callbacks/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, openapi_extra: Annotated[Optional[Dict[str, Any]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        openapi_extra: Annotated[</span>
<span class="gi">+            Optional[Dict[str, Any]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Extra metadata to be included in the OpenAPI schema for this *path
<span class="w"> </span>                operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Advanced Configuration](https://fastapi.tiangolo.com/advanced/path-operation-advanced-configuration/#custom-openapi-path-operation-schema).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, generate_unique_id_function: Annotated[Callable[[routing.</span>
<span class="gd">-        APIRoute], str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        generate_unique_id_function: Annotated[</span>
<span class="gi">+            Callable[[routing.APIRoute], str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Customize the function used to generate unique IDs for the *path
<span class="w"> </span>                operations* shown in the generated OpenAPI.

<span class="gu">@@ -1495,8 +2159,9 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(generate_unique_id)) -&gt;Callable[[DecoratedCallable],</span>
<span class="gd">-        DecoratedCallable]:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(generate_unique_id),</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Add a *path operation* using an HTTP PUT operation.

<span class="gu">@@ -1517,16 +2182,49 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>            return {&quot;message&quot;: &quot;Item replaced&quot;, &quot;id&quot;: item_id}
<span class="w"> </span>        ```
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self.router.put(</span>
<span class="gi">+            path,</span>
<span class="gi">+            response_model=response_model,</span>
<span class="gi">+            status_code=status_code,</span>
<span class="gi">+            tags=tags,</span>
<span class="gi">+            dependencies=dependencies,</span>
<span class="gi">+            summary=summary,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            response_description=response_description,</span>
<span class="gi">+            responses=responses,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            operation_id=operation_id,</span>
<span class="gi">+            response_model_include=response_model_include,</span>
<span class="gi">+            response_model_exclude=response_model_exclude,</span>
<span class="gi">+            response_model_by_alias=response_model_by_alias,</span>
<span class="gi">+            response_model_exclude_unset=response_model_exclude_unset,</span>
<span class="gi">+            response_model_exclude_defaults=response_model_exclude_defaults,</span>
<span class="gi">+            response_model_exclude_none=response_model_exclude_none,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            response_class=response_class,</span>
<span class="gi">+            name=name,</span>
<span class="gi">+            callbacks=callbacks,</span>
<span class="gi">+            openapi_extra=openapi_extra,</span>
<span class="gi">+            generate_unique_id_function=generate_unique_id_function,</span>
<span class="gi">+        )</span>

<span class="gd">-    def post(self, path: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def post(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The URL path to be used for this *path operation*.

<span class="w"> </span>                For example, in `http://example.com/items`, the path is `/items`.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], *, response_model: Annotated[Any, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        *,</span>
<span class="gi">+        response_model: Annotated[</span>
<span class="gi">+            Any,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The type to use for the response.

<span class="w"> </span>                It could be any valid Pydantic *field* type. So, it doesn&#39;t have to
<span class="gu">@@ -1555,8 +2253,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model](https://fastapi.tiangolo.com/tutorial/response-model/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(None), status_code: Annotated[Optional[int], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(None),</span>
<span class="gi">+        status_code: Annotated[</span>
<span class="gi">+            Optional[int],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The default status code to be used for the response.

<span class="w"> </span>                You could override the status code by returning a response directly.
<span class="gu">@@ -1564,8 +2266,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Status Code](https://fastapi.tiangolo.com/tutorial/response-status-code/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, tags: Annotated[Optional[List[Union[str, Enum]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        tags: Annotated[</span>
<span class="gi">+            Optional[List[Union[str, Enum]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of tags to be applied to the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -1573,16 +2279,24 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/#tags).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, dependencies: Annotated[Optional[Sequence[Depends]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        dependencies: Annotated[</span>
<span class="gi">+            Optional[Sequence[Depends]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of dependencies (using `Depends()`) to be applied to the
<span class="w"> </span>                *path operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Dependencies in path operation decorators](https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-in-path-operation-decorators/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, summary: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        summary: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A summary for the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -1590,8 +2304,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A description for the *path operation*.

<span class="w"> </span>                If not provided, it will be extracted automatically from the docstring
<span class="gu">@@ -1604,27 +2322,42 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_description: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_description: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The description for the default response.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;Successful Response&#39;, responses: Annotated[Optional[Dict[Union[</span>
<span class="gd">-        int, str], Dict[str, Any]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;Successful Response&quot;,</span>
<span class="gi">+        responses: Annotated[</span>
<span class="gi">+            Optional[Dict[Union[int, str], Dict[str, Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Additional responses that could be returned by this *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, deprecated: Annotated[Optional[bool], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        deprecated: Annotated[</span>
<span class="gi">+            Optional[bool],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Mark this *path operation* as deprecated.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, operation_id: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        operation_id: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Custom operation ID to be used by this *path operation*.

<span class="w"> </span>                By default, it is generated automatically.
<span class="gu">@@ -1639,32 +2372,48 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_include: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_include: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to include only certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_exclude: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_exclude: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to exclude certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_by_alias: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_by_alias: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response model
<span class="w"> </span>                should be serialized by alias when an alias is used.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_model_exclude_unset: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_model_exclude_unset: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that were not set and
<span class="w"> </span>                have their default values. This is different from
<span class="gu">@@ -1677,8 +2426,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_defaults: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_defaults: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that have the same value
<span class="w"> </span>                as the default. This is different from `response_model_exclude_unset`
<span class="gu">@@ -1690,8 +2443,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_none: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_none: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data should
<span class="w"> </span>                exclude fields set to `None`.

<span class="gu">@@ -1703,8 +2460,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_exclude_none).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, include_in_schema: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        include_in_schema: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Include this *path operation* in the generated OpenAPI schema.

<span class="w"> </span>                This affects the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -1712,8 +2473,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Query Parameters and String Validations](https://fastapi.tiangolo.com/tutorial/query-params-str-validations/#exclude-from-openapi).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_class: Annotated[Type[Response], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_class: Annotated[</span>
<span class="gi">+            Type[Response],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Response class to be used for this *path operation*.

<span class="w"> </span>                This will not be used if you return a response directly.
<span class="gu">@@ -1721,12 +2486,20 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Custom Response - HTML, Stream, File, others](https://fastapi.tiangolo.com/advanced/custom-response/#redirectresponse).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(JSONResponse), name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(JSONResponse),</span>
<span class="gi">+        name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Name for this *path operation*. Only used internally.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, callbacks: Annotated[Optional[List[BaseRoute]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        callbacks: Annotated[</span>
<span class="gi">+            Optional[List[BaseRoute]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                List of *path operations* that will be used as OpenAPI callbacks.

<span class="w"> </span>                This is only for OpenAPI documentation, the callbacks won&#39;t be used
<span class="gu">@@ -1737,17 +2510,24 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for OpenAPI Callbacks](https://fastapi.tiangolo.com/advanced/openapi-callbacks/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, openapi_extra: Annotated[Optional[Dict[str, Any]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        openapi_extra: Annotated[</span>
<span class="gi">+            Optional[Dict[str, Any]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Extra metadata to be included in the OpenAPI schema for this *path
<span class="w"> </span>                operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Advanced Configuration](https://fastapi.tiangolo.com/advanced/path-operation-advanced-configuration/#custom-openapi-path-operation-schema).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, generate_unique_id_function: Annotated[Callable[[routing.</span>
<span class="gd">-        APIRoute], str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        generate_unique_id_function: Annotated[</span>
<span class="gi">+            Callable[[routing.APIRoute], str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Customize the function used to generate unique IDs for the *path
<span class="w"> </span>                operations* shown in the generated OpenAPI.

<span class="gu">@@ -1757,8 +2537,9 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(generate_unique_id)) -&gt;Callable[[DecoratedCallable],</span>
<span class="gd">-        DecoratedCallable]:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(generate_unique_id),</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Add a *path operation* using an HTTP POST operation.

<span class="gu">@@ -1779,16 +2560,49 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>            return {&quot;message&quot;: &quot;Item created&quot;}
<span class="w"> </span>        ```
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self.router.post(</span>
<span class="gi">+            path,</span>
<span class="gi">+            response_model=response_model,</span>
<span class="gi">+            status_code=status_code,</span>
<span class="gi">+            tags=tags,</span>
<span class="gi">+            dependencies=dependencies,</span>
<span class="gi">+            summary=summary,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            response_description=response_description,</span>
<span class="gi">+            responses=responses,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            operation_id=operation_id,</span>
<span class="gi">+            response_model_include=response_model_include,</span>
<span class="gi">+            response_model_exclude=response_model_exclude,</span>
<span class="gi">+            response_model_by_alias=response_model_by_alias,</span>
<span class="gi">+            response_model_exclude_unset=response_model_exclude_unset,</span>
<span class="gi">+            response_model_exclude_defaults=response_model_exclude_defaults,</span>
<span class="gi">+            response_model_exclude_none=response_model_exclude_none,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            response_class=response_class,</span>
<span class="gi">+            name=name,</span>
<span class="gi">+            callbacks=callbacks,</span>
<span class="gi">+            openapi_extra=openapi_extra,</span>
<span class="gi">+            generate_unique_id_function=generate_unique_id_function,</span>
<span class="gi">+        )</span>

<span class="gd">-    def delete(self, path: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def delete(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The URL path to be used for this *path operation*.

<span class="w"> </span>                For example, in `http://example.com/items`, the path is `/items`.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], *, response_model: Annotated[Any, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        *,</span>
<span class="gi">+        response_model: Annotated[</span>
<span class="gi">+            Any,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The type to use for the response.

<span class="w"> </span>                It could be any valid Pydantic *field* type. So, it doesn&#39;t have to
<span class="gu">@@ -1817,8 +2631,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model](https://fastapi.tiangolo.com/tutorial/response-model/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(None), status_code: Annotated[Optional[int], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(None),</span>
<span class="gi">+        status_code: Annotated[</span>
<span class="gi">+            Optional[int],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The default status code to be used for the response.

<span class="w"> </span>                You could override the status code by returning a response directly.
<span class="gu">@@ -1826,8 +2644,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Status Code](https://fastapi.tiangolo.com/tutorial/response-status-code/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, tags: Annotated[Optional[List[Union[str, Enum]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        tags: Annotated[</span>
<span class="gi">+            Optional[List[Union[str, Enum]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of tags to be applied to the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -1835,16 +2657,24 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/#tags).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, dependencies: Annotated[Optional[Sequence[Depends]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        dependencies: Annotated[</span>
<span class="gi">+            Optional[Sequence[Depends]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of dependencies (using `Depends()`) to be applied to the
<span class="w"> </span>                *path operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Dependencies in path operation decorators](https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-in-path-operation-decorators/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, summary: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        summary: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A summary for the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -1852,8 +2682,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A description for the *path operation*.

<span class="w"> </span>                If not provided, it will be extracted automatically from the docstring
<span class="gu">@@ -1866,27 +2700,42 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_description: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_description: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The description for the default response.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;Successful Response&#39;, responses: Annotated[Optional[Dict[Union[</span>
<span class="gd">-        int, str], Dict[str, Any]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;Successful Response&quot;,</span>
<span class="gi">+        responses: Annotated[</span>
<span class="gi">+            Optional[Dict[Union[int, str], Dict[str, Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Additional responses that could be returned by this *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, deprecated: Annotated[Optional[bool], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        deprecated: Annotated[</span>
<span class="gi">+            Optional[bool],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Mark this *path operation* as deprecated.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, operation_id: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        operation_id: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Custom operation ID to be used by this *path operation*.

<span class="w"> </span>                By default, it is generated automatically.
<span class="gu">@@ -1901,32 +2750,48 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_include: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_include: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to include only certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_exclude: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_exclude: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to exclude certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_by_alias: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_by_alias: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response model
<span class="w"> </span>                should be serialized by alias when an alias is used.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_model_exclude_unset: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_model_exclude_unset: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that were not set and
<span class="w"> </span>                have their default values. This is different from
<span class="gu">@@ -1939,8 +2804,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_defaults: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_defaults: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that have the same value
<span class="w"> </span>                as the default. This is different from `response_model_exclude_unset`
<span class="gu">@@ -1952,8 +2821,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_none: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_none: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data should
<span class="w"> </span>                exclude fields set to `None`.

<span class="gu">@@ -1965,8 +2838,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_exclude_none).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, include_in_schema: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        include_in_schema: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Include this *path operation* in the generated OpenAPI schema.

<span class="w"> </span>                This affects the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -1974,8 +2851,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Query Parameters and String Validations](https://fastapi.tiangolo.com/tutorial/query-params-str-validations/#exclude-from-openapi).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_class: Annotated[Type[Response], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_class: Annotated[</span>
<span class="gi">+            Type[Response],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Response class to be used for this *path operation*.

<span class="w"> </span>                This will not be used if you return a response directly.
<span class="gu">@@ -1983,12 +2864,20 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Custom Response - HTML, Stream, File, others](https://fastapi.tiangolo.com/advanced/custom-response/#redirectresponse).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(JSONResponse), name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(JSONResponse),</span>
<span class="gi">+        name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Name for this *path operation*. Only used internally.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, callbacks: Annotated[Optional[List[BaseRoute]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        callbacks: Annotated[</span>
<span class="gi">+            Optional[List[BaseRoute]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                List of *path operations* that will be used as OpenAPI callbacks.

<span class="w"> </span>                This is only for OpenAPI documentation, the callbacks won&#39;t be used
<span class="gu">@@ -1999,17 +2888,24 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for OpenAPI Callbacks](https://fastapi.tiangolo.com/advanced/openapi-callbacks/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, openapi_extra: Annotated[Optional[Dict[str, Any]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        openapi_extra: Annotated[</span>
<span class="gi">+            Optional[Dict[str, Any]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Extra metadata to be included in the OpenAPI schema for this *path
<span class="w"> </span>                operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Advanced Configuration](https://fastapi.tiangolo.com/advanced/path-operation-advanced-configuration/#custom-openapi-path-operation-schema).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, generate_unique_id_function: Annotated[Callable[[routing.</span>
<span class="gd">-        APIRoute], str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        generate_unique_id_function: Annotated[</span>
<span class="gi">+            Callable[[routing.APIRoute], str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Customize the function used to generate unique IDs for the *path
<span class="w"> </span>                operations* shown in the generated OpenAPI.

<span class="gu">@@ -2019,8 +2915,9 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(generate_unique_id)) -&gt;Callable[[DecoratedCallable],</span>
<span class="gd">-        DecoratedCallable]:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(generate_unique_id),</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Add a *path operation* using an HTTP DELETE operation.

<span class="gu">@@ -2036,16 +2933,49 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>            return {&quot;message&quot;: &quot;Item deleted&quot;}
<span class="w"> </span>        ```
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self.router.delete(</span>
<span class="gi">+            path,</span>
<span class="gi">+            response_model=response_model,</span>
<span class="gi">+            status_code=status_code,</span>
<span class="gi">+            tags=tags,</span>
<span class="gi">+            dependencies=dependencies,</span>
<span class="gi">+            summary=summary,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            response_description=response_description,</span>
<span class="gi">+            responses=responses,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            operation_id=operation_id,</span>
<span class="gi">+            response_model_include=response_model_include,</span>
<span class="gi">+            response_model_exclude=response_model_exclude,</span>
<span class="gi">+            response_model_by_alias=response_model_by_alias,</span>
<span class="gi">+            response_model_exclude_unset=response_model_exclude_unset,</span>
<span class="gi">+            response_model_exclude_defaults=response_model_exclude_defaults,</span>
<span class="gi">+            response_model_exclude_none=response_model_exclude_none,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            response_class=response_class,</span>
<span class="gi">+            name=name,</span>
<span class="gi">+            callbacks=callbacks,</span>
<span class="gi">+            openapi_extra=openapi_extra,</span>
<span class="gi">+            generate_unique_id_function=generate_unique_id_function,</span>
<span class="gi">+        )</span>

<span class="gd">-    def options(self, path: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def options(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The URL path to be used for this *path operation*.

<span class="w"> </span>                For example, in `http://example.com/items`, the path is `/items`.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], *, response_model: Annotated[Any, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        *,</span>
<span class="gi">+        response_model: Annotated[</span>
<span class="gi">+            Any,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The type to use for the response.

<span class="w"> </span>                It could be any valid Pydantic *field* type. So, it doesn&#39;t have to
<span class="gu">@@ -2074,8 +3004,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model](https://fastapi.tiangolo.com/tutorial/response-model/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(None), status_code: Annotated[Optional[int], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(None),</span>
<span class="gi">+        status_code: Annotated[</span>
<span class="gi">+            Optional[int],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The default status code to be used for the response.

<span class="w"> </span>                You could override the status code by returning a response directly.
<span class="gu">@@ -2083,8 +3017,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Status Code](https://fastapi.tiangolo.com/tutorial/response-status-code/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, tags: Annotated[Optional[List[Union[str, Enum]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        tags: Annotated[</span>
<span class="gi">+            Optional[List[Union[str, Enum]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of tags to be applied to the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -2092,16 +3030,24 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/#tags).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, dependencies: Annotated[Optional[Sequence[Depends]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        dependencies: Annotated[</span>
<span class="gi">+            Optional[Sequence[Depends]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of dependencies (using `Depends()`) to be applied to the
<span class="w"> </span>                *path operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Dependencies in path operation decorators](https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-in-path-operation-decorators/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, summary: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        summary: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A summary for the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -2109,8 +3055,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A description for the *path operation*.

<span class="w"> </span>                If not provided, it will be extracted automatically from the docstring
<span class="gu">@@ -2123,27 +3073,42 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_description: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_description: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The description for the default response.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;Successful Response&#39;, responses: Annotated[Optional[Dict[Union[</span>
<span class="gd">-        int, str], Dict[str, Any]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;Successful Response&quot;,</span>
<span class="gi">+        responses: Annotated[</span>
<span class="gi">+            Optional[Dict[Union[int, str], Dict[str, Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Additional responses that could be returned by this *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, deprecated: Annotated[Optional[bool], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        deprecated: Annotated[</span>
<span class="gi">+            Optional[bool],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Mark this *path operation* as deprecated.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, operation_id: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        operation_id: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Custom operation ID to be used by this *path operation*.

<span class="w"> </span>                By default, it is generated automatically.
<span class="gu">@@ -2158,32 +3123,48 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_include: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_include: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to include only certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_exclude: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_exclude: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to exclude certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_by_alias: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_by_alias: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response model
<span class="w"> </span>                should be serialized by alias when an alias is used.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_model_exclude_unset: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_model_exclude_unset: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that were not set and
<span class="w"> </span>                have their default values. This is different from
<span class="gu">@@ -2196,8 +3177,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_defaults: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_defaults: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that have the same value
<span class="w"> </span>                as the default. This is different from `response_model_exclude_unset`
<span class="gu">@@ -2209,8 +3194,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_none: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_none: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data should
<span class="w"> </span>                exclude fields set to `None`.

<span class="gu">@@ -2222,8 +3211,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_exclude_none).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, include_in_schema: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        include_in_schema: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Include this *path operation* in the generated OpenAPI schema.

<span class="w"> </span>                This affects the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -2231,8 +3224,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Query Parameters and String Validations](https://fastapi.tiangolo.com/tutorial/query-params-str-validations/#exclude-from-openapi).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_class: Annotated[Type[Response], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_class: Annotated[</span>
<span class="gi">+            Type[Response],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Response class to be used for this *path operation*.

<span class="w"> </span>                This will not be used if you return a response directly.
<span class="gu">@@ -2240,12 +3237,20 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Custom Response - HTML, Stream, File, others](https://fastapi.tiangolo.com/advanced/custom-response/#redirectresponse).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(JSONResponse), name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(JSONResponse),</span>
<span class="gi">+        name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Name for this *path operation*. Only used internally.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, callbacks: Annotated[Optional[List[BaseRoute]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        callbacks: Annotated[</span>
<span class="gi">+            Optional[List[BaseRoute]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                List of *path operations* that will be used as OpenAPI callbacks.

<span class="w"> </span>                This is only for OpenAPI documentation, the callbacks won&#39;t be used
<span class="gu">@@ -2256,17 +3261,24 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for OpenAPI Callbacks](https://fastapi.tiangolo.com/advanced/openapi-callbacks/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, openapi_extra: Annotated[Optional[Dict[str, Any]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        openapi_extra: Annotated[</span>
<span class="gi">+            Optional[Dict[str, Any]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Extra metadata to be included in the OpenAPI schema for this *path
<span class="w"> </span>                operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Advanced Configuration](https://fastapi.tiangolo.com/advanced/path-operation-advanced-configuration/#custom-openapi-path-operation-schema).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, generate_unique_id_function: Annotated[Callable[[routing.</span>
<span class="gd">-        APIRoute], str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        generate_unique_id_function: Annotated[</span>
<span class="gi">+            Callable[[routing.APIRoute], str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Customize the function used to generate unique IDs for the *path
<span class="w"> </span>                operations* shown in the generated OpenAPI.

<span class="gu">@@ -2276,8 +3288,9 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(generate_unique_id)) -&gt;Callable[[DecoratedCallable],</span>
<span class="gd">-        DecoratedCallable]:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(generate_unique_id),</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Add a *path operation* using an HTTP OPTIONS operation.

<span class="gu">@@ -2293,16 +3306,49 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>            return {&quot;additions&quot;: [&quot;Aji&quot;, &quot;Guacamole&quot;]}
<span class="w"> </span>        ```
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self.router.options(</span>
<span class="gi">+            path,</span>
<span class="gi">+            response_model=response_model,</span>
<span class="gi">+            status_code=status_code,</span>
<span class="gi">+            tags=tags,</span>
<span class="gi">+            dependencies=dependencies,</span>
<span class="gi">+            summary=summary,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            response_description=response_description,</span>
<span class="gi">+            responses=responses,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            operation_id=operation_id,</span>
<span class="gi">+            response_model_include=response_model_include,</span>
<span class="gi">+            response_model_exclude=response_model_exclude,</span>
<span class="gi">+            response_model_by_alias=response_model_by_alias,</span>
<span class="gi">+            response_model_exclude_unset=response_model_exclude_unset,</span>
<span class="gi">+            response_model_exclude_defaults=response_model_exclude_defaults,</span>
<span class="gi">+            response_model_exclude_none=response_model_exclude_none,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            response_class=response_class,</span>
<span class="gi">+            name=name,</span>
<span class="gi">+            callbacks=callbacks,</span>
<span class="gi">+            openapi_extra=openapi_extra,</span>
<span class="gi">+            generate_unique_id_function=generate_unique_id_function,</span>
<span class="gi">+        )</span>

<span class="gd">-    def head(self, path: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def head(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The URL path to be used for this *path operation*.

<span class="w"> </span>                For example, in `http://example.com/items`, the path is `/items`.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], *, response_model: Annotated[Any, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        *,</span>
<span class="gi">+        response_model: Annotated[</span>
<span class="gi">+            Any,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The type to use for the response.

<span class="w"> </span>                It could be any valid Pydantic *field* type. So, it doesn&#39;t have to
<span class="gu">@@ -2331,8 +3377,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model](https://fastapi.tiangolo.com/tutorial/response-model/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(None), status_code: Annotated[Optional[int], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(None),</span>
<span class="gi">+        status_code: Annotated[</span>
<span class="gi">+            Optional[int],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The default status code to be used for the response.

<span class="w"> </span>                You could override the status code by returning a response directly.
<span class="gu">@@ -2340,8 +3390,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Status Code](https://fastapi.tiangolo.com/tutorial/response-status-code/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, tags: Annotated[Optional[List[Union[str, Enum]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        tags: Annotated[</span>
<span class="gi">+            Optional[List[Union[str, Enum]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of tags to be applied to the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -2349,16 +3403,24 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/#tags).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, dependencies: Annotated[Optional[Sequence[Depends]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        dependencies: Annotated[</span>
<span class="gi">+            Optional[Sequence[Depends]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of dependencies (using `Depends()`) to be applied to the
<span class="w"> </span>                *path operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Dependencies in path operation decorators](https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-in-path-operation-decorators/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, summary: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        summary: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A summary for the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -2366,8 +3428,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A description for the *path operation*.

<span class="w"> </span>                If not provided, it will be extracted automatically from the docstring
<span class="gu">@@ -2380,27 +3446,42 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_description: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_description: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The description for the default response.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;Successful Response&#39;, responses: Annotated[Optional[Dict[Union[</span>
<span class="gd">-        int, str], Dict[str, Any]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;Successful Response&quot;,</span>
<span class="gi">+        responses: Annotated[</span>
<span class="gi">+            Optional[Dict[Union[int, str], Dict[str, Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Additional responses that could be returned by this *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, deprecated: Annotated[Optional[bool], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        deprecated: Annotated[</span>
<span class="gi">+            Optional[bool],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Mark this *path operation* as deprecated.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, operation_id: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        operation_id: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Custom operation ID to be used by this *path operation*.

<span class="w"> </span>                By default, it is generated automatically.
<span class="gu">@@ -2415,32 +3496,48 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_include: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_include: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to include only certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_exclude: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_exclude: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to exclude certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_by_alias: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_by_alias: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response model
<span class="w"> </span>                should be serialized by alias when an alias is used.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_model_exclude_unset: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_model_exclude_unset: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that were not set and
<span class="w"> </span>                have their default values. This is different from
<span class="gu">@@ -2453,8 +3550,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_defaults: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_defaults: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that have the same value
<span class="w"> </span>                as the default. This is different from `response_model_exclude_unset`
<span class="gu">@@ -2466,8 +3567,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_none: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_none: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data should
<span class="w"> </span>                exclude fields set to `None`.

<span class="gu">@@ -2479,8 +3584,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_exclude_none).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, include_in_schema: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        include_in_schema: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Include this *path operation* in the generated OpenAPI schema.

<span class="w"> </span>                This affects the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -2488,8 +3597,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Query Parameters and String Validations](https://fastapi.tiangolo.com/tutorial/query-params-str-validations/#exclude-from-openapi).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_class: Annotated[Type[Response], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_class: Annotated[</span>
<span class="gi">+            Type[Response],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Response class to be used for this *path operation*.

<span class="w"> </span>                This will not be used if you return a response directly.
<span class="gu">@@ -2497,12 +3610,20 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Custom Response - HTML, Stream, File, others](https://fastapi.tiangolo.com/advanced/custom-response/#redirectresponse).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(JSONResponse), name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(JSONResponse),</span>
<span class="gi">+        name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Name for this *path operation*. Only used internally.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, callbacks: Annotated[Optional[List[BaseRoute]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        callbacks: Annotated[</span>
<span class="gi">+            Optional[List[BaseRoute]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                List of *path operations* that will be used as OpenAPI callbacks.

<span class="w"> </span>                This is only for OpenAPI documentation, the callbacks won&#39;t be used
<span class="gu">@@ -2513,17 +3634,24 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for OpenAPI Callbacks](https://fastapi.tiangolo.com/advanced/openapi-callbacks/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, openapi_extra: Annotated[Optional[Dict[str, Any]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        openapi_extra: Annotated[</span>
<span class="gi">+            Optional[Dict[str, Any]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Extra metadata to be included in the OpenAPI schema for this *path
<span class="w"> </span>                operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Advanced Configuration](https://fastapi.tiangolo.com/advanced/path-operation-advanced-configuration/#custom-openapi-path-operation-schema).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, generate_unique_id_function: Annotated[Callable[[routing.</span>
<span class="gd">-        APIRoute], str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        generate_unique_id_function: Annotated[</span>
<span class="gi">+            Callable[[routing.APIRoute], str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Customize the function used to generate unique IDs for the *path
<span class="w"> </span>                operations* shown in the generated OpenAPI.

<span class="gu">@@ -2533,8 +3661,9 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(generate_unique_id)) -&gt;Callable[[DecoratedCallable],</span>
<span class="gd">-        DecoratedCallable]:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(generate_unique_id),</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Add a *path operation* using an HTTP HEAD operation.

<span class="gu">@@ -2550,16 +3679,49 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>            response.headers[&quot;X-Cat-Dog&quot;] = &quot;Alone in the world&quot;
<span class="w"> </span>        ```
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self.router.head(</span>
<span class="gi">+            path,</span>
<span class="gi">+            response_model=response_model,</span>
<span class="gi">+            status_code=status_code,</span>
<span class="gi">+            tags=tags,</span>
<span class="gi">+            dependencies=dependencies,</span>
<span class="gi">+            summary=summary,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            response_description=response_description,</span>
<span class="gi">+            responses=responses,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            operation_id=operation_id,</span>
<span class="gi">+            response_model_include=response_model_include,</span>
<span class="gi">+            response_model_exclude=response_model_exclude,</span>
<span class="gi">+            response_model_by_alias=response_model_by_alias,</span>
<span class="gi">+            response_model_exclude_unset=response_model_exclude_unset,</span>
<span class="gi">+            response_model_exclude_defaults=response_model_exclude_defaults,</span>
<span class="gi">+            response_model_exclude_none=response_model_exclude_none,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            response_class=response_class,</span>
<span class="gi">+            name=name,</span>
<span class="gi">+            callbacks=callbacks,</span>
<span class="gi">+            openapi_extra=openapi_extra,</span>
<span class="gi">+            generate_unique_id_function=generate_unique_id_function,</span>
<span class="gi">+        )</span>

<span class="gd">-    def patch(self, path: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def patch(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The URL path to be used for this *path operation*.

<span class="w"> </span>                For example, in `http://example.com/items`, the path is `/items`.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], *, response_model: Annotated[Any, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        *,</span>
<span class="gi">+        response_model: Annotated[</span>
<span class="gi">+            Any,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The type to use for the response.

<span class="w"> </span>                It could be any valid Pydantic *field* type. So, it doesn&#39;t have to
<span class="gu">@@ -2588,8 +3750,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model](https://fastapi.tiangolo.com/tutorial/response-model/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(None), status_code: Annotated[Optional[int], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(None),</span>
<span class="gi">+        status_code: Annotated[</span>
<span class="gi">+            Optional[int],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The default status code to be used for the response.

<span class="w"> </span>                You could override the status code by returning a response directly.
<span class="gu">@@ -2597,8 +3763,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Status Code](https://fastapi.tiangolo.com/tutorial/response-status-code/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, tags: Annotated[Optional[List[Union[str, Enum]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        tags: Annotated[</span>
<span class="gi">+            Optional[List[Union[str, Enum]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of tags to be applied to the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -2606,16 +3776,24 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/#tags).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, dependencies: Annotated[Optional[Sequence[Depends]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        dependencies: Annotated[</span>
<span class="gi">+            Optional[Sequence[Depends]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of dependencies (using `Depends()`) to be applied to the
<span class="w"> </span>                *path operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Dependencies in path operation decorators](https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-in-path-operation-decorators/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, summary: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        summary: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A summary for the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -2623,8 +3801,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A description for the *path operation*.

<span class="w"> </span>                If not provided, it will be extracted automatically from the docstring
<span class="gu">@@ -2637,27 +3819,42 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_description: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_description: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The description for the default response.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;Successful Response&#39;, responses: Annotated[Optional[Dict[Union[</span>
<span class="gd">-        int, str], Dict[str, Any]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;Successful Response&quot;,</span>
<span class="gi">+        responses: Annotated[</span>
<span class="gi">+            Optional[Dict[Union[int, str], Dict[str, Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Additional responses that could be returned by this *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, deprecated: Annotated[Optional[bool], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        deprecated: Annotated[</span>
<span class="gi">+            Optional[bool],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Mark this *path operation* as deprecated.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, operation_id: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        operation_id: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Custom operation ID to be used by this *path operation*.

<span class="w"> </span>                By default, it is generated automatically.
<span class="gu">@@ -2672,32 +3869,48 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_include: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_include: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to include only certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_exclude: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_exclude: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to exclude certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_by_alias: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_by_alias: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response model
<span class="w"> </span>                should be serialized by alias when an alias is used.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_model_exclude_unset: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_model_exclude_unset: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that were not set and
<span class="w"> </span>                have their default values. This is different from
<span class="gu">@@ -2710,8 +3923,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_defaults: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_defaults: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that have the same value
<span class="w"> </span>                as the default. This is different from `response_model_exclude_unset`
<span class="gu">@@ -2723,8 +3940,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_none: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_none: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data should
<span class="w"> </span>                exclude fields set to `None`.

<span class="gu">@@ -2736,8 +3957,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_exclude_none).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, include_in_schema: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        include_in_schema: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Include this *path operation* in the generated OpenAPI schema.

<span class="w"> </span>                This affects the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -2745,8 +3970,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Query Parameters and String Validations](https://fastapi.tiangolo.com/tutorial/query-params-str-validations/#exclude-from-openapi).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_class: Annotated[Type[Response], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_class: Annotated[</span>
<span class="gi">+            Type[Response],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Response class to be used for this *path operation*.

<span class="w"> </span>                This will not be used if you return a response directly.
<span class="gu">@@ -2754,12 +3983,20 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Custom Response - HTML, Stream, File, others](https://fastapi.tiangolo.com/advanced/custom-response/#redirectresponse).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(JSONResponse), name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(JSONResponse),</span>
<span class="gi">+        name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Name for this *path operation*. Only used internally.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, callbacks: Annotated[Optional[List[BaseRoute]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        callbacks: Annotated[</span>
<span class="gi">+            Optional[List[BaseRoute]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                List of *path operations* that will be used as OpenAPI callbacks.

<span class="w"> </span>                This is only for OpenAPI documentation, the callbacks won&#39;t be used
<span class="gu">@@ -2770,17 +4007,24 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for OpenAPI Callbacks](https://fastapi.tiangolo.com/advanced/openapi-callbacks/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, openapi_extra: Annotated[Optional[Dict[str, Any]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        openapi_extra: Annotated[</span>
<span class="gi">+            Optional[Dict[str, Any]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Extra metadata to be included in the OpenAPI schema for this *path
<span class="w"> </span>                operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Advanced Configuration](https://fastapi.tiangolo.com/advanced/path-operation-advanced-configuration/#custom-openapi-path-operation-schema).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, generate_unique_id_function: Annotated[Callable[[routing.</span>
<span class="gd">-        APIRoute], str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        generate_unique_id_function: Annotated[</span>
<span class="gi">+            Callable[[routing.APIRoute], str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Customize the function used to generate unique IDs for the *path
<span class="w"> </span>                operations* shown in the generated OpenAPI.

<span class="gu">@@ -2790,8 +4034,9 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(generate_unique_id)) -&gt;Callable[[DecoratedCallable],</span>
<span class="gd">-        DecoratedCallable]:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(generate_unique_id),</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Add a *path operation* using an HTTP PATCH operation.

<span class="gu">@@ -2812,16 +4057,49 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>            return {&quot;message&quot;: &quot;Item updated in place&quot;}
<span class="w"> </span>        ```
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self.router.patch(</span>
<span class="gi">+            path,</span>
<span class="gi">+            response_model=response_model,</span>
<span class="gi">+            status_code=status_code,</span>
<span class="gi">+            tags=tags,</span>
<span class="gi">+            dependencies=dependencies,</span>
<span class="gi">+            summary=summary,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            response_description=response_description,</span>
<span class="gi">+            responses=responses,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            operation_id=operation_id,</span>
<span class="gi">+            response_model_include=response_model_include,</span>
<span class="gi">+            response_model_exclude=response_model_exclude,</span>
<span class="gi">+            response_model_by_alias=response_model_by_alias,</span>
<span class="gi">+            response_model_exclude_unset=response_model_exclude_unset,</span>
<span class="gi">+            response_model_exclude_defaults=response_model_exclude_defaults,</span>
<span class="gi">+            response_model_exclude_none=response_model_exclude_none,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            response_class=response_class,</span>
<span class="gi">+            name=name,</span>
<span class="gi">+            callbacks=callbacks,</span>
<span class="gi">+            openapi_extra=openapi_extra,</span>
<span class="gi">+            generate_unique_id_function=generate_unique_id_function,</span>
<span class="gi">+        )</span>

<span class="gd">-    def trace(self, path: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def trace(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The URL path to be used for this *path operation*.

<span class="w"> </span>                For example, in `http://example.com/items`, the path is `/items`.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], *, response_model: Annotated[Any, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        *,</span>
<span class="gi">+        response_model: Annotated[</span>
<span class="gi">+            Any,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The type to use for the response.

<span class="w"> </span>                It could be any valid Pydantic *field* type. So, it doesn&#39;t have to
<span class="gu">@@ -2850,8 +4128,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model](https://fastapi.tiangolo.com/tutorial/response-model/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(None), status_code: Annotated[Optional[int], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(None),</span>
<span class="gi">+        status_code: Annotated[</span>
<span class="gi">+            Optional[int],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The default status code to be used for the response.

<span class="w"> </span>                You could override the status code by returning a response directly.
<span class="gu">@@ -2859,8 +4141,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Status Code](https://fastapi.tiangolo.com/tutorial/response-status-code/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, tags: Annotated[Optional[List[Union[str, Enum]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        tags: Annotated[</span>
<span class="gi">+            Optional[List[Union[str, Enum]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of tags to be applied to the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -2868,16 +4154,24 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/#tags).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, dependencies: Annotated[Optional[Sequence[Depends]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        dependencies: Annotated[</span>
<span class="gi">+            Optional[Sequence[Depends]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of dependencies (using `Depends()`) to be applied to the
<span class="w"> </span>                *path operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Dependencies in path operation decorators](https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-in-path-operation-decorators/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, summary: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        summary: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A summary for the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -2885,8 +4179,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A description for the *path operation*.

<span class="w"> </span>                If not provided, it will be extracted automatically from the docstring
<span class="gu">@@ -2899,27 +4197,42 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_description: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_description: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The description for the default response.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;Successful Response&#39;, responses: Annotated[Optional[Dict[Union[</span>
<span class="gd">-        int, str], Dict[str, Any]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;Successful Response&quot;,</span>
<span class="gi">+        responses: Annotated[</span>
<span class="gi">+            Optional[Dict[Union[int, str], Dict[str, Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Additional responses that could be returned by this *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, deprecated: Annotated[Optional[bool], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        deprecated: Annotated[</span>
<span class="gi">+            Optional[bool],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Mark this *path operation* as deprecated.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, operation_id: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        operation_id: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Custom operation ID to be used by this *path operation*.

<span class="w"> </span>                By default, it is generated automatically.
<span class="gu">@@ -2934,32 +4247,48 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_include: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_include: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to include only certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_exclude: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_exclude: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to exclude certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_by_alias: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_by_alias: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response model
<span class="w"> </span>                should be serialized by alias when an alias is used.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_model_exclude_unset: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_model_exclude_unset: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that were not set and
<span class="w"> </span>                have their default values. This is different from
<span class="gu">@@ -2972,8 +4301,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_defaults: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_defaults: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that have the same value
<span class="w"> </span>                as the default. This is different from `response_model_exclude_unset`
<span class="gu">@@ -2985,8 +4318,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_none: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_none: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data should
<span class="w"> </span>                exclude fields set to `None`.

<span class="gu">@@ -2998,8 +4335,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_exclude_none).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, include_in_schema: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        include_in_schema: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Include this *path operation* in the generated OpenAPI schema.

<span class="w"> </span>                This affects the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -3007,8 +4348,12 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Query Parameters and String Validations](https://fastapi.tiangolo.com/tutorial/query-params-str-validations/#exclude-from-openapi).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_class: Annotated[Type[Response], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_class: Annotated[</span>
<span class="gi">+            Type[Response],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Response class to be used for this *path operation*.

<span class="w"> </span>                This will not be used if you return a response directly.
<span class="gu">@@ -3016,12 +4361,20 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Custom Response - HTML, Stream, File, others](https://fastapi.tiangolo.com/advanced/custom-response/#redirectresponse).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(JSONResponse), name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(JSONResponse),</span>
<span class="gi">+        name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Name for this *path operation*. Only used internally.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, callbacks: Annotated[Optional[List[BaseRoute]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        callbacks: Annotated[</span>
<span class="gi">+            Optional[List[BaseRoute]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                List of *path operations* that will be used as OpenAPI callbacks.

<span class="w"> </span>                This is only for OpenAPI documentation, the callbacks won&#39;t be used
<span class="gu">@@ -3032,17 +4385,24 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for OpenAPI Callbacks](https://fastapi.tiangolo.com/advanced/openapi-callbacks/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, openapi_extra: Annotated[Optional[Dict[str, Any]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        openapi_extra: Annotated[</span>
<span class="gi">+            Optional[Dict[str, Any]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Extra metadata to be included in the OpenAPI schema for this *path
<span class="w"> </span>                operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Advanced Configuration](https://fastapi.tiangolo.com/advanced/path-operation-advanced-configuration/#custom-openapi-path-operation-schema).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, generate_unique_id_function: Annotated[Callable[[routing.</span>
<span class="gd">-        APIRoute], str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        generate_unique_id_function: Annotated[</span>
<span class="gi">+            Callable[[routing.APIRoute], str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Customize the function used to generate unique IDs for the *path
<span class="w"> </span>                operations* shown in the generated OpenAPI.

<span class="gu">@@ -3052,8 +4412,9 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(generate_unique_id)) -&gt;Callable[[DecoratedCallable],</span>
<span class="gd">-        DecoratedCallable]:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(generate_unique_id),</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Add a *path operation* using an HTTP TRACE operation.

<span class="gu">@@ -3069,7 +4430,40 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>            return None
<span class="w"> </span>        ```
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self.router.trace(</span>
<span class="gi">+            path,</span>
<span class="gi">+            response_model=response_model,</span>
<span class="gi">+            status_code=status_code,</span>
<span class="gi">+            tags=tags,</span>
<span class="gi">+            dependencies=dependencies,</span>
<span class="gi">+            summary=summary,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            response_description=response_description,</span>
<span class="gi">+            responses=responses,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            operation_id=operation_id,</span>
<span class="gi">+            response_model_include=response_model_include,</span>
<span class="gi">+            response_model_exclude=response_model_exclude,</span>
<span class="gi">+            response_model_by_alias=response_model_by_alias,</span>
<span class="gi">+            response_model_exclude_unset=response_model_exclude_unset,</span>
<span class="gi">+            response_model_exclude_defaults=response_model_exclude_defaults,</span>
<span class="gi">+            response_model_exclude_none=response_model_exclude_none,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            response_class=response_class,</span>
<span class="gi">+            name=name,</span>
<span class="gi">+            callbacks=callbacks,</span>
<span class="gi">+            openapi_extra=openapi_extra,</span>
<span class="gi">+            generate_unique_id_function=generate_unique_id_function,</span>
<span class="gi">+        )</span>
<span class="gi">+</span>
<span class="gi">+    def websocket_route(</span>
<span class="gi">+        self, path: str, name: Union[str, None] = None</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="gi">+        def decorator(func: DecoratedCallable) -&gt; DecoratedCallable:</span>
<span class="gi">+            self.router.add_websocket_route(path, func, name=name)</span>
<span class="gi">+            return func</span>
<span class="gi">+</span>
<span class="gi">+        return decorator</span>

<span class="w"> </span>    @deprecated(
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -3078,12 +4472,18 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>        Read more about it in the
<span class="w"> </span>        [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        )</span>
<span class="gd">-    def on_event(self, event_type: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    )</span>
<span class="gi">+    def on_event(</span>
<span class="gi">+        self,</span>
<span class="gi">+        event_type: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The type of event. `startup` or `shutdown`.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]) -&gt;Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Add an event handler for the application.

<span class="gu">@@ -3092,13 +4492,19 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>        Read more about it in the
<span class="w"> </span>        [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/#alternative-events-deprecated).
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self.router.on_event(event_type)</span>

<span class="gd">-    def middleware(self, middleware_type: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def middleware(</span>
<span class="gi">+        self,</span>
<span class="gi">+        middleware_type: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The type of middleware. Currently only supports `http`.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]) -&gt;Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Add a middleware to the application.

<span class="gu">@@ -3124,14 +4530,24 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>            return response
<span class="w"> </span>        ```
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>

<span class="gd">-    def exception_handler(self, exc_class_or_status_code: Annotated[Union[</span>
<span class="gd">-        int, Type[Exception]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+        def decorator(func: DecoratedCallable) -&gt; DecoratedCallable:</span>
<span class="gi">+            self.add_middleware(BaseHTTPMiddleware, dispatch=func)</span>
<span class="gi">+            return func</span>
<span class="gi">+</span>
<span class="gi">+        return decorator</span>
<span class="gi">+</span>
<span class="gi">+    def exception_handler(</span>
<span class="gi">+        self,</span>
<span class="gi">+        exc_class_or_status_code: Annotated[</span>
<span class="gi">+            Union[int, Type[Exception]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The Exception class this would handle, or a status code.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]) -&gt;Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Add an exception handler to the app.

<span class="gu">@@ -3161,4 +4577,9 @@ class FastAPI(Starlette):</span>
<span class="w"> </span>            )
<span class="w"> </span>        ```
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+</span>
<span class="gi">+        def decorator(func: DecoratedCallable) -&gt; DecoratedCallable:</span>
<span class="gi">+            self.add_exception_handler(exc_class_or_status_code, func)</span>
<span class="gi">+            return func</span>
<span class="gi">+</span>
<span class="gi">+        return decorator</span>
<span class="gh">diff --git a/fastapi/background.py b/fastapi/background.py</span>
<span class="gh">index 368be9bc..203578a4 100644</span>
<span class="gd">--- a/fastapi/background.py</span>
<span class="gi">+++ b/fastapi/background.py</span>
<span class="gu">@@ -1,7 +1,9 @@</span>
<span class="w"> </span>from typing import Any, Callable
<span class="gi">+</span>
<span class="w"> </span>from starlette.background import BackgroundTasks as StarletteBackgroundTasks
<span class="w"> </span>from typing_extensions import Annotated, Doc, ParamSpec
<span class="gd">-P = ParamSpec(&#39;P&#39;)</span>
<span class="gi">+</span>
<span class="gi">+P = ParamSpec(&quot;P&quot;)</span>


<span class="w"> </span>class BackgroundTasks(StarletteBackgroundTasks):
<span class="gu">@@ -33,17 +35,25 @@ class BackgroundTasks(StarletteBackgroundTasks):</span>
<span class="w"> </span>    ```
<span class="w"> </span>    &quot;&quot;&quot;

<span class="gd">-    def add_task(self, func: Annotated[Callable[P, Any], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def add_task(</span>
<span class="gi">+        self,</span>
<span class="gi">+        func: Annotated[</span>
<span class="gi">+            Callable[P, Any],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The function to call after the response is sent.

<span class="w"> </span>                It can be a regular `def` function or an `async def` function.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], *args: P.args, **kwargs: P.kwargs) -&gt;None:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        *args: P.args,</span>
<span class="gi">+        **kwargs: P.kwargs,</span>
<span class="gi">+    ) -&gt; None:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Add a function to be called in the background after the response is sent.

<span class="w"> </span>        Read more about it in the
<span class="w"> </span>        [FastAPI docs for Background Tasks](https://fastapi.tiangolo.com/tutorial/background-tasks/).
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return super().add_task(func, *args, **kwargs)</span>
<span class="gh">diff --git a/fastapi/cli.py b/fastapi/cli.py</span>
<span class="gh">index 1bd91d5d..8d3301e9 100644</span>
<span class="gd">--- a/fastapi/cli.py</span>
<span class="gi">+++ b/fastapi/cli.py</span>
<span class="gu">@@ -1,4 +1,13 @@</span>
<span class="w"> </span>try:
<span class="w"> </span>    from fastapi_cli.cli import main as cli_main
<span class="gd">-except ImportError:</span>
<span class="gd">-    cli_main = None</span>
<span class="gi">+</span>
<span class="gi">+except ImportError:  # pragma: no cover</span>
<span class="gi">+    cli_main = None  # type: ignore</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def main() -&gt; None:</span>
<span class="gi">+    if not cli_main:  # type: ignore[truthy-function]</span>
<span class="gi">+        message = &#39;To use the fastapi command, please install &quot;fastapi[standard]&quot;:\n\n\tpip install &quot;fastapi[standard]&quot;\n&#39;</span>
<span class="gi">+        print(message)</span>
<span class="gi">+        raise RuntimeError(message)  # noqa: B904</span>
<span class="gi">+    cli_main()</span>
<span class="gh">diff --git a/fastapi/concurrency.py b/fastapi/concurrency.py</span>
<span class="gh">index 0fabc8f3..894bd3ed 100644</span>
<span class="gd">--- a/fastapi/concurrency.py</span>
<span class="gi">+++ b/fastapi/concurrency.py</span>
<span class="gu">@@ -1,8 +1,39 @@</span>
<span class="w"> </span>from contextlib import asynccontextmanager as asynccontextmanager
<span class="w"> </span>from typing import AsyncGenerator, ContextManager, TypeVar
<span class="gi">+</span>
<span class="w"> </span>import anyio
<span class="w"> </span>from anyio import CapacityLimiter
<span class="gd">-from starlette.concurrency import iterate_in_threadpool as iterate_in_threadpool</span>
<span class="gd">-from starlette.concurrency import run_in_threadpool as run_in_threadpool</span>
<span class="gd">-from starlette.concurrency import run_until_first_complete as run_until_first_complete</span>
<span class="gd">-_T = TypeVar(&#39;_T&#39;)</span>
<span class="gi">+from starlette.concurrency import iterate_in_threadpool as iterate_in_threadpool  # noqa</span>
<span class="gi">+from starlette.concurrency import run_in_threadpool as run_in_threadpool  # noqa</span>
<span class="gi">+from starlette.concurrency import (  # noqa</span>
<span class="gi">+    run_until_first_complete as run_until_first_complete,</span>
<span class="gi">+)</span>
<span class="gi">+</span>
<span class="gi">+_T = TypeVar(&quot;_T&quot;)</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+@asynccontextmanager</span>
<span class="gi">+async def contextmanager_in_threadpool(</span>
<span class="gi">+    cm: ContextManager[_T],</span>
<span class="gi">+) -&gt; AsyncGenerator[_T, None]:</span>
<span class="gi">+    # blocking __exit__ from running waiting on a free thread</span>
<span class="gi">+    # can create race conditions/deadlocks if the context manager itself</span>
<span class="gi">+    # has its own internal pool (e.g. a database connection pool)</span>
<span class="gi">+    # to avoid this we let __exit__ run without a capacity limit</span>
<span class="gi">+    # since we&#39;re creating a new limiter for each call, any non-zero limit</span>
<span class="gi">+    # works (1 is arbitrary)</span>
<span class="gi">+    exit_limiter = CapacityLimiter(1)</span>
<span class="gi">+    try:</span>
<span class="gi">+        yield await run_in_threadpool(cm.__enter__)</span>
<span class="gi">+    except Exception as e:</span>
<span class="gi">+        ok = bool(</span>
<span class="gi">+            await anyio.to_thread.run_sync(</span>
<span class="gi">+                cm.__exit__, type(e), e, None, limiter=exit_limiter</span>
<span class="gi">+            )</span>
<span class="gi">+        )</span>
<span class="gi">+        if not ok:</span>
<span class="gi">+            raise e</span>
<span class="gi">+    else:</span>
<span class="gi">+        await anyio.to_thread.run_sync(</span>
<span class="gi">+            cm.__exit__, None, None, None, limiter=exit_limiter</span>
<span class="gi">+        )</span>
<span class="gh">diff --git a/fastapi/datastructures.py b/fastapi/datastructures.py</span>
<span class="gh">index e6043019..cf8406b0 100644</span>
<span class="gd">--- a/fastapi/datastructures.py</span>
<span class="gi">+++ b/fastapi/datastructures.py</span>
<span class="gu">@@ -1,11 +1,28 @@</span>
<span class="gd">-from typing import Any, BinaryIO, Callable, Dict, Iterable, Optional, Type, TypeVar, cast</span>
<span class="gd">-from fastapi._compat import PYDANTIC_V2, CoreSchema, GetJsonSchemaHandler, JsonSchemaValue, with_info_plain_validator_function</span>
<span class="gd">-from starlette.datastructures import URL as URL</span>
<span class="gd">-from starlette.datastructures import Address as Address</span>
<span class="gd">-from starlette.datastructures import FormData as FormData</span>
<span class="gd">-from starlette.datastructures import Headers as Headers</span>
<span class="gd">-from starlette.datastructures import QueryParams as QueryParams</span>
<span class="gd">-from starlette.datastructures import State as State</span>
<span class="gi">+from typing import (</span>
<span class="gi">+    Any,</span>
<span class="gi">+    BinaryIO,</span>
<span class="gi">+    Callable,</span>
<span class="gi">+    Dict,</span>
<span class="gi">+    Iterable,</span>
<span class="gi">+    Optional,</span>
<span class="gi">+    Type,</span>
<span class="gi">+    TypeVar,</span>
<span class="gi">+    cast,</span>
<span class="gi">+)</span>
<span class="gi">+</span>
<span class="gi">+from fastapi._compat import (</span>
<span class="gi">+    PYDANTIC_V2,</span>
<span class="gi">+    CoreSchema,</span>
<span class="gi">+    GetJsonSchemaHandler,</span>
<span class="gi">+    JsonSchemaValue,</span>
<span class="gi">+    with_info_plain_validator_function,</span>
<span class="gi">+)</span>
<span class="gi">+from starlette.datastructures import URL as URL  # noqa: F401</span>
<span class="gi">+from starlette.datastructures import Address as Address  # noqa: F401</span>
<span class="gi">+from starlette.datastructures import FormData as FormData  # noqa: F401</span>
<span class="gi">+from starlette.datastructures import Headers as Headers  # noqa: F401</span>
<span class="gi">+from starlette.datastructures import QueryParams as QueryParams  # noqa: F401</span>
<span class="gi">+from starlette.datastructures import State as State  # noqa: F401</span>
<span class="w"> </span>from starlette.datastructures import UploadFile as StarletteUploadFile
<span class="w"> </span>from typing_extensions import Annotated, Doc

<span class="gu">@@ -43,19 +60,29 @@ class UploadFile(StarletteUploadFile):</span>
<span class="w"> </span>        return {&quot;filename&quot;: file.filename}
<span class="w"> </span>    ```
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    file: Annotated[BinaryIO, Doc(</span>
<span class="gd">-        &#39;The standard Python file object (non-async).&#39;)]</span>
<span class="gd">-    filename: Annotated[Optional[str], Doc(&#39;The original file name.&#39;)]</span>
<span class="gd">-    size: Annotated[Optional[int], Doc(&#39;The size of the file in bytes.&#39;)]</span>
<span class="gd">-    headers: Annotated[Headers, Doc(&#39;The headers of the request.&#39;)]</span>
<span class="gd">-    content_type: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &#39;The content type of the request, from the headers.&#39;)]</span>
<span class="gd">-</span>
<span class="gd">-    async def write(self, data: Annotated[bytes, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+</span>
<span class="gi">+    file: Annotated[</span>
<span class="gi">+        BinaryIO,</span>
<span class="gi">+        Doc(&quot;The standard Python file object (non-async).&quot;),</span>
<span class="gi">+    ]</span>
<span class="gi">+    filename: Annotated[Optional[str], Doc(&quot;The original file name.&quot;)]</span>
<span class="gi">+    size: Annotated[Optional[int], Doc(&quot;The size of the file in bytes.&quot;)]</span>
<span class="gi">+    headers: Annotated[Headers, Doc(&quot;The headers of the request.&quot;)]</span>
<span class="gi">+    content_type: Annotated[</span>
<span class="gi">+        Optional[str], Doc(&quot;The content type of the request, from the headers.&quot;)</span>
<span class="gi">+    ]</span>
<span class="gi">+</span>
<span class="gi">+    async def write(</span>
<span class="gi">+        self,</span>
<span class="gi">+        data: Annotated[</span>
<span class="gi">+            bytes,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The bytes to write to the file.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]) -&gt;None:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+    ) -&gt; None:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Write some bytes to the file.

<span class="gu">@@ -63,25 +90,37 @@ class UploadFile(StarletteUploadFile):</span>

<span class="w"> </span>        To be awaitable, compatible with async, this is run in threadpool.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return await super().write(data)</span>

<span class="gd">-    async def read(self, size: Annotated[int, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    async def read(</span>
<span class="gi">+        self,</span>
<span class="gi">+        size: Annotated[</span>
<span class="gi">+            int,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The number of bytes to read from the file.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=-1) -&gt;bytes:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = -1,</span>
<span class="gi">+    ) -&gt; bytes:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Read some bytes from the file.

<span class="w"> </span>        To be awaitable, compatible with async, this is run in threadpool.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return await super().read(size)</span>

<span class="gd">-    async def seek(self, offset: Annotated[int, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    async def seek(</span>
<span class="gi">+        self,</span>
<span class="gi">+        offset: Annotated[</span>
<span class="gi">+            int,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The position in bytes to seek to in the file.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]) -&gt;None:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+    ) -&gt; None:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Move to a position in the file.

<span class="gu">@@ -89,34 +128,48 @@ class UploadFile(StarletteUploadFile):</span>

<span class="w"> </span>        To be awaitable, compatible with async, this is run in threadpool.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return await super().seek(offset)</span>

<span class="gd">-    async def close(self) -&gt;None:</span>
<span class="gi">+    async def close(self) -&gt; None:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Close the file.

<span class="w"> </span>        To be awaitable, compatible with async, this is run in threadpool.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return await super().close()</span>

<span class="w"> </span>    @classmethod
<span class="gd">-    def __get_validators__(cls: Type[&#39;UploadFile&#39;]) -&gt;Iterable[Callable[...,</span>
<span class="gd">-        Any]]:</span>
<span class="gi">+    def __get_validators__(cls: Type[&quot;UploadFile&quot;]) -&gt; Iterable[Callable[..., Any]]:</span>
<span class="w"> </span>        yield cls.validate
<span class="gi">+</span>
<span class="gi">+    @classmethod</span>
<span class="gi">+    def validate(cls: Type[&quot;UploadFile&quot;], v: Any) -&gt; Any:</span>
<span class="gi">+        if not isinstance(v, StarletteUploadFile):</span>
<span class="gi">+            raise ValueError(f&quot;Expected UploadFile, received: {type(v)}&quot;)</span>
<span class="gi">+        return v</span>
<span class="gi">+</span>
<span class="gi">+    @classmethod</span>
<span class="gi">+    def _validate(cls, __input_value: Any, _: Any) -&gt; &quot;UploadFile&quot;:</span>
<span class="gi">+        if not isinstance(__input_value, StarletteUploadFile):</span>
<span class="gi">+            raise ValueError(f&quot;Expected UploadFile, received: {type(__input_value)}&quot;)</span>
<span class="gi">+        return cast(UploadFile, __input_value)</span>
<span class="gi">+</span>
<span class="w"> </span>    if not PYDANTIC_V2:

<span class="w"> </span>        @classmethod
<span class="gd">-        def __modify_schema__(cls, field_schema: Dict[str, Any]) -&gt;None:</span>
<span class="gd">-            field_schema.update({&#39;type&#39;: &#39;string&#39;, &#39;format&#39;: &#39;binary&#39;})</span>
<span class="gi">+        def __modify_schema__(cls, field_schema: Dict[str, Any]) -&gt; None:</span>
<span class="gi">+            field_schema.update({&quot;type&quot;: &quot;string&quot;, &quot;format&quot;: &quot;binary&quot;})</span>

<span class="w"> </span>    @classmethod
<span class="gd">-    def __get_pydantic_json_schema__(cls, core_schema: CoreSchema, handler:</span>
<span class="gd">-        GetJsonSchemaHandler) -&gt;JsonSchemaValue:</span>
<span class="gd">-        return {&#39;type&#39;: &#39;string&#39;, &#39;format&#39;: &#39;binary&#39;}</span>
<span class="gi">+    def __get_pydantic_json_schema__(</span>
<span class="gi">+        cls, core_schema: CoreSchema, handler: GetJsonSchemaHandler</span>
<span class="gi">+    ) -&gt; JsonSchemaValue:</span>
<span class="gi">+        return {&quot;type&quot;: &quot;string&quot;, &quot;format&quot;: &quot;binary&quot;}</span>

<span class="w"> </span>    @classmethod
<span class="gd">-    def __get_pydantic_core_schema__(cls, source: Type[Any], handler:</span>
<span class="gd">-        Callable[[Any], CoreSchema]) -&gt;CoreSchema:</span>
<span class="gi">+    def __get_pydantic_core_schema__(</span>
<span class="gi">+        cls, source: Type[Any], handler: Callable[[Any], CoreSchema]</span>
<span class="gi">+    ) -&gt; CoreSchema:</span>
<span class="w"> </span>        return with_info_plain_validator_function(cls._validate)


<span class="gu">@@ -131,21 +184,21 @@ class DefaultPlaceholder:</span>
<span class="w"> </span>    def __init__(self, value: Any):
<span class="w"> </span>        self.value = value

<span class="gd">-    def __bool__(self) -&gt;bool:</span>
<span class="gi">+    def __bool__(self) -&gt; bool:</span>
<span class="w"> </span>        return bool(self.value)

<span class="gd">-    def __eq__(self, o: object) -&gt;bool:</span>
<span class="gi">+    def __eq__(self, o: object) -&gt; bool:</span>
<span class="w"> </span>        return isinstance(o, DefaultPlaceholder) and o.value == self.value


<span class="gd">-DefaultType = TypeVar(&#39;DefaultType&#39;)</span>
<span class="gi">+DefaultType = TypeVar(&quot;DefaultType&quot;)</span>


<span class="gd">-def Default(value: DefaultType) -&gt;DefaultType:</span>
<span class="gi">+def Default(value: DefaultType) -&gt; DefaultType:</span>
<span class="w"> </span>    &quot;&quot;&quot;
<span class="w"> </span>    You shouldn&#39;t use this function directly.

<span class="w"> </span>    It&#39;s used internally to recognize when a default value has been overwritten, even
<span class="w"> </span>    if the overridden default value was truthy.
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    return DefaultPlaceholder(value)  # type: ignore</span>
<span class="gh">diff --git a/fastapi/dependencies/models.py b/fastapi/dependencies/models.py</span>
<span class="gh">index 4e5ecdae..61ef0063 100644</span>
<span class="gd">--- a/fastapi/dependencies/models.py</span>
<span class="gi">+++ b/fastapi/dependencies/models.py</span>
<span class="gu">@@ -1,31 +1,40 @@</span>
<span class="w"> </span>from typing import Any, Callable, List, Optional, Sequence
<span class="gi">+</span>
<span class="w"> </span>from fastapi._compat import ModelField
<span class="w"> </span>from fastapi.security.base import SecurityBase


<span class="w"> </span>class SecurityRequirement:
<span class="gd">-</span>
<span class="gd">-    def __init__(self, security_scheme: SecurityBase, scopes: Optional[</span>
<span class="gd">-        Sequence[str]]=None):</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self, security_scheme: SecurityBase, scopes: Optional[Sequence[str]] = None</span>
<span class="gi">+    ):</span>
<span class="w"> </span>        self.security_scheme = security_scheme
<span class="w"> </span>        self.scopes = scopes


<span class="w"> </span>class Dependant:
<span class="gd">-</span>
<span class="gd">-    def __init__(self, *, path_params: Optional[List[ModelField]]=None,</span>
<span class="gd">-        query_params: Optional[List[ModelField]]=None, header_params:</span>
<span class="gd">-        Optional[List[ModelField]]=None, cookie_params: Optional[List[</span>
<span class="gd">-        ModelField]]=None, body_params: Optional[List[ModelField]]=None,</span>
<span class="gd">-        dependencies: Optional[List[&#39;Dependant&#39;]]=None, security_schemes:</span>
<span class="gd">-        Optional[List[SecurityRequirement]]=None, name: Optional[str]=None,</span>
<span class="gd">-        call: Optional[Callable[..., Any]]=None, request_param_name:</span>
<span class="gd">-        Optional[str]=None, websocket_param_name: Optional[str]=None,</span>
<span class="gd">-        http_connection_param_name: Optional[str]=None, response_param_name:</span>
<span class="gd">-        Optional[str]=None, background_tasks_param_name: Optional[str]=None,</span>
<span class="gd">-        security_scopes_param_name: Optional[str]=None, security_scopes:</span>
<span class="gd">-        Optional[List[str]]=None, use_cache: bool=True, path: Optional[str]</span>
<span class="gd">-        =None) -&gt;None:</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        *,</span>
<span class="gi">+        path_params: Optional[List[ModelField]] = None,</span>
<span class="gi">+        query_params: Optional[List[ModelField]] = None,</span>
<span class="gi">+        header_params: Optional[List[ModelField]] = None,</span>
<span class="gi">+        cookie_params: Optional[List[ModelField]] = None,</span>
<span class="gi">+        body_params: Optional[List[ModelField]] = None,</span>
<span class="gi">+        dependencies: Optional[List[&quot;Dependant&quot;]] = None,</span>
<span class="gi">+        security_schemes: Optional[List[SecurityRequirement]] = None,</span>
<span class="gi">+        name: Optional[str] = None,</span>
<span class="gi">+        call: Optional[Callable[..., Any]] = None,</span>
<span class="gi">+        request_param_name: Optional[str] = None,</span>
<span class="gi">+        websocket_param_name: Optional[str] = None,</span>
<span class="gi">+        http_connection_param_name: Optional[str] = None,</span>
<span class="gi">+        response_param_name: Optional[str] = None,</span>
<span class="gi">+        background_tasks_param_name: Optional[str] = None,</span>
<span class="gi">+        security_scopes_param_name: Optional[str] = None,</span>
<span class="gi">+        security_scopes: Optional[List[str]] = None,</span>
<span class="gi">+        use_cache: bool = True,</span>
<span class="gi">+        path: Optional[str] = None,</span>
<span class="gi">+    ) -&gt; None:</span>
<span class="w"> </span>        self.path_params = path_params or []
<span class="w"> </span>        self.query_params = query_params or []
<span class="w"> </span>        self.header_params = header_params or []
<span class="gu">@@ -43,6 +52,7 @@ class Dependant:</span>
<span class="w"> </span>        self.name = name
<span class="w"> </span>        self.call = call
<span class="w"> </span>        self.use_cache = use_cache
<span class="gi">+        # Store the path to be able to re-generate a dependable from it in overrides</span>
<span class="w"> </span>        self.path = path
<span class="gd">-        self.cache_key = self.call, tuple(sorted(set(self.security_scopes or</span>
<span class="gd">-            [])))</span>
<span class="gi">+        # Save the cache key at creation to optimize performance</span>
<span class="gi">+        self.cache_key = (self.call, tuple(sorted(set(self.security_scopes or []))))</span>
<span class="gh">diff --git a/fastapi/dependencies/utils.py b/fastapi/dependencies/utils.py</span>
<span class="gh">index 3c6ab88a..4f984177 100644</span>
<span class="gd">--- a/fastapi/dependencies/utils.py</span>
<span class="gi">+++ b/fastapi/dependencies/utils.py</span>
<span class="gu">@@ -1,12 +1,54 @@</span>
<span class="w"> </span>import inspect
<span class="w"> </span>from contextlib import AsyncExitStack, contextmanager
<span class="w"> </span>from copy import copy, deepcopy
<span class="gd">-from typing import Any, Callable, Coroutine, Dict, ForwardRef, List, Mapping, Optional, Sequence, Tuple, Type, Union, cast</span>
<span class="gi">+from typing import (</span>
<span class="gi">+    Any,</span>
<span class="gi">+    Callable,</span>
<span class="gi">+    Coroutine,</span>
<span class="gi">+    Dict,</span>
<span class="gi">+    ForwardRef,</span>
<span class="gi">+    List,</span>
<span class="gi">+    Mapping,</span>
<span class="gi">+    Optional,</span>
<span class="gi">+    Sequence,</span>
<span class="gi">+    Tuple,</span>
<span class="gi">+    Type,</span>
<span class="gi">+    Union,</span>
<span class="gi">+    cast,</span>
<span class="gi">+)</span>
<span class="gi">+</span>
<span class="w"> </span>import anyio
<span class="w"> </span>from fastapi import params
<span class="gd">-from fastapi._compat import PYDANTIC_V2, ErrorWrapper, ModelField, Required, Undefined, _regenerate_error_with_loc, copy_field_info, create_body_model, evaluate_forwardref, field_annotation_is_scalar, get_annotation_from_field_info, get_missing_field_error, is_bytes_field, is_bytes_sequence_field, is_scalar_field, is_scalar_sequence_field, is_sequence_field, is_uploadfile_or_nonable_uploadfile_annotation, is_uploadfile_sequence_annotation, lenient_issubclass, sequence_types, serialize_sequence_value, value_is_sequence</span>
<span class="gi">+from fastapi._compat import (</span>
<span class="gi">+    PYDANTIC_V2,</span>
<span class="gi">+    ErrorWrapper,</span>
<span class="gi">+    ModelField,</span>
<span class="gi">+    Required,</span>
<span class="gi">+    Undefined,</span>
<span class="gi">+    _regenerate_error_with_loc,</span>
<span class="gi">+    copy_field_info,</span>
<span class="gi">+    create_body_model,</span>
<span class="gi">+    evaluate_forwardref,</span>
<span class="gi">+    field_annotation_is_scalar,</span>
<span class="gi">+    get_annotation_from_field_info,</span>
<span class="gi">+    get_missing_field_error,</span>
<span class="gi">+    is_bytes_field,</span>
<span class="gi">+    is_bytes_sequence_field,</span>
<span class="gi">+    is_scalar_field,</span>
<span class="gi">+    is_scalar_sequence_field,</span>
<span class="gi">+    is_sequence_field,</span>
<span class="gi">+    is_uploadfile_or_nonable_uploadfile_annotation,</span>
<span class="gi">+    is_uploadfile_sequence_annotation,</span>
<span class="gi">+    lenient_issubclass,</span>
<span class="gi">+    sequence_types,</span>
<span class="gi">+    serialize_sequence_value,</span>
<span class="gi">+    value_is_sequence,</span>
<span class="gi">+)</span>
<span class="w"> </span>from fastapi.background import BackgroundTasks
<span class="gd">-from fastapi.concurrency import asynccontextmanager, contextmanager_in_threadpool</span>
<span class="gi">+from fastapi.concurrency import (</span>
<span class="gi">+    asynccontextmanager,</span>
<span class="gi">+    contextmanager_in_threadpool,</span>
<span class="gi">+)</span>
<span class="w"> </span>from fastapi.dependencies.models import Dependant, SecurityRequirement
<span class="w"> </span>from fastapi.logger import logger
<span class="w"> </span>from fastapi.security.base import SecurityBase
<span class="gu">@@ -21,18 +63,756 @@ from starlette.requests import HTTPConnection, Request</span>
<span class="w"> </span>from starlette.responses import Response
<span class="w"> </span>from starlette.websockets import WebSocket
<span class="w"> </span>from typing_extensions import Annotated, get_args, get_origin
<span class="gd">-multipart_not_installed_error = &quot;&quot;&quot;Form data requires &quot;python-multipart&quot; to be installed. </span>
<span class="gd">-You can install &quot;python-multipart&quot; with: </span>

<span class="gd">-pip install python-multipart</span>
<span class="gd">-&quot;&quot;&quot;</span>
<span class="gd">-multipart_incorrect_install_error = &quot;&quot;&quot;Form data requires &quot;python-multipart&quot; to be installed. It seems you installed &quot;multipart&quot; instead. </span>
<span class="gd">-You can remove &quot;multipart&quot; with: </span>
<span class="gi">+multipart_not_installed_error = (</span>
<span class="gi">+    &#39;Form data requires &quot;python-multipart&quot; to be installed. \n&#39;</span>
<span class="gi">+    &#39;You can install &quot;python-multipart&quot; with: \n\n&#39;</span>
<span class="gi">+    &quot;pip install python-multipart\n&quot;</span>
<span class="gi">+)</span>
<span class="gi">+multipart_incorrect_install_error = (</span>
<span class="gi">+    &#39;Form data requires &quot;python-multipart&quot; to be installed. &#39;</span>
<span class="gi">+    &#39;It seems you installed &quot;multipart&quot; instead. \n&#39;</span>
<span class="gi">+    &#39;You can remove &quot;multipart&quot; with: \n\n&#39;</span>
<span class="gi">+    &quot;pip uninstall multipart\n\n&quot;</span>
<span class="gi">+    &#39;And then install &quot;python-multipart&quot; with: \n\n&#39;</span>
<span class="gi">+    &quot;pip install python-multipart\n&quot;</span>
<span class="gi">+)</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def check_file_field(field: ModelField) -&gt; None:</span>
<span class="gi">+    field_info = field.field_info</span>
<span class="gi">+    if isinstance(field_info, params.Form):</span>
<span class="gi">+        try:</span>
<span class="gi">+            # __version__ is available in both multiparts, and can be mocked</span>
<span class="gi">+            from multipart import __version__  # type: ignore</span>
<span class="gi">+</span>
<span class="gi">+            assert __version__</span>
<span class="gi">+            try:</span>
<span class="gi">+                # parse_options_header is only available in the right multipart</span>
<span class="gi">+                from multipart.multipart import parse_options_header  # type: ignore</span>
<span class="gi">+</span>
<span class="gi">+                assert parse_options_header</span>
<span class="gi">+            except ImportError:</span>
<span class="gi">+                logger.error(multipart_incorrect_install_error)</span>
<span class="gi">+                raise RuntimeError(multipart_incorrect_install_error) from None</span>
<span class="gi">+        except ImportError:</span>
<span class="gi">+            logger.error(multipart_not_installed_error)</span>
<span class="gi">+            raise RuntimeError(multipart_not_installed_error) from None</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def get_param_sub_dependant(</span>
<span class="gi">+    *,</span>
<span class="gi">+    param_name: str,</span>
<span class="gi">+    depends: params.Depends,</span>
<span class="gi">+    path: str,</span>
<span class="gi">+    security_scopes: Optional[List[str]] = None,</span>
<span class="gi">+) -&gt; Dependant:</span>
<span class="gi">+    assert depends.dependency</span>
<span class="gi">+    return get_sub_dependant(</span>
<span class="gi">+        depends=depends,</span>
<span class="gi">+        dependency=depends.dependency,</span>
<span class="gi">+        path=path,</span>
<span class="gi">+        name=param_name,</span>
<span class="gi">+        security_scopes=security_scopes,</span>
<span class="gi">+    )</span>
<span class="gi">+</span>

<span class="gd">-pip uninstall multipart</span>
<span class="gi">+def get_parameterless_sub_dependant(*, depends: params.Depends, path: str) -&gt; Dependant:</span>
<span class="gi">+    assert callable(</span>
<span class="gi">+        depends.dependency</span>
<span class="gi">+    ), &quot;A parameter-less dependency must have a callable dependency&quot;</span>
<span class="gi">+    return get_sub_dependant(depends=depends, dependency=depends.dependency, path=path)</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def get_sub_dependant(</span>
<span class="gi">+    *,</span>
<span class="gi">+    depends: params.Depends,</span>
<span class="gi">+    dependency: Callable[..., Any],</span>
<span class="gi">+    path: str,</span>
<span class="gi">+    name: Optional[str] = None,</span>
<span class="gi">+    security_scopes: Optional[List[str]] = None,</span>
<span class="gi">+) -&gt; Dependant:</span>
<span class="gi">+    security_requirement = None</span>
<span class="gi">+    security_scopes = security_scopes or []</span>
<span class="gi">+    if isinstance(depends, params.Security):</span>
<span class="gi">+        dependency_scopes = depends.scopes</span>
<span class="gi">+        security_scopes.extend(dependency_scopes)</span>
<span class="gi">+    if isinstance(dependency, SecurityBase):</span>
<span class="gi">+        use_scopes: List[str] = []</span>
<span class="gi">+        if isinstance(dependency, (OAuth2, OpenIdConnect)):</span>
<span class="gi">+            use_scopes = security_scopes</span>
<span class="gi">+        security_requirement = SecurityRequirement(</span>
<span class="gi">+            security_scheme=dependency, scopes=use_scopes</span>
<span class="gi">+        )</span>
<span class="gi">+    sub_dependant = get_dependant(</span>
<span class="gi">+        path=path,</span>
<span class="gi">+        call=dependency,</span>
<span class="gi">+        name=name,</span>
<span class="gi">+        security_scopes=security_scopes,</span>
<span class="gi">+        use_cache=depends.use_cache,</span>
<span class="gi">+    )</span>
<span class="gi">+    if security_requirement:</span>
<span class="gi">+        sub_dependant.security_requirements.append(security_requirement)</span>
<span class="gi">+    return sub_dependant</span>

<span class="gd">-And then install &quot;python-multipart&quot; with: </span>

<span class="gd">-pip install python-multipart</span>
<span class="gd">-&quot;&quot;&quot;</span>
<span class="w"> </span>CacheKey = Tuple[Optional[Callable[..., Any]], Tuple[str, ...]]
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def get_flat_dependant(</span>
<span class="gi">+    dependant: Dependant,</span>
<span class="gi">+    *,</span>
<span class="gi">+    skip_repeats: bool = False,</span>
<span class="gi">+    visited: Optional[List[CacheKey]] = None,</span>
<span class="gi">+) -&gt; Dependant:</span>
<span class="gi">+    if visited is None:</span>
<span class="gi">+        visited = []</span>
<span class="gi">+    visited.append(dependant.cache_key)</span>
<span class="gi">+</span>
<span class="gi">+    flat_dependant = Dependant(</span>
<span class="gi">+        path_params=dependant.path_params.copy(),</span>
<span class="gi">+        query_params=dependant.query_params.copy(),</span>
<span class="gi">+        header_params=dependant.header_params.copy(),</span>
<span class="gi">+        cookie_params=dependant.cookie_params.copy(),</span>
<span class="gi">+        body_params=dependant.body_params.copy(),</span>
<span class="gi">+        security_schemes=dependant.security_requirements.copy(),</span>
<span class="gi">+        use_cache=dependant.use_cache,</span>
<span class="gi">+        path=dependant.path,</span>
<span class="gi">+    )</span>
<span class="gi">+    for sub_dependant in dependant.dependencies:</span>
<span class="gi">+        if skip_repeats and sub_dependant.cache_key in visited:</span>
<span class="gi">+            continue</span>
<span class="gi">+        flat_sub = get_flat_dependant(</span>
<span class="gi">+            sub_dependant, skip_repeats=skip_repeats, visited=visited</span>
<span class="gi">+        )</span>
<span class="gi">+        flat_dependant.path_params.extend(flat_sub.path_params)</span>
<span class="gi">+        flat_dependant.query_params.extend(flat_sub.query_params)</span>
<span class="gi">+        flat_dependant.header_params.extend(flat_sub.header_params)</span>
<span class="gi">+        flat_dependant.cookie_params.extend(flat_sub.cookie_params)</span>
<span class="gi">+        flat_dependant.body_params.extend(flat_sub.body_params)</span>
<span class="gi">+        flat_dependant.security_requirements.extend(flat_sub.security_requirements)</span>
<span class="gi">+    return flat_dependant</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def get_flat_params(dependant: Dependant) -&gt; List[ModelField]:</span>
<span class="gi">+    flat_dependant = get_flat_dependant(dependant, skip_repeats=True)</span>
<span class="gi">+    return (</span>
<span class="gi">+        flat_dependant.path_params</span>
<span class="gi">+        + flat_dependant.query_params</span>
<span class="gi">+        + flat_dependant.header_params</span>
<span class="gi">+        + flat_dependant.cookie_params</span>
<span class="gi">+    )</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def get_typed_signature(call: Callable[..., Any]) -&gt; inspect.Signature:</span>
<span class="gi">+    signature = inspect.signature(call)</span>
<span class="gi">+    globalns = getattr(call, &quot;__globals__&quot;, {})</span>
<span class="gi">+    typed_params = [</span>
<span class="gi">+        inspect.Parameter(</span>
<span class="gi">+            name=param.name,</span>
<span class="gi">+            kind=param.kind,</span>
<span class="gi">+            default=param.default,</span>
<span class="gi">+            annotation=get_typed_annotation(param.annotation, globalns),</span>
<span class="gi">+        )</span>
<span class="gi">+        for param in signature.parameters.values()</span>
<span class="gi">+    ]</span>
<span class="gi">+    typed_signature = inspect.Signature(typed_params)</span>
<span class="gi">+    return typed_signature</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def get_typed_annotation(annotation: Any, globalns: Dict[str, Any]) -&gt; Any:</span>
<span class="gi">+    if isinstance(annotation, str):</span>
<span class="gi">+        annotation = ForwardRef(annotation)</span>
<span class="gi">+        annotation = evaluate_forwardref(annotation, globalns, globalns)</span>
<span class="gi">+    return annotation</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def get_typed_return_annotation(call: Callable[..., Any]) -&gt; Any:</span>
<span class="gi">+    signature = inspect.signature(call)</span>
<span class="gi">+    annotation = signature.return_annotation</span>
<span class="gi">+</span>
<span class="gi">+    if annotation is inspect.Signature.empty:</span>
<span class="gi">+        return None</span>
<span class="gi">+</span>
<span class="gi">+    globalns = getattr(call, &quot;__globals__&quot;, {})</span>
<span class="gi">+    return get_typed_annotation(annotation, globalns)</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def get_dependant(</span>
<span class="gi">+    *,</span>
<span class="gi">+    path: str,</span>
<span class="gi">+    call: Callable[..., Any],</span>
<span class="gi">+    name: Optional[str] = None,</span>
<span class="gi">+    security_scopes: Optional[List[str]] = None,</span>
<span class="gi">+    use_cache: bool = True,</span>
<span class="gi">+) -&gt; Dependant:</span>
<span class="gi">+    path_param_names = get_path_param_names(path)</span>
<span class="gi">+    endpoint_signature = get_typed_signature(call)</span>
<span class="gi">+    signature_params = endpoint_signature.parameters</span>
<span class="gi">+    dependant = Dependant(</span>
<span class="gi">+        call=call,</span>
<span class="gi">+        name=name,</span>
<span class="gi">+        path=path,</span>
<span class="gi">+        security_scopes=security_scopes,</span>
<span class="gi">+        use_cache=use_cache,</span>
<span class="gi">+    )</span>
<span class="gi">+    for param_name, param in signature_params.items():</span>
<span class="gi">+        is_path_param = param_name in path_param_names</span>
<span class="gi">+        type_annotation, depends, param_field = analyze_param(</span>
<span class="gi">+            param_name=param_name,</span>
<span class="gi">+            annotation=param.annotation,</span>
<span class="gi">+            value=param.default,</span>
<span class="gi">+            is_path_param=is_path_param,</span>
<span class="gi">+        )</span>
<span class="gi">+        if depends is not None:</span>
<span class="gi">+            sub_dependant = get_param_sub_dependant(</span>
<span class="gi">+                param_name=param_name,</span>
<span class="gi">+                depends=depends,</span>
<span class="gi">+                path=path,</span>
<span class="gi">+                security_scopes=security_scopes,</span>
<span class="gi">+            )</span>
<span class="gi">+            dependant.dependencies.append(sub_dependant)</span>
<span class="gi">+            continue</span>
<span class="gi">+        if add_non_field_param_to_dependency(</span>
<span class="gi">+            param_name=param_name,</span>
<span class="gi">+            type_annotation=type_annotation,</span>
<span class="gi">+            dependant=dependant,</span>
<span class="gi">+        ):</span>
<span class="gi">+            assert (</span>
<span class="gi">+                param_field is None</span>
<span class="gi">+            ), f&quot;Cannot specify multiple FastAPI annotations for {param_name!r}&quot;</span>
<span class="gi">+            continue</span>
<span class="gi">+        assert param_field is not None</span>
<span class="gi">+        if is_body_param(param_field=param_field, is_path_param=is_path_param):</span>
<span class="gi">+            dependant.body_params.append(param_field)</span>
<span class="gi">+        else:</span>
<span class="gi">+            add_param_to_fields(field=param_field, dependant=dependant)</span>
<span class="gi">+    return dependant</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def add_non_field_param_to_dependency(</span>
<span class="gi">+    *, param_name: str, type_annotation: Any, dependant: Dependant</span>
<span class="gi">+) -&gt; Optional[bool]:</span>
<span class="gi">+    if lenient_issubclass(type_annotation, Request):</span>
<span class="gi">+        dependant.request_param_name = param_name</span>
<span class="gi">+        return True</span>
<span class="gi">+    elif lenient_issubclass(type_annotation, WebSocket):</span>
<span class="gi">+        dependant.websocket_param_name = param_name</span>
<span class="gi">+        return True</span>
<span class="gi">+    elif lenient_issubclass(type_annotation, HTTPConnection):</span>
<span class="gi">+        dependant.http_connection_param_name = param_name</span>
<span class="gi">+        return True</span>
<span class="gi">+    elif lenient_issubclass(type_annotation, Response):</span>
<span class="gi">+        dependant.response_param_name = param_name</span>
<span class="gi">+        return True</span>
<span class="gi">+    elif lenient_issubclass(type_annotation, StarletteBackgroundTasks):</span>
<span class="gi">+        dependant.background_tasks_param_name = param_name</span>
<span class="gi">+        return True</span>
<span class="gi">+    elif lenient_issubclass(type_annotation, SecurityScopes):</span>
<span class="gi">+        dependant.security_scopes_param_name = param_name</span>
<span class="gi">+        return True</span>
<span class="gi">+    return None</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def analyze_param(</span>
<span class="gi">+    *,</span>
<span class="gi">+    param_name: str,</span>
<span class="gi">+    annotation: Any,</span>
<span class="gi">+    value: Any,</span>
<span class="gi">+    is_path_param: bool,</span>
<span class="gi">+) -&gt; Tuple[Any, Optional[params.Depends], Optional[ModelField]]:</span>
<span class="gi">+    field_info = None</span>
<span class="gi">+    depends = None</span>
<span class="gi">+    type_annotation: Any = Any</span>
<span class="gi">+    use_annotation: Any = Any</span>
<span class="gi">+    if annotation is not inspect.Signature.empty:</span>
<span class="gi">+        use_annotation = annotation</span>
<span class="gi">+        type_annotation = annotation</span>
<span class="gi">+    if get_origin(use_annotation) is Annotated:</span>
<span class="gi">+        annotated_args = get_args(annotation)</span>
<span class="gi">+        type_annotation = annotated_args[0]</span>
<span class="gi">+        fastapi_annotations = [</span>
<span class="gi">+            arg</span>
<span class="gi">+            for arg in annotated_args[1:]</span>
<span class="gi">+            if isinstance(arg, (FieldInfo, params.Depends))</span>
<span class="gi">+        ]</span>
<span class="gi">+        fastapi_specific_annotations = [</span>
<span class="gi">+            arg</span>
<span class="gi">+            for arg in fastapi_annotations</span>
<span class="gi">+            if isinstance(arg, (params.Param, params.Body, params.Depends))</span>
<span class="gi">+        ]</span>
<span class="gi">+        if fastapi_specific_annotations:</span>
<span class="gi">+            fastapi_annotation: Union[</span>
<span class="gi">+                FieldInfo, params.Depends, None</span>
<span class="gi">+            ] = fastapi_specific_annotations[-1]</span>
<span class="gi">+        else:</span>
<span class="gi">+            fastapi_annotation = None</span>
<span class="gi">+        if isinstance(fastapi_annotation, FieldInfo):</span>
<span class="gi">+            # Copy `field_info` because we mutate `field_info.default` below.</span>
<span class="gi">+            field_info = copy_field_info(</span>
<span class="gi">+                field_info=fastapi_annotation, annotation=use_annotation</span>
<span class="gi">+            )</span>
<span class="gi">+            assert field_info.default is Undefined or field_info.default is Required, (</span>
<span class="gi">+                f&quot;`{field_info.__class__.__name__}` default value cannot be set in&quot;</span>
<span class="gi">+                f&quot; `Annotated` for {param_name!r}. Set the default value with `=` instead.&quot;</span>
<span class="gi">+            )</span>
<span class="gi">+            if value is not inspect.Signature.empty:</span>
<span class="gi">+                assert not is_path_param, &quot;Path parameters cannot have default values&quot;</span>
<span class="gi">+                field_info.default = value</span>
<span class="gi">+            else:</span>
<span class="gi">+                field_info.default = Required</span>
<span class="gi">+        elif isinstance(fastapi_annotation, params.Depends):</span>
<span class="gi">+            depends = fastapi_annotation</span>
<span class="gi">+</span>
<span class="gi">+    if isinstance(value, params.Depends):</span>
<span class="gi">+        assert depends is None, (</span>
<span class="gi">+            &quot;Cannot specify `Depends` in `Annotated` and default value&quot;</span>
<span class="gi">+            f&quot; together for {param_name!r}&quot;</span>
<span class="gi">+        )</span>
<span class="gi">+        assert field_info is None, (</span>
<span class="gi">+            &quot;Cannot specify a FastAPI annotation in `Annotated` and `Depends` as a&quot;</span>
<span class="gi">+            f&quot; default value together for {param_name!r}&quot;</span>
<span class="gi">+        )</span>
<span class="gi">+        depends = value</span>
<span class="gi">+    elif isinstance(value, FieldInfo):</span>
<span class="gi">+        assert field_info is None, (</span>
<span class="gi">+            &quot;Cannot specify FastAPI annotations in `Annotated` and default value&quot;</span>
<span class="gi">+            f&quot; together for {param_name!r}&quot;</span>
<span class="gi">+        )</span>
<span class="gi">+        field_info = value</span>
<span class="gi">+        if PYDANTIC_V2:</span>
<span class="gi">+            field_info.annotation = type_annotation</span>
<span class="gi">+</span>
<span class="gi">+    if depends is not None and depends.dependency is None:</span>
<span class="gi">+        # Copy `depends` before mutating it</span>
<span class="gi">+        depends = copy(depends)</span>
<span class="gi">+        depends.dependency = type_annotation</span>
<span class="gi">+</span>
<span class="gi">+    if lenient_issubclass(</span>
<span class="gi">+        type_annotation,</span>
<span class="gi">+        (</span>
<span class="gi">+            Request,</span>
<span class="gi">+            WebSocket,</span>
<span class="gi">+            HTTPConnection,</span>
<span class="gi">+            Response,</span>
<span class="gi">+            StarletteBackgroundTasks,</span>
<span class="gi">+            SecurityScopes,</span>
<span class="gi">+        ),</span>
<span class="gi">+    ):</span>
<span class="gi">+        assert depends is None, f&quot;Cannot specify `Depends` for type {type_annotation!r}&quot;</span>
<span class="gi">+        assert (</span>
<span class="gi">+            field_info is None</span>
<span class="gi">+        ), f&quot;Cannot specify FastAPI annotation for type {type_annotation!r}&quot;</span>
<span class="gi">+    elif field_info is None and depends is None:</span>
<span class="gi">+        default_value = value if value is not inspect.Signature.empty else Required</span>
<span class="gi">+        if is_path_param:</span>
<span class="gi">+            # We might check here that `default_value is Required`, but the fact is that the same</span>
<span class="gi">+            # parameter might sometimes be a path parameter and sometimes not. See</span>
<span class="gi">+            # `tests/test_infer_param_optionality.py` for an example.</span>
<span class="gi">+            field_info = params.Path(annotation=use_annotation)</span>
<span class="gi">+        elif is_uploadfile_or_nonable_uploadfile_annotation(</span>
<span class="gi">+            type_annotation</span>
<span class="gi">+        ) or is_uploadfile_sequence_annotation(type_annotation):</span>
<span class="gi">+            field_info = params.File(annotation=use_annotation, default=default_value)</span>
<span class="gi">+        elif not field_annotation_is_scalar(annotation=type_annotation):</span>
<span class="gi">+            field_info = params.Body(annotation=use_annotation, default=default_value)</span>
<span class="gi">+        else:</span>
<span class="gi">+            field_info = params.Query(annotation=use_annotation, default=default_value)</span>
<span class="gi">+</span>
<span class="gi">+    field = None</span>
<span class="gi">+    if field_info is not None:</span>
<span class="gi">+        if is_path_param:</span>
<span class="gi">+            assert isinstance(field_info, params.Path), (</span>
<span class="gi">+                f&quot;Cannot use `{field_info.__class__.__name__}` for path param&quot;</span>
<span class="gi">+                f&quot; {param_name!r}&quot;</span>
<span class="gi">+            )</span>
<span class="gi">+        elif (</span>
<span class="gi">+            isinstance(field_info, params.Param)</span>
<span class="gi">+            and getattr(field_info, &quot;in_&quot;, None) is None</span>
<span class="gi">+        ):</span>
<span class="gi">+            field_info.in_ = params.ParamTypes.query</span>
<span class="gi">+        use_annotation_from_field_info = get_annotation_from_field_info(</span>
<span class="gi">+            use_annotation,</span>
<span class="gi">+            field_info,</span>
<span class="gi">+            param_name,</span>
<span class="gi">+        )</span>
<span class="gi">+        if not field_info.alias and getattr(field_info, &quot;convert_underscores&quot;, None):</span>
<span class="gi">+            alias = param_name.replace(&quot;_&quot;, &quot;-&quot;)</span>
<span class="gi">+        else:</span>
<span class="gi">+            alias = field_info.alias or param_name</span>
<span class="gi">+        field_info.alias = alias</span>
<span class="gi">+        field = create_response_field(</span>
<span class="gi">+            name=param_name,</span>
<span class="gi">+            type_=use_annotation_from_field_info,</span>
<span class="gi">+            default=field_info.default,</span>
<span class="gi">+            alias=alias,</span>
<span class="gi">+            required=field_info.default in (Required, Undefined),</span>
<span class="gi">+            field_info=field_info,</span>
<span class="gi">+        )</span>
<span class="gi">+</span>
<span class="gi">+    return type_annotation, depends, field</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def is_body_param(*, param_field: ModelField, is_path_param: bool) -&gt; bool:</span>
<span class="gi">+    if is_path_param:</span>
<span class="gi">+        assert is_scalar_field(</span>
<span class="gi">+            field=param_field</span>
<span class="gi">+        ), &quot;Path params must be of one of the supported types&quot;</span>
<span class="gi">+        return False</span>
<span class="gi">+    elif is_scalar_field(field=param_field):</span>
<span class="gi">+        return False</span>
<span class="gi">+    elif isinstance(</span>
<span class="gi">+        param_field.field_info, (params.Query, params.Header)</span>
<span class="gi">+    ) and is_scalar_sequence_field(param_field):</span>
<span class="gi">+        return False</span>
<span class="gi">+    else:</span>
<span class="gi">+        assert isinstance(</span>
<span class="gi">+            param_field.field_info, params.Body</span>
<span class="gi">+        ), f&quot;Param: {param_field.name} can only be a request body, using Body()&quot;</span>
<span class="gi">+        return True</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def add_param_to_fields(*, field: ModelField, dependant: Dependant) -&gt; None:</span>
<span class="gi">+    field_info = field.field_info</span>
<span class="gi">+    field_info_in = getattr(field_info, &quot;in_&quot;, None)</span>
<span class="gi">+    if field_info_in == params.ParamTypes.path:</span>
<span class="gi">+        dependant.path_params.append(field)</span>
<span class="gi">+    elif field_info_in == params.ParamTypes.query:</span>
<span class="gi">+        dependant.query_params.append(field)</span>
<span class="gi">+    elif field_info_in == params.ParamTypes.header:</span>
<span class="gi">+        dependant.header_params.append(field)</span>
<span class="gi">+    else:</span>
<span class="gi">+        assert (</span>
<span class="gi">+            field_info_in == params.ParamTypes.cookie</span>
<span class="gi">+        ), f&quot;non-body parameters must be in path, query, header or cookie: {field.name}&quot;</span>
<span class="gi">+        dependant.cookie_params.append(field)</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def is_coroutine_callable(call: Callable[..., Any]) -&gt; bool:</span>
<span class="gi">+    if inspect.isroutine(call):</span>
<span class="gi">+        return inspect.iscoroutinefunction(call)</span>
<span class="gi">+    if inspect.isclass(call):</span>
<span class="gi">+        return False</span>
<span class="gi">+    dunder_call = getattr(call, &quot;__call__&quot;, None)  # noqa: B004</span>
<span class="gi">+    return inspect.iscoroutinefunction(dunder_call)</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def is_async_gen_callable(call: Callable[..., Any]) -&gt; bool:</span>
<span class="gi">+    if inspect.isasyncgenfunction(call):</span>
<span class="gi">+        return True</span>
<span class="gi">+    dunder_call = getattr(call, &quot;__call__&quot;, None)  # noqa: B004</span>
<span class="gi">+    return inspect.isasyncgenfunction(dunder_call)</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def is_gen_callable(call: Callable[..., Any]) -&gt; bool:</span>
<span class="gi">+    if inspect.isgeneratorfunction(call):</span>
<span class="gi">+        return True</span>
<span class="gi">+    dunder_call = getattr(call, &quot;__call__&quot;, None)  # noqa: B004</span>
<span class="gi">+    return inspect.isgeneratorfunction(dunder_call)</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+async def solve_generator(</span>
<span class="gi">+    *, call: Callable[..., Any], stack: AsyncExitStack, sub_values: Dict[str, Any]</span>
<span class="gi">+) -&gt; Any:</span>
<span class="gi">+    if is_gen_callable(call):</span>
<span class="gi">+        cm = contextmanager_in_threadpool(contextmanager(call)(**sub_values))</span>
<span class="gi">+    elif is_async_gen_callable(call):</span>
<span class="gi">+        cm = asynccontextmanager(call)(**sub_values)</span>
<span class="gi">+    return await stack.enter_async_context(cm)</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+async def solve_dependencies(</span>
<span class="gi">+    *,</span>
<span class="gi">+    request: Union[Request, WebSocket],</span>
<span class="gi">+    dependant: Dependant,</span>
<span class="gi">+    body: Optional[Union[Dict[str, Any], FormData]] = None,</span>
<span class="gi">+    background_tasks: Optional[StarletteBackgroundTasks] = None,</span>
<span class="gi">+    response: Optional[Response] = None,</span>
<span class="gi">+    dependency_overrides_provider: Optional[Any] = None,</span>
<span class="gi">+    dependency_cache: Optional[Dict[Tuple[Callable[..., Any], Tuple[str]], Any]] = None,</span>
<span class="gi">+    async_exit_stack: AsyncExitStack,</span>
<span class="gi">+) -&gt; Tuple[</span>
<span class="gi">+    Dict[str, Any],</span>
<span class="gi">+    List[Any],</span>
<span class="gi">+    Optional[StarletteBackgroundTasks],</span>
<span class="gi">+    Response,</span>
<span class="gi">+    Dict[Tuple[Callable[..., Any], Tuple[str]], Any],</span>
<span class="gi">+]:</span>
<span class="gi">+    values: Dict[str, Any] = {}</span>
<span class="gi">+    errors: List[Any] = []</span>
<span class="gi">+    if response is None:</span>
<span class="gi">+        response = Response()</span>
<span class="gi">+        del response.headers[&quot;content-length&quot;]</span>
<span class="gi">+        response.status_code = None  # type: ignore</span>
<span class="gi">+    dependency_cache = dependency_cache or {}</span>
<span class="gi">+    sub_dependant: Dependant</span>
<span class="gi">+    for sub_dependant in dependant.dependencies:</span>
<span class="gi">+        sub_dependant.call = cast(Callable[..., Any], sub_dependant.call)</span>
<span class="gi">+        sub_dependant.cache_key = cast(</span>
<span class="gi">+            Tuple[Callable[..., Any], Tuple[str]], sub_dependant.cache_key</span>
<span class="gi">+        )</span>
<span class="gi">+        call = sub_dependant.call</span>
<span class="gi">+        use_sub_dependant = sub_dependant</span>
<span class="gi">+        if (</span>
<span class="gi">+            dependency_overrides_provider</span>
<span class="gi">+            and dependency_overrides_provider.dependency_overrides</span>
<span class="gi">+        ):</span>
<span class="gi">+            original_call = sub_dependant.call</span>
<span class="gi">+            call = getattr(</span>
<span class="gi">+                dependency_overrides_provider, &quot;dependency_overrides&quot;, {}</span>
<span class="gi">+            ).get(original_call, original_call)</span>
<span class="gi">+            use_path: str = sub_dependant.path  # type: ignore</span>
<span class="gi">+            use_sub_dependant = get_dependant(</span>
<span class="gi">+                path=use_path,</span>
<span class="gi">+                call=call,</span>
<span class="gi">+                name=sub_dependant.name,</span>
<span class="gi">+                security_scopes=sub_dependant.security_scopes,</span>
<span class="gi">+            )</span>
<span class="gi">+</span>
<span class="gi">+        solved_result = await solve_dependencies(</span>
<span class="gi">+            request=request,</span>
<span class="gi">+            dependant=use_sub_dependant,</span>
<span class="gi">+            body=body,</span>
<span class="gi">+            background_tasks=background_tasks,</span>
<span class="gi">+            response=response,</span>
<span class="gi">+            dependency_overrides_provider=dependency_overrides_provider,</span>
<span class="gi">+            dependency_cache=dependency_cache,</span>
<span class="gi">+            async_exit_stack=async_exit_stack,</span>
<span class="gi">+        )</span>
<span class="gi">+        (</span>
<span class="gi">+            sub_values,</span>
<span class="gi">+            sub_errors,</span>
<span class="gi">+            background_tasks,</span>
<span class="gi">+            _,  # the subdependency returns the same response we have</span>
<span class="gi">+            sub_dependency_cache,</span>
<span class="gi">+        ) = solved_result</span>
<span class="gi">+        dependency_cache.update(sub_dependency_cache)</span>
<span class="gi">+        if sub_errors:</span>
<span class="gi">+            errors.extend(sub_errors)</span>
<span class="gi">+            continue</span>
<span class="gi">+        if sub_dependant.use_cache and sub_dependant.cache_key in dependency_cache:</span>
<span class="gi">+            solved = dependency_cache[sub_dependant.cache_key]</span>
<span class="gi">+        elif is_gen_callable(call) or is_async_gen_callable(call):</span>
<span class="gi">+            solved = await solve_generator(</span>
<span class="gi">+                call=call, stack=async_exit_stack, sub_values=sub_values</span>
<span class="gi">+            )</span>
<span class="gi">+        elif is_coroutine_callable(call):</span>
<span class="gi">+            solved = await call(**sub_values)</span>
<span class="gi">+        else:</span>
<span class="gi">+            solved = await run_in_threadpool(call, **sub_values)</span>
<span class="gi">+        if sub_dependant.name is not None:</span>
<span class="gi">+            values[sub_dependant.name] = solved</span>
<span class="gi">+        if sub_dependant.cache_key not in dependency_cache:</span>
<span class="gi">+            dependency_cache[sub_dependant.cache_key] = solved</span>
<span class="gi">+    path_values, path_errors = request_params_to_args(</span>
<span class="gi">+        dependant.path_params, request.path_params</span>
<span class="gi">+    )</span>
<span class="gi">+    query_values, query_errors = request_params_to_args(</span>
<span class="gi">+        dependant.query_params, request.query_params</span>
<span class="gi">+    )</span>
<span class="gi">+    header_values, header_errors = request_params_to_args(</span>
<span class="gi">+        dependant.header_params, request.headers</span>
<span class="gi">+    )</span>
<span class="gi">+    cookie_values, cookie_errors = request_params_to_args(</span>
<span class="gi">+        dependant.cookie_params, request.cookies</span>
<span class="gi">+    )</span>
<span class="gi">+    values.update(path_values)</span>
<span class="gi">+    values.update(query_values)</span>
<span class="gi">+    values.update(header_values)</span>
<span class="gi">+    values.update(cookie_values)</span>
<span class="gi">+    errors += path_errors + query_errors + header_errors + cookie_errors</span>
<span class="gi">+    if dependant.body_params:</span>
<span class="gi">+        (</span>
<span class="gi">+            body_values,</span>
<span class="gi">+            body_errors,</span>
<span class="gi">+        ) = await request_body_to_args(  # body_params checked above</span>
<span class="gi">+            required_params=dependant.body_params, received_body=body</span>
<span class="gi">+        )</span>
<span class="gi">+        values.update(body_values)</span>
<span class="gi">+        errors.extend(body_errors)</span>
<span class="gi">+    if dependant.http_connection_param_name:</span>
<span class="gi">+        values[dependant.http_connection_param_name] = request</span>
<span class="gi">+    if dependant.request_param_name and isinstance(request, Request):</span>
<span class="gi">+        values[dependant.request_param_name] = request</span>
<span class="gi">+    elif dependant.websocket_param_name and isinstance(request, WebSocket):</span>
<span class="gi">+        values[dependant.websocket_param_name] = request</span>
<span class="gi">+    if dependant.background_tasks_param_name:</span>
<span class="gi">+        if background_tasks is None:</span>
<span class="gi">+            background_tasks = BackgroundTasks()</span>
<span class="gi">+        values[dependant.background_tasks_param_name] = background_tasks</span>
<span class="gi">+    if dependant.response_param_name:</span>
<span class="gi">+        values[dependant.response_param_name] = response</span>
<span class="gi">+    if dependant.security_scopes_param_name:</span>
<span class="gi">+        values[dependant.security_scopes_param_name] = SecurityScopes(</span>
<span class="gi">+            scopes=dependant.security_scopes</span>
<span class="gi">+        )</span>
<span class="gi">+    return values, errors, background_tasks, response, dependency_cache</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def request_params_to_args(</span>
<span class="gi">+    required_params: Sequence[ModelField],</span>
<span class="gi">+    received_params: Union[Mapping[str, Any], QueryParams, Headers],</span>
<span class="gi">+) -&gt; Tuple[Dict[str, Any], List[Any]]:</span>
<span class="gi">+    values = {}</span>
<span class="gi">+    errors = []</span>
<span class="gi">+    for field in required_params:</span>
<span class="gi">+        if is_scalar_sequence_field(field) and isinstance(</span>
<span class="gi">+            received_params, (QueryParams, Headers)</span>
<span class="gi">+        ):</span>
<span class="gi">+            value = received_params.getlist(field.alias) or field.default</span>
<span class="gi">+        else:</span>
<span class="gi">+            value = received_params.get(field.alias)</span>
<span class="gi">+        field_info = field.field_info</span>
<span class="gi">+        assert isinstance(</span>
<span class="gi">+            field_info, params.Param</span>
<span class="gi">+        ), &quot;Params must be subclasses of Param&quot;</span>
<span class="gi">+        loc = (field_info.in_.value, field.alias)</span>
<span class="gi">+        if value is None:</span>
<span class="gi">+            if field.required:</span>
<span class="gi">+                errors.append(get_missing_field_error(loc=loc))</span>
<span class="gi">+            else:</span>
<span class="gi">+                values[field.name] = deepcopy(field.default)</span>
<span class="gi">+            continue</span>
<span class="gi">+        v_, errors_ = field.validate(value, values, loc=loc)</span>
<span class="gi">+        if isinstance(errors_, ErrorWrapper):</span>
<span class="gi">+            errors.append(errors_)</span>
<span class="gi">+        elif isinstance(errors_, list):</span>
<span class="gi">+            new_errors = _regenerate_error_with_loc(errors=errors_, loc_prefix=())</span>
<span class="gi">+            errors.extend(new_errors)</span>
<span class="gi">+        else:</span>
<span class="gi">+            values[field.name] = v_</span>
<span class="gi">+    return values, errors</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+async def request_body_to_args(</span>
<span class="gi">+    required_params: List[ModelField],</span>
<span class="gi">+    received_body: Optional[Union[Dict[str, Any], FormData]],</span>
<span class="gi">+) -&gt; Tuple[Dict[str, Any], List[Dict[str, Any]]]:</span>
<span class="gi">+    values = {}</span>
<span class="gi">+    errors: List[Dict[str, Any]] = []</span>
<span class="gi">+    if required_params:</span>
<span class="gi">+        field = required_params[0]</span>
<span class="gi">+        field_info = field.field_info</span>
<span class="gi">+        embed = getattr(field_info, &quot;embed&quot;, None)</span>
<span class="gi">+        field_alias_omitted = len(required_params) == 1 and not embed</span>
<span class="gi">+        if field_alias_omitted:</span>
<span class="gi">+            received_body = {field.alias: received_body}</span>
<span class="gi">+</span>
<span class="gi">+        for field in required_params:</span>
<span class="gi">+            loc: Tuple[str, ...]</span>
<span class="gi">+            if field_alias_omitted:</span>
<span class="gi">+                loc = (&quot;body&quot;,)</span>
<span class="gi">+            else:</span>
<span class="gi">+                loc = (&quot;body&quot;, field.alias)</span>
<span class="gi">+</span>
<span class="gi">+            value: Optional[Any] = None</span>
<span class="gi">+            if received_body is not None:</span>
<span class="gi">+                if (is_sequence_field(field)) and isinstance(received_body, FormData):</span>
<span class="gi">+                    value = received_body.getlist(field.alias)</span>
<span class="gi">+                else:</span>
<span class="gi">+                    try:</span>
<span class="gi">+                        value = received_body.get(field.alias)</span>
<span class="gi">+                    except AttributeError:</span>
<span class="gi">+                        errors.append(get_missing_field_error(loc))</span>
<span class="gi">+                        continue</span>
<span class="gi">+            if (</span>
<span class="gi">+                value is None</span>
<span class="gi">+                or (isinstance(field_info, params.Form) and value == &quot;&quot;)</span>
<span class="gi">+                or (</span>
<span class="gi">+                    isinstance(field_info, params.Form)</span>
<span class="gi">+                    and is_sequence_field(field)</span>
<span class="gi">+                    and len(value) == 0</span>
<span class="gi">+                )</span>
<span class="gi">+            ):</span>
<span class="gi">+                if field.required:</span>
<span class="gi">+                    errors.append(get_missing_field_error(loc))</span>
<span class="gi">+                else:</span>
<span class="gi">+                    values[field.name] = deepcopy(field.default)</span>
<span class="gi">+                continue</span>
<span class="gi">+            if (</span>
<span class="gi">+                isinstance(field_info, params.File)</span>
<span class="gi">+                and is_bytes_field(field)</span>
<span class="gi">+                and isinstance(value, UploadFile)</span>
<span class="gi">+            ):</span>
<span class="gi">+                value = await value.read()</span>
<span class="gi">+            elif (</span>
<span class="gi">+                is_bytes_sequence_field(field)</span>
<span class="gi">+                and isinstance(field_info, params.File)</span>
<span class="gi">+                and value_is_sequence(value)</span>
<span class="gi">+            ):</span>
<span class="gi">+                # For types</span>
<span class="gi">+                assert isinstance(value, sequence_types)  # type: ignore[arg-type]</span>
<span class="gi">+                results: List[Union[bytes, str]] = []</span>
<span class="gi">+</span>
<span class="gi">+                async def process_fn(</span>
<span class="gi">+                    fn: Callable[[], Coroutine[Any, Any, Any]],</span>
<span class="gi">+                ) -&gt; None:</span>
<span class="gi">+                    result = await fn()</span>
<span class="gi">+                    results.append(result)  # noqa: B023</span>
<span class="gi">+</span>
<span class="gi">+                async with anyio.create_task_group() as tg:</span>
<span class="gi">+                    for sub_value in value:</span>
<span class="gi">+                        tg.start_soon(process_fn, sub_value.read)</span>
<span class="gi">+                value = serialize_sequence_value(field=field, value=results)</span>
<span class="gi">+</span>
<span class="gi">+            v_, errors_ = field.validate(value, values, loc=loc)</span>
<span class="gi">+</span>
<span class="gi">+            if isinstance(errors_, list):</span>
<span class="gi">+                errors.extend(errors_)</span>
<span class="gi">+            elif errors_:</span>
<span class="gi">+                errors.append(errors_)</span>
<span class="gi">+            else:</span>
<span class="gi">+                values[field.name] = v_</span>
<span class="gi">+    return values, errors</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def get_body_field(*, dependant: Dependant, name: str) -&gt; Optional[ModelField]:</span>
<span class="gi">+    flat_dependant = get_flat_dependant(dependant)</span>
<span class="gi">+    if not flat_dependant.body_params:</span>
<span class="gi">+        return None</span>
<span class="gi">+    first_param = flat_dependant.body_params[0]</span>
<span class="gi">+    field_info = first_param.field_info</span>
<span class="gi">+    embed = getattr(field_info, &quot;embed&quot;, None)</span>
<span class="gi">+    body_param_names_set = {param.name for param in flat_dependant.body_params}</span>
<span class="gi">+    if len(body_param_names_set) == 1 and not embed:</span>
<span class="gi">+        check_file_field(first_param)</span>
<span class="gi">+        return first_param</span>
<span class="gi">+    # If one field requires to embed, all have to be embedded</span>
<span class="gi">+    # in case a sub-dependency is evaluated with a single unique body field</span>
<span class="gi">+    # That is combined (embedded) with other body fields</span>
<span class="gi">+    for param in flat_dependant.body_params:</span>
<span class="gi">+        setattr(param.field_info, &quot;embed&quot;, True)  # noqa: B010</span>
<span class="gi">+    model_name = &quot;Body_&quot; + name</span>
<span class="gi">+    BodyModel = create_body_model(</span>
<span class="gi">+        fields=flat_dependant.body_params, model_name=model_name</span>
<span class="gi">+    )</span>
<span class="gi">+    required = any(True for f in flat_dependant.body_params if f.required)</span>
<span class="gi">+    BodyFieldInfo_kwargs: Dict[str, Any] = {</span>
<span class="gi">+        &quot;annotation&quot;: BodyModel,</span>
<span class="gi">+        &quot;alias&quot;: &quot;body&quot;,</span>
<span class="gi">+    }</span>
<span class="gi">+    if not required:</span>
<span class="gi">+        BodyFieldInfo_kwargs[&quot;default&quot;] = None</span>
<span class="gi">+    if any(isinstance(f.field_info, params.File) for f in flat_dependant.body_params):</span>
<span class="gi">+        BodyFieldInfo: Type[params.Body] = params.File</span>
<span class="gi">+    elif any(isinstance(f.field_info, params.Form) for f in flat_dependant.body_params):</span>
<span class="gi">+        BodyFieldInfo = params.Form</span>
<span class="gi">+    else:</span>
<span class="gi">+        BodyFieldInfo = params.Body</span>
<span class="gi">+</span>
<span class="gi">+        body_param_media_types = [</span>
<span class="gi">+            f.field_info.media_type</span>
<span class="gi">+            for f in flat_dependant.body_params</span>
<span class="gi">+            if isinstance(f.field_info, params.Body)</span>
<span class="gi">+        ]</span>
<span class="gi">+        if len(set(body_param_media_types)) == 1:</span>
<span class="gi">+            BodyFieldInfo_kwargs[&quot;media_type&quot;] = body_param_media_types[0]</span>
<span class="gi">+    final_field = create_response_field(</span>
<span class="gi">+        name=&quot;body&quot;,</span>
<span class="gi">+        type_=BodyModel,</span>
<span class="gi">+        required=required,</span>
<span class="gi">+        alias=&quot;body&quot;,</span>
<span class="gi">+        field_info=BodyFieldInfo(**BodyFieldInfo_kwargs),</span>
<span class="gi">+    )</span>
<span class="gi">+    check_file_field(final_field)</span>
<span class="gi">+    return final_field</span>
<span class="gh">diff --git a/fastapi/encoders.py b/fastapi/encoders.py</span>
<span class="gh">index 66986830..451ea076 100644</span>
<span class="gd">--- a/fastapi/encoders.py</span>
<span class="gi">+++ b/fastapi/encoders.py</span>
<span class="gu">@@ -3,22 +3,38 @@ import datetime</span>
<span class="w"> </span>from collections import defaultdict, deque
<span class="w"> </span>from decimal import Decimal
<span class="w"> </span>from enum import Enum
<span class="gd">-from ipaddress import IPv4Address, IPv4Interface, IPv4Network, IPv6Address, IPv6Interface, IPv6Network</span>
<span class="gi">+from ipaddress import (</span>
<span class="gi">+    IPv4Address,</span>
<span class="gi">+    IPv4Interface,</span>
<span class="gi">+    IPv4Network,</span>
<span class="gi">+    IPv6Address,</span>
<span class="gi">+    IPv6Interface,</span>
<span class="gi">+    IPv6Network,</span>
<span class="gi">+)</span>
<span class="w"> </span>from pathlib import Path, PurePath
<span class="w"> </span>from re import Pattern
<span class="w"> </span>from types import GeneratorType
<span class="w"> </span>from typing import Any, Callable, Dict, List, Optional, Tuple, Type, Union
<span class="w"> </span>from uuid import UUID
<span class="gi">+</span>
<span class="w"> </span>from fastapi.types import IncEx
<span class="w"> </span>from pydantic import BaseModel
<span class="w"> </span>from pydantic.color import Color
<span class="w"> </span>from pydantic.networks import AnyUrl, NameEmail
<span class="w"> </span>from pydantic.types import SecretBytes, SecretStr
<span class="w"> </span>from typing_extensions import Annotated, Doc
<span class="gi">+</span>
<span class="w"> </span>from ._compat import PYDANTIC_V2, UndefinedType, Url, _model_dump


<span class="gd">-def decimal_encoder(dec_value: Decimal) -&gt;Union[int, float]:</span>
<span class="gi">+# Taken from Pydantic v1 as is</span>
<span class="gi">+def isoformat(o: Union[datetime.date, datetime.time]) -&gt; str:</span>
<span class="gi">+    return o.isoformat()</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+# Taken from Pydantic v1 as is</span>
<span class="gi">+# TODO: pv2 should this return strings instead?</span>
<span class="gi">+def decimal_encoder(dec_value: Decimal) -&gt; Union[int, float]:</span>
<span class="w"> </span>    &quot;&quot;&quot;
<span class="w"> </span>    Encodes a Decimal as int of there&#39;s no exponent, otherwise float

<span class="gu">@@ -33,75 +49,146 @@ def decimal_encoder(dec_value: Decimal) -&gt;Union[int, float]:</span>
<span class="w"> </span>    &gt;&gt;&gt; decimal_encoder(Decimal(&quot;1&quot;))
<span class="w"> </span>    1
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gd">-</span>
<span class="gd">-</span>
<span class="gd">-ENCODERS_BY_TYPE: Dict[Type[Any], Callable[[Any], Any]] = {bytes: lambda o:</span>
<span class="gd">-    o.decode(), Color: str, datetime.date: isoformat, datetime.datetime:</span>
<span class="gd">-    isoformat, datetime.time: isoformat, datetime.timedelta: lambda td: td.</span>
<span class="gd">-    total_seconds(), Decimal: decimal_encoder, Enum: lambda o: o.value,</span>
<span class="gd">-    frozenset: list, deque: list, GeneratorType: list, IPv4Address: str,</span>
<span class="gd">-    IPv4Interface: str, IPv4Network: str, IPv6Address: str, IPv6Interface:</span>
<span class="gd">-    str, IPv6Network: str, NameEmail: str, Path: str, Pattern: lambda o: o.</span>
<span class="gd">-    pattern, SecretBytes: str, SecretStr: str, set: list, UUID: str, Url:</span>
<span class="gd">-    str, AnyUrl: str}</span>
<span class="gi">+    if dec_value.as_tuple().exponent &gt;= 0:  # type: ignore[operator]</span>
<span class="gi">+        return int(dec_value)</span>
<span class="gi">+    else:</span>
<span class="gi">+        return float(dec_value)</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+ENCODERS_BY_TYPE: Dict[Type[Any], Callable[[Any], Any]] = {</span>
<span class="gi">+    bytes: lambda o: o.decode(),</span>
<span class="gi">+    Color: str,</span>
<span class="gi">+    datetime.date: isoformat,</span>
<span class="gi">+    datetime.datetime: isoformat,</span>
<span class="gi">+    datetime.time: isoformat,</span>
<span class="gi">+    datetime.timedelta: lambda td: td.total_seconds(),</span>
<span class="gi">+    Decimal: decimal_encoder,</span>
<span class="gi">+    Enum: lambda o: o.value,</span>
<span class="gi">+    frozenset: list,</span>
<span class="gi">+    deque: list,</span>
<span class="gi">+    GeneratorType: list,</span>
<span class="gi">+    IPv4Address: str,</span>
<span class="gi">+    IPv4Interface: str,</span>
<span class="gi">+    IPv4Network: str,</span>
<span class="gi">+    IPv6Address: str,</span>
<span class="gi">+    IPv6Interface: str,</span>
<span class="gi">+    IPv6Network: str,</span>
<span class="gi">+    NameEmail: str,</span>
<span class="gi">+    Path: str,</span>
<span class="gi">+    Pattern: lambda o: o.pattern,</span>
<span class="gi">+    SecretBytes: str,</span>
<span class="gi">+    SecretStr: str,</span>
<span class="gi">+    set: list,</span>
<span class="gi">+    UUID: str,</span>
<span class="gi">+    Url: str,</span>
<span class="gi">+    AnyUrl: str,</span>
<span class="gi">+}</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def generate_encoders_by_class_tuples(</span>
<span class="gi">+    type_encoder_map: Dict[Any, Callable[[Any], Any]],</span>
<span class="gi">+) -&gt; Dict[Callable[[Any], Any], Tuple[Any, ...]]:</span>
<span class="gi">+    encoders_by_class_tuples: Dict[Callable[[Any], Any], Tuple[Any, ...]] = defaultdict(</span>
<span class="gi">+        tuple</span>
<span class="gi">+    )</span>
<span class="gi">+    for type_, encoder in type_encoder_map.items():</span>
<span class="gi">+        encoders_by_class_tuples[encoder] += (type_,)</span>
<span class="gi">+    return encoders_by_class_tuples</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="w"> </span>encoders_by_class_tuples = generate_encoders_by_class_tuples(ENCODERS_BY_TYPE)


<span class="gd">-def jsonable_encoder(obj: Annotated[Any, Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+def jsonable_encoder(</span>
<span class="gi">+    obj: Annotated[</span>
<span class="gi">+        Any,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            The input object to convert to JSON.
<span class="gd">-            &quot;&quot;&quot;)],</span>
<span class="gd">-    include: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ],</span>
<span class="gi">+    include: Annotated[</span>
<span class="gi">+        Optional[IncEx],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Pydantic&#39;s `include` parameter, passed to Pydantic models to set the
<span class="w"> </span>            fields to include.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=None, exclude: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    exclude: Annotated[</span>
<span class="gi">+        Optional[IncEx],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Pydantic&#39;s `exclude` parameter, passed to Pydantic models to set the
<span class="w"> </span>            fields to exclude.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=None, by_alias: Annotated[bool, Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    by_alias: Annotated[</span>
<span class="gi">+        bool,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Pydantic&#39;s `by_alias` parameter, passed to Pydantic models to define if
<span class="w"> </span>            the output should use the alias names (when provided) or the Python
<span class="w"> </span>            attribute names. In an API, if you set an alias, it&#39;s probably because you
<span class="w"> </span>            want to use it in the result, so you probably want to leave this set to
<span class="w"> </span>            `True`.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=True, exclude_unset: Annotated[bool, Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = True,</span>
<span class="gi">+    exclude_unset: Annotated[</span>
<span class="gi">+        bool,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Pydantic&#39;s `exclude_unset` parameter, passed to Pydantic models to define
<span class="w"> </span>            if it should exclude from the output the fields that were not explicitly
<span class="w"> </span>            set (and that only had their default values).
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=False, exclude_defaults: Annotated[bool, Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = False,</span>
<span class="gi">+    exclude_defaults: Annotated[</span>
<span class="gi">+        bool,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Pydantic&#39;s `exclude_defaults` parameter, passed to Pydantic models to define
<span class="w"> </span>            if it should exclude from the output the fields that had the same default
<span class="w"> </span>            value, even when they were explicitly set.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=False, exclude_none: Annotated[bool, Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = False,</span>
<span class="gi">+    exclude_none: Annotated[</span>
<span class="gi">+        bool,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Pydantic&#39;s `exclude_none` parameter, passed to Pydantic models to define
<span class="w"> </span>            if it should exclude from the output any fields that have a `None` value.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=False, custom_encoder: Annotated[Optional[Dict[Any, Callable[[Any],</span>
<span class="gd">-    Any]]], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = False,</span>
<span class="gi">+    custom_encoder: Annotated[</span>
<span class="gi">+        Optional[Dict[Any, Callable[[Any], Any]]],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Pydantic&#39;s `custom_encoder` parameter, passed to Pydantic models to define
<span class="w"> </span>            a custom encoder.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=None, sqlalchemy_safe: Annotated[bool, Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    sqlalchemy_safe: Annotated[</span>
<span class="gi">+        bool,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Exclude from the output any fields that start with the name `_sa`.

<span class="w"> </span>            This is mainly a hack for compatibility with SQLAlchemy objects, they
<span class="w"> </span>            store internal SQLAlchemy-specific state in attributes named with `_sa`,
<span class="w"> </span>            and those objects can&#39;t (and shouldn&#39;t be) serialized to JSON.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=True) -&gt;Any:</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = True,</span>
<span class="gi">+) -&gt; Any:</span>
<span class="w"> </span>    &quot;&quot;&quot;
<span class="w"> </span>    Convert any object to something that can be encoded in JSON.

<span class="gu">@@ -114,4 +201,143 @@ def jsonable_encoder(obj: Annotated[Any, Doc(</span>
<span class="w"> </span>    Read more about it in the
<span class="w"> </span>    [FastAPI docs for JSON Compatible Encoder](https://fastapi.tiangolo.com/tutorial/encoder/).
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    custom_encoder = custom_encoder or {}</span>
<span class="gi">+    if custom_encoder:</span>
<span class="gi">+        if type(obj) in custom_encoder:</span>
<span class="gi">+            return custom_encoder[type(obj)](obj)</span>
<span class="gi">+        else:</span>
<span class="gi">+            for encoder_type, encoder_instance in custom_encoder.items():</span>
<span class="gi">+                if isinstance(obj, encoder_type):</span>
<span class="gi">+                    return encoder_instance(obj)</span>
<span class="gi">+    if include is not None and not isinstance(include, (set, dict)):</span>
<span class="gi">+        include = set(include)</span>
<span class="gi">+    if exclude is not None and not isinstance(exclude, (set, dict)):</span>
<span class="gi">+        exclude = set(exclude)</span>
<span class="gi">+    if isinstance(obj, BaseModel):</span>
<span class="gi">+        # TODO: remove when deprecating Pydantic v1</span>
<span class="gi">+        encoders: Dict[Any, Any] = {}</span>
<span class="gi">+        if not PYDANTIC_V2:</span>
<span class="gi">+            encoders = getattr(obj.__config__, &quot;json_encoders&quot;, {})  # type: ignore[attr-defined]</span>
<span class="gi">+            if custom_encoder:</span>
<span class="gi">+                encoders.update(custom_encoder)</span>
<span class="gi">+        obj_dict = _model_dump(</span>
<span class="gi">+            obj,</span>
<span class="gi">+            mode=&quot;json&quot;,</span>
<span class="gi">+            include=include,</span>
<span class="gi">+            exclude=exclude,</span>
<span class="gi">+            by_alias=by_alias,</span>
<span class="gi">+            exclude_unset=exclude_unset,</span>
<span class="gi">+            exclude_none=exclude_none,</span>
<span class="gi">+            exclude_defaults=exclude_defaults,</span>
<span class="gi">+        )</span>
<span class="gi">+        if &quot;__root__&quot; in obj_dict:</span>
<span class="gi">+            obj_dict = obj_dict[&quot;__root__&quot;]</span>
<span class="gi">+        return jsonable_encoder(</span>
<span class="gi">+            obj_dict,</span>
<span class="gi">+            exclude_none=exclude_none,</span>
<span class="gi">+            exclude_defaults=exclude_defaults,</span>
<span class="gi">+            # TODO: remove when deprecating Pydantic v1</span>
<span class="gi">+            custom_encoder=encoders,</span>
<span class="gi">+            sqlalchemy_safe=sqlalchemy_safe,</span>
<span class="gi">+        )</span>
<span class="gi">+    if dataclasses.is_dataclass(obj):</span>
<span class="gi">+        obj_dict = dataclasses.asdict(obj)</span>
<span class="gi">+        return jsonable_encoder(</span>
<span class="gi">+            obj_dict,</span>
<span class="gi">+            include=include,</span>
<span class="gi">+            exclude=exclude,</span>
<span class="gi">+            by_alias=by_alias,</span>
<span class="gi">+            exclude_unset=exclude_unset,</span>
<span class="gi">+            exclude_defaults=exclude_defaults,</span>
<span class="gi">+            exclude_none=exclude_none,</span>
<span class="gi">+            custom_encoder=custom_encoder,</span>
<span class="gi">+            sqlalchemy_safe=sqlalchemy_safe,</span>
<span class="gi">+        )</span>
<span class="gi">+    if isinstance(obj, Enum):</span>
<span class="gi">+        return obj.value</span>
<span class="gi">+    if isinstance(obj, PurePath):</span>
<span class="gi">+        return str(obj)</span>
<span class="gi">+    if isinstance(obj, (str, int, float, type(None))):</span>
<span class="gi">+        return obj</span>
<span class="gi">+    if isinstance(obj, UndefinedType):</span>
<span class="gi">+        return None</span>
<span class="gi">+    if isinstance(obj, dict):</span>
<span class="gi">+        encoded_dict = {}</span>
<span class="gi">+        allowed_keys = set(obj.keys())</span>
<span class="gi">+        if include is not None:</span>
<span class="gi">+            allowed_keys &amp;= set(include)</span>
<span class="gi">+        if exclude is not None:</span>
<span class="gi">+            allowed_keys -= set(exclude)</span>
<span class="gi">+        for key, value in obj.items():</span>
<span class="gi">+            if (</span>
<span class="gi">+                (</span>
<span class="gi">+                    not sqlalchemy_safe</span>
<span class="gi">+                    or (not isinstance(key, str))</span>
<span class="gi">+                    or (not key.startswith(&quot;_sa&quot;))</span>
<span class="gi">+                )</span>
<span class="gi">+                and (value is not None or not exclude_none)</span>
<span class="gi">+                and key in allowed_keys</span>
<span class="gi">+            ):</span>
<span class="gi">+                encoded_key = jsonable_encoder(</span>
<span class="gi">+                    key,</span>
<span class="gi">+                    by_alias=by_alias,</span>
<span class="gi">+                    exclude_unset=exclude_unset,</span>
<span class="gi">+                    exclude_none=exclude_none,</span>
<span class="gi">+                    custom_encoder=custom_encoder,</span>
<span class="gi">+                    sqlalchemy_safe=sqlalchemy_safe,</span>
<span class="gi">+                )</span>
<span class="gi">+                encoded_value = jsonable_encoder(</span>
<span class="gi">+                    value,</span>
<span class="gi">+                    by_alias=by_alias,</span>
<span class="gi">+                    exclude_unset=exclude_unset,</span>
<span class="gi">+                    exclude_none=exclude_none,</span>
<span class="gi">+                    custom_encoder=custom_encoder,</span>
<span class="gi">+                    sqlalchemy_safe=sqlalchemy_safe,</span>
<span class="gi">+                )</span>
<span class="gi">+                encoded_dict[encoded_key] = encoded_value</span>
<span class="gi">+        return encoded_dict</span>
<span class="gi">+    if isinstance(obj, (list, set, frozenset, GeneratorType, tuple, deque)):</span>
<span class="gi">+        encoded_list = []</span>
<span class="gi">+        for item in obj:</span>
<span class="gi">+            encoded_list.append(</span>
<span class="gi">+                jsonable_encoder(</span>
<span class="gi">+                    item,</span>
<span class="gi">+                    include=include,</span>
<span class="gi">+                    exclude=exclude,</span>
<span class="gi">+                    by_alias=by_alias,</span>
<span class="gi">+                    exclude_unset=exclude_unset,</span>
<span class="gi">+                    exclude_defaults=exclude_defaults,</span>
<span class="gi">+                    exclude_none=exclude_none,</span>
<span class="gi">+                    custom_encoder=custom_encoder,</span>
<span class="gi">+                    sqlalchemy_safe=sqlalchemy_safe,</span>
<span class="gi">+                )</span>
<span class="gi">+            )</span>
<span class="gi">+        return encoded_list</span>
<span class="gi">+</span>
<span class="gi">+    if type(obj) in ENCODERS_BY_TYPE:</span>
<span class="gi">+        return ENCODERS_BY_TYPE[type(obj)](obj)</span>
<span class="gi">+    for encoder, classes_tuple in encoders_by_class_tuples.items():</span>
<span class="gi">+        if isinstance(obj, classes_tuple):</span>
<span class="gi">+            return encoder(obj)</span>
<span class="gi">+</span>
<span class="gi">+    try:</span>
<span class="gi">+        data = dict(obj)</span>
<span class="gi">+    except Exception as e:</span>
<span class="gi">+        errors: List[Exception] = []</span>
<span class="gi">+        errors.append(e)</span>
<span class="gi">+        try:</span>
<span class="gi">+            data = vars(obj)</span>
<span class="gi">+        except Exception as e:</span>
<span class="gi">+            errors.append(e)</span>
<span class="gi">+            raise ValueError(errors) from e</span>
<span class="gi">+    return jsonable_encoder(</span>
<span class="gi">+        data,</span>
<span class="gi">+        include=include,</span>
<span class="gi">+        exclude=exclude,</span>
<span class="gi">+        by_alias=by_alias,</span>
<span class="gi">+        exclude_unset=exclude_unset,</span>
<span class="gi">+        exclude_defaults=exclude_defaults,</span>
<span class="gi">+        exclude_none=exclude_none,</span>
<span class="gi">+        custom_encoder=custom_encoder,</span>
<span class="gi">+        sqlalchemy_safe=sqlalchemy_safe,</span>
<span class="gi">+    )</span>
<span class="gh">diff --git a/fastapi/exception_handlers.py b/fastapi/exception_handlers.py</span>
<span class="gh">index fab43330..6c2ba7fe 100644</span>
<span class="gd">--- a/fastapi/exception_handlers.py</span>
<span class="gi">+++ b/fastapi/exception_handlers.py</span>
<span class="gu">@@ -6,3 +6,29 @@ from starlette.exceptions import HTTPException</span>
<span class="w"> </span>from starlette.requests import Request
<span class="w"> </span>from starlette.responses import JSONResponse, Response
<span class="w"> </span>from starlette.status import HTTP_422_UNPROCESSABLE_ENTITY, WS_1008_POLICY_VIOLATION
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+async def http_exception_handler(request: Request, exc: HTTPException) -&gt; Response:</span>
<span class="gi">+    headers = getattr(exc, &quot;headers&quot;, None)</span>
<span class="gi">+    if not is_body_allowed_for_status_code(exc.status_code):</span>
<span class="gi">+        return Response(status_code=exc.status_code, headers=headers)</span>
<span class="gi">+    return JSONResponse(</span>
<span class="gi">+        {&quot;detail&quot;: exc.detail}, status_code=exc.status_code, headers=headers</span>
<span class="gi">+    )</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+async def request_validation_exception_handler(</span>
<span class="gi">+    request: Request, exc: RequestValidationError</span>
<span class="gi">+) -&gt; JSONResponse:</span>
<span class="gi">+    return JSONResponse(</span>
<span class="gi">+        status_code=HTTP_422_UNPROCESSABLE_ENTITY,</span>
<span class="gi">+        content={&quot;detail&quot;: jsonable_encoder(exc.errors())},</span>
<span class="gi">+    )</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+async def websocket_request_validation_exception_handler(</span>
<span class="gi">+    websocket: WebSocket, exc: WebSocketRequestValidationError</span>
<span class="gi">+) -&gt; None:</span>
<span class="gi">+    await websocket.close(</span>
<span class="gi">+        code=WS_1008_POLICY_VIOLATION, reason=jsonable_encoder(exc.errors())</span>
<span class="gi">+    )</span>
<span class="gh">diff --git a/fastapi/exceptions.py b/fastapi/exceptions.py</span>
<span class="gh">index eaf7aec3..44d4ada8 100644</span>
<span class="gd">--- a/fastapi/exceptions.py</span>
<span class="gi">+++ b/fastapi/exceptions.py</span>
<span class="gu">@@ -1,4 +1,5 @@</span>
<span class="w"> </span>from typing import Any, Dict, Optional, Sequence, Type, Union
<span class="gi">+</span>
<span class="w"> </span>from pydantic import BaseModel, create_model
<span class="w"> </span>from starlette.exceptions import HTTPException as StarletteHTTPException
<span class="w"> </span>from starlette.exceptions import WebSocketException as StarletteWebSocketException
<span class="gu">@@ -33,22 +34,35 @@ class HTTPException(StarletteHTTPException):</span>
<span class="w"> </span>    ```
<span class="w"> </span>    &quot;&quot;&quot;

<span class="gd">-    def __init__(self, status_code: Annotated[int, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        status_code: Annotated[</span>
<span class="gi">+            int,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                HTTP status code to send to the client.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], detail: Annotated[Any, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        detail: Annotated[</span>
<span class="gi">+            Any,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Any data to be sent to the client in the `detail` key of the JSON
<span class="w"> </span>                response.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, headers: Annotated[Optional[Dict[str, str]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        headers: Annotated[</span>
<span class="gi">+            Optional[Dict[str, str]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Any headers to send to the client in the response.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None) -&gt;None:</span>
<span class="gd">-        super().__init__(status_code=status_code, detail=detail, headers=</span>
<span class="gd">-            headers)</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+    ) -&gt; None:</span>
<span class="gi">+        super().__init__(status_code=status_code, detail=detail, headers=headers)</span>


<span class="w"> </span>class WebSocketException(StarletteWebSocketException):
<span class="gu">@@ -93,13 +107,21 @@ class WebSocketException(StarletteWebSocketException):</span>
<span class="w"> </span>    ```
<span class="w"> </span>    &quot;&quot;&quot;

<span class="gd">-    def __init__(self, code: Annotated[int, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        code: Annotated[</span>
<span class="gi">+            int,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A closing code from the
<span class="w"> </span>                [valid codes defined in the specification](https://datatracker.ietf.org/doc/html/rfc6455#section-7.4.1).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], reason: Annotated[Union[str, None], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        reason: Annotated[</span>
<span class="gi">+            Union[str, None],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The reason to close the WebSocket connection.

<span class="w"> </span>                It is UTF-8-encoded data. The interpretation of the reason is up to the
<span class="gu">@@ -108,12 +130,14 @@ class WebSocketException(StarletteWebSocketException):</span>
<span class="w"> </span>                It could contain text that could be human-readable or interpretable
<span class="w"> </span>                by the client code, etc.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None) -&gt;None:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+    ) -&gt; None:</span>
<span class="w"> </span>        super().__init__(code=code, reason=reason)


<span class="gd">-RequestErrorModel: Type[BaseModel] = create_model(&#39;Request&#39;)</span>
<span class="gd">-WebSocketErrorModel: Type[BaseModel] = create_model(&#39;WebSocket&#39;)</span>
<span class="gi">+RequestErrorModel: Type[BaseModel] = create_model(&quot;Request&quot;)</span>
<span class="gi">+WebSocketErrorModel: Type[BaseModel] = create_model(&quot;WebSocket&quot;)</span>


<span class="w"> </span>class FastAPIError(RuntimeError):
<span class="gu">@@ -123,14 +147,15 @@ class FastAPIError(RuntimeError):</span>


<span class="w"> </span>class ValidationException(Exception):
<span class="gd">-</span>
<span class="gd">-    def __init__(self, errors: Sequence[Any]) -&gt;None:</span>
<span class="gi">+    def __init__(self, errors: Sequence[Any]) -&gt; None:</span>
<span class="w"> </span>        self._errors = errors

<span class="gi">+    def errors(self) -&gt; Sequence[Any]:</span>
<span class="gi">+        return self._errors</span>

<span class="gd">-class RequestValidationError(ValidationException):</span>

<span class="gd">-    def __init__(self, errors: Sequence[Any], *, body: Any=None) -&gt;None:</span>
<span class="gi">+class RequestValidationError(ValidationException):</span>
<span class="gi">+    def __init__(self, errors: Sequence[Any], *, body: Any = None) -&gt; None:</span>
<span class="w"> </span>        super().__init__(errors)
<span class="w"> </span>        self.body = body

<span class="gu">@@ -140,13 +165,12 @@ class WebSocketRequestValidationError(ValidationException):</span>


<span class="w"> </span>class ResponseValidationError(ValidationException):
<span class="gd">-</span>
<span class="gd">-    def __init__(self, errors: Sequence[Any], *, body: Any=None) -&gt;None:</span>
<span class="gi">+    def __init__(self, errors: Sequence[Any], *, body: Any = None) -&gt; None:</span>
<span class="w"> </span>        super().__init__(errors)
<span class="w"> </span>        self.body = body

<span class="gd">-    def __str__(self) -&gt;str:</span>
<span class="gd">-        message = f&#39;{len(self._errors)} validation errors:\n&#39;</span>
<span class="gi">+    def __str__(self) -&gt; str:</span>
<span class="gi">+        message = f&quot;{len(self._errors)} validation errors:\n&quot;</span>
<span class="w"> </span>        for err in self._errors:
<span class="gd">-            message += f&#39;  {err}\n&#39;</span>
<span class="gi">+            message += f&quot;  {err}\n&quot;</span>
<span class="w"> </span>        return message
<span class="gh">diff --git a/fastapi/logger.py b/fastapi/logger.py</span>
<span class="gh">index 3317a231..5b2c4ad5 100644</span>
<span class="gd">--- a/fastapi/logger.py</span>
<span class="gi">+++ b/fastapi/logger.py</span>
<span class="gu">@@ -1,2 +1,3 @@</span>
<span class="w"> </span>import logging
<span class="gd">-logger = logging.getLogger(&#39;fastapi&#39;)</span>
<span class="gi">+</span>
<span class="gi">+logger = logging.getLogger(&quot;fastapi&quot;)</span>
<span class="gh">diff --git a/fastapi/middleware/cors.py b/fastapi/middleware/cors.py</span>
<span class="gh">index 8bef8b14..8dfaad0d 100644</span>
<span class="gd">--- a/fastapi/middleware/cors.py</span>
<span class="gi">+++ b/fastapi/middleware/cors.py</span>
<span class="gu">@@ -1 +1 @@</span>
<span class="gd">-from starlette.middleware.cors import CORSMiddleware as CORSMiddleware</span>
<span class="gi">+from starlette.middleware.cors import CORSMiddleware as CORSMiddleware  # noqa</span>
<span class="gh">diff --git a/fastapi/middleware/gzip.py b/fastapi/middleware/gzip.py</span>
<span class="gh">index 2d50d26a..bbeb2cc7 100644</span>
<span class="gd">--- a/fastapi/middleware/gzip.py</span>
<span class="gi">+++ b/fastapi/middleware/gzip.py</span>
<span class="gu">@@ -1 +1 @@</span>
<span class="gd">-from starlette.middleware.gzip import GZipMiddleware as GZipMiddleware</span>
<span class="gi">+from starlette.middleware.gzip import GZipMiddleware as GZipMiddleware  # noqa</span>
<span class="gh">diff --git a/fastapi/middleware/httpsredirect.py b/fastapi/middleware/httpsredirect.py</span>
<span class="gh">index 41e6bde4..b7a3d8e0 100644</span>
<span class="gd">--- a/fastapi/middleware/httpsredirect.py</span>
<span class="gi">+++ b/fastapi/middleware/httpsredirect.py</span>
<span class="gu">@@ -1 +1,3 @@</span>
<span class="gd">-from starlette.middleware.httpsredirect import HTTPSRedirectMiddleware as HTTPSRedirectMiddleware</span>
<span class="gi">+from starlette.middleware.httpsredirect import (  # noqa</span>
<span class="gi">+    HTTPSRedirectMiddleware as HTTPSRedirectMiddleware,</span>
<span class="gi">+)</span>
<span class="gh">diff --git a/fastapi/middleware/trustedhost.py b/fastapi/middleware/trustedhost.py</span>
<span class="gh">index 00aa1fa6..08d7e035 100644</span>
<span class="gd">--- a/fastapi/middleware/trustedhost.py</span>
<span class="gi">+++ b/fastapi/middleware/trustedhost.py</span>
<span class="gu">@@ -1 +1,3 @@</span>
<span class="gd">-from starlette.middleware.trustedhost import TrustedHostMiddleware as TrustedHostMiddleware</span>
<span class="gi">+from starlette.middleware.trustedhost import (  # noqa</span>
<span class="gi">+    TrustedHostMiddleware as TrustedHostMiddleware,</span>
<span class="gi">+)</span>
<span class="gh">diff --git a/fastapi/middleware/wsgi.py b/fastapi/middleware/wsgi.py</span>
<span class="gh">index 5e01d0ef..c4c6a797 100644</span>
<span class="gd">--- a/fastapi/middleware/wsgi.py</span>
<span class="gi">+++ b/fastapi/middleware/wsgi.py</span>
<span class="gu">@@ -1 +1 @@</span>
<span class="gd">-from starlette.middleware.wsgi import WSGIMiddleware as WSGIMiddleware</span>
<span class="gi">+from starlette.middleware.wsgi import WSGIMiddleware as WSGIMiddleware  # noqa</span>
<span class="gh">diff --git a/fastapi/openapi/constants.py b/fastapi/openapi/constants.py</span>
<span class="gh">index 639b3416..d724ee3c 100644</span>
<span class="gd">--- a/fastapi/openapi/constants.py</span>
<span class="gi">+++ b/fastapi/openapi/constants.py</span>
<span class="gu">@@ -1,3 +1,3 @@</span>
<span class="gd">-METHODS_WITH_BODY = {&#39;GET&#39;, &#39;HEAD&#39;, &#39;POST&#39;, &#39;PUT&#39;, &#39;DELETE&#39;, &#39;PATCH&#39;}</span>
<span class="gd">-REF_PREFIX = &#39;#/components/schemas/&#39;</span>
<span class="gd">-REF_TEMPLATE = &#39;#/components/schemas/{model}&#39;</span>
<span class="gi">+METHODS_WITH_BODY = {&quot;GET&quot;, &quot;HEAD&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;, &quot;PATCH&quot;}</span>
<span class="gi">+REF_PREFIX = &quot;#/components/schemas/&quot;</span>
<span class="gi">+REF_TEMPLATE = &quot;#/components/schemas/{model}&quot;</span>
<span class="gh">diff --git a/fastapi/openapi/docs.py b/fastapi/openapi/docs.py</span>
<span class="gh">index a9c03e54..c2ec358d 100644</span>
<span class="gd">--- a/fastapi/openapi/docs.py</span>
<span class="gi">+++ b/fastapi/openapi/docs.py</span>
<span class="gu">@@ -1,65 +1,104 @@</span>
<span class="w"> </span>import json
<span class="w"> </span>from typing import Any, Dict, Optional
<span class="gi">+</span>
<span class="w"> </span>from fastapi.encoders import jsonable_encoder
<span class="w"> </span>from starlette.responses import HTMLResponse
<span class="w"> </span>from typing_extensions import Annotated, Doc
<span class="gd">-swagger_ui_default_parameters: Annotated[Dict[str, Any], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+</span>
<span class="gi">+swagger_ui_default_parameters: Annotated[</span>
<span class="gi">+    Dict[str, Any],</span>
<span class="gi">+    Doc(</span>
<span class="gi">+        &quot;&quot;&quot;</span>
<span class="w"> </span>        Default configurations for Swagger UI.

<span class="w"> </span>        You can use it as a template to add any other configurations needed.
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-    )] = {&#39;dom_id&#39;: &#39;#swagger-ui&#39;, &#39;layout&#39;: &#39;BaseLayout&#39;, &#39;deepLinking&#39;: </span>
<span class="gd">-    True, &#39;showExtensions&#39;: True, &#39;showCommonExtensions&#39;: True}</span>
<span class="gi">+    ),</span>
<span class="gi">+] = {</span>
<span class="gi">+    &quot;dom_id&quot;: &quot;#swagger-ui&quot;,</span>
<span class="gi">+    &quot;layout&quot;: &quot;BaseLayout&quot;,</span>
<span class="gi">+    &quot;deepLinking&quot;: True,</span>
<span class="gi">+    &quot;showExtensions&quot;: True,</span>
<span class="gi">+    &quot;showCommonExtensions&quot;: True,</span>
<span class="gi">+}</span>


<span class="gd">-def get_swagger_ui_html(*, openapi_url: Annotated[str, Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+def get_swagger_ui_html(</span>
<span class="gi">+    *,</span>
<span class="gi">+    openapi_url: Annotated[</span>
<span class="gi">+        str,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            The OpenAPI URL that Swagger UI should load and use.

<span class="w"> </span>            This is normally done automatically by FastAPI using the default URL
<span class="w"> </span>            `/openapi.json`.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )], title: Annotated[str, Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ],</span>
<span class="gi">+    title: Annotated[</span>
<span class="gi">+        str,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            The HTML `&lt;title&gt;` content, normally shown in the browser tab.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )], swagger_js_url: Annotated[str, Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ],</span>
<span class="gi">+    swagger_js_url: Annotated[</span>
<span class="gi">+        str,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            The URL to use to load the Swagger UI JavaScript.

<span class="w"> </span>            It is normally set to a CDN URL.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=</span>
<span class="gd">-    &#39;https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js&#39;,</span>
<span class="gd">-    swagger_css_url: Annotated[str, Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = &quot;https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui-bundle.js&quot;,</span>
<span class="gi">+    swagger_css_url: Annotated[</span>
<span class="gi">+        str,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            The URL to use to load the Swagger UI CSS.

<span class="w"> </span>            It is normally set to a CDN URL.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=&#39;https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css&#39;,</span>
<span class="gd">-    swagger_favicon_url: Annotated[str, Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = &quot;https://cdn.jsdelivr.net/npm/swagger-ui-dist@5/swagger-ui.css&quot;,</span>
<span class="gi">+    swagger_favicon_url: Annotated[</span>
<span class="gi">+        str,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            The URL of the favicon to use. It is normally shown in the browser tab.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=&#39;https://fastapi.tiangolo.com/img/favicon.png&#39;, oauth2_redirect_url:</span>
<span class="gd">-    Annotated[Optional[str], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = &quot;https://fastapi.tiangolo.com/img/favicon.png&quot;,</span>
<span class="gi">+    oauth2_redirect_url: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            The OAuth2 redirect URL, it is normally automatically handled by FastAPI.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=None, init_oauth: Annotated[Optional[Dict[str, Any]], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    init_oauth: Annotated[</span>
<span class="gi">+        Optional[Dict[str, Any]],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            A dictionary with Swagger UI OAuth2 initialization configurations.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=None, swagger_ui_parameters: Annotated[Optional[Dict[str, Any]], Doc</span>
<span class="gd">-    (</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    swagger_ui_parameters: Annotated[</span>
<span class="gi">+        Optional[Dict[str, Any]],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Configuration parameters for Swagger UI.

<span class="w"> </span>            It defaults to [swagger_ui_default_parameters][fastapi.openapi.docs.swagger_ui_default_parameters].
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=None) -&gt;HTMLResponse:</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+) -&gt; HTMLResponse:</span>
<span class="w"> </span>    &quot;&quot;&quot;
<span class="w"> </span>    Generate and return the HTML  that loads Swagger UI for the interactive
<span class="w"> </span>    API docs (normally served at `/docs`).
<span class="gu">@@ -71,38 +110,102 @@ def get_swagger_ui_html(*, openapi_url: Annotated[str, Doc(</span>
<span class="w"> </span>    [FastAPI docs for Configure Swagger UI](https://fastapi.tiangolo.com/how-to/configure-swagger-ui/)
<span class="w"> </span>    and the [FastAPI docs for Custom Docs UI Static Assets (Self-Hosting)](https://fastapi.tiangolo.com/how-to/custom-docs-ui-assets/).
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    current_swagger_ui_parameters = swagger_ui_default_parameters.copy()</span>
<span class="gi">+    if swagger_ui_parameters:</span>
<span class="gi">+        current_swagger_ui_parameters.update(swagger_ui_parameters)</span>
<span class="gi">+</span>
<span class="gi">+    html = f&quot;&quot;&quot;</span>
<span class="gi">+    &lt;!DOCTYPE html&gt;</span>
<span class="gi">+    &lt;html&gt;</span>
<span class="gi">+    &lt;head&gt;</span>
<span class="gi">+    &lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; href=&quot;{swagger_css_url}&quot;&gt;</span>
<span class="gi">+    &lt;link rel=&quot;shortcut icon&quot; href=&quot;{swagger_favicon_url}&quot;&gt;</span>
<span class="gi">+    &lt;title&gt;{title}&lt;/title&gt;</span>
<span class="gi">+    &lt;/head&gt;</span>
<span class="gi">+    &lt;body&gt;</span>
<span class="gi">+    &lt;div id=&quot;swagger-ui&quot;&gt;</span>
<span class="gi">+    &lt;/div&gt;</span>
<span class="gi">+    &lt;script src=&quot;{swagger_js_url}&quot;&gt;&lt;/script&gt;</span>
<span class="gi">+    &lt;!-- `SwaggerUIBundle` is now available on the page --&gt;</span>
<span class="gi">+    &lt;script&gt;</span>
<span class="gi">+    const ui = SwaggerUIBundle({{</span>
<span class="gi">+        url: &#39;{openapi_url}&#39;,</span>
<span class="gi">+    &quot;&quot;&quot;</span>

<span class="gi">+    for key, value in current_swagger_ui_parameters.items():</span>
<span class="gi">+        html += f&quot;{json.dumps(key)}: {json.dumps(jsonable_encoder(value))},\n&quot;</span>

<span class="gd">-def get_redoc_html(*, openapi_url: Annotated[str, Doc(</span>
<span class="gi">+    if oauth2_redirect_url:</span>
<span class="gi">+        html += f&quot;oauth2RedirectUrl: window.location.origin + &#39;{oauth2_redirect_url}&#39;,&quot;</span>
<span class="gi">+</span>
<span class="gi">+    html += &quot;&quot;&quot;</span>
<span class="gi">+    presets: [</span>
<span class="gi">+        SwaggerUIBundle.presets.apis,</span>
<span class="gi">+        SwaggerUIBundle.SwaggerUIStandalonePreset</span>
<span class="gi">+        ],</span>
<span class="gi">+    })&quot;&quot;&quot;</span>
<span class="gi">+</span>
<span class="gi">+    if init_oauth:</span>
<span class="gi">+        html += f&quot;&quot;&quot;</span>
<span class="gi">+        ui.initOAuth({json.dumps(jsonable_encoder(init_oauth))})</span>
<span class="gi">+        &quot;&quot;&quot;</span>
<span class="gi">+</span>
<span class="gi">+    html += &quot;&quot;&quot;</span>
<span class="gi">+    &lt;/script&gt;</span>
<span class="gi">+    &lt;/body&gt;</span>
<span class="gi">+    &lt;/html&gt;</span>
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gi">+    return HTMLResponse(html)</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def get_redoc_html(</span>
<span class="gi">+    *,</span>
<span class="gi">+    openapi_url: Annotated[</span>
<span class="gi">+        str,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            The OpenAPI URL that ReDoc should load and use.

<span class="w"> </span>            This is normally done automatically by FastAPI using the default URL
<span class="w"> </span>            `/openapi.json`.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )], title: Annotated[str, Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ],</span>
<span class="gi">+    title: Annotated[</span>
<span class="gi">+        str,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            The HTML `&lt;title&gt;` content, normally shown in the browser tab.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )], redoc_js_url: Annotated[str, Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ],</span>
<span class="gi">+    redoc_js_url: Annotated[</span>
<span class="gi">+        str,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            The URL to use to load the ReDoc JavaScript.

<span class="w"> </span>            It is normally set to a CDN URL.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=</span>
<span class="gd">-    &#39;https://cdn.jsdelivr.net/npm/redoc@next/bundles/redoc.standalone.js&#39;,</span>
<span class="gd">-    redoc_favicon_url: Annotated[str, Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = &quot;https://cdn.jsdelivr.net/npm/redoc@next/bundles/redoc.standalone.js&quot;,</span>
<span class="gi">+    redoc_favicon_url: Annotated[</span>
<span class="gi">+        str,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            The URL of the favicon to use. It is normally shown in the browser tab.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=&#39;https://fastapi.tiangolo.com/img/favicon.png&#39;, with_google_fonts:</span>
<span class="gd">-    Annotated[bool, Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = &quot;https://fastapi.tiangolo.com/img/favicon.png&quot;,</span>
<span class="gi">+    with_google_fonts: Annotated[</span>
<span class="gi">+        bool,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Load and use Google Fonts.
<span class="gd">-            &quot;&quot;&quot;)]=True</span>
<span class="gd">-    ) -&gt;HTMLResponse:</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = True,</span>
<span class="gi">+) -&gt; HTMLResponse:</span>
<span class="w"> </span>    &quot;&quot;&quot;
<span class="w"> </span>    Generate and return the HTML response that loads ReDoc for the alternative
<span class="w"> </span>    API docs (normally served at `/redoc`).
<span class="gu">@@ -113,13 +216,129 @@ def get_redoc_html(*, openapi_url: Annotated[str, Doc(</span>
<span class="w"> </span>    Read more about it in the
<span class="w"> </span>    [FastAPI docs for Custom Docs UI Static Assets (Self-Hosting)](https://fastapi.tiangolo.com/how-to/custom-docs-ui-assets/).
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    html = f&quot;&quot;&quot;</span>
<span class="gi">+    &lt;!DOCTYPE html&gt;</span>
<span class="gi">+    &lt;html&gt;</span>
<span class="gi">+    &lt;head&gt;</span>
<span class="gi">+    &lt;title&gt;{title}&lt;/title&gt;</span>
<span class="gi">+    &lt;!-- needed for adaptive design --&gt;</span>
<span class="gi">+    &lt;meta charset=&quot;utf-8&quot;/&gt;</span>
<span class="gi">+    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;</span>
<span class="gi">+    &quot;&quot;&quot;</span>
<span class="gi">+    if with_google_fonts:</span>
<span class="gi">+        html += &quot;&quot;&quot;</span>
<span class="gi">+    &lt;link href=&quot;https://fonts.googleapis.com/css?family=Montserrat:300,400,700|Roboto:300,400,700&quot; rel=&quot;stylesheet&quot;&gt;</span>
<span class="gi">+    &quot;&quot;&quot;</span>
<span class="gi">+    html += f&quot;&quot;&quot;</span>
<span class="gi">+    &lt;link rel=&quot;shortcut icon&quot; href=&quot;{redoc_favicon_url}&quot;&gt;</span>
<span class="gi">+    &lt;!--</span>
<span class="gi">+    ReDoc doesn&#39;t change outer page styles</span>
<span class="gi">+    --&gt;</span>
<span class="gi">+    &lt;style&gt;</span>
<span class="gi">+      body {{</span>
<span class="gi">+        margin: 0;</span>
<span class="gi">+        padding: 0;</span>
<span class="gi">+      }}</span>
<span class="gi">+    &lt;/style&gt;</span>
<span class="gi">+    &lt;/head&gt;</span>
<span class="gi">+    &lt;body&gt;</span>
<span class="gi">+    &lt;noscript&gt;</span>
<span class="gi">+        ReDoc requires Javascript to function. Please enable it to browse the documentation.</span>
<span class="gi">+    &lt;/noscript&gt;</span>
<span class="gi">+    &lt;redoc spec-url=&quot;{openapi_url}&quot;&gt;&lt;/redoc&gt;</span>
<span class="gi">+    &lt;script src=&quot;{redoc_js_url}&quot;&gt; &lt;/script&gt;</span>
<span class="gi">+    &lt;/body&gt;</span>
<span class="gi">+    &lt;/html&gt;</span>
<span class="gi">+    &quot;&quot;&quot;</span>
<span class="gi">+    return HTMLResponse(html)</span>


<span class="gd">-def get_swagger_ui_oauth2_redirect_html() -&gt;HTMLResponse:</span>
<span class="gi">+def get_swagger_ui_oauth2_redirect_html() -&gt; HTMLResponse:</span>
<span class="w"> </span>    &quot;&quot;&quot;
<span class="w"> </span>    Generate the HTML response with the OAuth2 redirection for Swagger UI.

<span class="w"> </span>    You normally don&#39;t need to use or change this.
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    # copied from https://github.com/swagger-api/swagger-ui/blob/v4.14.0/dist/oauth2-redirect.html</span>
<span class="gi">+    html = &quot;&quot;&quot;</span>
<span class="gi">+    &lt;!doctype html&gt;</span>
<span class="gi">+    &lt;html lang=&quot;en-US&quot;&gt;</span>
<span class="gi">+    &lt;head&gt;</span>
<span class="gi">+        &lt;title&gt;Swagger UI: OAuth2 Redirect&lt;/title&gt;</span>
<span class="gi">+    &lt;/head&gt;</span>
<span class="gi">+    &lt;body&gt;</span>
<span class="gi">+    &lt;script&gt;</span>
<span class="gi">+        &#39;use strict&#39;;</span>
<span class="gi">+        function run () {</span>
<span class="gi">+            var oauth2 = window.opener.swaggerUIRedirectOauth2;</span>
<span class="gi">+            var sentState = oauth2.state;</span>
<span class="gi">+            var redirectUrl = oauth2.redirectUrl;</span>
<span class="gi">+            var isValid, qp, arr;</span>
<span class="gi">+</span>
<span class="gi">+            if (/code|token|error/.test(window.location.hash)) {</span>
<span class="gi">+                qp = window.location.hash.substring(1).replace(&#39;?&#39;, &#39;&amp;&#39;);</span>
<span class="gi">+            } else {</span>
<span class="gi">+                qp = location.search.substring(1);</span>
<span class="gi">+            }</span>
<span class="gi">+</span>
<span class="gi">+            arr = qp.split(&quot;&amp;&quot;);</span>
<span class="gi">+            arr.forEach(function (v,i,_arr) { _arr[i] = &#39;&quot;&#39; + v.replace(&#39;=&#39;, &#39;&quot;:&quot;&#39;) + &#39;&quot;&#39;;});</span>
<span class="gi">+            qp = qp ? JSON.parse(&#39;{&#39; + arr.join() + &#39;}&#39;,</span>
<span class="gi">+                    function (key, value) {</span>
<span class="gi">+                        return key === &quot;&quot; ? value : decodeURIComponent(value);</span>
<span class="gi">+                    }</span>
<span class="gi">+            ) : {};</span>
<span class="gi">+</span>
<span class="gi">+            isValid = qp.state === sentState;</span>
<span class="gi">+</span>
<span class="gi">+            if ((</span>
<span class="gi">+              oauth2.auth.schema.get(&quot;flow&quot;) === &quot;accessCode&quot; ||</span>
<span class="gi">+              oauth2.auth.schema.get(&quot;flow&quot;) === &quot;authorizationCode&quot; ||</span>
<span class="gi">+              oauth2.auth.schema.get(&quot;flow&quot;) === &quot;authorization_code&quot;</span>
<span class="gi">+            ) &amp;&amp; !oauth2.auth.code) {</span>
<span class="gi">+                if (!isValid) {</span>
<span class="gi">+                    oauth2.errCb({</span>
<span class="gi">+                        authId: oauth2.auth.name,</span>
<span class="gi">+                        source: &quot;auth&quot;,</span>
<span class="gi">+                        level: &quot;warning&quot;,</span>
<span class="gi">+                        message: &quot;Authorization may be unsafe, passed state was changed in server. The passed state wasn&#39;t returned from auth server.&quot;</span>
<span class="gi">+                    });</span>
<span class="gi">+                }</span>
<span class="gi">+</span>
<span class="gi">+                if (qp.code) {</span>
<span class="gi">+                    delete oauth2.state;</span>
<span class="gi">+                    oauth2.auth.code = qp.code;</span>
<span class="gi">+                    oauth2.callback({auth: oauth2.auth, redirectUrl: redirectUrl});</span>
<span class="gi">+                } else {</span>
<span class="gi">+                    let oauthErrorMsg;</span>
<span class="gi">+                    if (qp.error) {</span>
<span class="gi">+                        oauthErrorMsg = &quot;[&quot;+qp.error+&quot;]: &quot; +</span>
<span class="gi">+                            (qp.error_description ? qp.error_description+ &quot;. &quot; : &quot;no accessCode received from the server. &quot;) +</span>
<span class="gi">+                            (qp.error_uri ? &quot;More info: &quot;+qp.error_uri : &quot;&quot;);</span>
<span class="gi">+                    }</span>
<span class="gi">+</span>
<span class="gi">+                    oauth2.errCb({</span>
<span class="gi">+                        authId: oauth2.auth.name,</span>
<span class="gi">+                        source: &quot;auth&quot;,</span>
<span class="gi">+                        level: &quot;error&quot;,</span>
<span class="gi">+                        message: oauthErrorMsg || &quot;[Authorization failed]: no accessCode received from the server.&quot;</span>
<span class="gi">+                    });</span>
<span class="gi">+                }</span>
<span class="gi">+            } else {</span>
<span class="gi">+                oauth2.callback({auth: oauth2.auth, token: qp, isValid: isValid, redirectUrl: redirectUrl});</span>
<span class="gi">+            }</span>
<span class="gi">+            window.close();</span>
<span class="gi">+        }</span>
<span class="gi">+</span>
<span class="gi">+        if (document.readyState !== &#39;loading&#39;) {</span>
<span class="gi">+            run();</span>
<span class="gi">+        } else {</span>
<span class="gi">+            document.addEventListener(&#39;DOMContentLoaded&#39;, function () {</span>
<span class="gi">+                run();</span>
<span class="gi">+            });</span>
<span class="gi">+        }</span>
<span class="gi">+    &lt;/script&gt;</span>
<span class="gi">+    &lt;/body&gt;</span>
<span class="gi">+    &lt;/html&gt;</span>
<span class="gi">+        &quot;&quot;&quot;</span>
<span class="gi">+    return HTMLResponse(content=html)</span>
<span class="gh">diff --git a/fastapi/openapi/models.py b/fastapi/openapi/models.py</span>
<span class="gh">index 33fbecd4..ed07b40f 100644</span>
<span class="gd">--- a/fastapi/openapi/models.py</span>
<span class="gi">+++ b/fastapi/openapi/models.py</span>
<span class="gu">@@ -1,42 +1,68 @@</span>
<span class="w"> </span>from enum import Enum
<span class="w"> </span>from typing import Any, Callable, Dict, Iterable, List, Optional, Set, Type, Union
<span class="gd">-from fastapi._compat import PYDANTIC_V2, CoreSchema, GetJsonSchemaHandler, JsonSchemaValue, _model_rebuild, with_info_plain_validator_function</span>
<span class="gi">+</span>
<span class="gi">+from fastapi._compat import (</span>
<span class="gi">+    PYDANTIC_V2,</span>
<span class="gi">+    CoreSchema,</span>
<span class="gi">+    GetJsonSchemaHandler,</span>
<span class="gi">+    JsonSchemaValue,</span>
<span class="gi">+    _model_rebuild,</span>
<span class="gi">+    with_info_plain_validator_function,</span>
<span class="gi">+)</span>
<span class="w"> </span>from fastapi.logger import logger
<span class="w"> </span>from pydantic import AnyUrl, BaseModel, Field
<span class="w"> </span>from typing_extensions import Annotated, Literal, TypedDict
<span class="w"> </span>from typing_extensions import deprecated as typing_deprecated
<span class="gi">+</span>
<span class="w"> </span>try:
<span class="w"> </span>    import email_validator
<span class="gd">-    assert email_validator</span>
<span class="gi">+</span>
<span class="gi">+    assert email_validator  # make autoflake ignore the unused import</span>
<span class="w"> </span>    from pydantic import EmailStr
<span class="gd">-except ImportError:</span>
<span class="gi">+except ImportError:  # pragma: no cover</span>

<span class="gi">+    class EmailStr(str):  # type: ignore</span>
<span class="gi">+        @classmethod</span>
<span class="gi">+        def __get_validators__(cls) -&gt; Iterable[Callable[..., Any]]:</span>
<span class="gi">+            yield cls.validate</span>

<span class="gd">-    class EmailStr(str):</span>
<span class="gi">+        @classmethod</span>
<span class="gi">+        def validate(cls, v: Any) -&gt; str:</span>
<span class="gi">+            logger.warning(</span>
<span class="gi">+                &quot;email-validator not installed, email fields will be treated as str.\n&quot;</span>
<span class="gi">+                &quot;To install, run: pip install email-validator&quot;</span>
<span class="gi">+            )</span>
<span class="gi">+            return str(v)</span>

<span class="w"> </span>        @classmethod
<span class="gd">-        def __get_validators__(cls) -&gt;Iterable[Callable[..., Any]]:</span>
<span class="gd">-            yield cls.validate</span>
<span class="gi">+        def _validate(cls, __input_value: Any, _: Any) -&gt; str:</span>
<span class="gi">+            logger.warning(</span>
<span class="gi">+                &quot;email-validator not installed, email fields will be treated as str.\n&quot;</span>
<span class="gi">+                &quot;To install, run: pip install email-validator&quot;</span>
<span class="gi">+            )</span>
<span class="gi">+            return str(__input_value)</span>

<span class="w"> </span>        @classmethod
<span class="gd">-        def __get_pydantic_json_schema__(cls, core_schema: CoreSchema,</span>
<span class="gd">-            handler: GetJsonSchemaHandler) -&gt;JsonSchemaValue:</span>
<span class="gd">-            return {&#39;type&#39;: &#39;string&#39;, &#39;format&#39;: &#39;email&#39;}</span>
<span class="gi">+        def __get_pydantic_json_schema__(</span>
<span class="gi">+            cls, core_schema: CoreSchema, handler: GetJsonSchemaHandler</span>
<span class="gi">+        ) -&gt; JsonSchemaValue:</span>
<span class="gi">+            return {&quot;type&quot;: &quot;string&quot;, &quot;format&quot;: &quot;email&quot;}</span>

<span class="w"> </span>        @classmethod
<span class="gd">-        def __get_pydantic_core_schema__(cls, source: Type[Any], handler:</span>
<span class="gd">-            Callable[[Any], CoreSchema]) -&gt;CoreSchema:</span>
<span class="gi">+        def __get_pydantic_core_schema__(</span>
<span class="gi">+            cls, source: Type[Any], handler: Callable[[Any], CoreSchema]</span>
<span class="gi">+        ) -&gt; CoreSchema:</span>
<span class="w"> </span>            return with_info_plain_validator_function(cls._validate)


<span class="w"> </span>class BaseModelWithConfig(BaseModel):
<span class="w"> </span>    if PYDANTIC_V2:
<span class="gd">-        model_config = {&#39;extra&#39;: &#39;allow&#39;}</span>
<span class="gd">-    else:</span>
<span class="gi">+        model_config = {&quot;extra&quot;: &quot;allow&quot;}</span>

<span class="gi">+    else:</span>

<span class="w"> </span>        class Config:
<span class="gd">-            extra = &#39;allow&#39;</span>
<span class="gi">+            extra = &quot;allow&quot;</span>


<span class="w"> </span>class Contact(BaseModelWithConfig):
<span class="gu">@@ -74,7 +100,7 @@ class Server(BaseModelWithConfig):</span>


<span class="w"> </span>class Reference(BaseModel):
<span class="gd">-    ref: str = Field(alias=&#39;$ref&#39;)</span>
<span class="gi">+    ref: str = Field(alias=&quot;$ref&quot;)</span>


<span class="w"> </span>class Discriminator(BaseModel):
<span class="gu">@@ -96,33 +122,41 @@ class ExternalDocumentation(BaseModelWithConfig):</span>


<span class="w"> </span>class Schema(BaseModelWithConfig):
<span class="gd">-    schema_: Optional[str] = Field(default=None, alias=&#39;$schema&#39;)</span>
<span class="gd">-    vocabulary: Optional[str] = Field(default=None, alias=&#39;$vocabulary&#39;)</span>
<span class="gd">-    id: Optional[str] = Field(default=None, alias=&#39;$id&#39;)</span>
<span class="gd">-    anchor: Optional[str] = Field(default=None, alias=&#39;$anchor&#39;)</span>
<span class="gd">-    dynamicAnchor: Optional[str] = Field(default=None, alias=&#39;$dynamicAnchor&#39;)</span>
<span class="gd">-    ref: Optional[str] = Field(default=None, alias=&#39;$ref&#39;)</span>
<span class="gd">-    dynamicRef: Optional[str] = Field(default=None, alias=&#39;$dynamicRef&#39;)</span>
<span class="gd">-    defs: Optional[Dict[str, &#39;SchemaOrBool&#39;]] = Field(default=None, alias=</span>
<span class="gd">-        &#39;$defs&#39;)</span>
<span class="gd">-    comment: Optional[str] = Field(default=None, alias=&#39;$comment&#39;)</span>
<span class="gd">-    allOf: Optional[List[&#39;SchemaOrBool&#39;]] = None</span>
<span class="gd">-    anyOf: Optional[List[&#39;SchemaOrBool&#39;]] = None</span>
<span class="gd">-    oneOf: Optional[List[&#39;SchemaOrBool&#39;]] = None</span>
<span class="gd">-    not_: Optional[&#39;SchemaOrBool&#39;] = Field(default=None, alias=&#39;not&#39;)</span>
<span class="gd">-    if_: Optional[&#39;SchemaOrBool&#39;] = Field(default=None, alias=&#39;if&#39;)</span>
<span class="gd">-    then: Optional[&#39;SchemaOrBool&#39;] = None</span>
<span class="gd">-    else_: Optional[&#39;SchemaOrBool&#39;] = Field(default=None, alias=&#39;else&#39;)</span>
<span class="gd">-    dependentSchemas: Optional[Dict[str, &#39;SchemaOrBool&#39;]] = None</span>
<span class="gd">-    prefixItems: Optional[List[&#39;SchemaOrBool&#39;]] = None</span>
<span class="gd">-    items: Optional[Union[&#39;SchemaOrBool&#39;, List[&#39;SchemaOrBool&#39;]]] = None</span>
<span class="gd">-    contains: Optional[&#39;SchemaOrBool&#39;] = None</span>
<span class="gd">-    properties: Optional[Dict[str, &#39;SchemaOrBool&#39;]] = None</span>
<span class="gd">-    patternProperties: Optional[Dict[str, &#39;SchemaOrBool&#39;]] = None</span>
<span class="gd">-    additionalProperties: Optional[&#39;SchemaOrBool&#39;] = None</span>
<span class="gd">-    propertyNames: Optional[&#39;SchemaOrBool&#39;] = None</span>
<span class="gd">-    unevaluatedItems: Optional[&#39;SchemaOrBool&#39;] = None</span>
<span class="gd">-    unevaluatedProperties: Optional[&#39;SchemaOrBool&#39;] = None</span>
<span class="gi">+    # Ref: JSON Schema 2020-12: https://json-schema.org/draft/2020-12/json-schema-core.html#name-the-json-schema-core-vocabu</span>
<span class="gi">+    # Core Vocabulary</span>
<span class="gi">+    schema_: Optional[str] = Field(default=None, alias=&quot;$schema&quot;)</span>
<span class="gi">+    vocabulary: Optional[str] = Field(default=None, alias=&quot;$vocabulary&quot;)</span>
<span class="gi">+    id: Optional[str] = Field(default=None, alias=&quot;$id&quot;)</span>
<span class="gi">+    anchor: Optional[str] = Field(default=None, alias=&quot;$anchor&quot;)</span>
<span class="gi">+    dynamicAnchor: Optional[str] = Field(default=None, alias=&quot;$dynamicAnchor&quot;)</span>
<span class="gi">+    ref: Optional[str] = Field(default=None, alias=&quot;$ref&quot;)</span>
<span class="gi">+    dynamicRef: Optional[str] = Field(default=None, alias=&quot;$dynamicRef&quot;)</span>
<span class="gi">+    defs: Optional[Dict[str, &quot;SchemaOrBool&quot;]] = Field(default=None, alias=&quot;$defs&quot;)</span>
<span class="gi">+    comment: Optional[str] = Field(default=None, alias=&quot;$comment&quot;)</span>
<span class="gi">+    # Ref: JSON Schema 2020-12: https://json-schema.org/draft/2020-12/json-schema-core.html#name-a-vocabulary-for-applying-s</span>
<span class="gi">+    # A Vocabulary for Applying Subschemas</span>
<span class="gi">+    allOf: Optional[List[&quot;SchemaOrBool&quot;]] = None</span>
<span class="gi">+    anyOf: Optional[List[&quot;SchemaOrBool&quot;]] = None</span>
<span class="gi">+    oneOf: Optional[List[&quot;SchemaOrBool&quot;]] = None</span>
<span class="gi">+    not_: Optional[&quot;SchemaOrBool&quot;] = Field(default=None, alias=&quot;not&quot;)</span>
<span class="gi">+    if_: Optional[&quot;SchemaOrBool&quot;] = Field(default=None, alias=&quot;if&quot;)</span>
<span class="gi">+    then: Optional[&quot;SchemaOrBool&quot;] = None</span>
<span class="gi">+    else_: Optional[&quot;SchemaOrBool&quot;] = Field(default=None, alias=&quot;else&quot;)</span>
<span class="gi">+    dependentSchemas: Optional[Dict[str, &quot;SchemaOrBool&quot;]] = None</span>
<span class="gi">+    prefixItems: Optional[List[&quot;SchemaOrBool&quot;]] = None</span>
<span class="gi">+    # TODO: uncomment and remove below when deprecating Pydantic v1</span>
<span class="gi">+    # It generales a list of schemas for tuples, before prefixItems was available</span>
<span class="gi">+    # items: Optional[&quot;SchemaOrBool&quot;] = None</span>
<span class="gi">+    items: Optional[Union[&quot;SchemaOrBool&quot;, List[&quot;SchemaOrBool&quot;]]] = None</span>
<span class="gi">+    contains: Optional[&quot;SchemaOrBool&quot;] = None</span>
<span class="gi">+    properties: Optional[Dict[str, &quot;SchemaOrBool&quot;]] = None</span>
<span class="gi">+    patternProperties: Optional[Dict[str, &quot;SchemaOrBool&quot;]] = None</span>
<span class="gi">+    additionalProperties: Optional[&quot;SchemaOrBool&quot;] = None</span>
<span class="gi">+    propertyNames: Optional[&quot;SchemaOrBool&quot;] = None</span>
<span class="gi">+    unevaluatedItems: Optional[&quot;SchemaOrBool&quot;] = None</span>
<span class="gi">+    unevaluatedProperties: Optional[&quot;SchemaOrBool&quot;] = None</span>
<span class="gi">+    # Ref: JSON Schema Validation 2020-12: https://json-schema.org/draft/2020-12/json-schema-validation.html#name-a-vocabulary-for-structural</span>
<span class="gi">+    # A Vocabulary for Structural Validation</span>
<span class="w"> </span>    type: Optional[str] = None
<span class="w"> </span>    enum: Optional[List[Any]] = None
<span class="w"> </span>    const: Optional[Any] = None
<span class="gu">@@ -143,10 +177,16 @@ class Schema(BaseModelWithConfig):</span>
<span class="w"> </span>    minProperties: Optional[int] = Field(default=None, ge=0)
<span class="w"> </span>    required: Optional[List[str]] = None
<span class="w"> </span>    dependentRequired: Optional[Dict[str, Set[str]]] = None
<span class="gi">+    # Ref: JSON Schema Validation 2020-12: https://json-schema.org/draft/2020-12/json-schema-validation.html#name-vocabularies-for-semantic-c</span>
<span class="gi">+    # Vocabularies for Semantic Content With &quot;format&quot;</span>
<span class="w"> </span>    format: Optional[str] = None
<span class="gi">+    # Ref: JSON Schema Validation 2020-12: https://json-schema.org/draft/2020-12/json-schema-validation.html#name-a-vocabulary-for-the-conten</span>
<span class="gi">+    # A Vocabulary for the Contents of String-Encoded Data</span>
<span class="w"> </span>    contentEncoding: Optional[str] = None
<span class="w"> </span>    contentMediaType: Optional[str] = None
<span class="gd">-    contentSchema: Optional[&#39;SchemaOrBool&#39;] = None</span>
<span class="gi">+    contentSchema: Optional[&quot;SchemaOrBool&quot;] = None</span>
<span class="gi">+    # Ref: JSON Schema Validation 2020-12: https://json-schema.org/draft/2020-12/json-schema-validation.html#name-a-vocabulary-for-basic-meta</span>
<span class="gi">+    # A Vocabulary for Basic Meta-Data Annotations</span>
<span class="w"> </span>    title: Optional[str] = None
<span class="w"> </span>    description: Optional[str] = None
<span class="w"> </span>    default: Optional[Any] = None
<span class="gu">@@ -154,49 +194,57 @@ class Schema(BaseModelWithConfig):</span>
<span class="w"> </span>    readOnly: Optional[bool] = None
<span class="w"> </span>    writeOnly: Optional[bool] = None
<span class="w"> </span>    examples: Optional[List[Any]] = None
<span class="gi">+    # Ref: OpenAPI 3.1.0: https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.1.0.md#schema-object</span>
<span class="gi">+    # Schema Object</span>
<span class="w"> </span>    discriminator: Optional[Discriminator] = None
<span class="w"> </span>    xml: Optional[XML] = None
<span class="w"> </span>    externalDocs: Optional[ExternalDocumentation] = None
<span class="gd">-    example: Annotated[Optional[Any], typing_deprecated(</span>
<span class="gd">-        &#39;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, although still supported. Use examples instead.&#39;</span>
<span class="gd">-        )] = None</span>
<span class="gi">+    example: Annotated[</span>
<span class="gi">+        Optional[Any],</span>
<span class="gi">+        typing_deprecated(</span>
<span class="gi">+            &quot;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, &quot;</span>
<span class="gi">+            &quot;although still supported. Use examples instead.&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None</span>


<span class="gi">+# Ref: https://json-schema.org/draft/2020-12/json-schema-core.html#name-json-schema-documents</span>
<span class="gi">+# A JSON Schema MUST be an object or a boolean.</span>
<span class="w"> </span>SchemaOrBool = Union[Schema, bool]


<span class="gd">-class Example(TypedDict, total=(False)):</span>
<span class="gi">+class Example(TypedDict, total=False):</span>
<span class="w"> </span>    summary: Optional[str]
<span class="w"> </span>    description: Optional[str]
<span class="w"> </span>    value: Optional[Any]
<span class="w"> </span>    externalValue: Optional[AnyUrl]
<span class="gd">-    if PYDANTIC_V2:</span>
<span class="gd">-        __pydantic_config__ = {&#39;extra&#39;: &#39;allow&#39;}</span>
<span class="gd">-    else:</span>

<span class="gi">+    if PYDANTIC_V2:  # type: ignore [misc]</span>
<span class="gi">+        __pydantic_config__ = {&quot;extra&quot;: &quot;allow&quot;}</span>
<span class="gi">+</span>
<span class="gi">+    else:</span>

<span class="w"> </span>        class Config:
<span class="gd">-            extra = &#39;allow&#39;</span>
<span class="gi">+            extra = &quot;allow&quot;</span>


<span class="w"> </span>class ParameterInType(Enum):
<span class="gd">-    query = &#39;query&#39;</span>
<span class="gd">-    header = &#39;header&#39;</span>
<span class="gd">-    path = &#39;path&#39;</span>
<span class="gd">-    cookie = &#39;cookie&#39;</span>
<span class="gi">+    query = &quot;query&quot;</span>
<span class="gi">+    header = &quot;header&quot;</span>
<span class="gi">+    path = &quot;path&quot;</span>
<span class="gi">+    cookie = &quot;cookie&quot;</span>


<span class="w"> </span>class Encoding(BaseModelWithConfig):
<span class="w"> </span>    contentType: Optional[str] = None
<span class="gd">-    headers: Optional[Dict[str, Union[&#39;Header&#39;, Reference]]] = None</span>
<span class="gi">+    headers: Optional[Dict[str, Union[&quot;Header&quot;, Reference]]] = None</span>
<span class="w"> </span>    style: Optional[str] = None
<span class="w"> </span>    explode: Optional[bool] = None
<span class="w"> </span>    allowReserved: Optional[bool] = None


<span class="w"> </span>class MediaType(BaseModelWithConfig):
<span class="gd">-    schema_: Optional[Union[Schema, Reference]] = Field(default=None, alias</span>
<span class="gd">-        =&#39;schema&#39;)</span>
<span class="gi">+    schema_: Optional[Union[Schema, Reference]] = Field(default=None, alias=&quot;schema&quot;)</span>
<span class="w"> </span>    example: Optional[Any] = None
<span class="w"> </span>    examples: Optional[Dict[str, Union[Example, Reference]]] = None
<span class="w"> </span>    encoding: Optional[Dict[str, Encoding]] = None
<span class="gu">@@ -206,19 +254,20 @@ class ParameterBase(BaseModelWithConfig):</span>
<span class="w"> </span>    description: Optional[str] = None
<span class="w"> </span>    required: Optional[bool] = None
<span class="w"> </span>    deprecated: Optional[bool] = None
<span class="gi">+    # Serialization rules for simple scenarios</span>
<span class="w"> </span>    style: Optional[str] = None
<span class="w"> </span>    explode: Optional[bool] = None
<span class="w"> </span>    allowReserved: Optional[bool] = None
<span class="gd">-    schema_: Optional[Union[Schema, Reference]] = Field(default=None, alias</span>
<span class="gd">-        =&#39;schema&#39;)</span>
<span class="gi">+    schema_: Optional[Union[Schema, Reference]] = Field(default=None, alias=&quot;schema&quot;)</span>
<span class="w"> </span>    example: Optional[Any] = None
<span class="w"> </span>    examples: Optional[Dict[str, Union[Example, Reference]]] = None
<span class="gi">+    # Serialization rules for more complex scenarios</span>
<span class="w"> </span>    content: Optional[Dict[str, MediaType]] = None


<span class="w"> </span>class Parameter(ParameterBase):
<span class="w"> </span>    name: str
<span class="gd">-    in_: ParameterInType = Field(alias=&#39;in&#39;)</span>
<span class="gi">+    in_: ParameterInType = Field(alias=&quot;in&quot;)</span>


<span class="w"> </span>class Header(ParameterBase):
<span class="gu">@@ -255,16 +304,16 @@ class Operation(BaseModelWithConfig):</span>
<span class="w"> </span>    operationId: Optional[str] = None
<span class="w"> </span>    parameters: Optional[List[Union[Parameter, Reference]]] = None
<span class="w"> </span>    requestBody: Optional[Union[RequestBody, Reference]] = None
<span class="gi">+    # Using Any for Specification Extensions</span>
<span class="w"> </span>    responses: Optional[Dict[str, Union[Response, Any]]] = None
<span class="gd">-    callbacks: Optional[Dict[str, Union[Dict[str, &#39;PathItem&#39;], Reference]]</span>
<span class="gd">-        ] = None</span>
<span class="gi">+    callbacks: Optional[Dict[str, Union[Dict[str, &quot;PathItem&quot;], Reference]]] = None</span>
<span class="w"> </span>    deprecated: Optional[bool] = None
<span class="w"> </span>    security: Optional[List[Dict[str, List[str]]]] = None
<span class="w"> </span>    servers: Optional[List[Server]] = None


<span class="w"> </span>class PathItem(BaseModelWithConfig):
<span class="gd">-    ref: Optional[str] = Field(default=None, alias=&#39;$ref&#39;)</span>
<span class="gi">+    ref: Optional[str] = Field(default=None, alias=&quot;$ref&quot;)</span>
<span class="w"> </span>    summary: Optional[str] = None
<span class="w"> </span>    description: Optional[str] = None
<span class="w"> </span>    get: Optional[Operation] = None
<span class="gu">@@ -280,38 +329,36 @@ class PathItem(BaseModelWithConfig):</span>


<span class="w"> </span>class SecuritySchemeType(Enum):
<span class="gd">-    apiKey = &#39;apiKey&#39;</span>
<span class="gd">-    http = &#39;http&#39;</span>
<span class="gd">-    oauth2 = &#39;oauth2&#39;</span>
<span class="gd">-    openIdConnect = &#39;openIdConnect&#39;</span>
<span class="gi">+    apiKey = &quot;apiKey&quot;</span>
<span class="gi">+    http = &quot;http&quot;</span>
<span class="gi">+    oauth2 = &quot;oauth2&quot;</span>
<span class="gi">+    openIdConnect = &quot;openIdConnect&quot;</span>


<span class="w"> </span>class SecurityBase(BaseModelWithConfig):
<span class="gd">-    type_: SecuritySchemeType = Field(alias=&#39;type&#39;)</span>
<span class="gi">+    type_: SecuritySchemeType = Field(alias=&quot;type&quot;)</span>
<span class="w"> </span>    description: Optional[str] = None


<span class="w"> </span>class APIKeyIn(Enum):
<span class="gd">-    query = &#39;query&#39;</span>
<span class="gd">-    header = &#39;header&#39;</span>
<span class="gd">-    cookie = &#39;cookie&#39;</span>
<span class="gi">+    query = &quot;query&quot;</span>
<span class="gi">+    header = &quot;header&quot;</span>
<span class="gi">+    cookie = &quot;cookie&quot;</span>


<span class="w"> </span>class APIKey(SecurityBase):
<span class="gd">-    type_: SecuritySchemeType = Field(default=SecuritySchemeType.apiKey,</span>
<span class="gd">-        alias=&#39;type&#39;)</span>
<span class="gd">-    in_: APIKeyIn = Field(alias=&#39;in&#39;)</span>
<span class="gi">+    type_: SecuritySchemeType = Field(default=SecuritySchemeType.apiKey, alias=&quot;type&quot;)</span>
<span class="gi">+    in_: APIKeyIn = Field(alias=&quot;in&quot;)</span>
<span class="w"> </span>    name: str


<span class="w"> </span>class HTTPBase(SecurityBase):
<span class="gd">-    type_: SecuritySchemeType = Field(default=SecuritySchemeType.http,</span>
<span class="gd">-        alias=&#39;type&#39;)</span>
<span class="gi">+    type_: SecuritySchemeType = Field(default=SecuritySchemeType.http, alias=&quot;type&quot;)</span>
<span class="w"> </span>    scheme: str


<span class="w"> </span>class HTTPBearer(HTTPBase):
<span class="gd">-    scheme: Literal[&#39;bearer&#39;] = &#39;bearer&#39;</span>
<span class="gi">+    scheme: Literal[&quot;bearer&quot;] = &quot;bearer&quot;</span>
<span class="w"> </span>    bearerFormat: Optional[str] = None


<span class="gu">@@ -345,14 +392,14 @@ class OAuthFlows(BaseModelWithConfig):</span>


<span class="w"> </span>class OAuth2(SecurityBase):
<span class="gd">-    type_: SecuritySchemeType = Field(default=SecuritySchemeType.oauth2,</span>
<span class="gd">-        alias=&#39;type&#39;)</span>
<span class="gi">+    type_: SecuritySchemeType = Field(default=SecuritySchemeType.oauth2, alias=&quot;type&quot;)</span>
<span class="w"> </span>    flows: OAuthFlows


<span class="w"> </span>class OpenIdConnect(SecurityBase):
<span class="gd">-    type_: SecuritySchemeType = Field(default=SecuritySchemeType.</span>
<span class="gd">-        openIdConnect, alias=&#39;type&#39;)</span>
<span class="gi">+    type_: SecuritySchemeType = Field(</span>
<span class="gi">+        default=SecuritySchemeType.openIdConnect, alias=&quot;type&quot;</span>
<span class="gi">+    )</span>
<span class="w"> </span>    openIdConnectUrl: str


<span class="gu">@@ -366,11 +413,10 @@ class Components(BaseModelWithConfig):</span>
<span class="w"> </span>    examples: Optional[Dict[str, Union[Example, Reference]]] = None
<span class="w"> </span>    requestBodies: Optional[Dict[str, Union[RequestBody, Reference]]] = None
<span class="w"> </span>    headers: Optional[Dict[str, Union[Header, Reference]]] = None
<span class="gd">-    securitySchemes: Optional[Dict[str, Union[SecurityScheme, Reference]]</span>
<span class="gd">-        ] = None</span>
<span class="gi">+    securitySchemes: Optional[Dict[str, Union[SecurityScheme, Reference]]] = None</span>
<span class="w"> </span>    links: Optional[Dict[str, Union[Link, Reference]]] = None
<span class="gd">-    callbacks: Optional[Dict[str, Union[Dict[str, PathItem], Reference, Any]]</span>
<span class="gd">-        ] = None</span>
<span class="gi">+    # Using Any for Specification Extensions</span>
<span class="gi">+    callbacks: Optional[Dict[str, Union[Dict[str, PathItem], Reference, Any]]] = None</span>
<span class="w"> </span>    pathItems: Optional[Dict[str, Union[PathItem, Reference]]] = None


<span class="gu">@@ -385,6 +431,7 @@ class OpenAPI(BaseModelWithConfig):</span>
<span class="w"> </span>    info: Info
<span class="w"> </span>    jsonSchemaDialect: Optional[str] = None
<span class="w"> </span>    servers: Optional[List[Server]] = None
<span class="gi">+    # Using Any for Specification Extensions</span>
<span class="w"> </span>    paths: Optional[Dict[str, Union[PathItem, Any]]] = None
<span class="w"> </span>    webhooks: Optional[Dict[str, Union[PathItem, Reference]]] = None
<span class="w"> </span>    components: Optional[Components] = None
<span class="gh">diff --git a/fastapi/openapi/utils.py b/fastapi/openapi/utils.py</span>
<span class="gh">index 8f105dce..79ad9f83 100644</span>
<span class="gd">--- a/fastapi/openapi/utils.py</span>
<span class="gi">+++ b/fastapi/openapi/utils.py</span>
<span class="gu">@@ -2,8 +2,18 @@ import http.client</span>
<span class="w"> </span>import inspect
<span class="w"> </span>import warnings
<span class="w"> </span>from typing import Any, Dict, List, Optional, Sequence, Set, Tuple, Type, Union, cast
<span class="gi">+</span>
<span class="w"> </span>from fastapi import routing
<span class="gd">-from fastapi._compat import GenerateJsonSchema, JsonSchemaValue, ModelField, Undefined, get_compat_model_name_map, get_definitions, get_schema_from_model_field, lenient_issubclass</span>
<span class="gi">+from fastapi._compat import (</span>
<span class="gi">+    GenerateJsonSchema,</span>
<span class="gi">+    JsonSchemaValue,</span>
<span class="gi">+    ModelField,</span>
<span class="gi">+    Undefined,</span>
<span class="gi">+    get_compat_model_name_map,</span>
<span class="gi">+    get_definitions,</span>
<span class="gi">+    get_schema_from_model_field,</span>
<span class="gi">+    lenient_issubclass,</span>
<span class="gi">+)</span>
<span class="w"> </span>from fastapi.datastructures import DefaultPlaceholder
<span class="w"> </span>from fastapi.dependencies.models import Dependant
<span class="w"> </span>from fastapi.dependencies.utils import get_flat_dependant, get_flat_params
<span class="gu">@@ -13,19 +23,508 @@ from fastapi.openapi.models import OpenAPI</span>
<span class="w"> </span>from fastapi.params import Body, Param
<span class="w"> </span>from fastapi.responses import Response
<span class="w"> </span>from fastapi.types import ModelNameMap
<span class="gd">-from fastapi.utils import deep_dict_update, generate_operation_id_for_path, is_body_allowed_for_status_code</span>
<span class="gi">+from fastapi.utils import (</span>
<span class="gi">+    deep_dict_update,</span>
<span class="gi">+    generate_operation_id_for_path,</span>
<span class="gi">+    is_body_allowed_for_status_code,</span>
<span class="gi">+)</span>
<span class="w"> </span>from starlette.responses import JSONResponse
<span class="w"> </span>from starlette.routing import BaseRoute
<span class="w"> </span>from starlette.status import HTTP_422_UNPROCESSABLE_ENTITY
<span class="w"> </span>from typing_extensions import Literal
<span class="gd">-validation_error_definition = {&#39;title&#39;: &#39;ValidationError&#39;, &#39;type&#39;: &#39;object&#39;,</span>
<span class="gd">-    &#39;properties&#39;: {&#39;loc&#39;: {&#39;title&#39;: &#39;Location&#39;, &#39;type&#39;: &#39;array&#39;, &#39;items&#39;: {</span>
<span class="gd">-    &#39;anyOf&#39;: [{&#39;type&#39;: &#39;string&#39;}, {&#39;type&#39;: &#39;integer&#39;}]}}, &#39;msg&#39;: {&#39;title&#39;:</span>
<span class="gd">-    &#39;Message&#39;, &#39;type&#39;: &#39;string&#39;}, &#39;type&#39;: {&#39;title&#39;: &#39;Error Type&#39;, &#39;type&#39;:</span>
<span class="gd">-    &#39;string&#39;}}, &#39;required&#39;: [&#39;loc&#39;, &#39;msg&#39;, &#39;type&#39;]}</span>
<span class="gd">-validation_error_response_definition = {&#39;title&#39;: &#39;HTTPValidationError&#39;,</span>
<span class="gd">-    &#39;type&#39;: &#39;object&#39;, &#39;properties&#39;: {&#39;detail&#39;: {&#39;title&#39;: &#39;Detail&#39;, &#39;type&#39;:</span>
<span class="gd">-    &#39;array&#39;, &#39;items&#39;: {&#39;$ref&#39;: REF_PREFIX + &#39;ValidationError&#39;}}}}</span>
<span class="gd">-status_code_ranges: Dict[str, str] = {&#39;1XX&#39;: &#39;Information&#39;, &#39;2XX&#39;:</span>
<span class="gd">-    &#39;Success&#39;, &#39;3XX&#39;: &#39;Redirection&#39;, &#39;4XX&#39;: &#39;Client Error&#39;, &#39;5XX&#39;:</span>
<span class="gd">-    &#39;Server Error&#39;, &#39;DEFAULT&#39;: &#39;Default Response&#39;}</span>
<span class="gi">+</span>
<span class="gi">+validation_error_definition = {</span>
<span class="gi">+    &quot;title&quot;: &quot;ValidationError&quot;,</span>
<span class="gi">+    &quot;type&quot;: &quot;object&quot;,</span>
<span class="gi">+    &quot;properties&quot;: {</span>
<span class="gi">+        &quot;loc&quot;: {</span>
<span class="gi">+            &quot;title&quot;: &quot;Location&quot;,</span>
<span class="gi">+            &quot;type&quot;: &quot;array&quot;,</span>
<span class="gi">+            &quot;items&quot;: {&quot;anyOf&quot;: [{&quot;type&quot;: &quot;string&quot;}, {&quot;type&quot;: &quot;integer&quot;}]},</span>
<span class="gi">+        },</span>
<span class="gi">+        &quot;msg&quot;: {&quot;title&quot;: &quot;Message&quot;, &quot;type&quot;: &quot;string&quot;},</span>
<span class="gi">+        &quot;type&quot;: {&quot;title&quot;: &quot;Error Type&quot;, &quot;type&quot;: &quot;string&quot;},</span>
<span class="gi">+    },</span>
<span class="gi">+    &quot;required&quot;: [&quot;loc&quot;, &quot;msg&quot;, &quot;type&quot;],</span>
<span class="gi">+}</span>
<span class="gi">+</span>
<span class="gi">+validation_error_response_definition = {</span>
<span class="gi">+    &quot;title&quot;: &quot;HTTPValidationError&quot;,</span>
<span class="gi">+    &quot;type&quot;: &quot;object&quot;,</span>
<span class="gi">+    &quot;properties&quot;: {</span>
<span class="gi">+        &quot;detail&quot;: {</span>
<span class="gi">+            &quot;title&quot;: &quot;Detail&quot;,</span>
<span class="gi">+            &quot;type&quot;: &quot;array&quot;,</span>
<span class="gi">+            &quot;items&quot;: {&quot;$ref&quot;: REF_PREFIX + &quot;ValidationError&quot;},</span>
<span class="gi">+        }</span>
<span class="gi">+    },</span>
<span class="gi">+}</span>
<span class="gi">+</span>
<span class="gi">+status_code_ranges: Dict[str, str] = {</span>
<span class="gi">+    &quot;1XX&quot;: &quot;Information&quot;,</span>
<span class="gi">+    &quot;2XX&quot;: &quot;Success&quot;,</span>
<span class="gi">+    &quot;3XX&quot;: &quot;Redirection&quot;,</span>
<span class="gi">+    &quot;4XX&quot;: &quot;Client Error&quot;,</span>
<span class="gi">+    &quot;5XX&quot;: &quot;Server Error&quot;,</span>
<span class="gi">+    &quot;DEFAULT&quot;: &quot;Default Response&quot;,</span>
<span class="gi">+}</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def get_openapi_security_definitions(</span>
<span class="gi">+    flat_dependant: Dependant,</span>
<span class="gi">+) -&gt; Tuple[Dict[str, Any], List[Dict[str, Any]]]:</span>
<span class="gi">+    security_definitions = {}</span>
<span class="gi">+    operation_security = []</span>
<span class="gi">+    for security_requirement in flat_dependant.security_requirements:</span>
<span class="gi">+        security_definition = jsonable_encoder(</span>
<span class="gi">+            security_requirement.security_scheme.model,</span>
<span class="gi">+            by_alias=True,</span>
<span class="gi">+            exclude_none=True,</span>
<span class="gi">+        )</span>
<span class="gi">+        security_name = security_requirement.security_scheme.scheme_name</span>
<span class="gi">+        security_definitions[security_name] = security_definition</span>
<span class="gi">+        operation_security.append({security_name: security_requirement.scopes})</span>
<span class="gi">+    return security_definitions, operation_security</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def get_openapi_operation_parameters(</span>
<span class="gi">+    *,</span>
<span class="gi">+    all_route_params: Sequence[ModelField],</span>
<span class="gi">+    schema_generator: GenerateJsonSchema,</span>
<span class="gi">+    model_name_map: ModelNameMap,</span>
<span class="gi">+    field_mapping: Dict[</span>
<span class="gi">+        Tuple[ModelField, Literal[&quot;validation&quot;, &quot;serialization&quot;]], JsonSchemaValue</span>
<span class="gi">+    ],</span>
<span class="gi">+    separate_input_output_schemas: bool = True,</span>
<span class="gi">+) -&gt; List[Dict[str, Any]]:</span>
<span class="gi">+    parameters = []</span>
<span class="gi">+    for param in all_route_params:</span>
<span class="gi">+        field_info = param.field_info</span>
<span class="gi">+        field_info = cast(Param, field_info)</span>
<span class="gi">+        if not field_info.include_in_schema:</span>
<span class="gi">+            continue</span>
<span class="gi">+        param_schema = get_schema_from_model_field(</span>
<span class="gi">+            field=param,</span>
<span class="gi">+            schema_generator=schema_generator,</span>
<span class="gi">+            model_name_map=model_name_map,</span>
<span class="gi">+            field_mapping=field_mapping,</span>
<span class="gi">+            separate_input_output_schemas=separate_input_output_schemas,</span>
<span class="gi">+        )</span>
<span class="gi">+        parameter = {</span>
<span class="gi">+            &quot;name&quot;: param.alias,</span>
<span class="gi">+            &quot;in&quot;: field_info.in_.value,</span>
<span class="gi">+            &quot;required&quot;: param.required,</span>
<span class="gi">+            &quot;schema&quot;: param_schema,</span>
<span class="gi">+        }</span>
<span class="gi">+        if field_info.description:</span>
<span class="gi">+            parameter[&quot;description&quot;] = field_info.description</span>
<span class="gi">+        if field_info.openapi_examples:</span>
<span class="gi">+            parameter[&quot;examples&quot;] = jsonable_encoder(field_info.openapi_examples)</span>
<span class="gi">+        elif field_info.example != Undefined:</span>
<span class="gi">+            parameter[&quot;example&quot;] = jsonable_encoder(field_info.example)</span>
<span class="gi">+        if field_info.deprecated:</span>
<span class="gi">+            parameter[&quot;deprecated&quot;] = True</span>
<span class="gi">+        parameters.append(parameter)</span>
<span class="gi">+    return parameters</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def get_openapi_operation_request_body(</span>
<span class="gi">+    *,</span>
<span class="gi">+    body_field: Optional[ModelField],</span>
<span class="gi">+    schema_generator: GenerateJsonSchema,</span>
<span class="gi">+    model_name_map: ModelNameMap,</span>
<span class="gi">+    field_mapping: Dict[</span>
<span class="gi">+        Tuple[ModelField, Literal[&quot;validation&quot;, &quot;serialization&quot;]], JsonSchemaValue</span>
<span class="gi">+    ],</span>
<span class="gi">+    separate_input_output_schemas: bool = True,</span>
<span class="gi">+) -&gt; Optional[Dict[str, Any]]:</span>
<span class="gi">+    if not body_field:</span>
<span class="gi">+        return None</span>
<span class="gi">+    assert isinstance(body_field, ModelField)</span>
<span class="gi">+    body_schema = get_schema_from_model_field(</span>
<span class="gi">+        field=body_field,</span>
<span class="gi">+        schema_generator=schema_generator,</span>
<span class="gi">+        model_name_map=model_name_map,</span>
<span class="gi">+        field_mapping=field_mapping,</span>
<span class="gi">+        separate_input_output_schemas=separate_input_output_schemas,</span>
<span class="gi">+    )</span>
<span class="gi">+    field_info = cast(Body, body_field.field_info)</span>
<span class="gi">+    request_media_type = field_info.media_type</span>
<span class="gi">+    required = body_field.required</span>
<span class="gi">+    request_body_oai: Dict[str, Any] = {}</span>
<span class="gi">+    if required:</span>
<span class="gi">+        request_body_oai[&quot;required&quot;] = required</span>
<span class="gi">+    request_media_content: Dict[str, Any] = {&quot;schema&quot;: body_schema}</span>
<span class="gi">+    if field_info.openapi_examples:</span>
<span class="gi">+        request_media_content[&quot;examples&quot;] = jsonable_encoder(</span>
<span class="gi">+            field_info.openapi_examples</span>
<span class="gi">+        )</span>
<span class="gi">+    elif field_info.example != Undefined:</span>
<span class="gi">+        request_media_content[&quot;example&quot;] = jsonable_encoder(field_info.example)</span>
<span class="gi">+    request_body_oai[&quot;content&quot;] = {request_media_type: request_media_content}</span>
<span class="gi">+    return request_body_oai</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def generate_operation_id(</span>
<span class="gi">+    *, route: routing.APIRoute, method: str</span>
<span class="gi">+) -&gt; str:  # pragma: nocover</span>
<span class="gi">+    warnings.warn(</span>
<span class="gi">+        &quot;fastapi.openapi.utils.generate_operation_id() was deprecated, &quot;</span>
<span class="gi">+        &quot;it is not used internally, and will be removed soon&quot;,</span>
<span class="gi">+        DeprecationWarning,</span>
<span class="gi">+        stacklevel=2,</span>
<span class="gi">+    )</span>
<span class="gi">+    if route.operation_id:</span>
<span class="gi">+        return route.operation_id</span>
<span class="gi">+    path: str = route.path_format</span>
<span class="gi">+    return generate_operation_id_for_path(name=route.name, path=path, method=method)</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def generate_operation_summary(*, route: routing.APIRoute, method: str) -&gt; str:</span>
<span class="gi">+    if route.summary:</span>
<span class="gi">+        return route.summary</span>
<span class="gi">+    return route.name.replace(&quot;_&quot;, &quot; &quot;).title()</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def get_openapi_operation_metadata(</span>
<span class="gi">+    *, route: routing.APIRoute, method: str, operation_ids: Set[str]</span>
<span class="gi">+) -&gt; Dict[str, Any]:</span>
<span class="gi">+    operation: Dict[str, Any] = {}</span>
<span class="gi">+    if route.tags:</span>
<span class="gi">+        operation[&quot;tags&quot;] = route.tags</span>
<span class="gi">+    operation[&quot;summary&quot;] = generate_operation_summary(route=route, method=method)</span>
<span class="gi">+    if route.description:</span>
<span class="gi">+        operation[&quot;description&quot;] = route.description</span>
<span class="gi">+    operation_id = route.operation_id or route.unique_id</span>
<span class="gi">+    if operation_id in operation_ids:</span>
<span class="gi">+        message = (</span>
<span class="gi">+            f&quot;Duplicate Operation ID {operation_id} for function &quot;</span>
<span class="gi">+            + f&quot;{route.endpoint.__name__}&quot;</span>
<span class="gi">+        )</span>
<span class="gi">+        file_name = getattr(route.endpoint, &quot;__globals__&quot;, {}).get(&quot;__file__&quot;)</span>
<span class="gi">+        if file_name:</span>
<span class="gi">+            message += f&quot; at {file_name}&quot;</span>
<span class="gi">+        warnings.warn(message, stacklevel=1)</span>
<span class="gi">+    operation_ids.add(operation_id)</span>
<span class="gi">+    operation[&quot;operationId&quot;] = operation_id</span>
<span class="gi">+    if route.deprecated:</span>
<span class="gi">+        operation[&quot;deprecated&quot;] = route.deprecated</span>
<span class="gi">+    return operation</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def get_openapi_path(</span>
<span class="gi">+    *,</span>
<span class="gi">+    route: routing.APIRoute,</span>
<span class="gi">+    operation_ids: Set[str],</span>
<span class="gi">+    schema_generator: GenerateJsonSchema,</span>
<span class="gi">+    model_name_map: ModelNameMap,</span>
<span class="gi">+    field_mapping: Dict[</span>
<span class="gi">+        Tuple[ModelField, Literal[&quot;validation&quot;, &quot;serialization&quot;]], JsonSchemaValue</span>
<span class="gi">+    ],</span>
<span class="gi">+    separate_input_output_schemas: bool = True,</span>
<span class="gi">+) -&gt; Tuple[Dict[str, Any], Dict[str, Any], Dict[str, Any]]:</span>
<span class="gi">+    path = {}</span>
<span class="gi">+    security_schemes: Dict[str, Any] = {}</span>
<span class="gi">+    definitions: Dict[str, Any] = {}</span>
<span class="gi">+    assert route.methods is not None, &quot;Methods must be a list&quot;</span>
<span class="gi">+    if isinstance(route.response_class, DefaultPlaceholder):</span>
<span class="gi">+        current_response_class: Type[Response] = route.response_class.value</span>
<span class="gi">+    else:</span>
<span class="gi">+        current_response_class = route.response_class</span>
<span class="gi">+    assert current_response_class, &quot;A response class is needed to generate OpenAPI&quot;</span>
<span class="gi">+    route_response_media_type: Optional[str] = current_response_class.media_type</span>
<span class="gi">+    if route.include_in_schema:</span>
<span class="gi">+        for method in route.methods:</span>
<span class="gi">+            operation = get_openapi_operation_metadata(</span>
<span class="gi">+                route=route, method=method, operation_ids=operation_ids</span>
<span class="gi">+            )</span>
<span class="gi">+            parameters: List[Dict[str, Any]] = []</span>
<span class="gi">+            flat_dependant = get_flat_dependant(route.dependant, skip_repeats=True)</span>
<span class="gi">+            security_definitions, operation_security = get_openapi_security_definitions(</span>
<span class="gi">+                flat_dependant=flat_dependant</span>
<span class="gi">+            )</span>
<span class="gi">+            if operation_security:</span>
<span class="gi">+                operation.setdefault(&quot;security&quot;, []).extend(operation_security)</span>
<span class="gi">+            if security_definitions:</span>
<span class="gi">+                security_schemes.update(security_definitions)</span>
<span class="gi">+            all_route_params = get_flat_params(route.dependant)</span>
<span class="gi">+            operation_parameters = get_openapi_operation_parameters(</span>
<span class="gi">+                all_route_params=all_route_params,</span>
<span class="gi">+                schema_generator=schema_generator,</span>
<span class="gi">+                model_name_map=model_name_map,</span>
<span class="gi">+                field_mapping=field_mapping,</span>
<span class="gi">+                separate_input_output_schemas=separate_input_output_schemas,</span>
<span class="gi">+            )</span>
<span class="gi">+            parameters.extend(operation_parameters)</span>
<span class="gi">+            if parameters:</span>
<span class="gi">+                all_parameters = {</span>
<span class="gi">+                    (param[&quot;in&quot;], param[&quot;name&quot;]): param for param in parameters</span>
<span class="gi">+                }</span>
<span class="gi">+                required_parameters = {</span>
<span class="gi">+                    (param[&quot;in&quot;], param[&quot;name&quot;]): param</span>
<span class="gi">+                    for param in parameters</span>
<span class="gi">+                    if param.get(&quot;required&quot;)</span>
<span class="gi">+                }</span>
<span class="gi">+                # Make sure required definitions of the same parameter take precedence</span>
<span class="gi">+                # over non-required definitions</span>
<span class="gi">+                all_parameters.update(required_parameters)</span>
<span class="gi">+                operation[&quot;parameters&quot;] = list(all_parameters.values())</span>
<span class="gi">+            if method in METHODS_WITH_BODY:</span>
<span class="gi">+                request_body_oai = get_openapi_operation_request_body(</span>
<span class="gi">+                    body_field=route.body_field,</span>
<span class="gi">+                    schema_generator=schema_generator,</span>
<span class="gi">+                    model_name_map=model_name_map,</span>
<span class="gi">+                    field_mapping=field_mapping,</span>
<span class="gi">+                    separate_input_output_schemas=separate_input_output_schemas,</span>
<span class="gi">+                )</span>
<span class="gi">+                if request_body_oai:</span>
<span class="gi">+                    operation[&quot;requestBody&quot;] = request_body_oai</span>
<span class="gi">+            if route.callbacks:</span>
<span class="gi">+                callbacks = {}</span>
<span class="gi">+                for callback in route.callbacks:</span>
<span class="gi">+                    if isinstance(callback, routing.APIRoute):</span>
<span class="gi">+                        (</span>
<span class="gi">+                            cb_path,</span>
<span class="gi">+                            cb_security_schemes,</span>
<span class="gi">+                            cb_definitions,</span>
<span class="gi">+                        ) = get_openapi_path(</span>
<span class="gi">+                            route=callback,</span>
<span class="gi">+                            operation_ids=operation_ids,</span>
<span class="gi">+                            schema_generator=schema_generator,</span>
<span class="gi">+                            model_name_map=model_name_map,</span>
<span class="gi">+                            field_mapping=field_mapping,</span>
<span class="gi">+                            separate_input_output_schemas=separate_input_output_schemas,</span>
<span class="gi">+                        )</span>
<span class="gi">+                        callbacks[callback.name] = {callback.path: cb_path}</span>
<span class="gi">+                operation[&quot;callbacks&quot;] = callbacks</span>
<span class="gi">+            if route.status_code is not None:</span>
<span class="gi">+                status_code = str(route.status_code)</span>
<span class="gi">+            else:</span>
<span class="gi">+                # It would probably make more sense for all response classes to have an</span>
<span class="gi">+                # explicit default status_code, and to extract it from them, instead of</span>
<span class="gi">+                # doing this inspection tricks, that would probably be in the future</span>
<span class="gi">+                # TODO: probably make status_code a default class attribute for all</span>
<span class="gi">+                # responses in Starlette</span>
<span class="gi">+                response_signature = inspect.signature(current_response_class.__init__)</span>
<span class="gi">+                status_code_param = response_signature.parameters.get(&quot;status_code&quot;)</span>
<span class="gi">+                if status_code_param is not None:</span>
<span class="gi">+                    if isinstance(status_code_param.default, int):</span>
<span class="gi">+                        status_code = str(status_code_param.default)</span>
<span class="gi">+            operation.setdefault(&quot;responses&quot;, {}).setdefault(status_code, {})[</span>
<span class="gi">+                &quot;description&quot;</span>
<span class="gi">+            ] = route.response_description</span>
<span class="gi">+            if route_response_media_type and is_body_allowed_for_status_code(</span>
<span class="gi">+                route.status_code</span>
<span class="gi">+            ):</span>
<span class="gi">+                response_schema = {&quot;type&quot;: &quot;string&quot;}</span>
<span class="gi">+                if lenient_issubclass(current_response_class, JSONResponse):</span>
<span class="gi">+                    if route.response_field:</span>
<span class="gi">+                        response_schema = get_schema_from_model_field(</span>
<span class="gi">+                            field=route.response_field,</span>
<span class="gi">+                            schema_generator=schema_generator,</span>
<span class="gi">+                            model_name_map=model_name_map,</span>
<span class="gi">+                            field_mapping=field_mapping,</span>
<span class="gi">+                            separate_input_output_schemas=separate_input_output_schemas,</span>
<span class="gi">+                        )</span>
<span class="gi">+                    else:</span>
<span class="gi">+                        response_schema = {}</span>
<span class="gi">+                operation.setdefault(&quot;responses&quot;, {}).setdefault(</span>
<span class="gi">+                    status_code, {}</span>
<span class="gi">+                ).setdefault(&quot;content&quot;, {}).setdefault(route_response_media_type, {})[</span>
<span class="gi">+                    &quot;schema&quot;</span>
<span class="gi">+                ] = response_schema</span>
<span class="gi">+            if route.responses:</span>
<span class="gi">+                operation_responses = operation.setdefault(&quot;responses&quot;, {})</span>
<span class="gi">+                for (</span>
<span class="gi">+                    additional_status_code,</span>
<span class="gi">+                    additional_response,</span>
<span class="gi">+                ) in route.responses.items():</span>
<span class="gi">+                    process_response = additional_response.copy()</span>
<span class="gi">+                    process_response.pop(&quot;model&quot;, None)</span>
<span class="gi">+                    status_code_key = str(additional_status_code).upper()</span>
<span class="gi">+                    if status_code_key == &quot;DEFAULT&quot;:</span>
<span class="gi">+                        status_code_key = &quot;default&quot;</span>
<span class="gi">+                    openapi_response = operation_responses.setdefault(</span>
<span class="gi">+                        status_code_key, {}</span>
<span class="gi">+                    )</span>
<span class="gi">+                    assert isinstance(</span>
<span class="gi">+                        process_response, dict</span>
<span class="gi">+                    ), &quot;An additional response must be a dict&quot;</span>
<span class="gi">+                    field = route.response_fields.get(additional_status_code)</span>
<span class="gi">+                    additional_field_schema: Optional[Dict[str, Any]] = None</span>
<span class="gi">+                    if field:</span>
<span class="gi">+                        additional_field_schema = get_schema_from_model_field(</span>
<span class="gi">+                            field=field,</span>
<span class="gi">+                            schema_generator=schema_generator,</span>
<span class="gi">+                            model_name_map=model_name_map,</span>
<span class="gi">+                            field_mapping=field_mapping,</span>
<span class="gi">+                            separate_input_output_schemas=separate_input_output_schemas,</span>
<span class="gi">+                        )</span>
<span class="gi">+                        media_type = route_response_media_type or &quot;application/json&quot;</span>
<span class="gi">+                        additional_schema = (</span>
<span class="gi">+                            process_response.setdefault(&quot;content&quot;, {})</span>
<span class="gi">+                            .setdefault(media_type, {})</span>
<span class="gi">+                            .setdefault(&quot;schema&quot;, {})</span>
<span class="gi">+                        )</span>
<span class="gi">+                        deep_dict_update(additional_schema, additional_field_schema)</span>
<span class="gi">+                    status_text: Optional[str] = status_code_ranges.get(</span>
<span class="gi">+                        str(additional_status_code).upper()</span>
<span class="gi">+                    ) or http.client.responses.get(int(additional_status_code))</span>
<span class="gi">+                    description = (</span>
<span class="gi">+                        process_response.get(&quot;description&quot;)</span>
<span class="gi">+                        or openapi_response.get(&quot;description&quot;)</span>
<span class="gi">+                        or status_text</span>
<span class="gi">+                        or &quot;Additional Response&quot;</span>
<span class="gi">+                    )</span>
<span class="gi">+                    deep_dict_update(openapi_response, process_response)</span>
<span class="gi">+                    openapi_response[&quot;description&quot;] = description</span>
<span class="gi">+            http422 = str(HTTP_422_UNPROCESSABLE_ENTITY)</span>
<span class="gi">+            if (all_route_params or route.body_field) and not any(</span>
<span class="gi">+                status in operation[&quot;responses&quot;]</span>
<span class="gi">+                for status in [http422, &quot;4XX&quot;, &quot;default&quot;]</span>
<span class="gi">+            ):</span>
<span class="gi">+                operation[&quot;responses&quot;][http422] = {</span>
<span class="gi">+                    &quot;description&quot;: &quot;Validation Error&quot;,</span>
<span class="gi">+                    &quot;content&quot;: {</span>
<span class="gi">+                        &quot;application/json&quot;: {</span>
<span class="gi">+                            &quot;schema&quot;: {&quot;$ref&quot;: REF_PREFIX + &quot;HTTPValidationError&quot;}</span>
<span class="gi">+                        }</span>
<span class="gi">+                    },</span>
<span class="gi">+                }</span>
<span class="gi">+                if &quot;ValidationError&quot; not in definitions:</span>
<span class="gi">+                    definitions.update(</span>
<span class="gi">+                        {</span>
<span class="gi">+                            &quot;ValidationError&quot;: validation_error_definition,</span>
<span class="gi">+                            &quot;HTTPValidationError&quot;: validation_error_response_definition,</span>
<span class="gi">+                        }</span>
<span class="gi">+                    )</span>
<span class="gi">+            if route.openapi_extra:</span>
<span class="gi">+                deep_dict_update(operation, route.openapi_extra)</span>
<span class="gi">+            path[method.lower()] = operation</span>
<span class="gi">+    return path, security_schemes, definitions</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def get_fields_from_routes(</span>
<span class="gi">+    routes: Sequence[BaseRoute],</span>
<span class="gi">+) -&gt; List[ModelField]:</span>
<span class="gi">+    body_fields_from_routes: List[ModelField] = []</span>
<span class="gi">+    responses_from_routes: List[ModelField] = []</span>
<span class="gi">+    request_fields_from_routes: List[ModelField] = []</span>
<span class="gi">+    callback_flat_models: List[ModelField] = []</span>
<span class="gi">+    for route in routes:</span>
<span class="gi">+        if getattr(route, &quot;include_in_schema&quot;, None) and isinstance(</span>
<span class="gi">+            route, routing.APIRoute</span>
<span class="gi">+        ):</span>
<span class="gi">+            if route.body_field:</span>
<span class="gi">+                assert isinstance(</span>
<span class="gi">+                    route.body_field, ModelField</span>
<span class="gi">+                ), &quot;A request body must be a Pydantic Field&quot;</span>
<span class="gi">+                body_fields_from_routes.append(route.body_field)</span>
<span class="gi">+            if route.response_field:</span>
<span class="gi">+                responses_from_routes.append(route.response_field)</span>
<span class="gi">+            if route.response_fields:</span>
<span class="gi">+                responses_from_routes.extend(route.response_fields.values())</span>
<span class="gi">+            if route.callbacks:</span>
<span class="gi">+                callback_flat_models.extend(get_fields_from_routes(route.callbacks))</span>
<span class="gi">+            params = get_flat_params(route.dependant)</span>
<span class="gi">+            request_fields_from_routes.extend(params)</span>
<span class="gi">+</span>
<span class="gi">+    flat_models = callback_flat_models + list(</span>
<span class="gi">+        body_fields_from_routes + responses_from_routes + request_fields_from_routes</span>
<span class="gi">+    )</span>
<span class="gi">+    return flat_models</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def get_openapi(</span>
<span class="gi">+    *,</span>
<span class="gi">+    title: str,</span>
<span class="gi">+    version: str,</span>
<span class="gi">+    openapi_version: str = &quot;3.1.0&quot;,</span>
<span class="gi">+    summary: Optional[str] = None,</span>
<span class="gi">+    description: Optional[str] = None,</span>
<span class="gi">+    routes: Sequence[BaseRoute],</span>
<span class="gi">+    webhooks: Optional[Sequence[BaseRoute]] = None,</span>
<span class="gi">+    tags: Optional[List[Dict[str, Any]]] = None,</span>
<span class="gi">+    servers: Optional[List[Dict[str, Union[str, Any]]]] = None,</span>
<span class="gi">+    terms_of_service: Optional[str] = None,</span>
<span class="gi">+    contact: Optional[Dict[str, Union[str, Any]]] = None,</span>
<span class="gi">+    license_info: Optional[Dict[str, Union[str, Any]]] = None,</span>
<span class="gi">+    separate_input_output_schemas: bool = True,</span>
<span class="gi">+) -&gt; Dict[str, Any]:</span>
<span class="gi">+    info: Dict[str, Any] = {&quot;title&quot;: title, &quot;version&quot;: version}</span>
<span class="gi">+    if summary:</span>
<span class="gi">+        info[&quot;summary&quot;] = summary</span>
<span class="gi">+    if description:</span>
<span class="gi">+        info[&quot;description&quot;] = description</span>
<span class="gi">+    if terms_of_service:</span>
<span class="gi">+        info[&quot;termsOfService&quot;] = terms_of_service</span>
<span class="gi">+    if contact:</span>
<span class="gi">+        info[&quot;contact&quot;] = contact</span>
<span class="gi">+    if license_info:</span>
<span class="gi">+        info[&quot;license&quot;] = license_info</span>
<span class="gi">+    output: Dict[str, Any] = {&quot;openapi&quot;: openapi_version, &quot;info&quot;: info}</span>
<span class="gi">+    if servers:</span>
<span class="gi">+        output[&quot;servers&quot;] = servers</span>
<span class="gi">+    components: Dict[str, Dict[str, Any]] = {}</span>
<span class="gi">+    paths: Dict[str, Dict[str, Any]] = {}</span>
<span class="gi">+    webhook_paths: Dict[str, Dict[str, Any]] = {}</span>
<span class="gi">+    operation_ids: Set[str] = set()</span>
<span class="gi">+    all_fields = get_fields_from_routes(list(routes or []) + list(webhooks or []))</span>
<span class="gi">+    model_name_map = get_compat_model_name_map(all_fields)</span>
<span class="gi">+    schema_generator = GenerateJsonSchema(ref_template=REF_TEMPLATE)</span>
<span class="gi">+    field_mapping, definitions = get_definitions(</span>
<span class="gi">+        fields=all_fields,</span>
<span class="gi">+        schema_generator=schema_generator,</span>
<span class="gi">+        model_name_map=model_name_map,</span>
<span class="gi">+        separate_input_output_schemas=separate_input_output_schemas,</span>
<span class="gi">+    )</span>
<span class="gi">+    for route in routes or []:</span>
<span class="gi">+        if isinstance(route, routing.APIRoute):</span>
<span class="gi">+            result = get_openapi_path(</span>
<span class="gi">+                route=route,</span>
<span class="gi">+                operation_ids=operation_ids,</span>
<span class="gi">+                schema_generator=schema_generator,</span>
<span class="gi">+                model_name_map=model_name_map,</span>
<span class="gi">+                field_mapping=field_mapping,</span>
<span class="gi">+                separate_input_output_schemas=separate_input_output_schemas,</span>
<span class="gi">+            )</span>
<span class="gi">+            if result:</span>
<span class="gi">+                path, security_schemes, path_definitions = result</span>
<span class="gi">+                if path:</span>
<span class="gi">+                    paths.setdefault(route.path_format, {}).update(path)</span>
<span class="gi">+                if security_schemes:</span>
<span class="gi">+                    components.setdefault(&quot;securitySchemes&quot;, {}).update(</span>
<span class="gi">+                        security_schemes</span>
<span class="gi">+                    )</span>
<span class="gi">+                if path_definitions:</span>
<span class="gi">+                    definitions.update(path_definitions)</span>
<span class="gi">+    for webhook in webhooks or []:</span>
<span class="gi">+        if isinstance(webhook, routing.APIRoute):</span>
<span class="gi">+            result = get_openapi_path(</span>
<span class="gi">+                route=webhook,</span>
<span class="gi">+                operation_ids=operation_ids,</span>
<span class="gi">+                schema_generator=schema_generator,</span>
<span class="gi">+                model_name_map=model_name_map,</span>
<span class="gi">+                field_mapping=field_mapping,</span>
<span class="gi">+                separate_input_output_schemas=separate_input_output_schemas,</span>
<span class="gi">+            )</span>
<span class="gi">+            if result:</span>
<span class="gi">+                path, security_schemes, path_definitions = result</span>
<span class="gi">+                if path:</span>
<span class="gi">+                    webhook_paths.setdefault(webhook.path_format, {}).update(path)</span>
<span class="gi">+                if security_schemes:</span>
<span class="gi">+                    components.setdefault(&quot;securitySchemes&quot;, {}).update(</span>
<span class="gi">+                        security_schemes</span>
<span class="gi">+                    )</span>
<span class="gi">+                if path_definitions:</span>
<span class="gi">+                    definitions.update(path_definitions)</span>
<span class="gi">+    if definitions:</span>
<span class="gi">+        components[&quot;schemas&quot;] = {k: definitions[k] for k in sorted(definitions)}</span>
<span class="gi">+    if components:</span>
<span class="gi">+        output[&quot;components&quot;] = components</span>
<span class="gi">+    output[&quot;paths&quot;] = paths</span>
<span class="gi">+    if webhook_paths:</span>
<span class="gi">+        output[&quot;webhooks&quot;] = webhook_paths</span>
<span class="gi">+    if tags:</span>
<span class="gi">+        output[&quot;tags&quot;] = tags</span>
<span class="gi">+    return jsonable_encoder(OpenAPI(**output), by_alias=True, exclude_none=True)  # type: ignore</span>
<span class="gh">diff --git a/fastapi/param_functions.py b/fastapi/param_functions.py</span>
<span class="gh">index 298d63fa..3b25d774 100644</span>
<span class="gd">--- a/fastapi/param_functions.py</span>
<span class="gi">+++ b/fastapi/param_functions.py</span>
<span class="gu">@@ -1,127 +1,1818 @@</span>
<span class="w"> </span>from typing import Any, Callable, Dict, List, Optional, Sequence, Union
<span class="gi">+</span>
<span class="w"> </span>from fastapi import params
<span class="w"> </span>from fastapi._compat import Undefined
<span class="w"> </span>from fastapi.openapi.models import Example
<span class="w"> </span>from typing_extensions import Annotated, Doc, deprecated
<span class="gi">+</span>
<span class="w"> </span>_Unset: Any = Undefined


<span class="gd">-def Path(default: Annotated[Any, Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gd">-            Default value if the parameter field is not set.</span>
<span class="gi">+def Path(  # noqa: N802</span>
<span class="gi">+    default: Annotated[</span>
<span class="gi">+        Any,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Default value if the parameter field is not set.</span>
<span class="gi">+</span>
<span class="gi">+            This doesn&#39;t affect `Path` parameters as the value is always required.</span>
<span class="gi">+            The parameter is available only for compatibility.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = ...,</span>
<span class="gi">+    *,</span>
<span class="gi">+    default_factory: Annotated[</span>
<span class="gi">+        Union[Callable[[], Any], None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            A callable to generate the default value.</span>
<span class="gi">+</span>
<span class="gi">+            This doesn&#39;t affect `Path` parameters as the value is always required.</span>
<span class="gi">+            The parameter is available only for compatibility.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    alias: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            An alternative name for the parameter field.</span>
<span class="gi">+</span>
<span class="gi">+            This will be used to extract the data and for the generated OpenAPI.</span>
<span class="gi">+            It is particularly useful when you can&#39;t use the name you want because it</span>
<span class="gi">+            is a Python reserved keyword or similar.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    alias_priority: Annotated[</span>
<span class="gi">+        Union[int, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Priority of the alias. This affects whether an alias generator is used.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    # TODO: update when deprecating Pydantic v1, import these types</span>
<span class="gi">+    # validation_alias: str | AliasPath | AliasChoices | None</span>
<span class="gi">+    validation_alias: Annotated[</span>
<span class="gi">+        Union[str, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            &#39;Whitelist&#39; validation step. The parameter field will be the single one</span>
<span class="gi">+            allowed by the alias or set of aliases defined.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    serialization_alias: Annotated[</span>
<span class="gi">+        Union[str, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            &#39;Blacklist&#39; validation step. The vanilla parameter field will be the</span>
<span class="gi">+            single one of the alias&#39; or set of aliases&#39; fields and all the other</span>
<span class="gi">+            fields will be ignored at serialization time.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    title: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Human-readable title.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    description: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Human-readable description.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    gt: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Greater than. If set, value must be greater than this. Only applicable to</span>
<span class="gi">+            numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    ge: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Greater than or equal. If set, value must be greater than or equal to</span>
<span class="gi">+            this. Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    lt: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Less than. If set, value must be less than this. Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    le: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Less than or equal. If set, value must be less than or equal to this.</span>
<span class="gi">+            Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    min_length: Annotated[</span>
<span class="gi">+        Optional[int],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Minimum length for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    max_length: Annotated[</span>
<span class="gi">+        Optional[int],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Maximum length for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    pattern: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            RegEx pattern for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    regex: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            RegEx pattern for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+        deprecated(</span>
<span class="gi">+            &quot;Deprecated in FastAPI 0.100.0 and Pydantic v2, use `pattern` instead.&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    discriminator: Annotated[</span>
<span class="gi">+        Union[str, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Parameter field name for discriminating the type in a tagged union.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    strict: Annotated[</span>
<span class="gi">+        Union[bool, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            If `True`, strict validation is applied to the field.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    multiple_of: Annotated[</span>
<span class="gi">+        Union[float, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Value must be a multiple of this. Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    allow_inf_nan: Annotated[</span>
<span class="gi">+        Union[bool, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Allow `inf`, `-inf`, `nan`. Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    max_digits: Annotated[</span>
<span class="gi">+        Union[int, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Maximum number of allow digits for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    decimal_places: Annotated[</span>
<span class="gi">+        Union[int, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Maximum number of decimal places allowed for numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    examples: Annotated[</span>
<span class="gi">+        Optional[List[Any]],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Example values for this field.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    example: Annotated[</span>
<span class="gi">+        Optional[Any],</span>
<span class="gi">+        deprecated(</span>
<span class="gi">+            &quot;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, &quot;</span>
<span class="gi">+            &quot;although still supported. Use examples instead.&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    openapi_examples: Annotated[</span>
<span class="gi">+        Optional[Dict[str, Example]],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            OpenAPI-specific examples.</span>
<span class="gi">+</span>
<span class="gi">+            It will be added to the generated OpenAPI (e.g. visible at `/docs`).</span>
<span class="gi">+</span>
<span class="gi">+            Swagger UI (that provides the `/docs` interface) has better support for the</span>
<span class="gi">+            OpenAPI-specific examples than the JSON Schema `examples`, that&#39;s the main</span>
<span class="gi">+            use case for this.</span>
<span class="gi">+</span>
<span class="gi">+            Read more about it in the</span>
<span class="gi">+            [FastAPI docs for Declare Request Example Data](https://fastapi.tiangolo.com/tutorial/schema-extra-example/#using-the-openapi_examples-parameter).</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    deprecated: Annotated[</span>
<span class="gi">+        Union[deprecated, str, bool, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Mark this parameter field as deprecated.</span>
<span class="gi">+</span>
<span class="gi">+            It will affect the generated OpenAPI (e.g. visible at `/docs`).</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    include_in_schema: Annotated[</span>
<span class="gi">+        bool,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            To include (or not) this parameter field in the generated OpenAPI.</span>
<span class="gi">+            You probably don&#39;t need it, but it&#39;s available.</span>
<span class="gi">+</span>
<span class="gi">+            This affects the generated OpenAPI (e.g. visible at `/docs`).</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = True,</span>
<span class="gi">+    json_schema_extra: Annotated[</span>
<span class="gi">+        Union[Dict[str, Any], None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Any additional JSON schema data.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    **extra: Annotated[</span>
<span class="gi">+        Any,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Include extra fields used by the JSON Schema.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+        deprecated(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            The `extra` kwargs is deprecated. Use `json_schema_extra` instead.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ],</span>
<span class="gi">+) -&gt; Any:</span>
<span class="gi">+    &quot;&quot;&quot;</span>
<span class="gi">+    Declare a path parameter for a *path operation*.</span>
<span class="gi">+</span>
<span class="gi">+    Read more about it in the</span>
<span class="gi">+    [FastAPI docs for Path Parameters and Numeric Validations](https://fastapi.tiangolo.com/tutorial/path-params-numeric-validations/).</span>
<span class="gi">+</span>
<span class="gi">+    ```python</span>
<span class="gi">+    from typing import Annotated</span>
<span class="gi">+</span>
<span class="gi">+    from fastapi import FastAPI, Path</span>
<span class="gi">+</span>
<span class="gi">+    app = FastAPI()</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+    @app.get(&quot;/items/{item_id}&quot;)</span>
<span class="gi">+    async def read_items(</span>
<span class="gi">+        item_id: Annotated[int, Path(title=&quot;The ID of the item to get&quot;)],</span>
<span class="gi">+    ):</span>
<span class="gi">+        return {&quot;item_id&quot;: item_id}</span>
<span class="gi">+    ```</span>
<span class="gi">+    &quot;&quot;&quot;</span>
<span class="gi">+    return params.Path(</span>
<span class="gi">+        default=default,</span>
<span class="gi">+        default_factory=default_factory,</span>
<span class="gi">+        alias=alias,</span>
<span class="gi">+        alias_priority=alias_priority,</span>
<span class="gi">+        validation_alias=validation_alias,</span>
<span class="gi">+        serialization_alias=serialization_alias,</span>
<span class="gi">+        title=title,</span>
<span class="gi">+        description=description,</span>
<span class="gi">+        gt=gt,</span>
<span class="gi">+        ge=ge,</span>
<span class="gi">+        lt=lt,</span>
<span class="gi">+        le=le,</span>
<span class="gi">+        min_length=min_length,</span>
<span class="gi">+        max_length=max_length,</span>
<span class="gi">+        pattern=pattern,</span>
<span class="gi">+        regex=regex,</span>
<span class="gi">+        discriminator=discriminator,</span>
<span class="gi">+        strict=strict,</span>
<span class="gi">+        multiple_of=multiple_of,</span>
<span class="gi">+        allow_inf_nan=allow_inf_nan,</span>
<span class="gi">+        max_digits=max_digits,</span>
<span class="gi">+        decimal_places=decimal_places,</span>
<span class="gi">+        example=example,</span>
<span class="gi">+        examples=examples,</span>
<span class="gi">+        openapi_examples=openapi_examples,</span>
<span class="gi">+        deprecated=deprecated,</span>
<span class="gi">+        include_in_schema=include_in_schema,</span>
<span class="gi">+        json_schema_extra=json_schema_extra,</span>
<span class="gi">+        **extra,</span>
<span class="gi">+    )</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def Query(  # noqa: N802</span>
<span class="gi">+    default: Annotated[</span>
<span class="gi">+        Any,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Default value if the parameter field is not set.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = Undefined,</span>
<span class="gi">+    *,</span>
<span class="gi">+    default_factory: Annotated[</span>
<span class="gi">+        Union[Callable[[], Any], None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            A callable to generate the default value.</span>
<span class="gi">+</span>
<span class="gi">+            This doesn&#39;t affect `Path` parameters as the value is always required.</span>
<span class="gi">+            The parameter is available only for compatibility.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    alias: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            An alternative name for the parameter field.</span>
<span class="gi">+</span>
<span class="gi">+            This will be used to extract the data and for the generated OpenAPI.</span>
<span class="gi">+            It is particularly useful when you can&#39;t use the name you want because it</span>
<span class="gi">+            is a Python reserved keyword or similar.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    alias_priority: Annotated[</span>
<span class="gi">+        Union[int, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Priority of the alias. This affects whether an alias generator is used.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    # TODO: update when deprecating Pydantic v1, import these types</span>
<span class="gi">+    # validation_alias: str | AliasPath | AliasChoices | None</span>
<span class="gi">+    validation_alias: Annotated[</span>
<span class="gi">+        Union[str, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            &#39;Whitelist&#39; validation step. The parameter field will be the single one</span>
<span class="gi">+            allowed by the alias or set of aliases defined.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    serialization_alias: Annotated[</span>
<span class="gi">+        Union[str, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            &#39;Blacklist&#39; validation step. The vanilla parameter field will be the</span>
<span class="gi">+            single one of the alias&#39; or set of aliases&#39; fields and all the other</span>
<span class="gi">+            fields will be ignored at serialization time.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    title: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Human-readable title.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    description: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Human-readable description.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    gt: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Greater than. If set, value must be greater than this. Only applicable to</span>
<span class="gi">+            numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    ge: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Greater than or equal. If set, value must be greater than or equal to</span>
<span class="gi">+            this. Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    lt: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Less than. If set, value must be less than this. Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    le: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Less than or equal. If set, value must be less than or equal to this.</span>
<span class="gi">+            Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    min_length: Annotated[</span>
<span class="gi">+        Optional[int],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Minimum length for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    max_length: Annotated[</span>
<span class="gi">+        Optional[int],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Maximum length for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    pattern: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            RegEx pattern for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    regex: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            RegEx pattern for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+        deprecated(</span>
<span class="gi">+            &quot;Deprecated in FastAPI 0.100.0 and Pydantic v2, use `pattern` instead.&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    discriminator: Annotated[</span>
<span class="gi">+        Union[str, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Parameter field name for discriminating the type in a tagged union.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    strict: Annotated[</span>
<span class="gi">+        Union[bool, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            If `True`, strict validation is applied to the field.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    multiple_of: Annotated[</span>
<span class="gi">+        Union[float, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Value must be a multiple of this. Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    allow_inf_nan: Annotated[</span>
<span class="gi">+        Union[bool, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Allow `inf`, `-inf`, `nan`. Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    max_digits: Annotated[</span>
<span class="gi">+        Union[int, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Maximum number of allow digits for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    decimal_places: Annotated[</span>
<span class="gi">+        Union[int, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Maximum number of decimal places allowed for numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    examples: Annotated[</span>
<span class="gi">+        Optional[List[Any]],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Example values for this field.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    example: Annotated[</span>
<span class="gi">+        Optional[Any],</span>
<span class="gi">+        deprecated(</span>
<span class="gi">+            &quot;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, &quot;</span>
<span class="gi">+            &quot;although still supported. Use examples instead.&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    openapi_examples: Annotated[</span>
<span class="gi">+        Optional[Dict[str, Example]],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            OpenAPI-specific examples.</span>
<span class="gi">+</span>
<span class="gi">+            It will be added to the generated OpenAPI (e.g. visible at `/docs`).</span>
<span class="gi">+</span>
<span class="gi">+            Swagger UI (that provides the `/docs` interface) has better support for the</span>
<span class="gi">+            OpenAPI-specific examples than the JSON Schema `examples`, that&#39;s the main</span>
<span class="gi">+            use case for this.</span>
<span class="gi">+</span>
<span class="gi">+            Read more about it in the</span>
<span class="gi">+            [FastAPI docs for Declare Request Example Data](https://fastapi.tiangolo.com/tutorial/schema-extra-example/#using-the-openapi_examples-parameter).</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    deprecated: Annotated[</span>
<span class="gi">+        Union[deprecated, str, bool, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Mark this parameter field as deprecated.</span>
<span class="gi">+</span>
<span class="gi">+            It will affect the generated OpenAPI (e.g. visible at `/docs`).</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    include_in_schema: Annotated[</span>
<span class="gi">+        bool,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            To include (or not) this parameter field in the generated OpenAPI.</span>
<span class="gi">+            You probably don&#39;t need it, but it&#39;s available.</span>
<span class="gi">+</span>
<span class="gi">+            This affects the generated OpenAPI (e.g. visible at `/docs`).</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = True,</span>
<span class="gi">+    json_schema_extra: Annotated[</span>
<span class="gi">+        Union[Dict[str, Any], None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Any additional JSON schema data.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    **extra: Annotated[</span>
<span class="gi">+        Any,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Include extra fields used by the JSON Schema.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+        deprecated(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            The `extra` kwargs is deprecated. Use `json_schema_extra` instead.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ],</span>
<span class="gi">+) -&gt; Any:</span>
<span class="gi">+    return params.Query(</span>
<span class="gi">+        default=default,</span>
<span class="gi">+        default_factory=default_factory,</span>
<span class="gi">+        alias=alias,</span>
<span class="gi">+        alias_priority=alias_priority,</span>
<span class="gi">+        validation_alias=validation_alias,</span>
<span class="gi">+        serialization_alias=serialization_alias,</span>
<span class="gi">+        title=title,</span>
<span class="gi">+        description=description,</span>
<span class="gi">+        gt=gt,</span>
<span class="gi">+        ge=ge,</span>
<span class="gi">+        lt=lt,</span>
<span class="gi">+        le=le,</span>
<span class="gi">+        min_length=min_length,</span>
<span class="gi">+        max_length=max_length,</span>
<span class="gi">+        pattern=pattern,</span>
<span class="gi">+        regex=regex,</span>
<span class="gi">+        discriminator=discriminator,</span>
<span class="gi">+        strict=strict,</span>
<span class="gi">+        multiple_of=multiple_of,</span>
<span class="gi">+        allow_inf_nan=allow_inf_nan,</span>
<span class="gi">+        max_digits=max_digits,</span>
<span class="gi">+        decimal_places=decimal_places,</span>
<span class="gi">+        example=example,</span>
<span class="gi">+        examples=examples,</span>
<span class="gi">+        openapi_examples=openapi_examples,</span>
<span class="gi">+        deprecated=deprecated,</span>
<span class="gi">+        include_in_schema=include_in_schema,</span>
<span class="gi">+        json_schema_extra=json_schema_extra,</span>
<span class="gi">+        **extra,</span>
<span class="gi">+    )</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def Header(  # noqa: N802</span>
<span class="gi">+    default: Annotated[</span>
<span class="gi">+        Any,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Default value if the parameter field is not set.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = Undefined,</span>
<span class="gi">+    *,</span>
<span class="gi">+    default_factory: Annotated[</span>
<span class="gi">+        Union[Callable[[], Any], None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            A callable to generate the default value.</span>
<span class="gi">+</span>
<span class="gi">+            This doesn&#39;t affect `Path` parameters as the value is always required.</span>
<span class="gi">+            The parameter is available only for compatibility.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    alias: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            An alternative name for the parameter field.</span>
<span class="gi">+</span>
<span class="gi">+            This will be used to extract the data and for the generated OpenAPI.</span>
<span class="gi">+            It is particularly useful when you can&#39;t use the name you want because it</span>
<span class="gi">+            is a Python reserved keyword or similar.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    alias_priority: Annotated[</span>
<span class="gi">+        Union[int, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Priority of the alias. This affects whether an alias generator is used.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    # TODO: update when deprecating Pydantic v1, import these types</span>
<span class="gi">+    # validation_alias: str | AliasPath | AliasChoices | None</span>
<span class="gi">+    validation_alias: Annotated[</span>
<span class="gi">+        Union[str, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            &#39;Whitelist&#39; validation step. The parameter field will be the single one</span>
<span class="gi">+            allowed by the alias or set of aliases defined.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    serialization_alias: Annotated[</span>
<span class="gi">+        Union[str, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            &#39;Blacklist&#39; validation step. The vanilla parameter field will be the</span>
<span class="gi">+            single one of the alias&#39; or set of aliases&#39; fields and all the other</span>
<span class="gi">+            fields will be ignored at serialization time.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    convert_underscores: Annotated[</span>
<span class="gi">+        bool,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Automatically convert underscores to hyphens in the parameter field name.</span>
<span class="gi">+</span>
<span class="gi">+            Read more about it in the</span>
<span class="gi">+            [FastAPI docs for Header Parameters](https://fastapi.tiangolo.com/tutorial/header-params/#automatic-conversion)</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = True,</span>
<span class="gi">+    title: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Human-readable title.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    description: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Human-readable description.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    gt: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Greater than. If set, value must be greater than this. Only applicable to</span>
<span class="gi">+            numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    ge: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Greater than or equal. If set, value must be greater than or equal to</span>
<span class="gi">+            this. Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    lt: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Less than. If set, value must be less than this. Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    le: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Less than or equal. If set, value must be less than or equal to this.</span>
<span class="gi">+            Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    min_length: Annotated[</span>
<span class="gi">+        Optional[int],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Minimum length for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    max_length: Annotated[</span>
<span class="gi">+        Optional[int],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Maximum length for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    pattern: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            RegEx pattern for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    regex: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            RegEx pattern for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+        deprecated(</span>
<span class="gi">+            &quot;Deprecated in FastAPI 0.100.0 and Pydantic v2, use `pattern` instead.&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    discriminator: Annotated[</span>
<span class="gi">+        Union[str, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Parameter field name for discriminating the type in a tagged union.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    strict: Annotated[</span>
<span class="gi">+        Union[bool, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            If `True`, strict validation is applied to the field.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    multiple_of: Annotated[</span>
<span class="gi">+        Union[float, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Value must be a multiple of this. Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    allow_inf_nan: Annotated[</span>
<span class="gi">+        Union[bool, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Allow `inf`, `-inf`, `nan`. Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    max_digits: Annotated[</span>
<span class="gi">+        Union[int, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Maximum number of allow digits for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    decimal_places: Annotated[</span>
<span class="gi">+        Union[int, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Maximum number of decimal places allowed for numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    examples: Annotated[</span>
<span class="gi">+        Optional[List[Any]],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Example values for this field.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    example: Annotated[</span>
<span class="gi">+        Optional[Any],</span>
<span class="gi">+        deprecated(</span>
<span class="gi">+            &quot;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, &quot;</span>
<span class="gi">+            &quot;although still supported. Use examples instead.&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    openapi_examples: Annotated[</span>
<span class="gi">+        Optional[Dict[str, Example]],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            OpenAPI-specific examples.</span>
<span class="gi">+</span>
<span class="gi">+            It will be added to the generated OpenAPI (e.g. visible at `/docs`).</span>
<span class="gi">+</span>
<span class="gi">+            Swagger UI (that provides the `/docs` interface) has better support for the</span>
<span class="gi">+            OpenAPI-specific examples than the JSON Schema `examples`, that&#39;s the main</span>
<span class="gi">+            use case for this.</span>
<span class="gi">+</span>
<span class="gi">+            Read more about it in the</span>
<span class="gi">+            [FastAPI docs for Declare Request Example Data](https://fastapi.tiangolo.com/tutorial/schema-extra-example/#using-the-openapi_examples-parameter).</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    deprecated: Annotated[</span>
<span class="gi">+        Union[deprecated, str, bool, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Mark this parameter field as deprecated.</span>
<span class="gi">+</span>
<span class="gi">+            It will affect the generated OpenAPI (e.g. visible at `/docs`).</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    include_in_schema: Annotated[</span>
<span class="gi">+        bool,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            To include (or not) this parameter field in the generated OpenAPI.</span>
<span class="gi">+            You probably don&#39;t need it, but it&#39;s available.</span>
<span class="gi">+</span>
<span class="gi">+            This affects the generated OpenAPI (e.g. visible at `/docs`).</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = True,</span>
<span class="gi">+    json_schema_extra: Annotated[</span>
<span class="gi">+        Union[Dict[str, Any], None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Any additional JSON schema data.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    **extra: Annotated[</span>
<span class="gi">+        Any,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Include extra fields used by the JSON Schema.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+        deprecated(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            The `extra` kwargs is deprecated. Use `json_schema_extra` instead.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ],</span>
<span class="gi">+) -&gt; Any:</span>
<span class="gi">+    return params.Header(</span>
<span class="gi">+        default=default,</span>
<span class="gi">+        default_factory=default_factory,</span>
<span class="gi">+        alias=alias,</span>
<span class="gi">+        alias_priority=alias_priority,</span>
<span class="gi">+        validation_alias=validation_alias,</span>
<span class="gi">+        serialization_alias=serialization_alias,</span>
<span class="gi">+        convert_underscores=convert_underscores,</span>
<span class="gi">+        title=title,</span>
<span class="gi">+        description=description,</span>
<span class="gi">+        gt=gt,</span>
<span class="gi">+        ge=ge,</span>
<span class="gi">+        lt=lt,</span>
<span class="gi">+        le=le,</span>
<span class="gi">+        min_length=min_length,</span>
<span class="gi">+        max_length=max_length,</span>
<span class="gi">+        pattern=pattern,</span>
<span class="gi">+        regex=regex,</span>
<span class="gi">+        discriminator=discriminator,</span>
<span class="gi">+        strict=strict,</span>
<span class="gi">+        multiple_of=multiple_of,</span>
<span class="gi">+        allow_inf_nan=allow_inf_nan,</span>
<span class="gi">+        max_digits=max_digits,</span>
<span class="gi">+        decimal_places=decimal_places,</span>
<span class="gi">+        example=example,</span>
<span class="gi">+        examples=examples,</span>
<span class="gi">+        openapi_examples=openapi_examples,</span>
<span class="gi">+        deprecated=deprecated,</span>
<span class="gi">+        include_in_schema=include_in_schema,</span>
<span class="gi">+        json_schema_extra=json_schema_extra,</span>
<span class="gi">+        **extra,</span>
<span class="gi">+    )</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def Cookie(  # noqa: N802</span>
<span class="gi">+    default: Annotated[</span>
<span class="gi">+        Any,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Default value if the parameter field is not set.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = Undefined,</span>
<span class="gi">+    *,</span>
<span class="gi">+    default_factory: Annotated[</span>
<span class="gi">+        Union[Callable[[], Any], None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            A callable to generate the default value.</span>
<span class="gi">+</span>
<span class="gi">+            This doesn&#39;t affect `Path` parameters as the value is always required.</span>
<span class="gi">+            The parameter is available only for compatibility.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    alias: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            An alternative name for the parameter field.</span>
<span class="gi">+</span>
<span class="gi">+            This will be used to extract the data and for the generated OpenAPI.</span>
<span class="gi">+            It is particularly useful when you can&#39;t use the name you want because it</span>
<span class="gi">+            is a Python reserved keyword or similar.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    alias_priority: Annotated[</span>
<span class="gi">+        Union[int, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Priority of the alias. This affects whether an alias generator is used.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    # TODO: update when deprecating Pydantic v1, import these types</span>
<span class="gi">+    # validation_alias: str | AliasPath | AliasChoices | None</span>
<span class="gi">+    validation_alias: Annotated[</span>
<span class="gi">+        Union[str, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            &#39;Whitelist&#39; validation step. The parameter field will be the single one</span>
<span class="gi">+            allowed by the alias or set of aliases defined.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    serialization_alias: Annotated[</span>
<span class="gi">+        Union[str, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            &#39;Blacklist&#39; validation step. The vanilla parameter field will be the</span>
<span class="gi">+            single one of the alias&#39; or set of aliases&#39; fields and all the other</span>
<span class="gi">+            fields will be ignored at serialization time.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    title: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Human-readable title.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    description: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Human-readable description.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    gt: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Greater than. If set, value must be greater than this. Only applicable to</span>
<span class="gi">+            numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    ge: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Greater than or equal. If set, value must be greater than or equal to</span>
<span class="gi">+            this. Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    lt: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Less than. If set, value must be less than this. Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    le: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Less than or equal. If set, value must be less than or equal to this.</span>
<span class="gi">+            Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    min_length: Annotated[</span>
<span class="gi">+        Optional[int],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Minimum length for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    max_length: Annotated[</span>
<span class="gi">+        Optional[int],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Maximum length for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    pattern: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            RegEx pattern for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    regex: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            RegEx pattern for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+        deprecated(</span>
<span class="gi">+            &quot;Deprecated in FastAPI 0.100.0 and Pydantic v2, use `pattern` instead.&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    discriminator: Annotated[</span>
<span class="gi">+        Union[str, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Parameter field name for discriminating the type in a tagged union.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    strict: Annotated[</span>
<span class="gi">+        Union[bool, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            If `True`, strict validation is applied to the field.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    multiple_of: Annotated[</span>
<span class="gi">+        Union[float, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Value must be a multiple of this. Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    allow_inf_nan: Annotated[</span>
<span class="gi">+        Union[bool, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Allow `inf`, `-inf`, `nan`. Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    max_digits: Annotated[</span>
<span class="gi">+        Union[int, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Maximum number of allow digits for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    decimal_places: Annotated[</span>
<span class="gi">+        Union[int, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Maximum number of decimal places allowed for numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    examples: Annotated[</span>
<span class="gi">+        Optional[List[Any]],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Example values for this field.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    example: Annotated[</span>
<span class="gi">+        Optional[Any],</span>
<span class="gi">+        deprecated(</span>
<span class="gi">+            &quot;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, &quot;</span>
<span class="gi">+            &quot;although still supported. Use examples instead.&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    openapi_examples: Annotated[</span>
<span class="gi">+        Optional[Dict[str, Example]],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            OpenAPI-specific examples.</span>
<span class="gi">+</span>
<span class="gi">+            It will be added to the generated OpenAPI (e.g. visible at `/docs`).</span>
<span class="gi">+</span>
<span class="gi">+            Swagger UI (that provides the `/docs` interface) has better support for the</span>
<span class="gi">+            OpenAPI-specific examples than the JSON Schema `examples`, that&#39;s the main</span>
<span class="gi">+            use case for this.</span>
<span class="gi">+</span>
<span class="gi">+            Read more about it in the</span>
<span class="gi">+            [FastAPI docs for Declare Request Example Data](https://fastapi.tiangolo.com/tutorial/schema-extra-example/#using-the-openapi_examples-parameter).</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    deprecated: Annotated[</span>
<span class="gi">+        Union[deprecated, str, bool, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Mark this parameter field as deprecated.</span>
<span class="gi">+</span>
<span class="gi">+            It will affect the generated OpenAPI (e.g. visible at `/docs`).</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    include_in_schema: Annotated[</span>
<span class="gi">+        bool,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            To include (or not) this parameter field in the generated OpenAPI.</span>
<span class="gi">+            You probably don&#39;t need it, but it&#39;s available.</span>
<span class="gi">+</span>
<span class="gi">+            This affects the generated OpenAPI (e.g. visible at `/docs`).</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = True,</span>
<span class="gi">+    json_schema_extra: Annotated[</span>
<span class="gi">+        Union[Dict[str, Any], None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Any additional JSON schema data.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    **extra: Annotated[</span>
<span class="gi">+        Any,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Include extra fields used by the JSON Schema.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+        deprecated(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            The `extra` kwargs is deprecated. Use `json_schema_extra` instead.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ],</span>
<span class="gi">+) -&gt; Any:</span>
<span class="gi">+    return params.Cookie(</span>
<span class="gi">+        default=default,</span>
<span class="gi">+        default_factory=default_factory,</span>
<span class="gi">+        alias=alias,</span>
<span class="gi">+        alias_priority=alias_priority,</span>
<span class="gi">+        validation_alias=validation_alias,</span>
<span class="gi">+        serialization_alias=serialization_alias,</span>
<span class="gi">+        title=title,</span>
<span class="gi">+        description=description,</span>
<span class="gi">+        gt=gt,</span>
<span class="gi">+        ge=ge,</span>
<span class="gi">+        lt=lt,</span>
<span class="gi">+        le=le,</span>
<span class="gi">+        min_length=min_length,</span>
<span class="gi">+        max_length=max_length,</span>
<span class="gi">+        pattern=pattern,</span>
<span class="gi">+        regex=regex,</span>
<span class="gi">+        discriminator=discriminator,</span>
<span class="gi">+        strict=strict,</span>
<span class="gi">+        multiple_of=multiple_of,</span>
<span class="gi">+        allow_inf_nan=allow_inf_nan,</span>
<span class="gi">+        max_digits=max_digits,</span>
<span class="gi">+        decimal_places=decimal_places,</span>
<span class="gi">+        example=example,</span>
<span class="gi">+        examples=examples,</span>
<span class="gi">+        openapi_examples=openapi_examples,</span>
<span class="gi">+        deprecated=deprecated,</span>
<span class="gi">+        include_in_schema=include_in_schema,</span>
<span class="gi">+        json_schema_extra=json_schema_extra,</span>
<span class="gi">+        **extra,</span>
<span class="gi">+    )</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def Body(  # noqa: N802</span>
<span class="gi">+    default: Annotated[</span>
<span class="gi">+        Any,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Default value if the parameter field is not set.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = Undefined,</span>
<span class="gi">+    *,</span>
<span class="gi">+    default_factory: Annotated[</span>
<span class="gi">+        Union[Callable[[], Any], None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            A callable to generate the default value.</span>
<span class="gi">+</span>
<span class="gi">+            This doesn&#39;t affect `Path` parameters as the value is always required.</span>
<span class="gi">+            The parameter is available only for compatibility.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    embed: Annotated[</span>
<span class="gi">+        bool,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            When `embed` is `True`, the parameter will be expected in a JSON body as a</span>
<span class="gi">+            key instead of being the JSON body itself.</span>
<span class="gi">+</span>
<span class="gi">+            This happens automatically when more than one `Body` parameter is declared.</span>
<span class="gi">+</span>
<span class="gi">+            Read more about it in the</span>
<span class="gi">+            [FastAPI docs for Body - Multiple Parameters](https://fastapi.tiangolo.com/tutorial/body-multiple-params/#embed-a-single-body-parameter).</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = False,</span>
<span class="gi">+    media_type: Annotated[</span>
<span class="gi">+        str,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            The media type of this parameter field. Changing it would affect the</span>
<span class="gi">+            generated OpenAPI, but currently it doesn&#39;t affect the parsing of the data.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = &quot;application/json&quot;,</span>
<span class="gi">+    alias: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            An alternative name for the parameter field.</span>
<span class="gi">+</span>
<span class="gi">+            This will be used to extract the data and for the generated OpenAPI.</span>
<span class="gi">+            It is particularly useful when you can&#39;t use the name you want because it</span>
<span class="gi">+            is a Python reserved keyword or similar.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    alias_priority: Annotated[</span>
<span class="gi">+        Union[int, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Priority of the alias. This affects whether an alias generator is used.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    # TODO: update when deprecating Pydantic v1, import these types</span>
<span class="gi">+    # validation_alias: str | AliasPath | AliasChoices | None</span>
<span class="gi">+    validation_alias: Annotated[</span>
<span class="gi">+        Union[str, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            &#39;Whitelist&#39; validation step. The parameter field will be the single one</span>
<span class="gi">+            allowed by the alias or set of aliases defined.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    serialization_alias: Annotated[</span>
<span class="gi">+        Union[str, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            &#39;Blacklist&#39; validation step. The vanilla parameter field will be the</span>
<span class="gi">+            single one of the alias&#39; or set of aliases&#39; fields and all the other</span>
<span class="gi">+            fields will be ignored at serialization time.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    title: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Human-readable title.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    description: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Human-readable description.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    gt: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Greater than. If set, value must be greater than this. Only applicable to</span>
<span class="gi">+            numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    ge: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Greater than or equal. If set, value must be greater than or equal to</span>
<span class="gi">+            this. Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    lt: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Less than. If set, value must be less than this. Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    le: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Less than or equal. If set, value must be less than or equal to this.</span>
<span class="gi">+            Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    min_length: Annotated[</span>
<span class="gi">+        Optional[int],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Minimum length for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    max_length: Annotated[</span>
<span class="gi">+        Optional[int],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Maximum length for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    pattern: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            RegEx pattern for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    regex: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            RegEx pattern for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+        deprecated(</span>
<span class="gi">+            &quot;Deprecated in FastAPI 0.100.0 and Pydantic v2, use `pattern` instead.&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    discriminator: Annotated[</span>
<span class="gi">+        Union[str, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Parameter field name for discriminating the type in a tagged union.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    strict: Annotated[</span>
<span class="gi">+        Union[bool, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            If `True`, strict validation is applied to the field.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    multiple_of: Annotated[</span>
<span class="gi">+        Union[float, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Value must be a multiple of this. Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    allow_inf_nan: Annotated[</span>
<span class="gi">+        Union[bool, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Allow `inf`, `-inf`, `nan`. Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    max_digits: Annotated[</span>
<span class="gi">+        Union[int, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Maximum number of allow digits for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    decimal_places: Annotated[</span>
<span class="gi">+        Union[int, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Maximum number of decimal places allowed for numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    examples: Annotated[</span>
<span class="gi">+        Optional[List[Any]],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Example values for this field.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    example: Annotated[</span>
<span class="gi">+        Optional[Any],</span>
<span class="gi">+        deprecated(</span>
<span class="gi">+            &quot;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, &quot;</span>
<span class="gi">+            &quot;although still supported. Use examples instead.&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    openapi_examples: Annotated[</span>
<span class="gi">+        Optional[Dict[str, Example]],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            OpenAPI-specific examples.</span>
<span class="gi">+</span>
<span class="gi">+            It will be added to the generated OpenAPI (e.g. visible at `/docs`).</span>
<span class="gi">+</span>
<span class="gi">+            Swagger UI (that provides the `/docs` interface) has better support for the</span>
<span class="gi">+            OpenAPI-specific examples than the JSON Schema `examples`, that&#39;s the main</span>
<span class="gi">+            use case for this.</span>

<span class="gd">-            This doesn&#39;t affect `Path` parameters as the value is always required.</span>
<span class="gd">-            The parameter is available only for compatibility.</span>
<span class="gi">+            Read more about it in the</span>
<span class="gi">+            [FastAPI docs for Declare Request Example Data](https://fastapi.tiangolo.com/tutorial/schema-extra-example/#using-the-openapi_examples-parameter).</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    deprecated: Annotated[</span>
<span class="gi">+        Union[deprecated, str, bool, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Mark this parameter field as deprecated.</span>
<span class="gi">+</span>
<span class="gi">+            It will affect the generated OpenAPI (e.g. visible at `/docs`).</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    include_in_schema: Annotated[</span>
<span class="gi">+        bool,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            To include (or not) this parameter field in the generated OpenAPI.</span>
<span class="gi">+            You probably don&#39;t need it, but it&#39;s available.</span>
<span class="gi">+</span>
<span class="gi">+            This affects the generated OpenAPI (e.g. visible at `/docs`).</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = True,</span>
<span class="gi">+    json_schema_extra: Annotated[</span>
<span class="gi">+        Union[Dict[str, Any], None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Any additional JSON schema data.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    **extra: Annotated[</span>
<span class="gi">+        Any,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Include extra fields used by the JSON Schema.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+        deprecated(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            The `extra` kwargs is deprecated. Use `json_schema_extra` instead.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ],</span>
<span class="gi">+) -&gt; Any:</span>
<span class="gi">+    return params.Body(</span>
<span class="gi">+        default=default,</span>
<span class="gi">+        default_factory=default_factory,</span>
<span class="gi">+        embed=embed,</span>
<span class="gi">+        media_type=media_type,</span>
<span class="gi">+        alias=alias,</span>
<span class="gi">+        alias_priority=alias_priority,</span>
<span class="gi">+        validation_alias=validation_alias,</span>
<span class="gi">+        serialization_alias=serialization_alias,</span>
<span class="gi">+        title=title,</span>
<span class="gi">+        description=description,</span>
<span class="gi">+        gt=gt,</span>
<span class="gi">+        ge=ge,</span>
<span class="gi">+        lt=lt,</span>
<span class="gi">+        le=le,</span>
<span class="gi">+        min_length=min_length,</span>
<span class="gi">+        max_length=max_length,</span>
<span class="gi">+        pattern=pattern,</span>
<span class="gi">+        regex=regex,</span>
<span class="gi">+        discriminator=discriminator,</span>
<span class="gi">+        strict=strict,</span>
<span class="gi">+        multiple_of=multiple_of,</span>
<span class="gi">+        allow_inf_nan=allow_inf_nan,</span>
<span class="gi">+        max_digits=max_digits,</span>
<span class="gi">+        decimal_places=decimal_places,</span>
<span class="gi">+        example=example,</span>
<span class="gi">+        examples=examples,</span>
<span class="gi">+        openapi_examples=openapi_examples,</span>
<span class="gi">+        deprecated=deprecated,</span>
<span class="gi">+        include_in_schema=include_in_schema,</span>
<span class="gi">+        json_schema_extra=json_schema_extra,</span>
<span class="gi">+        **extra,</span>
<span class="gi">+    )</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def Form(  # noqa: N802</span>
<span class="gi">+    default: Annotated[</span>
<span class="gi">+        Any,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Default value if the parameter field is not set.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = Undefined,</span>
<span class="gi">+    *,</span>
<span class="gi">+    default_factory: Annotated[</span>
<span class="gi">+        Union[Callable[[], Any], None],</span>
<span class="gi">+        Doc(</span>
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=..., *, default_factory: Annotated[Union[Callable[[], Any], None],</span>
<span class="gd">-    Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="w"> </span>            A callable to generate the default value.

<span class="w"> </span>            This doesn&#39;t affect `Path` parameters as the value is always required.
<span class="w"> </span>            The parameter is available only for compatibility.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=_Unset, alias: Annotated[Optional[str], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    media_type: Annotated[</span>
<span class="gi">+        str,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            The media type of this parameter field. Changing it would affect the</span>
<span class="gi">+            generated OpenAPI, but currently it doesn&#39;t affect the parsing of the data.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = &quot;application/x-www-form-urlencoded&quot;,</span>
<span class="gi">+    alias: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            An alternative name for the parameter field.

<span class="w"> </span>            This will be used to extract the data and for the generated OpenAPI.
<span class="w"> </span>            It is particularly useful when you can&#39;t use the name you want because it
<span class="w"> </span>            is a Python reserved keyword or similar.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=None, alias_priority: Annotated[Union[int, None], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    alias_priority: Annotated[</span>
<span class="gi">+        Union[int, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Priority of the alias. This affects whether an alias generator is used.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=_Unset, validation_alias: Annotated[Union[str, None], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    # TODO: update when deprecating Pydantic v1, import these types</span>
<span class="gi">+    # validation_alias: str | AliasPath | AliasChoices | None</span>
<span class="gi">+    validation_alias: Annotated[</span>
<span class="gi">+        Union[str, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            &#39;Whitelist&#39; validation step. The parameter field will be the single one
<span class="w"> </span>            allowed by the alias or set of aliases defined.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=None, serialization_alias: Annotated[Union[str, None], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    serialization_alias: Annotated[</span>
<span class="gi">+        Union[str, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            &#39;Blacklist&#39; validation step. The vanilla parameter field will be the
<span class="w"> </span>            single one of the alias&#39; or set of aliases&#39; fields and all the other
<span class="w"> </span>            fields will be ignored at serialization time.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=None, title: Annotated[Optional[str], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    title: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Human-readable title.
<span class="gd">-            &quot;&quot;&quot;)]=None,</span>
<span class="gd">-    description: Annotated[Optional[str], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    description: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Human-readable description.
<span class="gd">-            &quot;&quot;&quot;)]=None, gt:</span>
<span class="gd">-    Annotated[Optional[float], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    gt: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Greater than. If set, value must be greater than this. Only applicable to
<span class="w"> </span>            numbers.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=None, ge: Annotated[Optional[float], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    ge: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Greater than or equal. If set, value must be greater than or equal to
<span class="w"> </span>            this. Only applicable to numbers.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=None, lt: Annotated[Optional[float], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    lt: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Less than. If set, value must be less than this. Only applicable to numbers.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=None, le: Annotated[Optional[float], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    le: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Less than or equal. If set, value must be less than or equal to this.
<span class="w"> </span>            Only applicable to numbers.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=None, min_length: Annotated[Optional[int], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    min_length: Annotated[</span>
<span class="gi">+        Optional[int],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Minimum length for strings.
<span class="gd">-            &quot;&quot;&quot;)]=None,</span>
<span class="gd">-    max_length: Annotated[Optional[int], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    max_length: Annotated[</span>
<span class="gi">+        Optional[int],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Maximum length for strings.
<span class="gd">-            &quot;&quot;&quot;)]=None,</span>
<span class="gd">-    pattern: Annotated[Optional[str], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    pattern: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            RegEx pattern for strings.
<span class="gd">-            &quot;&quot;&quot;)]=None,</span>
<span class="gd">-    regex: Annotated[Optional[str], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    regex: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            RegEx pattern for strings.
<span class="gd">-            &quot;&quot;&quot;), deprecated</span>
<span class="gd">-    (</span>
<span class="gd">-    &#39;Deprecated in FastAPI 0.100.0 and Pydantic v2, use `pattern` instead.&#39;</span>
<span class="gd">-    )]=None, discriminator: Annotated[Union[str, None], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+        deprecated(</span>
<span class="gi">+            &quot;Deprecated in FastAPI 0.100.0 and Pydantic v2, use `pattern` instead.&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    discriminator: Annotated[</span>
<span class="gi">+        Union[str, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Parameter field name for discriminating the type in a tagged union.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=None, strict: Annotated[Union[bool, None], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    strict: Annotated[</span>
<span class="gi">+        Union[bool, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            If `True`, strict validation is applied to the field.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=_Unset, multiple_of: Annotated[Union[float, None], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    multiple_of: Annotated[</span>
<span class="gi">+        Union[float, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Value must be a multiple of this. Only applicable to numbers.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=_Unset, allow_inf_nan: Annotated[Union[bool, None], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    allow_inf_nan: Annotated[</span>
<span class="gi">+        Union[bool, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Allow `inf`, `-inf`, `nan`. Only applicable to numbers.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=_Unset, max_digits: Annotated[Union[int, None], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    max_digits: Annotated[</span>
<span class="gi">+        Union[int, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Maximum number of allow digits for strings.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=_Unset, decimal_places: Annotated[Union[int, None], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    decimal_places: Annotated[</span>
<span class="gi">+        Union[int, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Maximum number of decimal places allowed for numbers.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=_Unset, examples: Annotated[Optional[List[Any]], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    examples: Annotated[</span>
<span class="gi">+        Optional[List[Any]],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Example values for this field.
<span class="gd">-            &quot;&quot;&quot;)]=None,</span>
<span class="gd">-    example: Annotated[Optional[Any], deprecated(</span>
<span class="gd">-    &#39;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, although still supported. Use examples instead.&#39;</span>
<span class="gd">-    )]=_Unset, openapi_examples: Annotated[Optional[Dict[str, Example]],</span>
<span class="gd">-    Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    example: Annotated[</span>
<span class="gi">+        Optional[Any],</span>
<span class="gi">+        deprecated(</span>
<span class="gi">+            &quot;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, &quot;</span>
<span class="gi">+            &quot;although still supported. Use examples instead.&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    openapi_examples: Annotated[</span>
<span class="gi">+        Optional[Dict[str, Example]],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            OpenAPI-specific examples.

<span class="w"> </span>            It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -133,65 +1824,416 @@ def Path(default: Annotated[Any, Doc(</span>
<span class="w"> </span>            Read more about it in the
<span class="w"> </span>            [FastAPI docs for Declare Request Example Data](https://fastapi.tiangolo.com/tutorial/schema-extra-example/#using-the-openapi_examples-parameter).
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=None, deprecated: Annotated[Union[deprecated, str, bool, None], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    deprecated: Annotated[</span>
<span class="gi">+        Union[deprecated, str, bool, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Mark this parameter field as deprecated.

<span class="w"> </span>            It will affect the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=None, include_in_schema: Annotated[bool, Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    include_in_schema: Annotated[</span>
<span class="gi">+        bool,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            To include (or not) this parameter field in the generated OpenAPI.
<span class="w"> </span>            You probably don&#39;t need it, but it&#39;s available.

<span class="w"> </span>            This affects the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=True, json_schema_extra: Annotated[Union[Dict[str, Any], None], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = True,</span>
<span class="gi">+    json_schema_extra: Annotated[</span>
<span class="gi">+        Union[Dict[str, Any], None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Any additional JSON schema data.
<span class="gd">-            &quot;&quot;&quot;)]=None,</span>
<span class="gd">-    **extra: Annotated[Any, Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    **extra: Annotated[</span>
<span class="gi">+        Any,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            Include extra fields used by the JSON Schema.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    ), deprecated(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+        deprecated(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            The `extra` kwargs is deprecated. Use `json_schema_extra` instead.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]) -&gt;Any:</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gd">-    Declare a path parameter for a *path operation*.</span>
<span class="gi">+        ),</span>
<span class="gi">+    ],</span>
<span class="gi">+) -&gt; Any:</span>
<span class="gi">+    return params.Form(</span>
<span class="gi">+        default=default,</span>
<span class="gi">+        default_factory=default_factory,</span>
<span class="gi">+        media_type=media_type,</span>
<span class="gi">+        alias=alias,</span>
<span class="gi">+        alias_priority=alias_priority,</span>
<span class="gi">+        validation_alias=validation_alias,</span>
<span class="gi">+        serialization_alias=serialization_alias,</span>
<span class="gi">+        title=title,</span>
<span class="gi">+        description=description,</span>
<span class="gi">+        gt=gt,</span>
<span class="gi">+        ge=ge,</span>
<span class="gi">+        lt=lt,</span>
<span class="gi">+        le=le,</span>
<span class="gi">+        min_length=min_length,</span>
<span class="gi">+        max_length=max_length,</span>
<span class="gi">+        pattern=pattern,</span>
<span class="gi">+        regex=regex,</span>
<span class="gi">+        discriminator=discriminator,</span>
<span class="gi">+        strict=strict,</span>
<span class="gi">+        multiple_of=multiple_of,</span>
<span class="gi">+        allow_inf_nan=allow_inf_nan,</span>
<span class="gi">+        max_digits=max_digits,</span>
<span class="gi">+        decimal_places=decimal_places,</span>
<span class="gi">+        example=example,</span>
<span class="gi">+        examples=examples,</span>
<span class="gi">+        openapi_examples=openapi_examples,</span>
<span class="gi">+        deprecated=deprecated,</span>
<span class="gi">+        include_in_schema=include_in_schema,</span>
<span class="gi">+        json_schema_extra=json_schema_extra,</span>
<span class="gi">+        **extra,</span>
<span class="gi">+    )</span>

<span class="gd">-    Read more about it in the</span>
<span class="gd">-    [FastAPI docs for Path Parameters and Numeric Validations](https://fastapi.tiangolo.com/tutorial/path-params-numeric-validations/).</span>

<span class="gd">-    ```python</span>
<span class="gd">-    from typing import Annotated</span>
<span class="gi">+def File(  # noqa: N802</span>
<span class="gi">+    default: Annotated[</span>
<span class="gi">+        Any,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Default value if the parameter field is not set.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = Undefined,</span>
<span class="gi">+    *,</span>
<span class="gi">+    default_factory: Annotated[</span>
<span class="gi">+        Union[Callable[[], Any], None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            A callable to generate the default value.</span>

<span class="gd">-    from fastapi import FastAPI, Path</span>
<span class="gi">+            This doesn&#39;t affect `Path` parameters as the value is always required.</span>
<span class="gi">+            The parameter is available only for compatibility.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    media_type: Annotated[</span>
<span class="gi">+        str,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            The media type of this parameter field. Changing it would affect the</span>
<span class="gi">+            generated OpenAPI, but currently it doesn&#39;t affect the parsing of the data.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = &quot;multipart/form-data&quot;,</span>
<span class="gi">+    alias: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            An alternative name for the parameter field.</span>

<span class="gd">-    app = FastAPI()</span>
<span class="gi">+            This will be used to extract the data and for the generated OpenAPI.</span>
<span class="gi">+            It is particularly useful when you can&#39;t use the name you want because it</span>
<span class="gi">+            is a Python reserved keyword or similar.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    alias_priority: Annotated[</span>
<span class="gi">+        Union[int, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Priority of the alias. This affects whether an alias generator is used.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    # TODO: update when deprecating Pydantic v1, import these types</span>
<span class="gi">+    # validation_alias: str | AliasPath | AliasChoices | None</span>
<span class="gi">+    validation_alias: Annotated[</span>
<span class="gi">+        Union[str, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            &#39;Whitelist&#39; validation step. The parameter field will be the single one</span>
<span class="gi">+            allowed by the alias or set of aliases defined.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    serialization_alias: Annotated[</span>
<span class="gi">+        Union[str, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            &#39;Blacklist&#39; validation step. The vanilla parameter field will be the</span>
<span class="gi">+            single one of the alias&#39; or set of aliases&#39; fields and all the other</span>
<span class="gi">+            fields will be ignored at serialization time.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    title: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Human-readable title.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    description: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Human-readable description.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    gt: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Greater than. If set, value must be greater than this. Only applicable to</span>
<span class="gi">+            numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    ge: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Greater than or equal. If set, value must be greater than or equal to</span>
<span class="gi">+            this. Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    lt: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Less than. If set, value must be less than this. Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    le: Annotated[</span>
<span class="gi">+        Optional[float],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Less than or equal. If set, value must be less than or equal to this.</span>
<span class="gi">+            Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    min_length: Annotated[</span>
<span class="gi">+        Optional[int],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Minimum length for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    max_length: Annotated[</span>
<span class="gi">+        Optional[int],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Maximum length for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    pattern: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            RegEx pattern for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    regex: Annotated[</span>
<span class="gi">+        Optional[str],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            RegEx pattern for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+        deprecated(</span>
<span class="gi">+            &quot;Deprecated in FastAPI 0.100.0 and Pydantic v2, use `pattern` instead.&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    discriminator: Annotated[</span>
<span class="gi">+        Union[str, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Parameter field name for discriminating the type in a tagged union.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    strict: Annotated[</span>
<span class="gi">+        Union[bool, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            If `True`, strict validation is applied to the field.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    multiple_of: Annotated[</span>
<span class="gi">+        Union[float, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Value must be a multiple of this. Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    allow_inf_nan: Annotated[</span>
<span class="gi">+        Union[bool, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Allow `inf`, `-inf`, `nan`. Only applicable to numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    max_digits: Annotated[</span>
<span class="gi">+        Union[int, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Maximum number of allow digits for strings.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    decimal_places: Annotated[</span>
<span class="gi">+        Union[int, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Maximum number of decimal places allowed for numbers.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    examples: Annotated[</span>
<span class="gi">+        Optional[List[Any]],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Example values for this field.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    example: Annotated[</span>
<span class="gi">+        Optional[Any],</span>
<span class="gi">+        deprecated(</span>
<span class="gi">+            &quot;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, &quot;</span>
<span class="gi">+            &quot;although still supported. Use examples instead.&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = _Unset,</span>
<span class="gi">+    openapi_examples: Annotated[</span>
<span class="gi">+        Optional[Dict[str, Example]],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            OpenAPI-specific examples.</span>

<span class="gi">+            It will be added to the generated OpenAPI (e.g. visible at `/docs`).</span>

<span class="gd">-    @app.get(&quot;/items/{item_id}&quot;)</span>
<span class="gd">-    async def read_items(</span>
<span class="gd">-        item_id: Annotated[int, Path(title=&quot;The ID of the item to get&quot;)],</span>
<span class="gd">-    ):</span>
<span class="gd">-        return {&quot;item_id&quot;: item_id}</span>
<span class="gd">-    ```</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gd">-    pass</span>
<span class="gi">+            Swagger UI (that provides the `/docs` interface) has better support for the</span>
<span class="gi">+            OpenAPI-specific examples than the JSON Schema `examples`, that&#39;s the main</span>
<span class="gi">+            use case for this.</span>
<span class="gi">+</span>
<span class="gi">+            Read more about it in the</span>
<span class="gi">+            [FastAPI docs for Declare Request Example Data](https://fastapi.tiangolo.com/tutorial/schema-extra-example/#using-the-openapi_examples-parameter).</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    deprecated: Annotated[</span>
<span class="gi">+        Union[deprecated, str, bool, None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Mark this parameter field as deprecated.</span>

<span class="gi">+            It will affect the generated OpenAPI (e.g. visible at `/docs`).</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    include_in_schema: Annotated[</span>
<span class="gi">+        bool,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            To include (or not) this parameter field in the generated OpenAPI.</span>
<span class="gi">+            You probably don&#39;t need it, but it&#39;s available.</span>

<span class="gd">-def Depends(dependency: Annotated[Optional[Callable[..., Any]], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+            This affects the generated OpenAPI (e.g. visible at `/docs`).</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = True,</span>
<span class="gi">+    json_schema_extra: Annotated[</span>
<span class="gi">+        Union[Dict[str, Any], None],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Any additional JSON schema data.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    **extra: Annotated[</span>
<span class="gi">+        Any,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            Include extra fields used by the JSON Schema.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+        deprecated(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            The `extra` kwargs is deprecated. Use `json_schema_extra` instead.</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ],</span>
<span class="gi">+) -&gt; Any:</span>
<span class="gi">+    return params.File(</span>
<span class="gi">+        default=default,</span>
<span class="gi">+        default_factory=default_factory,</span>
<span class="gi">+        media_type=media_type,</span>
<span class="gi">+        alias=alias,</span>
<span class="gi">+        alias_priority=alias_priority,</span>
<span class="gi">+        validation_alias=validation_alias,</span>
<span class="gi">+        serialization_alias=serialization_alias,</span>
<span class="gi">+        title=title,</span>
<span class="gi">+        description=description,</span>
<span class="gi">+        gt=gt,</span>
<span class="gi">+        ge=ge,</span>
<span class="gi">+        lt=lt,</span>
<span class="gi">+        le=le,</span>
<span class="gi">+        min_length=min_length,</span>
<span class="gi">+        max_length=max_length,</span>
<span class="gi">+        pattern=pattern,</span>
<span class="gi">+        regex=regex,</span>
<span class="gi">+        discriminator=discriminator,</span>
<span class="gi">+        strict=strict,</span>
<span class="gi">+        multiple_of=multiple_of,</span>
<span class="gi">+        allow_inf_nan=allow_inf_nan,</span>
<span class="gi">+        max_digits=max_digits,</span>
<span class="gi">+        decimal_places=decimal_places,</span>
<span class="gi">+        example=example,</span>
<span class="gi">+        examples=examples,</span>
<span class="gi">+        openapi_examples=openapi_examples,</span>
<span class="gi">+        deprecated=deprecated,</span>
<span class="gi">+        include_in_schema=include_in_schema,</span>
<span class="gi">+        json_schema_extra=json_schema_extra,</span>
<span class="gi">+        **extra,</span>
<span class="gi">+    )</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def Depends(  # noqa: N802</span>
<span class="gi">+    dependency: Annotated[</span>
<span class="gi">+        Optional[Callable[..., Any]],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            A &quot;dependable&quot; callable (like a function).

<span class="w"> </span>            Don&#39;t call it directly, FastAPI will call it for you, just pass the object
<span class="w"> </span>            directly.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=None, *, use_cache: Annotated[bool, Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    *,</span>
<span class="gi">+    use_cache: Annotated[</span>
<span class="gi">+        bool,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            By default, after a dependency is called the first time in a request, if
<span class="w"> </span>            the dependency is declared again for the rest of the request (for example
<span class="w"> </span>            if the dependency is needed by several dependencies), the value will be
<span class="gu">@@ -200,7 +2242,9 @@ def Depends(dependency: Annotated[Optional[Callable[..., Any]], Doc(</span>
<span class="w"> </span>            Set `use_cache` to `False` to disable this behavior and ensure the
<span class="w"> </span>            dependency is called again (if declared more than once) in the same request.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=True) -&gt;Any:</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = True,</span>
<span class="gi">+) -&gt; Any:</span>
<span class="w"> </span>    &quot;&quot;&quot;
<span class="w"> </span>    Declare a FastAPI dependency.

<span class="gu">@@ -230,18 +2274,26 @@ def Depends(dependency: Annotated[Optional[Callable[..., Any]], Doc(</span>
<span class="w"> </span>        return commons
<span class="w"> </span>    ```
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    return params.Depends(dependency=dependency, use_cache=use_cache)</span>


<span class="gd">-def Security(dependency: Annotated[Optional[Callable[..., Any]], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+def Security(  # noqa: N802</span>
<span class="gi">+    dependency: Annotated[</span>
<span class="gi">+        Optional[Callable[..., Any]],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            A &quot;dependable&quot; callable (like a function).

<span class="w"> </span>            Don&#39;t call it directly, FastAPI will call it for you, just pass the object
<span class="w"> </span>            directly.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=None, *, scopes: Annotated[Optional[Sequence[str]], Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    *,</span>
<span class="gi">+    scopes: Annotated[</span>
<span class="gi">+        Optional[Sequence[str]],</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            OAuth2 scopes required for the *path operation* that uses this Security
<span class="w"> </span>            dependency.

<span class="gu">@@ -253,8 +2305,12 @@ def Security(dependency: Annotated[Optional[Callable[..., Any]], Doc(</span>
<span class="w"> </span>            So they are visible in the OpenAPI specification.
<span class="w"> </span>            )
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=None, use_cache: Annotated[bool, Doc(</span>
<span class="gd">-    &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = None,</span>
<span class="gi">+    use_cache: Annotated[</span>
<span class="gi">+        bool,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            By default, after a dependency is called the first time in a request, if
<span class="w"> </span>            the dependency is declared again for the rest of the request (for example
<span class="w"> </span>            if the dependency is needed by several dependencies), the value will be
<span class="gu">@@ -263,7 +2319,9 @@ def Security(dependency: Annotated[Optional[Callable[..., Any]], Doc(</span>
<span class="w"> </span>            Set `use_cache` to `False` to disable this behavior and ensure the
<span class="w"> </span>            dependency is called again (if declared more than once) in the same request.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-    )]=True) -&gt;Any:</span>
<span class="gi">+        ),</span>
<span class="gi">+    ] = True,</span>
<span class="gi">+) -&gt; Any:</span>
<span class="w"> </span>    &quot;&quot;&quot;
<span class="w"> </span>    Declare a FastAPI Security dependency.

<span class="gu">@@ -299,4 +2357,4 @@ def Security(dependency: Annotated[Optional[Callable[..., Any]], Doc(</span>
<span class="w"> </span>        return [{&quot;item_id&quot;: &quot;Foo&quot;, &quot;owner&quot;: current_user.username}]
<span class="w"> </span>    ```
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    return params.Security(dependency=dependency, scopes=scopes, use_cache=use_cache)</span>
<span class="gh">diff --git a/fastapi/params.py b/fastapi/params.py</span>
<span class="gh">index cebc920a..86014653 100644</span>
<span class="gd">--- a/fastapi/params.py</span>
<span class="gi">+++ b/fastapi/params.py</span>
<span class="gu">@@ -1,391 +1,783 @@</span>
<span class="w"> </span>import warnings
<span class="w"> </span>from enum import Enum
<span class="w"> </span>from typing import Any, Callable, Dict, List, Optional, Sequence, Union
<span class="gi">+</span>
<span class="w"> </span>from fastapi.openapi.models import Example
<span class="w"> </span>from pydantic.fields import FieldInfo
<span class="w"> </span>from typing_extensions import Annotated, deprecated
<span class="gi">+</span>
<span class="w"> </span>from ._compat import PYDANTIC_V2, PYDANTIC_VERSION, Undefined
<span class="gi">+</span>
<span class="w"> </span>_Unset: Any = Undefined


<span class="w"> </span>class ParamTypes(Enum):
<span class="gd">-    query = &#39;query&#39;</span>
<span class="gd">-    header = &#39;header&#39;</span>
<span class="gd">-    path = &#39;path&#39;</span>
<span class="gd">-    cookie = &#39;cookie&#39;</span>
<span class="gi">+    query = &quot;query&quot;</span>
<span class="gi">+    header = &quot;header&quot;</span>
<span class="gi">+    path = &quot;path&quot;</span>
<span class="gi">+    cookie = &quot;cookie&quot;</span>


<span class="w"> </span>class Param(FieldInfo):
<span class="w"> </span>    in_: ParamTypes

<span class="gd">-    def __init__(self, default: Any=Undefined, *, default_factory: Union[</span>
<span class="gd">-        Callable[[], Any], None]=_Unset, annotation: Optional[Any]=None,</span>
<span class="gd">-        alias: Optional[str]=None, alias_priority: Union[int, None]=_Unset,</span>
<span class="gd">-        validation_alias: Union[str, None]=None, serialization_alias: Union</span>
<span class="gd">-        [str, None]=None, title: Optional[str]=None, description: Optional[</span>
<span class="gd">-        str]=None, gt: Optional[float]=None, ge: Optional[float]=None, lt:</span>
<span class="gd">-        Optional[float]=None, le: Optional[float]=None, min_length:</span>
<span class="gd">-        Optional[int]=None, max_length: Optional[int]=None, pattern:</span>
<span class="gd">-        Optional[str]=None, regex: Annotated[Optional[str], deprecated(</span>
<span class="gd">-        &#39;Deprecated in FastAPI 0.100.0 and Pydantic v2, use `pattern` instead.&#39;</span>
<span class="gd">-        )]=None, discriminator: Union[str, None]=None, strict: Union[bool,</span>
<span class="gd">-        None]=_Unset, multiple_of: Union[float, None]=_Unset, allow_inf_nan:</span>
<span class="gd">-        Union[bool, None]=_Unset, max_digits: Union[int, None]=_Unset,</span>
<span class="gd">-        decimal_places: Union[int, None]=_Unset, examples: Optional[List[</span>
<span class="gd">-        Any]]=None, example: Annotated[Optional[Any], deprecated(</span>
<span class="gd">-        &#39;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, although still supported. Use examples instead.&#39;</span>
<span class="gd">-        )]=_Unset, openapi_examples: Optional[Dict[str, Example]]=None,</span>
<span class="gd">-        deprecated: Union[deprecated, str, bool, None]=None,</span>
<span class="gd">-        include_in_schema: bool=True, json_schema_extra: Union[Dict[str,</span>
<span class="gd">-        Any], None]=None, **extra: Any):</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        default: Any = Undefined,</span>
<span class="gi">+        *,</span>
<span class="gi">+        default_factory: Union[Callable[[], Any], None] = _Unset,</span>
<span class="gi">+        annotation: Optional[Any] = None,</span>
<span class="gi">+        alias: Optional[str] = None,</span>
<span class="gi">+        alias_priority: Union[int, None] = _Unset,</span>
<span class="gi">+        # TODO: update when deprecating Pydantic v1, import these types</span>
<span class="gi">+        # validation_alias: str | AliasPath | AliasChoices | None</span>
<span class="gi">+        validation_alias: Union[str, None] = None,</span>
<span class="gi">+        serialization_alias: Union[str, None] = None,</span>
<span class="gi">+        title: Optional[str] = None,</span>
<span class="gi">+        description: Optional[str] = None,</span>
<span class="gi">+        gt: Optional[float] = None,</span>
<span class="gi">+        ge: Optional[float] = None,</span>
<span class="gi">+        lt: Optional[float] = None,</span>
<span class="gi">+        le: Optional[float] = None,</span>
<span class="gi">+        min_length: Optional[int] = None,</span>
<span class="gi">+        max_length: Optional[int] = None,</span>
<span class="gi">+        pattern: Optional[str] = None,</span>
<span class="gi">+        regex: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            deprecated(</span>
<span class="gi">+                &quot;Deprecated in FastAPI 0.100.0 and Pydantic v2, use `pattern` instead.&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        discriminator: Union[str, None] = None,</span>
<span class="gi">+        strict: Union[bool, None] = _Unset,</span>
<span class="gi">+        multiple_of: Union[float, None] = _Unset,</span>
<span class="gi">+        allow_inf_nan: Union[bool, None] = _Unset,</span>
<span class="gi">+        max_digits: Union[int, None] = _Unset,</span>
<span class="gi">+        decimal_places: Union[int, None] = _Unset,</span>
<span class="gi">+        examples: Optional[List[Any]] = None,</span>
<span class="gi">+        example: Annotated[</span>
<span class="gi">+            Optional[Any],</span>
<span class="gi">+            deprecated(</span>
<span class="gi">+                &quot;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, &quot;</span>
<span class="gi">+                &quot;although still supported. Use examples instead.&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = _Unset,</span>
<span class="gi">+        openapi_examples: Optional[Dict[str, Example]] = None,</span>
<span class="gi">+        deprecated: Union[deprecated, str, bool, None] = None,</span>
<span class="gi">+        include_in_schema: bool = True,</span>
<span class="gi">+        json_schema_extra: Union[Dict[str, Any], None] = None,</span>
<span class="gi">+        **extra: Any,</span>
<span class="gi">+    ):</span>
<span class="w"> </span>        if example is not _Unset:
<span class="w"> </span>            warnings.warn(
<span class="gd">-                &#39;`example` has been deprecated, please use `examples` instead&#39;,</span>
<span class="gd">-                category=DeprecationWarning, stacklevel=4)</span>
<span class="gi">+                &quot;`example` has been deprecated, please use `examples` instead&quot;,</span>
<span class="gi">+                category=DeprecationWarning,</span>
<span class="gi">+                stacklevel=4,</span>
<span class="gi">+            )</span>
<span class="w"> </span>        self.example = example
<span class="w"> </span>        self.include_in_schema = include_in_schema
<span class="w"> </span>        self.openapi_examples = openapi_examples
<span class="gd">-        kwargs = dict(default=default, default_factory=default_factory,</span>
<span class="gd">-            alias=alias, title=title, description=description, gt=gt, ge=ge,</span>
<span class="gd">-            lt=lt, le=le, min_length=min_length, max_length=max_length,</span>
<span class="gd">-            discriminator=discriminator, multiple_of=multiple_of, allow_nan</span>
<span class="gd">-            =allow_inf_nan, max_digits=max_digits, decimal_places=</span>
<span class="gd">-            decimal_places, **extra)</span>
<span class="gi">+        kwargs = dict(</span>
<span class="gi">+            default=default,</span>
<span class="gi">+            default_factory=default_factory,</span>
<span class="gi">+            alias=alias,</span>
<span class="gi">+            title=title,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            gt=gt,</span>
<span class="gi">+            ge=ge,</span>
<span class="gi">+            lt=lt,</span>
<span class="gi">+            le=le,</span>
<span class="gi">+            min_length=min_length,</span>
<span class="gi">+            max_length=max_length,</span>
<span class="gi">+            discriminator=discriminator,</span>
<span class="gi">+            multiple_of=multiple_of,</span>
<span class="gi">+            allow_nan=allow_inf_nan,</span>
<span class="gi">+            max_digits=max_digits,</span>
<span class="gi">+            decimal_places=decimal_places,</span>
<span class="gi">+            **extra,</span>
<span class="gi">+        )</span>
<span class="w"> </span>        if examples is not None:
<span class="gd">-            kwargs[&#39;examples&#39;] = examples</span>
<span class="gi">+            kwargs[&quot;examples&quot;] = examples</span>
<span class="w"> </span>        if regex is not None:
<span class="w"> </span>            warnings.warn(
<span class="gd">-                &#39;`regex` has been deprecated, please use `pattern` instead&#39;,</span>
<span class="gd">-                category=DeprecationWarning, stacklevel=4)</span>
<span class="gi">+                &quot;`regex` has been deprecated, please use `pattern` instead&quot;,</span>
<span class="gi">+                category=DeprecationWarning,</span>
<span class="gi">+                stacklevel=4,</span>
<span class="gi">+            )</span>
<span class="w"> </span>        current_json_schema_extra = json_schema_extra or extra
<span class="gd">-        if PYDANTIC_VERSION &lt; &#39;2.7.0&#39;:</span>
<span class="gi">+        if PYDANTIC_VERSION &lt; &quot;2.7.0&quot;:</span>
<span class="w"> </span>            self.deprecated = deprecated
<span class="w"> </span>        else:
<span class="gd">-            kwargs[&#39;deprecated&#39;] = deprecated</span>
<span class="gi">+            kwargs[&quot;deprecated&quot;] = deprecated</span>
<span class="w"> </span>        if PYDANTIC_V2:
<span class="gd">-            kwargs.update({&#39;annotation&#39;: annotation, &#39;alias_priority&#39;:</span>
<span class="gd">-                alias_priority, &#39;validation_alias&#39;: validation_alias,</span>
<span class="gd">-                &#39;serialization_alias&#39;: serialization_alias, &#39;strict&#39;:</span>
<span class="gd">-                strict, &#39;json_schema_extra&#39;: current_json_schema_extra})</span>
<span class="gd">-            kwargs[&#39;pattern&#39;] = pattern or regex</span>
<span class="gi">+            kwargs.update(</span>
<span class="gi">+                {</span>
<span class="gi">+                    &quot;annotation&quot;: annotation,</span>
<span class="gi">+                    &quot;alias_priority&quot;: alias_priority,</span>
<span class="gi">+                    &quot;validation_alias&quot;: validation_alias,</span>
<span class="gi">+                    &quot;serialization_alias&quot;: serialization_alias,</span>
<span class="gi">+                    &quot;strict&quot;: strict,</span>
<span class="gi">+                    &quot;json_schema_extra&quot;: current_json_schema_extra,</span>
<span class="gi">+                }</span>
<span class="gi">+            )</span>
<span class="gi">+            kwargs[&quot;pattern&quot;] = pattern or regex</span>
<span class="w"> </span>        else:
<span class="gd">-            kwargs[&#39;regex&#39;] = pattern or regex</span>
<span class="gi">+            kwargs[&quot;regex&quot;] = pattern or regex</span>
<span class="w"> </span>            kwargs.update(**current_json_schema_extra)
<span class="w"> </span>        use_kwargs = {k: v for k, v in kwargs.items() if v is not _Unset}
<span class="gi">+</span>
<span class="w"> </span>        super().__init__(**use_kwargs)

<span class="gd">-    def __repr__(self) -&gt;str:</span>
<span class="gd">-        return f&#39;{self.__class__.__name__}({self.default})&#39;</span>
<span class="gi">+    def __repr__(self) -&gt; str:</span>
<span class="gi">+        return f&quot;{self.__class__.__name__}({self.default})&quot;</span>


<span class="w"> </span>class Path(Param):
<span class="w"> </span>    in_ = ParamTypes.path

<span class="gd">-    def __init__(self, default: Any=..., *, default_factory: Union[Callable</span>
<span class="gd">-        [[], Any], None]=_Unset, annotation: Optional[Any]=None, alias:</span>
<span class="gd">-        Optional[str]=None, alias_priority: Union[int, None]=_Unset,</span>
<span class="gd">-        validation_alias: Union[str, None]=None, serialization_alias: Union</span>
<span class="gd">-        [str, None]=None, title: Optional[str]=None, description: Optional[</span>
<span class="gd">-        str]=None, gt: Optional[float]=None, ge: Optional[float]=None, lt:</span>
<span class="gd">-        Optional[float]=None, le: Optional[float]=None, min_length:</span>
<span class="gd">-        Optional[int]=None, max_length: Optional[int]=None, pattern:</span>
<span class="gd">-        Optional[str]=None, regex: Annotated[Optional[str], deprecated(</span>
<span class="gd">-        &#39;Deprecated in FastAPI 0.100.0 and Pydantic v2, use `pattern` instead.&#39;</span>
<span class="gd">-        )]=None, discriminator: Union[str, None]=None, strict: Union[bool,</span>
<span class="gd">-        None]=_Unset, multiple_of: Union[float, None]=_Unset, allow_inf_nan:</span>
<span class="gd">-        Union[bool, None]=_Unset, max_digits: Union[int, None]=_Unset,</span>
<span class="gd">-        decimal_places: Union[int, None]=_Unset, examples: Optional[List[</span>
<span class="gd">-        Any]]=None, example: Annotated[Optional[Any], deprecated(</span>
<span class="gd">-        &#39;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, although still supported. Use examples instead.&#39;</span>
<span class="gd">-        )]=_Unset, openapi_examples: Optional[Dict[str, Example]]=None,</span>
<span class="gd">-        deprecated: Union[deprecated, str, bool, None]=None,</span>
<span class="gd">-        include_in_schema: bool=True, json_schema_extra: Union[Dict[str,</span>
<span class="gd">-        Any], None]=None, **extra: Any):</span>
<span class="gd">-        assert default is ..., &#39;Path parameters cannot have a default value&#39;</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        default: Any = ...,</span>
<span class="gi">+        *,</span>
<span class="gi">+        default_factory: Union[Callable[[], Any], None] = _Unset,</span>
<span class="gi">+        annotation: Optional[Any] = None,</span>
<span class="gi">+        alias: Optional[str] = None,</span>
<span class="gi">+        alias_priority: Union[int, None] = _Unset,</span>
<span class="gi">+        # TODO: update when deprecating Pydantic v1, import these types</span>
<span class="gi">+        # validation_alias: str | AliasPath | AliasChoices | None</span>
<span class="gi">+        validation_alias: Union[str, None] = None,</span>
<span class="gi">+        serialization_alias: Union[str, None] = None,</span>
<span class="gi">+        title: Optional[str] = None,</span>
<span class="gi">+        description: Optional[str] = None,</span>
<span class="gi">+        gt: Optional[float] = None,</span>
<span class="gi">+        ge: Optional[float] = None,</span>
<span class="gi">+        lt: Optional[float] = None,</span>
<span class="gi">+        le: Optional[float] = None,</span>
<span class="gi">+        min_length: Optional[int] = None,</span>
<span class="gi">+        max_length: Optional[int] = None,</span>
<span class="gi">+        pattern: Optional[str] = None,</span>
<span class="gi">+        regex: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            deprecated(</span>
<span class="gi">+                &quot;Deprecated in FastAPI 0.100.0 and Pydantic v2, use `pattern` instead.&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        discriminator: Union[str, None] = None,</span>
<span class="gi">+        strict: Union[bool, None] = _Unset,</span>
<span class="gi">+        multiple_of: Union[float, None] = _Unset,</span>
<span class="gi">+        allow_inf_nan: Union[bool, None] = _Unset,</span>
<span class="gi">+        max_digits: Union[int, None] = _Unset,</span>
<span class="gi">+        decimal_places: Union[int, None] = _Unset,</span>
<span class="gi">+        examples: Optional[List[Any]] = None,</span>
<span class="gi">+        example: Annotated[</span>
<span class="gi">+            Optional[Any],</span>
<span class="gi">+            deprecated(</span>
<span class="gi">+                &quot;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, &quot;</span>
<span class="gi">+                &quot;although still supported. Use examples instead.&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = _Unset,</span>
<span class="gi">+        openapi_examples: Optional[Dict[str, Example]] = None,</span>
<span class="gi">+        deprecated: Union[deprecated, str, bool, None] = None,</span>
<span class="gi">+        include_in_schema: bool = True,</span>
<span class="gi">+        json_schema_extra: Union[Dict[str, Any], None] = None,</span>
<span class="gi">+        **extra: Any,</span>
<span class="gi">+    ):</span>
<span class="gi">+        assert default is ..., &quot;Path parameters cannot have a default value&quot;</span>
<span class="w"> </span>        self.in_ = self.in_
<span class="gd">-        super().__init__(default=default, default_factory=default_factory,</span>
<span class="gd">-            annotation=annotation, alias=alias, alias_priority=</span>
<span class="gd">-            alias_priority, validation_alias=validation_alias,</span>
<span class="gd">-            serialization_alias=serialization_alias, title=title,</span>
<span class="gd">-            description=description, gt=gt, ge=ge, lt=lt, le=le, min_length</span>
<span class="gd">-            =min_length, max_length=max_length, pattern=pattern, regex=</span>
<span class="gd">-            regex, discriminator=discriminator, strict=strict, multiple_of=</span>
<span class="gd">-            multiple_of, allow_inf_nan=allow_inf_nan, max_digits=max_digits,</span>
<span class="gd">-            decimal_places=decimal_places, deprecated=deprecated, example=</span>
<span class="gd">-            example, examples=examples, openapi_examples=openapi_examples,</span>
<span class="gd">-            include_in_schema=include_in_schema, json_schema_extra=</span>
<span class="gd">-            json_schema_extra, **extra)</span>
<span class="gi">+        super().__init__(</span>
<span class="gi">+            default=default,</span>
<span class="gi">+            default_factory=default_factory,</span>
<span class="gi">+            annotation=annotation,</span>
<span class="gi">+            alias=alias,</span>
<span class="gi">+            alias_priority=alias_priority,</span>
<span class="gi">+            validation_alias=validation_alias,</span>
<span class="gi">+            serialization_alias=serialization_alias,</span>
<span class="gi">+            title=title,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            gt=gt,</span>
<span class="gi">+            ge=ge,</span>
<span class="gi">+            lt=lt,</span>
<span class="gi">+            le=le,</span>
<span class="gi">+            min_length=min_length,</span>
<span class="gi">+            max_length=max_length,</span>
<span class="gi">+            pattern=pattern,</span>
<span class="gi">+            regex=regex,</span>
<span class="gi">+            discriminator=discriminator,</span>
<span class="gi">+            strict=strict,</span>
<span class="gi">+            multiple_of=multiple_of,</span>
<span class="gi">+            allow_inf_nan=allow_inf_nan,</span>
<span class="gi">+            max_digits=max_digits,</span>
<span class="gi">+            decimal_places=decimal_places,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            example=example,</span>
<span class="gi">+            examples=examples,</span>
<span class="gi">+            openapi_examples=openapi_examples,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            json_schema_extra=json_schema_extra,</span>
<span class="gi">+            **extra,</span>
<span class="gi">+        )</span>


<span class="w"> </span>class Query(Param):
<span class="w"> </span>    in_ = ParamTypes.query

<span class="gd">-    def __init__(self, default: Any=Undefined, *, default_factory: Union[</span>
<span class="gd">-        Callable[[], Any], None]=_Unset, annotation: Optional[Any]=None,</span>
<span class="gd">-        alias: Optional[str]=None, alias_priority: Union[int, None]=_Unset,</span>
<span class="gd">-        validation_alias: Union[str, None]=None, serialization_alias: Union</span>
<span class="gd">-        [str, None]=None, title: Optional[str]=None, description: Optional[</span>
<span class="gd">-        str]=None, gt: Optional[float]=None, ge: Optional[float]=None, lt:</span>
<span class="gd">-        Optional[float]=None, le: Optional[float]=None, min_length:</span>
<span class="gd">-        Optional[int]=None, max_length: Optional[int]=None, pattern:</span>
<span class="gd">-        Optional[str]=None, regex: Annotated[Optional[str], deprecated(</span>
<span class="gd">-        &#39;Deprecated in FastAPI 0.100.0 and Pydantic v2, use `pattern` instead.&#39;</span>
<span class="gd">-        )]=None, discriminator: Union[str, None]=None, strict: Union[bool,</span>
<span class="gd">-        None]=_Unset, multiple_of: Union[float, None]=_Unset, allow_inf_nan:</span>
<span class="gd">-        Union[bool, None]=_Unset, max_digits: Union[int, None]=_Unset,</span>
<span class="gd">-        decimal_places: Union[int, None]=_Unset, examples: Optional[List[</span>
<span class="gd">-        Any]]=None, example: Annotated[Optional[Any], deprecated(</span>
<span class="gd">-        &#39;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, although still supported. Use examples instead.&#39;</span>
<span class="gd">-        )]=_Unset, openapi_examples: Optional[Dict[str, Example]]=None,</span>
<span class="gd">-        deprecated: Union[deprecated, str, bool, None]=None,</span>
<span class="gd">-        include_in_schema: bool=True, json_schema_extra: Union[Dict[str,</span>
<span class="gd">-        Any], None]=None, **extra: Any):</span>
<span class="gd">-        super().__init__(default=default, default_factory=default_factory,</span>
<span class="gd">-            annotation=annotation, alias=alias, alias_priority=</span>
<span class="gd">-            alias_priority, validation_alias=validation_alias,</span>
<span class="gd">-            serialization_alias=serialization_alias, title=title,</span>
<span class="gd">-            description=description, gt=gt, ge=ge, lt=lt, le=le, min_length</span>
<span class="gd">-            =min_length, max_length=max_length, pattern=pattern, regex=</span>
<span class="gd">-            regex, discriminator=discriminator, strict=strict, multiple_of=</span>
<span class="gd">-            multiple_of, allow_inf_nan=allow_inf_nan, max_digits=max_digits,</span>
<span class="gd">-            decimal_places=decimal_places, deprecated=deprecated, example=</span>
<span class="gd">-            example, examples=examples, openapi_examples=openapi_examples,</span>
<span class="gd">-            include_in_schema=include_in_schema, json_schema_extra=</span>
<span class="gd">-            json_schema_extra, **extra)</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        default: Any = Undefined,</span>
<span class="gi">+        *,</span>
<span class="gi">+        default_factory: Union[Callable[[], Any], None] = _Unset,</span>
<span class="gi">+        annotation: Optional[Any] = None,</span>
<span class="gi">+        alias: Optional[str] = None,</span>
<span class="gi">+        alias_priority: Union[int, None] = _Unset,</span>
<span class="gi">+        # TODO: update when deprecating Pydantic v1, import these types</span>
<span class="gi">+        # validation_alias: str | AliasPath | AliasChoices | None</span>
<span class="gi">+        validation_alias: Union[str, None] = None,</span>
<span class="gi">+        serialization_alias: Union[str, None] = None,</span>
<span class="gi">+        title: Optional[str] = None,</span>
<span class="gi">+        description: Optional[str] = None,</span>
<span class="gi">+        gt: Optional[float] = None,</span>
<span class="gi">+        ge: Optional[float] = None,</span>
<span class="gi">+        lt: Optional[float] = None,</span>
<span class="gi">+        le: Optional[float] = None,</span>
<span class="gi">+        min_length: Optional[int] = None,</span>
<span class="gi">+        max_length: Optional[int] = None,</span>
<span class="gi">+        pattern: Optional[str] = None,</span>
<span class="gi">+        regex: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            deprecated(</span>
<span class="gi">+                &quot;Deprecated in FastAPI 0.100.0 and Pydantic v2, use `pattern` instead.&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        discriminator: Union[str, None] = None,</span>
<span class="gi">+        strict: Union[bool, None] = _Unset,</span>
<span class="gi">+        multiple_of: Union[float, None] = _Unset,</span>
<span class="gi">+        allow_inf_nan: Union[bool, None] = _Unset,</span>
<span class="gi">+        max_digits: Union[int, None] = _Unset,</span>
<span class="gi">+        decimal_places: Union[int, None] = _Unset,</span>
<span class="gi">+        examples: Optional[List[Any]] = None,</span>
<span class="gi">+        example: Annotated[</span>
<span class="gi">+            Optional[Any],</span>
<span class="gi">+            deprecated(</span>
<span class="gi">+                &quot;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, &quot;</span>
<span class="gi">+                &quot;although still supported. Use examples instead.&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = _Unset,</span>
<span class="gi">+        openapi_examples: Optional[Dict[str, Example]] = None,</span>
<span class="gi">+        deprecated: Union[deprecated, str, bool, None] = None,</span>
<span class="gi">+        include_in_schema: bool = True,</span>
<span class="gi">+        json_schema_extra: Union[Dict[str, Any], None] = None,</span>
<span class="gi">+        **extra: Any,</span>
<span class="gi">+    ):</span>
<span class="gi">+        super().__init__(</span>
<span class="gi">+            default=default,</span>
<span class="gi">+            default_factory=default_factory,</span>
<span class="gi">+            annotation=annotation,</span>
<span class="gi">+            alias=alias,</span>
<span class="gi">+            alias_priority=alias_priority,</span>
<span class="gi">+            validation_alias=validation_alias,</span>
<span class="gi">+            serialization_alias=serialization_alias,</span>
<span class="gi">+            title=title,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            gt=gt,</span>
<span class="gi">+            ge=ge,</span>
<span class="gi">+            lt=lt,</span>
<span class="gi">+            le=le,</span>
<span class="gi">+            min_length=min_length,</span>
<span class="gi">+            max_length=max_length,</span>
<span class="gi">+            pattern=pattern,</span>
<span class="gi">+            regex=regex,</span>
<span class="gi">+            discriminator=discriminator,</span>
<span class="gi">+            strict=strict,</span>
<span class="gi">+            multiple_of=multiple_of,</span>
<span class="gi">+            allow_inf_nan=allow_inf_nan,</span>
<span class="gi">+            max_digits=max_digits,</span>
<span class="gi">+            decimal_places=decimal_places,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            example=example,</span>
<span class="gi">+            examples=examples,</span>
<span class="gi">+            openapi_examples=openapi_examples,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            json_schema_extra=json_schema_extra,</span>
<span class="gi">+            **extra,</span>
<span class="gi">+        )</span>


<span class="w"> </span>class Header(Param):
<span class="w"> </span>    in_ = ParamTypes.header

<span class="gd">-    def __init__(self, default: Any=Undefined, *, default_factory: Union[</span>
<span class="gd">-        Callable[[], Any], None]=_Unset, annotation: Optional[Any]=None,</span>
<span class="gd">-        alias: Optional[str]=None, alias_priority: Union[int, None]=_Unset,</span>
<span class="gd">-        validation_alias: Union[str, None]=None, serialization_alias: Union</span>
<span class="gd">-        [str, None]=None, convert_underscores: bool=True, title: Optional[</span>
<span class="gd">-        str]=None, description: Optional[str]=None, gt: Optional[float]=</span>
<span class="gd">-        None, ge: Optional[float]=None, lt: Optional[float]=None, le:</span>
<span class="gd">-        Optional[float]=None, min_length: Optional[int]=None, max_length:</span>
<span class="gd">-        Optional[int]=None, pattern: Optional[str]=None, regex: Annotated[</span>
<span class="gd">-        Optional[str], deprecated(</span>
<span class="gd">-        &#39;Deprecated in FastAPI 0.100.0 and Pydantic v2, use `pattern` instead.&#39;</span>
<span class="gd">-        )]=None, discriminator: Union[str, None]=None, strict: Union[bool,</span>
<span class="gd">-        None]=_Unset, multiple_of: Union[float, None]=_Unset, allow_inf_nan:</span>
<span class="gd">-        Union[bool, None]=_Unset, max_digits: Union[int, None]=_Unset,</span>
<span class="gd">-        decimal_places: Union[int, None]=_Unset, examples: Optional[List[</span>
<span class="gd">-        Any]]=None, example: Annotated[Optional[Any], deprecated(</span>
<span class="gd">-        &#39;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, although still supported. Use examples instead.&#39;</span>
<span class="gd">-        )]=_Unset, openapi_examples: Optional[Dict[str, Example]]=None,</span>
<span class="gd">-        deprecated: Union[deprecated, str, bool, None]=None,</span>
<span class="gd">-        include_in_schema: bool=True, json_schema_extra: Union[Dict[str,</span>
<span class="gd">-        Any], None]=None, **extra: Any):</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        default: Any = Undefined,</span>
<span class="gi">+        *,</span>
<span class="gi">+        default_factory: Union[Callable[[], Any], None] = _Unset,</span>
<span class="gi">+        annotation: Optional[Any] = None,</span>
<span class="gi">+        alias: Optional[str] = None,</span>
<span class="gi">+        alias_priority: Union[int, None] = _Unset,</span>
<span class="gi">+        # TODO: update when deprecating Pydantic v1, import these types</span>
<span class="gi">+        # validation_alias: str | AliasPath | AliasChoices | None</span>
<span class="gi">+        validation_alias: Union[str, None] = None,</span>
<span class="gi">+        serialization_alias: Union[str, None] = None,</span>
<span class="gi">+        convert_underscores: bool = True,</span>
<span class="gi">+        title: Optional[str] = None,</span>
<span class="gi">+        description: Optional[str] = None,</span>
<span class="gi">+        gt: Optional[float] = None,</span>
<span class="gi">+        ge: Optional[float] = None,</span>
<span class="gi">+        lt: Optional[float] = None,</span>
<span class="gi">+        le: Optional[float] = None,</span>
<span class="gi">+        min_length: Optional[int] = None,</span>
<span class="gi">+        max_length: Optional[int] = None,</span>
<span class="gi">+        pattern: Optional[str] = None,</span>
<span class="gi">+        regex: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            deprecated(</span>
<span class="gi">+                &quot;Deprecated in FastAPI 0.100.0 and Pydantic v2, use `pattern` instead.&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        discriminator: Union[str, None] = None,</span>
<span class="gi">+        strict: Union[bool, None] = _Unset,</span>
<span class="gi">+        multiple_of: Union[float, None] = _Unset,</span>
<span class="gi">+        allow_inf_nan: Union[bool, None] = _Unset,</span>
<span class="gi">+        max_digits: Union[int, None] = _Unset,</span>
<span class="gi">+        decimal_places: Union[int, None] = _Unset,</span>
<span class="gi">+        examples: Optional[List[Any]] = None,</span>
<span class="gi">+        example: Annotated[</span>
<span class="gi">+            Optional[Any],</span>
<span class="gi">+            deprecated(</span>
<span class="gi">+                &quot;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, &quot;</span>
<span class="gi">+                &quot;although still supported. Use examples instead.&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = _Unset,</span>
<span class="gi">+        openapi_examples: Optional[Dict[str, Example]] = None,</span>
<span class="gi">+        deprecated: Union[deprecated, str, bool, None] = None,</span>
<span class="gi">+        include_in_schema: bool = True,</span>
<span class="gi">+        json_schema_extra: Union[Dict[str, Any], None] = None,</span>
<span class="gi">+        **extra: Any,</span>
<span class="gi">+    ):</span>
<span class="w"> </span>        self.convert_underscores = convert_underscores
<span class="gd">-        super().__init__(default=default, default_factory=default_factory,</span>
<span class="gd">-            annotation=annotation, alias=alias, alias_priority=</span>
<span class="gd">-            alias_priority, validation_alias=validation_alias,</span>
<span class="gd">-            serialization_alias=serialization_alias, title=title,</span>
<span class="gd">-            description=description, gt=gt, ge=ge, lt=lt, le=le, min_length</span>
<span class="gd">-            =min_length, max_length=max_length, pattern=pattern, regex=</span>
<span class="gd">-            regex, discriminator=discriminator, strict=strict, multiple_of=</span>
<span class="gd">-            multiple_of, allow_inf_nan=allow_inf_nan, max_digits=max_digits,</span>
<span class="gd">-            decimal_places=decimal_places, deprecated=deprecated, example=</span>
<span class="gd">-            example, examples=examples, openapi_examples=openapi_examples,</span>
<span class="gd">-            include_in_schema=include_in_schema, json_schema_extra=</span>
<span class="gd">-            json_schema_extra, **extra)</span>
<span class="gi">+        super().__init__(</span>
<span class="gi">+            default=default,</span>
<span class="gi">+            default_factory=default_factory,</span>
<span class="gi">+            annotation=annotation,</span>
<span class="gi">+            alias=alias,</span>
<span class="gi">+            alias_priority=alias_priority,</span>
<span class="gi">+            validation_alias=validation_alias,</span>
<span class="gi">+            serialization_alias=serialization_alias,</span>
<span class="gi">+            title=title,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            gt=gt,</span>
<span class="gi">+            ge=ge,</span>
<span class="gi">+            lt=lt,</span>
<span class="gi">+            le=le,</span>
<span class="gi">+            min_length=min_length,</span>
<span class="gi">+            max_length=max_length,</span>
<span class="gi">+            pattern=pattern,</span>
<span class="gi">+            regex=regex,</span>
<span class="gi">+            discriminator=discriminator,</span>
<span class="gi">+            strict=strict,</span>
<span class="gi">+            multiple_of=multiple_of,</span>
<span class="gi">+            allow_inf_nan=allow_inf_nan,</span>
<span class="gi">+            max_digits=max_digits,</span>
<span class="gi">+            decimal_places=decimal_places,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            example=example,</span>
<span class="gi">+            examples=examples,</span>
<span class="gi">+            openapi_examples=openapi_examples,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            json_schema_extra=json_schema_extra,</span>
<span class="gi">+            **extra,</span>
<span class="gi">+        )</span>


<span class="w"> </span>class Cookie(Param):
<span class="w"> </span>    in_ = ParamTypes.cookie

<span class="gd">-    def __init__(self, default: Any=Undefined, *, default_factory: Union[</span>
<span class="gd">-        Callable[[], Any], None]=_Unset, annotation: Optional[Any]=None,</span>
<span class="gd">-        alias: Optional[str]=None, alias_priority: Union[int, None]=_Unset,</span>
<span class="gd">-        validation_alias: Union[str, None]=None, serialization_alias: Union</span>
<span class="gd">-        [str, None]=None, title: Optional[str]=None, description: Optional[</span>
<span class="gd">-        str]=None, gt: Optional[float]=None, ge: Optional[float]=None, lt:</span>
<span class="gd">-        Optional[float]=None, le: Optional[float]=None, min_length:</span>
<span class="gd">-        Optional[int]=None, max_length: Optional[int]=None, pattern:</span>
<span class="gd">-        Optional[str]=None, regex: Annotated[Optional[str], deprecated(</span>
<span class="gd">-        &#39;Deprecated in FastAPI 0.100.0 and Pydantic v2, use `pattern` instead.&#39;</span>
<span class="gd">-        )]=None, discriminator: Union[str, None]=None, strict: Union[bool,</span>
<span class="gd">-        None]=_Unset, multiple_of: Union[float, None]=_Unset, allow_inf_nan:</span>
<span class="gd">-        Union[bool, None]=_Unset, max_digits: Union[int, None]=_Unset,</span>
<span class="gd">-        decimal_places: Union[int, None]=_Unset, examples: Optional[List[</span>
<span class="gd">-        Any]]=None, example: Annotated[Optional[Any], deprecated(</span>
<span class="gd">-        &#39;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, although still supported. Use examples instead.&#39;</span>
<span class="gd">-        )]=_Unset, openapi_examples: Optional[Dict[str, Example]]=None,</span>
<span class="gd">-        deprecated: Union[deprecated, str, bool, None]=None,</span>
<span class="gd">-        include_in_schema: bool=True, json_schema_extra: Union[Dict[str,</span>
<span class="gd">-        Any], None]=None, **extra: Any):</span>
<span class="gd">-        super().__init__(default=default, default_factory=default_factory,</span>
<span class="gd">-            annotation=annotation, alias=alias, alias_priority=</span>
<span class="gd">-            alias_priority, validation_alias=validation_alias,</span>
<span class="gd">-            serialization_alias=serialization_alias, title=title,</span>
<span class="gd">-            description=description, gt=gt, ge=ge, lt=lt, le=le, min_length</span>
<span class="gd">-            =min_length, max_length=max_length, pattern=pattern, regex=</span>
<span class="gd">-            regex, discriminator=discriminator, strict=strict, multiple_of=</span>
<span class="gd">-            multiple_of, allow_inf_nan=allow_inf_nan, max_digits=max_digits,</span>
<span class="gd">-            decimal_places=decimal_places, deprecated=deprecated, example=</span>
<span class="gd">-            example, examples=examples, openapi_examples=openapi_examples,</span>
<span class="gd">-            include_in_schema=include_in_schema, json_schema_extra=</span>
<span class="gd">-            json_schema_extra, **extra)</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        default: Any = Undefined,</span>
<span class="gi">+        *,</span>
<span class="gi">+        default_factory: Union[Callable[[], Any], None] = _Unset,</span>
<span class="gi">+        annotation: Optional[Any] = None,</span>
<span class="gi">+        alias: Optional[str] = None,</span>
<span class="gi">+        alias_priority: Union[int, None] = _Unset,</span>
<span class="gi">+        # TODO: update when deprecating Pydantic v1, import these types</span>
<span class="gi">+        # validation_alias: str | AliasPath | AliasChoices | None</span>
<span class="gi">+        validation_alias: Union[str, None] = None,</span>
<span class="gi">+        serialization_alias: Union[str, None] = None,</span>
<span class="gi">+        title: Optional[str] = None,</span>
<span class="gi">+        description: Optional[str] = None,</span>
<span class="gi">+        gt: Optional[float] = None,</span>
<span class="gi">+        ge: Optional[float] = None,</span>
<span class="gi">+        lt: Optional[float] = None,</span>
<span class="gi">+        le: Optional[float] = None,</span>
<span class="gi">+        min_length: Optional[int] = None,</span>
<span class="gi">+        max_length: Optional[int] = None,</span>
<span class="gi">+        pattern: Optional[str] = None,</span>
<span class="gi">+        regex: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            deprecated(</span>
<span class="gi">+                &quot;Deprecated in FastAPI 0.100.0 and Pydantic v2, use `pattern` instead.&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        discriminator: Union[str, None] = None,</span>
<span class="gi">+        strict: Union[bool, None] = _Unset,</span>
<span class="gi">+        multiple_of: Union[float, None] = _Unset,</span>
<span class="gi">+        allow_inf_nan: Union[bool, None] = _Unset,</span>
<span class="gi">+        max_digits: Union[int, None] = _Unset,</span>
<span class="gi">+        decimal_places: Union[int, None] = _Unset,</span>
<span class="gi">+        examples: Optional[List[Any]] = None,</span>
<span class="gi">+        example: Annotated[</span>
<span class="gi">+            Optional[Any],</span>
<span class="gi">+            deprecated(</span>
<span class="gi">+                &quot;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, &quot;</span>
<span class="gi">+                &quot;although still supported. Use examples instead.&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = _Unset,</span>
<span class="gi">+        openapi_examples: Optional[Dict[str, Example]] = None,</span>
<span class="gi">+        deprecated: Union[deprecated, str, bool, None] = None,</span>
<span class="gi">+        include_in_schema: bool = True,</span>
<span class="gi">+        json_schema_extra: Union[Dict[str, Any], None] = None,</span>
<span class="gi">+        **extra: Any,</span>
<span class="gi">+    ):</span>
<span class="gi">+        super().__init__(</span>
<span class="gi">+            default=default,</span>
<span class="gi">+            default_factory=default_factory,</span>
<span class="gi">+            annotation=annotation,</span>
<span class="gi">+            alias=alias,</span>
<span class="gi">+            alias_priority=alias_priority,</span>
<span class="gi">+            validation_alias=validation_alias,</span>
<span class="gi">+            serialization_alias=serialization_alias,</span>
<span class="gi">+            title=title,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            gt=gt,</span>
<span class="gi">+            ge=ge,</span>
<span class="gi">+            lt=lt,</span>
<span class="gi">+            le=le,</span>
<span class="gi">+            min_length=min_length,</span>
<span class="gi">+            max_length=max_length,</span>
<span class="gi">+            pattern=pattern,</span>
<span class="gi">+            regex=regex,</span>
<span class="gi">+            discriminator=discriminator,</span>
<span class="gi">+            strict=strict,</span>
<span class="gi">+            multiple_of=multiple_of,</span>
<span class="gi">+            allow_inf_nan=allow_inf_nan,</span>
<span class="gi">+            max_digits=max_digits,</span>
<span class="gi">+            decimal_places=decimal_places,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            example=example,</span>
<span class="gi">+            examples=examples,</span>
<span class="gi">+            openapi_examples=openapi_examples,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            json_schema_extra=json_schema_extra,</span>
<span class="gi">+            **extra,</span>
<span class="gi">+        )</span>


<span class="w"> </span>class Body(FieldInfo):
<span class="gd">-</span>
<span class="gd">-    def __init__(self, default: Any=Undefined, *, default_factory: Union[</span>
<span class="gd">-        Callable[[], Any], None]=_Unset, annotation: Optional[Any]=None,</span>
<span class="gd">-        embed: bool=False, media_type: str=&#39;application/json&#39;, alias:</span>
<span class="gd">-        Optional[str]=None, alias_priority: Union[int, None]=_Unset,</span>
<span class="gd">-        validation_alias: Union[str, None]=None, serialization_alias: Union</span>
<span class="gd">-        [str, None]=None, title: Optional[str]=None, description: Optional[</span>
<span class="gd">-        str]=None, gt: Optional[float]=None, ge: Optional[float]=None, lt:</span>
<span class="gd">-        Optional[float]=None, le: Optional[float]=None, min_length:</span>
<span class="gd">-        Optional[int]=None, max_length: Optional[int]=None, pattern:</span>
<span class="gd">-        Optional[str]=None, regex: Annotated[Optional[str], deprecated(</span>
<span class="gd">-        &#39;Deprecated in FastAPI 0.100.0 and Pydantic v2, use `pattern` instead.&#39;</span>
<span class="gd">-        )]=None, discriminator: Union[str, None]=None, strict: Union[bool,</span>
<span class="gd">-        None]=_Unset, multiple_of: Union[float, None]=_Unset, allow_inf_nan:</span>
<span class="gd">-        Union[bool, None]=_Unset, max_digits: Union[int, None]=_Unset,</span>
<span class="gd">-        decimal_places: Union[int, None]=_Unset, examples: Optional[List[</span>
<span class="gd">-        Any]]=None, example: Annotated[Optional[Any], deprecated(</span>
<span class="gd">-        &#39;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, although still supported. Use examples instead.&#39;</span>
<span class="gd">-        )]=_Unset, openapi_examples: Optional[Dict[str, Example]]=None,</span>
<span class="gd">-        deprecated: Union[deprecated, str, bool, None]=None,</span>
<span class="gd">-        include_in_schema: bool=True, json_schema_extra: Union[Dict[str,</span>
<span class="gd">-        Any], None]=None, **extra: Any):</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        default: Any = Undefined,</span>
<span class="gi">+        *,</span>
<span class="gi">+        default_factory: Union[Callable[[], Any], None] = _Unset,</span>
<span class="gi">+        annotation: Optional[Any] = None,</span>
<span class="gi">+        embed: bool = False,</span>
<span class="gi">+        media_type: str = &quot;application/json&quot;,</span>
<span class="gi">+        alias: Optional[str] = None,</span>
<span class="gi">+        alias_priority: Union[int, None] = _Unset,</span>
<span class="gi">+        # TODO: update when deprecating Pydantic v1, import these types</span>
<span class="gi">+        # validation_alias: str | AliasPath | AliasChoices | None</span>
<span class="gi">+        validation_alias: Union[str, None] = None,</span>
<span class="gi">+        serialization_alias: Union[str, None] = None,</span>
<span class="gi">+        title: Optional[str] = None,</span>
<span class="gi">+        description: Optional[str] = None,</span>
<span class="gi">+        gt: Optional[float] = None,</span>
<span class="gi">+        ge: Optional[float] = None,</span>
<span class="gi">+        lt: Optional[float] = None,</span>
<span class="gi">+        le: Optional[float] = None,</span>
<span class="gi">+        min_length: Optional[int] = None,</span>
<span class="gi">+        max_length: Optional[int] = None,</span>
<span class="gi">+        pattern: Optional[str] = None,</span>
<span class="gi">+        regex: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            deprecated(</span>
<span class="gi">+                &quot;Deprecated in FastAPI 0.100.0 and Pydantic v2, use `pattern` instead.&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        discriminator: Union[str, None] = None,</span>
<span class="gi">+        strict: Union[bool, None] = _Unset,</span>
<span class="gi">+        multiple_of: Union[float, None] = _Unset,</span>
<span class="gi">+        allow_inf_nan: Union[bool, None] = _Unset,</span>
<span class="gi">+        max_digits: Union[int, None] = _Unset,</span>
<span class="gi">+        decimal_places: Union[int, None] = _Unset,</span>
<span class="gi">+        examples: Optional[List[Any]] = None,</span>
<span class="gi">+        example: Annotated[</span>
<span class="gi">+            Optional[Any],</span>
<span class="gi">+            deprecated(</span>
<span class="gi">+                &quot;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, &quot;</span>
<span class="gi">+                &quot;although still supported. Use examples instead.&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = _Unset,</span>
<span class="gi">+        openapi_examples: Optional[Dict[str, Example]] = None,</span>
<span class="gi">+        deprecated: Union[deprecated, str, bool, None] = None,</span>
<span class="gi">+        include_in_schema: bool = True,</span>
<span class="gi">+        json_schema_extra: Union[Dict[str, Any], None] = None,</span>
<span class="gi">+        **extra: Any,</span>
<span class="gi">+    ):</span>
<span class="w"> </span>        self.embed = embed
<span class="w"> </span>        self.media_type = media_type
<span class="w"> </span>        if example is not _Unset:
<span class="w"> </span>            warnings.warn(
<span class="gd">-                &#39;`example` has been deprecated, please use `examples` instead&#39;,</span>
<span class="gd">-                category=DeprecationWarning, stacklevel=4)</span>
<span class="gi">+                &quot;`example` has been deprecated, please use `examples` instead&quot;,</span>
<span class="gi">+                category=DeprecationWarning,</span>
<span class="gi">+                stacklevel=4,</span>
<span class="gi">+            )</span>
<span class="w"> </span>        self.example = example
<span class="w"> </span>        self.include_in_schema = include_in_schema
<span class="w"> </span>        self.openapi_examples = openapi_examples
<span class="gd">-        kwargs = dict(default=default, default_factory=default_factory,</span>
<span class="gd">-            alias=alias, title=title, description=description, gt=gt, ge=ge,</span>
<span class="gd">-            lt=lt, le=le, min_length=min_length, max_length=max_length,</span>
<span class="gd">-            discriminator=discriminator, multiple_of=multiple_of, allow_nan</span>
<span class="gd">-            =allow_inf_nan, max_digits=max_digits, decimal_places=</span>
<span class="gd">-            decimal_places, **extra)</span>
<span class="gi">+        kwargs = dict(</span>
<span class="gi">+            default=default,</span>
<span class="gi">+            default_factory=default_factory,</span>
<span class="gi">+            alias=alias,</span>
<span class="gi">+            title=title,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            gt=gt,</span>
<span class="gi">+            ge=ge,</span>
<span class="gi">+            lt=lt,</span>
<span class="gi">+            le=le,</span>
<span class="gi">+            min_length=min_length,</span>
<span class="gi">+            max_length=max_length,</span>
<span class="gi">+            discriminator=discriminator,</span>
<span class="gi">+            multiple_of=multiple_of,</span>
<span class="gi">+            allow_nan=allow_inf_nan,</span>
<span class="gi">+            max_digits=max_digits,</span>
<span class="gi">+            decimal_places=decimal_places,</span>
<span class="gi">+            **extra,</span>
<span class="gi">+        )</span>
<span class="w"> </span>        if examples is not None:
<span class="gd">-            kwargs[&#39;examples&#39;] = examples</span>
<span class="gi">+            kwargs[&quot;examples&quot;] = examples</span>
<span class="w"> </span>        if regex is not None:
<span class="w"> </span>            warnings.warn(
<span class="gd">-                &#39;`regex` has been depreacated, please use `pattern` instead&#39;,</span>
<span class="gd">-                category=DeprecationWarning, stacklevel=4)</span>
<span class="gi">+                &quot;`regex` has been depreacated, please use `pattern` instead&quot;,</span>
<span class="gi">+                category=DeprecationWarning,</span>
<span class="gi">+                stacklevel=4,</span>
<span class="gi">+            )</span>
<span class="w"> </span>        current_json_schema_extra = json_schema_extra or extra
<span class="gd">-        if PYDANTIC_VERSION &lt; &#39;2.7.0&#39;:</span>
<span class="gi">+        if PYDANTIC_VERSION &lt; &quot;2.7.0&quot;:</span>
<span class="w"> </span>            self.deprecated = deprecated
<span class="w"> </span>        else:
<span class="gd">-            kwargs[&#39;deprecated&#39;] = deprecated</span>
<span class="gi">+            kwargs[&quot;deprecated&quot;] = deprecated</span>
<span class="w"> </span>        if PYDANTIC_V2:
<span class="gd">-            kwargs.update({&#39;annotation&#39;: annotation, &#39;alias_priority&#39;:</span>
<span class="gd">-                alias_priority, &#39;validation_alias&#39;: validation_alias,</span>
<span class="gd">-                &#39;serialization_alias&#39;: serialization_alias, &#39;strict&#39;:</span>
<span class="gd">-                strict, &#39;json_schema_extra&#39;: current_json_schema_extra})</span>
<span class="gd">-            kwargs[&#39;pattern&#39;] = pattern or regex</span>
<span class="gi">+            kwargs.update(</span>
<span class="gi">+                {</span>
<span class="gi">+                    &quot;annotation&quot;: annotation,</span>
<span class="gi">+                    &quot;alias_priority&quot;: alias_priority,</span>
<span class="gi">+                    &quot;validation_alias&quot;: validation_alias,</span>
<span class="gi">+                    &quot;serialization_alias&quot;: serialization_alias,</span>
<span class="gi">+                    &quot;strict&quot;: strict,</span>
<span class="gi">+                    &quot;json_schema_extra&quot;: current_json_schema_extra,</span>
<span class="gi">+                }</span>
<span class="gi">+            )</span>
<span class="gi">+            kwargs[&quot;pattern&quot;] = pattern or regex</span>
<span class="w"> </span>        else:
<span class="gd">-            kwargs[&#39;regex&#39;] = pattern or regex</span>
<span class="gi">+            kwargs[&quot;regex&quot;] = pattern or regex</span>
<span class="w"> </span>            kwargs.update(**current_json_schema_extra)
<span class="gi">+</span>
<span class="w"> </span>        use_kwargs = {k: v for k, v in kwargs.items() if v is not _Unset}
<span class="gi">+</span>
<span class="w"> </span>        super().__init__(**use_kwargs)

<span class="gd">-    def __repr__(self) -&gt;str:</span>
<span class="gd">-        return f&#39;{self.__class__.__name__}({self.default})&#39;</span>
<span class="gi">+    def __repr__(self) -&gt; str:</span>
<span class="gi">+        return f&quot;{self.__class__.__name__}({self.default})&quot;</span>


<span class="w"> </span>class Form(Body):
<span class="gd">-</span>
<span class="gd">-    def __init__(self, default: Any=Undefined, *, default_factory: Union[</span>
<span class="gd">-        Callable[[], Any], None]=_Unset, annotation: Optional[Any]=None,</span>
<span class="gd">-        media_type: str=&#39;application/x-www-form-urlencoded&#39;, alias:</span>
<span class="gd">-        Optional[str]=None, alias_priority: Union[int, None]=_Unset,</span>
<span class="gd">-        validation_alias: Union[str, None]=None, serialization_alias: Union</span>
<span class="gd">-        [str, None]=None, title: Optional[str]=None, description: Optional[</span>
<span class="gd">-        str]=None, gt: Optional[float]=None, ge: Optional[float]=None, lt:</span>
<span class="gd">-        Optional[float]=None, le: Optional[float]=None, min_length:</span>
<span class="gd">-        Optional[int]=None, max_length: Optional[int]=None, pattern:</span>
<span class="gd">-        Optional[str]=None, regex: Annotated[Optional[str], deprecated(</span>
<span class="gd">-        &#39;Deprecated in FastAPI 0.100.0 and Pydantic v2, use `pattern` instead.&#39;</span>
<span class="gd">-        )]=None, discriminator: Union[str, None]=None, strict: Union[bool,</span>
<span class="gd">-        None]=_Unset, multiple_of: Union[float, None]=_Unset, allow_inf_nan:</span>
<span class="gd">-        Union[bool, None]=_Unset, max_digits: Union[int, None]=_Unset,</span>
<span class="gd">-        decimal_places: Union[int, None]=_Unset, examples: Optional[List[</span>
<span class="gd">-        Any]]=None, example: Annotated[Optional[Any], deprecated(</span>
<span class="gd">-        &#39;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, although still supported. Use examples instead.&#39;</span>
<span class="gd">-        )]=_Unset, openapi_examples: Optional[Dict[str, Example]]=None,</span>
<span class="gd">-        deprecated: Union[deprecated, str, bool, None]=None,</span>
<span class="gd">-        include_in_schema: bool=True, json_schema_extra: Union[Dict[str,</span>
<span class="gd">-        Any], None]=None, **extra: Any):</span>
<span class="gd">-        super().__init__(default=default, default_factory=default_factory,</span>
<span class="gd">-            annotation=annotation, embed=True, media_type=media_type, alias</span>
<span class="gd">-            =alias, alias_priority=alias_priority, validation_alias=</span>
<span class="gd">-            validation_alias, serialization_alias=serialization_alias,</span>
<span class="gd">-            title=title, description=description, gt=gt, ge=ge, lt=lt, le=</span>
<span class="gd">-            le, min_length=min_length, max_length=max_length, pattern=</span>
<span class="gd">-            pattern, regex=regex, discriminator=discriminator, strict=</span>
<span class="gd">-            strict, multiple_of=multiple_of, allow_inf_nan=allow_inf_nan,</span>
<span class="gd">-            max_digits=max_digits, decimal_places=decimal_places,</span>
<span class="gd">-            deprecated=deprecated, example=example, examples=examples,</span>
<span class="gd">-            openapi_examples=openapi_examples, include_in_schema=</span>
<span class="gd">-            include_in_schema, json_schema_extra=json_schema_extra, **extra)</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        default: Any = Undefined,</span>
<span class="gi">+        *,</span>
<span class="gi">+        default_factory: Union[Callable[[], Any], None] = _Unset,</span>
<span class="gi">+        annotation: Optional[Any] = None,</span>
<span class="gi">+        media_type: str = &quot;application/x-www-form-urlencoded&quot;,</span>
<span class="gi">+        alias: Optional[str] = None,</span>
<span class="gi">+        alias_priority: Union[int, None] = _Unset,</span>
<span class="gi">+        # TODO: update when deprecating Pydantic v1, import these types</span>
<span class="gi">+        # validation_alias: str | AliasPath | AliasChoices | None</span>
<span class="gi">+        validation_alias: Union[str, None] = None,</span>
<span class="gi">+        serialization_alias: Union[str, None] = None,</span>
<span class="gi">+        title: Optional[str] = None,</span>
<span class="gi">+        description: Optional[str] = None,</span>
<span class="gi">+        gt: Optional[float] = None,</span>
<span class="gi">+        ge: Optional[float] = None,</span>
<span class="gi">+        lt: Optional[float] = None,</span>
<span class="gi">+        le: Optional[float] = None,</span>
<span class="gi">+        min_length: Optional[int] = None,</span>
<span class="gi">+        max_length: Optional[int] = None,</span>
<span class="gi">+        pattern: Optional[str] = None,</span>
<span class="gi">+        regex: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            deprecated(</span>
<span class="gi">+                &quot;Deprecated in FastAPI 0.100.0 and Pydantic v2, use `pattern` instead.&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        discriminator: Union[str, None] = None,</span>
<span class="gi">+        strict: Union[bool, None] = _Unset,</span>
<span class="gi">+        multiple_of: Union[float, None] = _Unset,</span>
<span class="gi">+        allow_inf_nan: Union[bool, None] = _Unset,</span>
<span class="gi">+        max_digits: Union[int, None] = _Unset,</span>
<span class="gi">+        decimal_places: Union[int, None] = _Unset,</span>
<span class="gi">+        examples: Optional[List[Any]] = None,</span>
<span class="gi">+        example: Annotated[</span>
<span class="gi">+            Optional[Any],</span>
<span class="gi">+            deprecated(</span>
<span class="gi">+                &quot;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, &quot;</span>
<span class="gi">+                &quot;although still supported. Use examples instead.&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = _Unset,</span>
<span class="gi">+        openapi_examples: Optional[Dict[str, Example]] = None,</span>
<span class="gi">+        deprecated: Union[deprecated, str, bool, None] = None,</span>
<span class="gi">+        include_in_schema: bool = True,</span>
<span class="gi">+        json_schema_extra: Union[Dict[str, Any], None] = None,</span>
<span class="gi">+        **extra: Any,</span>
<span class="gi">+    ):</span>
<span class="gi">+        super().__init__(</span>
<span class="gi">+            default=default,</span>
<span class="gi">+            default_factory=default_factory,</span>
<span class="gi">+            annotation=annotation,</span>
<span class="gi">+            embed=True,</span>
<span class="gi">+            media_type=media_type,</span>
<span class="gi">+            alias=alias,</span>
<span class="gi">+            alias_priority=alias_priority,</span>
<span class="gi">+            validation_alias=validation_alias,</span>
<span class="gi">+            serialization_alias=serialization_alias,</span>
<span class="gi">+            title=title,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            gt=gt,</span>
<span class="gi">+            ge=ge,</span>
<span class="gi">+            lt=lt,</span>
<span class="gi">+            le=le,</span>
<span class="gi">+            min_length=min_length,</span>
<span class="gi">+            max_length=max_length,</span>
<span class="gi">+            pattern=pattern,</span>
<span class="gi">+            regex=regex,</span>
<span class="gi">+            discriminator=discriminator,</span>
<span class="gi">+            strict=strict,</span>
<span class="gi">+            multiple_of=multiple_of,</span>
<span class="gi">+            allow_inf_nan=allow_inf_nan,</span>
<span class="gi">+            max_digits=max_digits,</span>
<span class="gi">+            decimal_places=decimal_places,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            example=example,</span>
<span class="gi">+            examples=examples,</span>
<span class="gi">+            openapi_examples=openapi_examples,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            json_schema_extra=json_schema_extra,</span>
<span class="gi">+            **extra,</span>
<span class="gi">+        )</span>


<span class="w"> </span>class File(Form):
<span class="gd">-</span>
<span class="gd">-    def __init__(self, default: Any=Undefined, *, default_factory: Union[</span>
<span class="gd">-        Callable[[], Any], None]=_Unset, annotation: Optional[Any]=None,</span>
<span class="gd">-        media_type: str=&#39;multipart/form-data&#39;, alias: Optional[str]=None,</span>
<span class="gd">-        alias_priority: Union[int, None]=_Unset, validation_alias: Union[</span>
<span class="gd">-        str, None]=None, serialization_alias: Union[str, None]=None, title:</span>
<span class="gd">-        Optional[str]=None, description: Optional[str]=None, gt: Optional[</span>
<span class="gd">-        float]=None, ge: Optional[float]=None, lt: Optional[float]=None, le:</span>
<span class="gd">-        Optional[float]=None, min_length: Optional[int]=None, max_length:</span>
<span class="gd">-        Optional[int]=None, pattern: Optional[str]=None, regex: Annotated[</span>
<span class="gd">-        Optional[str], deprecated(</span>
<span class="gd">-        &#39;Deprecated in FastAPI 0.100.0 and Pydantic v2, use `pattern` instead.&#39;</span>
<span class="gd">-        )]=None, discriminator: Union[str, None]=None, strict: Union[bool,</span>
<span class="gd">-        None]=_Unset, multiple_of: Union[float, None]=_Unset, allow_inf_nan:</span>
<span class="gd">-        Union[bool, None]=_Unset, max_digits: Union[int, None]=_Unset,</span>
<span class="gd">-        decimal_places: Union[int, None]=_Unset, examples: Optional[List[</span>
<span class="gd">-        Any]]=None, example: Annotated[Optional[Any], deprecated(</span>
<span class="gd">-        &#39;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, although still supported. Use examples instead.&#39;</span>
<span class="gd">-        )]=_Unset, openapi_examples: Optional[Dict[str, Example]]=None,</span>
<span class="gd">-        deprecated: Union[deprecated, str, bool, None]=None,</span>
<span class="gd">-        include_in_schema: bool=True, json_schema_extra: Union[Dict[str,</span>
<span class="gd">-        Any], None]=None, **extra: Any):</span>
<span class="gd">-        super().__init__(default=default, default_factory=default_factory,</span>
<span class="gd">-            annotation=annotation, media_type=media_type, alias=alias,</span>
<span class="gd">-            alias_priority=alias_priority, validation_alias=</span>
<span class="gd">-            validation_alias, serialization_alias=serialization_alias,</span>
<span class="gd">-            title=title, description=description, gt=gt, ge=ge, lt=lt, le=</span>
<span class="gd">-            le, min_length=min_length, max_length=max_length, pattern=</span>
<span class="gd">-            pattern, regex=regex, discriminator=discriminator, strict=</span>
<span class="gd">-            strict, multiple_of=multiple_of, allow_inf_nan=allow_inf_nan,</span>
<span class="gd">-            max_digits=max_digits, decimal_places=decimal_places,</span>
<span class="gd">-            deprecated=deprecated, example=example, examples=examples,</span>
<span class="gd">-            openapi_examples=openapi_examples, include_in_schema=</span>
<span class="gd">-            include_in_schema, json_schema_extra=json_schema_extra, **extra)</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        default: Any = Undefined,</span>
<span class="gi">+        *,</span>
<span class="gi">+        default_factory: Union[Callable[[], Any], None] = _Unset,</span>
<span class="gi">+        annotation: Optional[Any] = None,</span>
<span class="gi">+        media_type: str = &quot;multipart/form-data&quot;,</span>
<span class="gi">+        alias: Optional[str] = None,</span>
<span class="gi">+        alias_priority: Union[int, None] = _Unset,</span>
<span class="gi">+        # TODO: update when deprecating Pydantic v1, import these types</span>
<span class="gi">+        # validation_alias: str | AliasPath | AliasChoices | None</span>
<span class="gi">+        validation_alias: Union[str, None] = None,</span>
<span class="gi">+        serialization_alias: Union[str, None] = None,</span>
<span class="gi">+        title: Optional[str] = None,</span>
<span class="gi">+        description: Optional[str] = None,</span>
<span class="gi">+        gt: Optional[float] = None,</span>
<span class="gi">+        ge: Optional[float] = None,</span>
<span class="gi">+        lt: Optional[float] = None,</span>
<span class="gi">+        le: Optional[float] = None,</span>
<span class="gi">+        min_length: Optional[int] = None,</span>
<span class="gi">+        max_length: Optional[int] = None,</span>
<span class="gi">+        pattern: Optional[str] = None,</span>
<span class="gi">+        regex: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            deprecated(</span>
<span class="gi">+                &quot;Deprecated in FastAPI 0.100.0 and Pydantic v2, use `pattern` instead.&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        discriminator: Union[str, None] = None,</span>
<span class="gi">+        strict: Union[bool, None] = _Unset,</span>
<span class="gi">+        multiple_of: Union[float, None] = _Unset,</span>
<span class="gi">+        allow_inf_nan: Union[bool, None] = _Unset,</span>
<span class="gi">+        max_digits: Union[int, None] = _Unset,</span>
<span class="gi">+        decimal_places: Union[int, None] = _Unset,</span>
<span class="gi">+        examples: Optional[List[Any]] = None,</span>
<span class="gi">+        example: Annotated[</span>
<span class="gi">+            Optional[Any],</span>
<span class="gi">+            deprecated(</span>
<span class="gi">+                &quot;Deprecated in OpenAPI 3.1.0 that now uses JSON Schema 2020-12, &quot;</span>
<span class="gi">+                &quot;although still supported. Use examples instead.&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = _Unset,</span>
<span class="gi">+        openapi_examples: Optional[Dict[str, Example]] = None,</span>
<span class="gi">+        deprecated: Union[deprecated, str, bool, None] = None,</span>
<span class="gi">+        include_in_schema: bool = True,</span>
<span class="gi">+        json_schema_extra: Union[Dict[str, Any], None] = None,</span>
<span class="gi">+        **extra: Any,</span>
<span class="gi">+    ):</span>
<span class="gi">+        super().__init__(</span>
<span class="gi">+            default=default,</span>
<span class="gi">+            default_factory=default_factory,</span>
<span class="gi">+            annotation=annotation,</span>
<span class="gi">+            media_type=media_type,</span>
<span class="gi">+            alias=alias,</span>
<span class="gi">+            alias_priority=alias_priority,</span>
<span class="gi">+            validation_alias=validation_alias,</span>
<span class="gi">+            serialization_alias=serialization_alias,</span>
<span class="gi">+            title=title,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            gt=gt,</span>
<span class="gi">+            ge=ge,</span>
<span class="gi">+            lt=lt,</span>
<span class="gi">+            le=le,</span>
<span class="gi">+            min_length=min_length,</span>
<span class="gi">+            max_length=max_length,</span>
<span class="gi">+            pattern=pattern,</span>
<span class="gi">+            regex=regex,</span>
<span class="gi">+            discriminator=discriminator,</span>
<span class="gi">+            strict=strict,</span>
<span class="gi">+            multiple_of=multiple_of,</span>
<span class="gi">+            allow_inf_nan=allow_inf_nan,</span>
<span class="gi">+            max_digits=max_digits,</span>
<span class="gi">+            decimal_places=decimal_places,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            example=example,</span>
<span class="gi">+            examples=examples,</span>
<span class="gi">+            openapi_examples=openapi_examples,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            json_schema_extra=json_schema_extra,</span>
<span class="gi">+            **extra,</span>
<span class="gi">+        )</span>


<span class="w"> </span>class Depends:
<span class="gd">-</span>
<span class="gd">-    def __init__(self, dependency: Optional[Callable[..., Any]]=None, *,</span>
<span class="gd">-        use_cache: bool=True):</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self, dependency: Optional[Callable[..., Any]] = None, *, use_cache: bool = True</span>
<span class="gi">+    ):</span>
<span class="w"> </span>        self.dependency = dependency
<span class="w"> </span>        self.use_cache = use_cache

<span class="gd">-    def __repr__(self) -&gt;str:</span>
<span class="gd">-        attr = getattr(self.dependency, &#39;__name__&#39;, type(self.dependency).</span>
<span class="gd">-            __name__)</span>
<span class="gd">-        cache = &#39;&#39; if self.use_cache else &#39;, use_cache=False&#39;</span>
<span class="gd">-        return f&#39;{self.__class__.__name__}({attr}{cache})&#39;</span>
<span class="gi">+    def __repr__(self) -&gt; str:</span>
<span class="gi">+        attr = getattr(self.dependency, &quot;__name__&quot;, type(self.dependency).__name__)</span>
<span class="gi">+        cache = &quot;&quot; if self.use_cache else &quot;, use_cache=False&quot;</span>
<span class="gi">+        return f&quot;{self.__class__.__name__}({attr}{cache})&quot;</span>


<span class="w"> </span>class Security(Depends):
<span class="gd">-</span>
<span class="gd">-    def __init__(self, dependency: Optional[Callable[..., Any]]=None, *,</span>
<span class="gd">-        scopes: Optional[Sequence[str]]=None, use_cache: bool=True):</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        dependency: Optional[Callable[..., Any]] = None,</span>
<span class="gi">+        *,</span>
<span class="gi">+        scopes: Optional[Sequence[str]] = None,</span>
<span class="gi">+        use_cache: bool = True,</span>
<span class="gi">+    ):</span>
<span class="w"> </span>        super().__init__(dependency=dependency, use_cache=use_cache)
<span class="w"> </span>        self.scopes = scopes or []
<span class="gh">diff --git a/fastapi/requests.py b/fastapi/requests.py</span>
<span class="gh">index 931a2bfc..d16552c0 100644</span>
<span class="gd">--- a/fastapi/requests.py</span>
<span class="gi">+++ b/fastapi/requests.py</span>
<span class="gu">@@ -1,2 +1,2 @@</span>
<span class="gd">-from starlette.requests import HTTPConnection as HTTPConnection</span>
<span class="gd">-from starlette.requests import Request as Request</span>
<span class="gi">+from starlette.requests import HTTPConnection as HTTPConnection  # noqa: F401</span>
<span class="gi">+from starlette.requests import Request as Request  # noqa: F401</span>
<span class="gh">diff --git a/fastapi/responses.py b/fastapi/responses.py</span>
<span class="gh">index ae75b5a3..6c8db6f3 100644</span>
<span class="gd">--- a/fastapi/responses.py</span>
<span class="gi">+++ b/fastapi/responses.py</span>
<span class="gu">@@ -1,19 +1,23 @@</span>
<span class="w"> </span>from typing import Any
<span class="gd">-from starlette.responses import FileResponse as FileResponse</span>
<span class="gd">-from starlette.responses import HTMLResponse as HTMLResponse</span>
<span class="gd">-from starlette.responses import JSONResponse as JSONResponse</span>
<span class="gd">-from starlette.responses import PlainTextResponse as PlainTextResponse</span>
<span class="gd">-from starlette.responses import RedirectResponse as RedirectResponse</span>
<span class="gd">-from starlette.responses import Response as Response</span>
<span class="gd">-from starlette.responses import StreamingResponse as StreamingResponse</span>
<span class="gi">+</span>
<span class="gi">+from starlette.responses import FileResponse as FileResponse  # noqa</span>
<span class="gi">+from starlette.responses import HTMLResponse as HTMLResponse  # noqa</span>
<span class="gi">+from starlette.responses import JSONResponse as JSONResponse  # noqa</span>
<span class="gi">+from starlette.responses import PlainTextResponse as PlainTextResponse  # noqa</span>
<span class="gi">+from starlette.responses import RedirectResponse as RedirectResponse  # noqa</span>
<span class="gi">+from starlette.responses import Response as Response  # noqa</span>
<span class="gi">+from starlette.responses import StreamingResponse as StreamingResponse  # noqa</span>
<span class="gi">+</span>
<span class="w"> </span>try:
<span class="w"> </span>    import ujson
<span class="gd">-except ImportError:</span>
<span class="gd">-    ujson = None</span>
<span class="gi">+except ImportError:  # pragma: nocover</span>
<span class="gi">+    ujson = None  # type: ignore</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="w"> </span>try:
<span class="w"> </span>    import orjson
<span class="gd">-except ImportError:</span>
<span class="gd">-    orjson = None</span>
<span class="gi">+except ImportError:  # pragma: nocover</span>
<span class="gi">+    orjson = None  # type: ignore</span>


<span class="w"> </span>class UJSONResponse(JSONResponse):
<span class="gu">@@ -24,6 +28,10 @@ class UJSONResponse(JSONResponse):</span>
<span class="w"> </span>    [FastAPI docs for Custom Response - HTML, Stream, File, others](https://fastapi.tiangolo.com/advanced/custom-response/).
<span class="w"> </span>    &quot;&quot;&quot;

<span class="gi">+    def render(self, content: Any) -&gt; bytes:</span>
<span class="gi">+        assert ujson is not None, &quot;ujson must be installed to use UJSONResponse&quot;</span>
<span class="gi">+        return ujson.dumps(content, ensure_ascii=False).encode(&quot;utf-8&quot;)</span>
<span class="gi">+</span>

<span class="w"> </span>class ORJSONResponse(JSONResponse):
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gu">@@ -32,3 +40,9 @@ class ORJSONResponse(JSONResponse):</span>
<span class="w"> </span>    Read more about it in the
<span class="w"> </span>    [FastAPI docs for Custom Response - HTML, Stream, File, others](https://fastapi.tiangolo.com/advanced/custom-response/).
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gi">+</span>
<span class="gi">+    def render(self, content: Any) -&gt; bytes:</span>
<span class="gi">+        assert orjson is not None, &quot;orjson must be installed to use ORJSONResponse&quot;</span>
<span class="gi">+        return orjson.dumps(</span>
<span class="gi">+            content, option=orjson.OPT_NON_STR_KEYS | orjson.OPT_SERIALIZE_NUMPY</span>
<span class="gi">+        )</span>
<span class="gh">diff --git a/fastapi/routing.py b/fastapi/routing.py</span>
<span class="gh">index b0e631f4..fa135185 100644</span>
<span class="gd">--- a/fastapi/routing.py</span>
<span class="gi">+++ b/fastapi/routing.py</span>
<span class="gu">@@ -5,72 +5,422 @@ import inspect</span>
<span class="w"> </span>import json
<span class="w"> </span>from contextlib import AsyncExitStack
<span class="w"> </span>from enum import Enum, IntEnum
<span class="gd">-from typing import Any, Callable, Coroutine, Dict, List, Optional, Sequence, Set, Tuple, Type, Union</span>
<span class="gi">+from typing import (</span>
<span class="gi">+    Any,</span>
<span class="gi">+    Callable,</span>
<span class="gi">+    Coroutine,</span>
<span class="gi">+    Dict,</span>
<span class="gi">+    List,</span>
<span class="gi">+    Optional,</span>
<span class="gi">+    Sequence,</span>
<span class="gi">+    Set,</span>
<span class="gi">+    Tuple,</span>
<span class="gi">+    Type,</span>
<span class="gi">+    Union,</span>
<span class="gi">+)</span>
<span class="gi">+</span>
<span class="w"> </span>from fastapi import params
<span class="gd">-from fastapi._compat import ModelField, Undefined, _get_model_config, _model_dump, _normalize_errors, lenient_issubclass</span>
<span class="gi">+from fastapi._compat import (</span>
<span class="gi">+    ModelField,</span>
<span class="gi">+    Undefined,</span>
<span class="gi">+    _get_model_config,</span>
<span class="gi">+    _model_dump,</span>
<span class="gi">+    _normalize_errors,</span>
<span class="gi">+    lenient_issubclass,</span>
<span class="gi">+)</span>
<span class="w"> </span>from fastapi.datastructures import Default, DefaultPlaceholder
<span class="w"> </span>from fastapi.dependencies.models import Dependant
<span class="gd">-from fastapi.dependencies.utils import get_body_field, get_dependant, get_parameterless_sub_dependant, get_typed_return_annotation, solve_dependencies</span>
<span class="gi">+from fastapi.dependencies.utils import (</span>
<span class="gi">+    get_body_field,</span>
<span class="gi">+    get_dependant,</span>
<span class="gi">+    get_parameterless_sub_dependant,</span>
<span class="gi">+    get_typed_return_annotation,</span>
<span class="gi">+    solve_dependencies,</span>
<span class="gi">+)</span>
<span class="w"> </span>from fastapi.encoders import jsonable_encoder
<span class="gd">-from fastapi.exceptions import FastAPIError, RequestValidationError, ResponseValidationError, WebSocketRequestValidationError</span>
<span class="gi">+from fastapi.exceptions import (</span>
<span class="gi">+    FastAPIError,</span>
<span class="gi">+    RequestValidationError,</span>
<span class="gi">+    ResponseValidationError,</span>
<span class="gi">+    WebSocketRequestValidationError,</span>
<span class="gi">+)</span>
<span class="w"> </span>from fastapi.types import DecoratedCallable, IncEx
<span class="gd">-from fastapi.utils import create_cloned_field, create_response_field, generate_unique_id, get_value_or_default, is_body_allowed_for_status_code</span>
<span class="gi">+from fastapi.utils import (</span>
<span class="gi">+    create_cloned_field,</span>
<span class="gi">+    create_response_field,</span>
<span class="gi">+    generate_unique_id,</span>
<span class="gi">+    get_value_or_default,</span>
<span class="gi">+    is_body_allowed_for_status_code,</span>
<span class="gi">+)</span>
<span class="w"> </span>from pydantic import BaseModel
<span class="w"> </span>from starlette import routing
<span class="w"> </span>from starlette.concurrency import run_in_threadpool
<span class="w"> </span>from starlette.exceptions import HTTPException
<span class="w"> </span>from starlette.requests import Request
<span class="w"> </span>from starlette.responses import JSONResponse, Response
<span class="gd">-from starlette.routing import BaseRoute, Match, compile_path, get_name, request_response, websocket_session</span>
<span class="gd">-from starlette.routing import Mount as Mount</span>
<span class="gi">+from starlette.routing import (</span>
<span class="gi">+    BaseRoute,</span>
<span class="gi">+    Match,</span>
<span class="gi">+    compile_path,</span>
<span class="gi">+    get_name,</span>
<span class="gi">+    request_response,</span>
<span class="gi">+    websocket_session,</span>
<span class="gi">+)</span>
<span class="gi">+from starlette.routing import Mount as Mount  # noqa</span>
<span class="w"> </span>from starlette.types import ASGIApp, Lifespan, Scope
<span class="w"> </span>from starlette.websockets import WebSocket
<span class="w"> </span>from typing_extensions import Annotated, Doc, deprecated


<span class="gd">-class APIWebSocketRoute(routing.WebSocketRoute):</span>
<span class="gi">+def _prepare_response_content(</span>
<span class="gi">+    res: Any,</span>
<span class="gi">+    *,</span>
<span class="gi">+    exclude_unset: bool,</span>
<span class="gi">+    exclude_defaults: bool = False,</span>
<span class="gi">+    exclude_none: bool = False,</span>
<span class="gi">+) -&gt; Any:</span>
<span class="gi">+    if isinstance(res, BaseModel):</span>
<span class="gi">+        read_with_orm_mode = getattr(_get_model_config(res), &quot;read_with_orm_mode&quot;, None)</span>
<span class="gi">+        if read_with_orm_mode:</span>
<span class="gi">+            # Let from_orm extract the data from this model instead of converting</span>
<span class="gi">+            # it now to a dict.</span>
<span class="gi">+            # Otherwise, there&#39;s no way to extract lazy data that requires attribute</span>
<span class="gi">+            # access instead of dict iteration, e.g. lazy relationships.</span>
<span class="gi">+            return res</span>
<span class="gi">+        return _model_dump(</span>
<span class="gi">+            res,</span>
<span class="gi">+            by_alias=True,</span>
<span class="gi">+            exclude_unset=exclude_unset,</span>
<span class="gi">+            exclude_defaults=exclude_defaults,</span>
<span class="gi">+            exclude_none=exclude_none,</span>
<span class="gi">+        )</span>
<span class="gi">+    elif isinstance(res, list):</span>
<span class="gi">+        return [</span>
<span class="gi">+            _prepare_response_content(</span>
<span class="gi">+                item,</span>
<span class="gi">+                exclude_unset=exclude_unset,</span>
<span class="gi">+                exclude_defaults=exclude_defaults,</span>
<span class="gi">+                exclude_none=exclude_none,</span>
<span class="gi">+            )</span>
<span class="gi">+            for item in res</span>
<span class="gi">+        ]</span>
<span class="gi">+    elif isinstance(res, dict):</span>
<span class="gi">+        return {</span>
<span class="gi">+            k: _prepare_response_content(</span>
<span class="gi">+                v,</span>
<span class="gi">+                exclude_unset=exclude_unset,</span>
<span class="gi">+                exclude_defaults=exclude_defaults,</span>
<span class="gi">+                exclude_none=exclude_none,</span>
<span class="gi">+            )</span>
<span class="gi">+            for k, v in res.items()</span>
<span class="gi">+        }</span>
<span class="gi">+    elif dataclasses.is_dataclass(res):</span>
<span class="gi">+        return dataclasses.asdict(res)</span>
<span class="gi">+    return res</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+async def serialize_response(</span>
<span class="gi">+    *,</span>
<span class="gi">+    field: Optional[ModelField] = None,</span>
<span class="gi">+    response_content: Any,</span>
<span class="gi">+    include: Optional[IncEx] = None,</span>
<span class="gi">+    exclude: Optional[IncEx] = None,</span>
<span class="gi">+    by_alias: bool = True,</span>
<span class="gi">+    exclude_unset: bool = False,</span>
<span class="gi">+    exclude_defaults: bool = False,</span>
<span class="gi">+    exclude_none: bool = False,</span>
<span class="gi">+    is_coroutine: bool = True,</span>
<span class="gi">+) -&gt; Any:</span>
<span class="gi">+    if field:</span>
<span class="gi">+        errors = []</span>
<span class="gi">+        if not hasattr(field, &quot;serialize&quot;):</span>
<span class="gi">+            # pydantic v1</span>
<span class="gi">+            response_content = _prepare_response_content(</span>
<span class="gi">+                response_content,</span>
<span class="gi">+                exclude_unset=exclude_unset,</span>
<span class="gi">+                exclude_defaults=exclude_defaults,</span>
<span class="gi">+                exclude_none=exclude_none,</span>
<span class="gi">+            )</span>
<span class="gi">+        if is_coroutine:</span>
<span class="gi">+            value, errors_ = field.validate(response_content, {}, loc=(&quot;response&quot;,))</span>
<span class="gi">+        else:</span>
<span class="gi">+            value, errors_ = await run_in_threadpool(</span>
<span class="gi">+                field.validate, response_content, {}, loc=(&quot;response&quot;,)</span>
<span class="gi">+            )</span>
<span class="gi">+        if isinstance(errors_, list):</span>
<span class="gi">+            errors.extend(errors_)</span>
<span class="gi">+        elif errors_:</span>
<span class="gi">+            errors.append(errors_)</span>
<span class="gi">+        if errors:</span>
<span class="gi">+            raise ResponseValidationError(</span>
<span class="gi">+                errors=_normalize_errors(errors), body=response_content</span>
<span class="gi">+            )</span>
<span class="gi">+</span>
<span class="gi">+        if hasattr(field, &quot;serialize&quot;):</span>
<span class="gi">+            return field.serialize(</span>
<span class="gi">+                value,</span>
<span class="gi">+                include=include,</span>
<span class="gi">+                exclude=exclude,</span>
<span class="gi">+                by_alias=by_alias,</span>
<span class="gi">+                exclude_unset=exclude_unset,</span>
<span class="gi">+                exclude_defaults=exclude_defaults,</span>
<span class="gi">+                exclude_none=exclude_none,</span>
<span class="gi">+            )</span>
<span class="gi">+</span>
<span class="gi">+        return jsonable_encoder(</span>
<span class="gi">+            value,</span>
<span class="gi">+            include=include,</span>
<span class="gi">+            exclude=exclude,</span>
<span class="gi">+            by_alias=by_alias,</span>
<span class="gi">+            exclude_unset=exclude_unset,</span>
<span class="gi">+            exclude_defaults=exclude_defaults,</span>
<span class="gi">+            exclude_none=exclude_none,</span>
<span class="gi">+        )</span>
<span class="gi">+    else:</span>
<span class="gi">+        return jsonable_encoder(response_content)</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+async def run_endpoint_function(</span>
<span class="gi">+    *, dependant: Dependant, values: Dict[str, Any], is_coroutine: bool</span>
<span class="gi">+) -&gt; Any:</span>
<span class="gi">+    # Only called by get_request_handler. Has been split into its own function to</span>
<span class="gi">+    # facilitate profiling endpoints, since inner functions are harder to profile.</span>
<span class="gi">+    assert dependant.call is not None, &quot;dependant.call must be a function&quot;</span>
<span class="gi">+</span>
<span class="gi">+    if is_coroutine:</span>
<span class="gi">+        return await dependant.call(**values)</span>
<span class="gi">+    else:</span>
<span class="gi">+        return await run_in_threadpool(dependant.call, **values)</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def get_request_handler(</span>
<span class="gi">+    dependant: Dependant,</span>
<span class="gi">+    body_field: Optional[ModelField] = None,</span>
<span class="gi">+    status_code: Optional[int] = None,</span>
<span class="gi">+    response_class: Union[Type[Response], DefaultPlaceholder] = Default(JSONResponse),</span>
<span class="gi">+    response_field: Optional[ModelField] = None,</span>
<span class="gi">+    response_model_include: Optional[IncEx] = None,</span>
<span class="gi">+    response_model_exclude: Optional[IncEx] = None,</span>
<span class="gi">+    response_model_by_alias: bool = True,</span>
<span class="gi">+    response_model_exclude_unset: bool = False,</span>
<span class="gi">+    response_model_exclude_defaults: bool = False,</span>
<span class="gi">+    response_model_exclude_none: bool = False,</span>
<span class="gi">+    dependency_overrides_provider: Optional[Any] = None,</span>
<span class="gi">+) -&gt; Callable[[Request], Coroutine[Any, Any, Response]]:</span>
<span class="gi">+    assert dependant.call is not None, &quot;dependant.call must be a function&quot;</span>
<span class="gi">+    is_coroutine = asyncio.iscoroutinefunction(dependant.call)</span>
<span class="gi">+    is_body_form = body_field and isinstance(body_field.field_info, params.Form)</span>
<span class="gi">+    if isinstance(response_class, DefaultPlaceholder):</span>
<span class="gi">+        actual_response_class: Type[Response] = response_class.value</span>
<span class="gi">+    else:</span>
<span class="gi">+        actual_response_class = response_class</span>
<span class="gi">+</span>
<span class="gi">+    async def app(request: Request) -&gt; Response:</span>
<span class="gi">+        response: Union[Response, None] = None</span>
<span class="gi">+        async with AsyncExitStack() as file_stack:</span>
<span class="gi">+            try:</span>
<span class="gi">+                body: Any = None</span>
<span class="gi">+                if body_field:</span>
<span class="gi">+                    if is_body_form:</span>
<span class="gi">+                        body = await request.form()</span>
<span class="gi">+                        file_stack.push_async_callback(body.close)</span>
<span class="gi">+                    else:</span>
<span class="gi">+                        body_bytes = await request.body()</span>
<span class="gi">+                        if body_bytes:</span>
<span class="gi">+                            json_body: Any = Undefined</span>
<span class="gi">+                            content_type_value = request.headers.get(&quot;content-type&quot;)</span>
<span class="gi">+                            if not content_type_value:</span>
<span class="gi">+                                json_body = await request.json()</span>
<span class="gi">+                            else:</span>
<span class="gi">+                                message = email.message.Message()</span>
<span class="gi">+                                message[&quot;content-type&quot;] = content_type_value</span>
<span class="gi">+                                if message.get_content_maintype() == &quot;application&quot;:</span>
<span class="gi">+                                    subtype = message.get_content_subtype()</span>
<span class="gi">+                                    if subtype == &quot;json&quot; or subtype.endswith(&quot;+json&quot;):</span>
<span class="gi">+                                        json_body = await request.json()</span>
<span class="gi">+                            if json_body != Undefined:</span>
<span class="gi">+                                body = json_body</span>
<span class="gi">+                            else:</span>
<span class="gi">+                                body = body_bytes</span>
<span class="gi">+            except json.JSONDecodeError as e:</span>
<span class="gi">+                validation_error = RequestValidationError(</span>
<span class="gi">+                    [</span>
<span class="gi">+                        {</span>
<span class="gi">+                            &quot;type&quot;: &quot;json_invalid&quot;,</span>
<span class="gi">+                            &quot;loc&quot;: (&quot;body&quot;, e.pos),</span>
<span class="gi">+                            &quot;msg&quot;: &quot;JSON decode error&quot;,</span>
<span class="gi">+                            &quot;input&quot;: {},</span>
<span class="gi">+                            &quot;ctx&quot;: {&quot;error&quot;: e.msg},</span>
<span class="gi">+                        }</span>
<span class="gi">+                    ],</span>
<span class="gi">+                    body=e.doc,</span>
<span class="gi">+                )</span>
<span class="gi">+                raise validation_error from e</span>
<span class="gi">+            except HTTPException:</span>
<span class="gi">+                # If a middleware raises an HTTPException, it should be raised again</span>
<span class="gi">+                raise</span>
<span class="gi">+            except Exception as e:</span>
<span class="gi">+                http_error = HTTPException(</span>
<span class="gi">+                    status_code=400, detail=&quot;There was an error parsing the body&quot;</span>
<span class="gi">+                )</span>
<span class="gi">+                raise http_error from e</span>
<span class="gi">+            errors: List[Any] = []</span>
<span class="gi">+            async with AsyncExitStack() as async_exit_stack:</span>
<span class="gi">+                solved_result = await solve_dependencies(</span>
<span class="gi">+                    request=request,</span>
<span class="gi">+                    dependant=dependant,</span>
<span class="gi">+                    body=body,</span>
<span class="gi">+                    dependency_overrides_provider=dependency_overrides_provider,</span>
<span class="gi">+                    async_exit_stack=async_exit_stack,</span>
<span class="gi">+                )</span>
<span class="gi">+                values, errors, background_tasks, sub_response, _ = solved_result</span>
<span class="gi">+                if not errors:</span>
<span class="gi">+                    raw_response = await run_endpoint_function(</span>
<span class="gi">+                        dependant=dependant, values=values, is_coroutine=is_coroutine</span>
<span class="gi">+                    )</span>
<span class="gi">+                    if isinstance(raw_response, Response):</span>
<span class="gi">+                        if raw_response.background is None:</span>
<span class="gi">+                            raw_response.background = background_tasks</span>
<span class="gi">+                        response = raw_response</span>
<span class="gi">+                    else:</span>
<span class="gi">+                        response_args: Dict[str, Any] = {&quot;background&quot;: background_tasks}</span>
<span class="gi">+                        # If status_code was set, use it, otherwise use the default from the</span>
<span class="gi">+                        # response class, in the case of redirect it&#39;s 307</span>
<span class="gi">+                        current_status_code = (</span>
<span class="gi">+                            status_code if status_code else sub_response.status_code</span>
<span class="gi">+                        )</span>
<span class="gi">+                        if current_status_code is not None:</span>
<span class="gi">+                            response_args[&quot;status_code&quot;] = current_status_code</span>
<span class="gi">+                        if sub_response.status_code:</span>
<span class="gi">+                            response_args[&quot;status_code&quot;] = sub_response.status_code</span>
<span class="gi">+                        content = await serialize_response(</span>
<span class="gi">+                            field=response_field,</span>
<span class="gi">+                            response_content=raw_response,</span>
<span class="gi">+                            include=response_model_include,</span>
<span class="gi">+                            exclude=response_model_exclude,</span>
<span class="gi">+                            by_alias=response_model_by_alias,</span>
<span class="gi">+                            exclude_unset=response_model_exclude_unset,</span>
<span class="gi">+                            exclude_defaults=response_model_exclude_defaults,</span>
<span class="gi">+                            exclude_none=response_model_exclude_none,</span>
<span class="gi">+                            is_coroutine=is_coroutine,</span>
<span class="gi">+                        )</span>
<span class="gi">+                        response = actual_response_class(content, **response_args)</span>
<span class="gi">+                        if not is_body_allowed_for_status_code(response.status_code):</span>
<span class="gi">+                            response.body = b&quot;&quot;</span>
<span class="gi">+                        response.headers.raw.extend(sub_response.headers.raw)</span>
<span class="gi">+            if errors:</span>
<span class="gi">+                validation_error = RequestValidationError(</span>
<span class="gi">+                    _normalize_errors(errors), body=body</span>
<span class="gi">+                )</span>
<span class="gi">+                raise validation_error</span>
<span class="gi">+        if response is None:</span>
<span class="gi">+            raise FastAPIError(</span>
<span class="gi">+                &quot;No response object was returned. There&#39;s a high chance that the &quot;</span>
<span class="gi">+                &quot;application code is raising an exception and a dependency with yield &quot;</span>
<span class="gi">+                &quot;has a block with a bare except, or a block with except Exception, &quot;</span>
<span class="gi">+                &quot;and is not raising the exception again. Read more about it in the &quot;</span>
<span class="gi">+                &quot;docs: https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-with-yield/#dependencies-with-yield-and-except&quot;</span>
<span class="gi">+            )</span>
<span class="gi">+        return response</span>
<span class="gi">+</span>
<span class="gi">+    return app</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def get_websocket_app(</span>
<span class="gi">+    dependant: Dependant, dependency_overrides_provider: Optional[Any] = None</span>
<span class="gi">+) -&gt; Callable[[WebSocket], Coroutine[Any, Any, Any]]:</span>
<span class="gi">+    async def app(websocket: WebSocket) -&gt; None:</span>
<span class="gi">+        async with AsyncExitStack() as async_exit_stack:</span>
<span class="gi">+            # TODO: remove this scope later, after a few releases</span>
<span class="gi">+            # This scope fastapi_astack is no longer used by FastAPI, kept for</span>
<span class="gi">+            # compatibility, just in case</span>
<span class="gi">+            websocket.scope[&quot;fastapi_astack&quot;] = async_exit_stack</span>
<span class="gi">+            solved_result = await solve_dependencies(</span>
<span class="gi">+                request=websocket,</span>
<span class="gi">+                dependant=dependant,</span>
<span class="gi">+                dependency_overrides_provider=dependency_overrides_provider,</span>
<span class="gi">+                async_exit_stack=async_exit_stack,</span>
<span class="gi">+            )</span>
<span class="gi">+            values, errors, _, _2, _3 = solved_result</span>
<span class="gi">+            if errors:</span>
<span class="gi">+                raise WebSocketRequestValidationError(_normalize_errors(errors))</span>
<span class="gi">+            assert dependant.call is not None, &quot;dependant.call must be a function&quot;</span>
<span class="gi">+            await dependant.call(**values)</span>
<span class="gi">+</span>
<span class="gi">+    return app</span>
<span class="gi">+</span>

<span class="gd">-    def __init__(self, path: str, endpoint: Callable[..., Any], *, name:</span>
<span class="gd">-        Optional[str]=None, dependencies: Optional[Sequence[params.Depends]</span>
<span class="gd">-        ]=None, dependency_overrides_provider: Optional[Any]=None) -&gt;None:</span>
<span class="gi">+class APIWebSocketRoute(routing.WebSocketRoute):</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: str,</span>
<span class="gi">+        endpoint: Callable[..., Any],</span>
<span class="gi">+        *,</span>
<span class="gi">+        name: Optional[str] = None,</span>
<span class="gi">+        dependencies: Optional[Sequence[params.Depends]] = None,</span>
<span class="gi">+        dependency_overrides_provider: Optional[Any] = None,</span>
<span class="gi">+    ) -&gt; None:</span>
<span class="w"> </span>        self.path = path
<span class="w"> </span>        self.endpoint = endpoint
<span class="w"> </span>        self.name = get_name(endpoint) if name is None else name
<span class="w"> </span>        self.dependencies = list(dependencies or [])
<span class="gd">-        self.path_regex, self.path_format, self.param_convertors = (</span>
<span class="gd">-            compile_path(path))</span>
<span class="gd">-        self.dependant = get_dependant(path=self.path_format, call=self.</span>
<span class="gd">-            endpoint)</span>
<span class="gi">+        self.path_regex, self.path_format, self.param_convertors = compile_path(path)</span>
<span class="gi">+        self.dependant = get_dependant(path=self.path_format, call=self.endpoint)</span>
<span class="w"> </span>        for depends in self.dependencies[::-1]:
<span class="gd">-            self.dependant.dependencies.insert(0,</span>
<span class="gd">-                get_parameterless_sub_dependant(depends=depends, path=self.</span>
<span class="gd">-                path_format))</span>
<span class="gd">-        self.app = websocket_session(get_websocket_app(dependant=self.</span>
<span class="gd">-            dependant, dependency_overrides_provider=</span>
<span class="gd">-            dependency_overrides_provider))</span>
<span class="gi">+            self.dependant.dependencies.insert(</span>
<span class="gi">+                0,</span>
<span class="gi">+                get_parameterless_sub_dependant(depends=depends, path=self.path_format),</span>
<span class="gi">+            )</span>
<span class="gi">+</span>
<span class="gi">+        self.app = websocket_session(</span>
<span class="gi">+            get_websocket_app(</span>
<span class="gi">+                dependant=self.dependant,</span>
<span class="gi">+                dependency_overrides_provider=dependency_overrides_provider,</span>
<span class="gi">+            )</span>
<span class="gi">+        )</span>

<span class="gi">+    def matches(self, scope: Scope) -&gt; Tuple[Match, Scope]:</span>
<span class="gi">+        match, child_scope = super().matches(scope)</span>
<span class="gi">+        if match != Match.NONE:</span>
<span class="gi">+            child_scope[&quot;route&quot;] = self</span>
<span class="gi">+        return match, child_scope</span>

<span class="gd">-class APIRoute(routing.Route):</span>

<span class="gd">-    def __init__(self, path: str, endpoint: Callable[..., Any], *,</span>
<span class="gd">-        response_model: Any=Default(None), status_code: Optional[int]=None,</span>
<span class="gd">-        tags: Optional[List[Union[str, Enum]]]=None, dependencies: Optional</span>
<span class="gd">-        [Sequence[params.Depends]]=None, summary: Optional[str]=None,</span>
<span class="gd">-        description: Optional[str]=None, response_description: str=</span>
<span class="gd">-        &#39;Successful Response&#39;, responses: Optional[Dict[Union[int, str],</span>
<span class="gd">-        Dict[str, Any]]]=None, deprecated: Optional[bool]=None, name:</span>
<span class="gd">-        Optional[str]=None, methods: Optional[Union[Set[str], List[str]]]=</span>
<span class="gd">-        None, operation_id: Optional[str]=None, response_model_include:</span>
<span class="gd">-        Optional[IncEx]=None, response_model_exclude: Optional[IncEx]=None,</span>
<span class="gd">-        response_model_by_alias: bool=True, response_model_exclude_unset:</span>
<span class="gd">-        bool=False, response_model_exclude_defaults: bool=False,</span>
<span class="gd">-        response_model_exclude_none: bool=False, include_in_schema: bool=</span>
<span class="gd">-        True, response_class: Union[Type[Response], DefaultPlaceholder]=</span>
<span class="gd">-        Default(JSONResponse), dependency_overrides_provider: Optional[Any]</span>
<span class="gd">-        =None, callbacks: Optional[List[BaseRoute]]=None, openapi_extra:</span>
<span class="gd">-        Optional[Dict[str, Any]]=None, generate_unique_id_function: Union[</span>
<span class="gd">-        Callable[[&#39;APIRoute&#39;], str], DefaultPlaceholder]=Default(</span>
<span class="gd">-        generate_unique_id)) -&gt;None:</span>
<span class="gi">+class APIRoute(routing.Route):</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: str,</span>
<span class="gi">+        endpoint: Callable[..., Any],</span>
<span class="gi">+        *,</span>
<span class="gi">+        response_model: Any = Default(None),</span>
<span class="gi">+        status_code: Optional[int] = None,</span>
<span class="gi">+        tags: Optional[List[Union[str, Enum]]] = None,</span>
<span class="gi">+        dependencies: Optional[Sequence[params.Depends]] = None,</span>
<span class="gi">+        summary: Optional[str] = None,</span>
<span class="gi">+        description: Optional[str] = None,</span>
<span class="gi">+        response_description: str = &quot;Successful Response&quot;,</span>
<span class="gi">+        responses: Optional[Dict[Union[int, str], Dict[str, Any]]] = None,</span>
<span class="gi">+        deprecated: Optional[bool] = None,</span>
<span class="gi">+        name: Optional[str] = None,</span>
<span class="gi">+        methods: Optional[Union[Set[str], List[str]]] = None,</span>
<span class="gi">+        operation_id: Optional[str] = None,</span>
<span class="gi">+        response_model_include: Optional[IncEx] = None,</span>
<span class="gi">+        response_model_exclude: Optional[IncEx] = None,</span>
<span class="gi">+        response_model_by_alias: bool = True,</span>
<span class="gi">+        response_model_exclude_unset: bool = False,</span>
<span class="gi">+        response_model_exclude_defaults: bool = False,</span>
<span class="gi">+        response_model_exclude_none: bool = False,</span>
<span class="gi">+        include_in_schema: bool = True,</span>
<span class="gi">+        response_class: Union[Type[Response], DefaultPlaceholder] = Default(</span>
<span class="gi">+            JSONResponse</span>
<span class="gi">+        ),</span>
<span class="gi">+        dependency_overrides_provider: Optional[Any] = None,</span>
<span class="gi">+        callbacks: Optional[List[BaseRoute]] = None,</span>
<span class="gi">+        openapi_extra: Optional[Dict[str, Any]] = None,</span>
<span class="gi">+        generate_unique_id_function: Union[</span>
<span class="gi">+            Callable[[&quot;APIRoute&quot;], str], DefaultPlaceholder</span>
<span class="gi">+        ] = Default(generate_unique_id),</span>
<span class="gi">+    ) -&gt; None:</span>
<span class="w"> </span>        self.path = path
<span class="w"> </span>        self.endpoint = endpoint
<span class="w"> </span>        if isinstance(response_model, DefaultPlaceholder):
<span class="gu">@@ -99,64 +449,98 @@ class APIRoute(routing.Route):</span>
<span class="w"> </span>        self.tags = tags or []
<span class="w"> </span>        self.responses = responses or {}
<span class="w"> </span>        self.name = get_name(endpoint) if name is None else name
<span class="gd">-        self.path_regex, self.path_format, self.param_convertors = (</span>
<span class="gd">-            compile_path(path))</span>
<span class="gi">+        self.path_regex, self.path_format, self.param_convertors = compile_path(path)</span>
<span class="w"> </span>        if methods is None:
<span class="gd">-            methods = [&#39;GET&#39;]</span>
<span class="gi">+            methods = [&quot;GET&quot;]</span>
<span class="w"> </span>        self.methods: Set[str] = {method.upper() for method in methods}
<span class="w"> </span>        if isinstance(generate_unique_id_function, DefaultPlaceholder):
<span class="gd">-            current_generate_unique_id: Callable[[&#39;APIRoute&#39;], str</span>
<span class="gd">-                ] = generate_unique_id_function.value</span>
<span class="gi">+            current_generate_unique_id: Callable[</span>
<span class="gi">+                [&quot;APIRoute&quot;], str</span>
<span class="gi">+            ] = generate_unique_id_function.value</span>
<span class="w"> </span>        else:
<span class="w"> </span>            current_generate_unique_id = generate_unique_id_function
<span class="w"> </span>        self.unique_id = self.operation_id or current_generate_unique_id(self)
<span class="gi">+        # normalize enums e.g. http.HTTPStatus</span>
<span class="w"> </span>        if isinstance(status_code, IntEnum):
<span class="w"> </span>            status_code = int(status_code)
<span class="w"> </span>        self.status_code = status_code
<span class="w"> </span>        if self.response_model:
<span class="gd">-            assert is_body_allowed_for_status_code(status_code</span>
<span class="gd">-                ), f&#39;Status code {status_code} must not have a response body&#39;</span>
<span class="gd">-            response_name = &#39;Response_&#39; + self.unique_id</span>
<span class="gd">-            self.response_field = create_response_field(name=response_name,</span>
<span class="gd">-                type_=self.response_model, mode=&#39;serialization&#39;)</span>
<span class="gd">-            self.secure_cloned_response_field: Optional[ModelField</span>
<span class="gd">-                ] = create_cloned_field(self.response_field)</span>
<span class="gi">+            assert is_body_allowed_for_status_code(</span>
<span class="gi">+                status_code</span>
<span class="gi">+            ), f&quot;Status code {status_code} must not have a response body&quot;</span>
<span class="gi">+            response_name = &quot;Response_&quot; + self.unique_id</span>
<span class="gi">+            self.response_field = create_response_field(</span>
<span class="gi">+                name=response_name,</span>
<span class="gi">+                type_=self.response_model,</span>
<span class="gi">+                mode=&quot;serialization&quot;,</span>
<span class="gi">+            )</span>
<span class="gi">+            # Create a clone of the field, so that a Pydantic submodel is not returned</span>
<span class="gi">+            # as is just because it&#39;s an instance of a subclass of a more limited class</span>
<span class="gi">+            # e.g. UserInDB (containing hashed_password) could be a subclass of User</span>
<span class="gi">+            # that doesn&#39;t have the hashed_password. But because it&#39;s a subclass, it</span>
<span class="gi">+            # would pass the validation and be returned as is.</span>
<span class="gi">+            # By being a new field, no inheritance will be passed as is. A new model</span>
<span class="gi">+            # will always be created.</span>
<span class="gi">+            # TODO: remove when deprecating Pydantic v1</span>
<span class="gi">+            self.secure_cloned_response_field: Optional[</span>
<span class="gi">+                ModelField</span>
<span class="gi">+            ] = create_cloned_field(self.response_field)</span>
<span class="w"> </span>        else:
<span class="gd">-            self.response_field = None</span>
<span class="gi">+            self.response_field = None  # type: ignore</span>
<span class="w"> </span>            self.secure_cloned_response_field = None
<span class="w"> </span>        self.dependencies = list(dependencies or [])
<span class="gd">-        self.description = description or inspect.cleandoc(self.endpoint.</span>
<span class="gd">-            __doc__ or &#39;&#39;)</span>
<span class="gd">-        self.description = self.description.split(&#39;\x0c&#39;)[0].strip()</span>
<span class="gi">+        self.description = description or inspect.cleandoc(self.endpoint.__doc__ or &quot;&quot;)</span>
<span class="gi">+        # if a &quot;form feed&quot; character (page break) is found in the description text,</span>
<span class="gi">+        # truncate description text to the content preceding the first &quot;form feed&quot;</span>
<span class="gi">+        self.description = self.description.split(&quot;\f&quot;)[0].strip()</span>
<span class="w"> </span>        response_fields = {}
<span class="w"> </span>        for additional_status_code, response in self.responses.items():
<span class="gd">-            assert isinstance(response, dict</span>
<span class="gd">-                ), &#39;An additional response must be a dict&#39;</span>
<span class="gd">-            model = response.get(&#39;model&#39;)</span>
<span class="gi">+            assert isinstance(response, dict), &quot;An additional response must be a dict&quot;</span>
<span class="gi">+            model = response.get(&quot;model&quot;)</span>
<span class="w"> </span>            if model:
<span class="gd">-                assert is_body_allowed_for_status_code(additional_status_code</span>
<span class="gd">-                    ), f&#39;Status code {additional_status_code} must not have a response body&#39;</span>
<span class="gd">-                response_name = (</span>
<span class="gd">-                    f&#39;Response_{additional_status_code}_{self.unique_id}&#39;)</span>
<span class="gd">-                response_field = create_response_field(name=response_name,</span>
<span class="gd">-                    type_=model)</span>
<span class="gi">+                assert is_body_allowed_for_status_code(</span>
<span class="gi">+                    additional_status_code</span>
<span class="gi">+                ), f&quot;Status code {additional_status_code} must not have a response body&quot;</span>
<span class="gi">+                response_name = f&quot;Response_{additional_status_code}_{self.unique_id}&quot;</span>
<span class="gi">+                response_field = create_response_field(name=response_name, type_=model)</span>
<span class="w"> </span>                response_fields[additional_status_code] = response_field
<span class="w"> </span>        if response_fields:
<span class="gd">-            self.response_fields: Dict[Union[int, str], ModelField</span>
<span class="gd">-                ] = response_fields</span>
<span class="gi">+            self.response_fields: Dict[Union[int, str], ModelField] = response_fields</span>
<span class="w"> </span>        else:
<span class="w"> </span>            self.response_fields = {}
<span class="gd">-        assert callable(endpoint), &#39;An endpoint must be a callable&#39;</span>
<span class="gd">-        self.dependant = get_dependant(path=self.path_format, call=self.</span>
<span class="gd">-            endpoint)</span>
<span class="gi">+</span>
<span class="gi">+        assert callable(endpoint), &quot;An endpoint must be a callable&quot;</span>
<span class="gi">+        self.dependant = get_dependant(path=self.path_format, call=self.endpoint)</span>
<span class="w"> </span>        for depends in self.dependencies[::-1]:
<span class="gd">-            self.dependant.dependencies.insert(0,</span>
<span class="gd">-                get_parameterless_sub_dependant(depends=depends, path=self.</span>
<span class="gd">-                path_format))</span>
<span class="gd">-        self.body_field = get_body_field(dependant=self.dependant, name=</span>
<span class="gd">-            self.unique_id)</span>
<span class="gi">+            self.dependant.dependencies.insert(</span>
<span class="gi">+                0,</span>
<span class="gi">+                get_parameterless_sub_dependant(depends=depends, path=self.path_format),</span>
<span class="gi">+            )</span>
<span class="gi">+        self.body_field = get_body_field(dependant=self.dependant, name=self.unique_id)</span>
<span class="w"> </span>        self.app = request_response(self.get_route_handler())

<span class="gi">+    def get_route_handler(self) -&gt; Callable[[Request], Coroutine[Any, Any, Response]]:</span>
<span class="gi">+        return get_request_handler(</span>
<span class="gi">+            dependant=self.dependant,</span>
<span class="gi">+            body_field=self.body_field,</span>
<span class="gi">+            status_code=self.status_code,</span>
<span class="gi">+            response_class=self.response_class,</span>
<span class="gi">+            response_field=self.secure_cloned_response_field,</span>
<span class="gi">+            response_model_include=self.response_model_include,</span>
<span class="gi">+            response_model_exclude=self.response_model_exclude,</span>
<span class="gi">+            response_model_by_alias=self.response_model_by_alias,</span>
<span class="gi">+            response_model_exclude_unset=self.response_model_exclude_unset,</span>
<span class="gi">+            response_model_exclude_defaults=self.response_model_exclude_defaults,</span>
<span class="gi">+            response_model_exclude_none=self.response_model_exclude_none,</span>
<span class="gi">+            dependency_overrides_provider=self.dependency_overrides_provider,</span>
<span class="gi">+        )</span>
<span class="gi">+</span>
<span class="gi">+    def matches(self, scope: Scope) -&gt; Tuple[Match, Scope]:</span>
<span class="gi">+        match, child_scope = super().matches(scope)</span>
<span class="gi">+        if match != Match.NONE:</span>
<span class="gi">+            child_scope[&quot;route&quot;] = self</span>
<span class="gi">+        return match, child_scope</span>
<span class="gi">+</span>

<span class="w"> </span>class APIRouter(routing.Router):
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gu">@@ -185,10 +569,14 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>    ```
<span class="w"> </span>    &quot;&quot;&quot;

<span class="gd">-    def __init__(self, *, prefix: Annotated[str, Doc(</span>
<span class="gd">-        &#39;An optional path prefix for the router.&#39;)]=&#39;&#39;, tags: Annotated[</span>
<span class="gd">-        Optional[List[Union[str, Enum]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        *,</span>
<span class="gi">+        prefix: Annotated[str, Doc(&quot;An optional path prefix for the router.&quot;)] = &quot;&quot;,</span>
<span class="gi">+        tags: Annotated[</span>
<span class="gi">+            Optional[List[Union[str, Enum]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of tags to be applied to all the *path operations* in this
<span class="w"> </span>                router.

<span class="gu">@@ -197,25 +585,35 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, dependencies: Annotated[Optional[Sequence[params.Depends]],</span>
<span class="gd">-        Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        dependencies: Annotated[</span>
<span class="gi">+            Optional[Sequence[params.Depends]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of dependencies (using `Depends()`) to be applied to all the
<span class="w"> </span>                *path operations* in this router.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Bigger Applications - Multiple Files](https://fastapi.tiangolo.com/tutorial/bigger-applications/#include-an-apirouter-with-a-custom-prefix-tags-responses-and-dependencies).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, default_response_class: Annotated[Type[Response], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        default_response_class: Annotated[</span>
<span class="gi">+            Type[Response],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The default response class to be used.

<span class="w"> </span>                Read more in the
<span class="w"> </span>                [FastAPI docs for Custom Response - HTML, Stream, File, others](https://fastapi.tiangolo.com/advanced/custom-response/#default-response-class).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(JSONResponse), responses: Annotated[Optional[Dict[Union[</span>
<span class="gd">-        int, str], Dict[str, Any]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(JSONResponse),</span>
<span class="gi">+        responses: Annotated[</span>
<span class="gi">+            Optional[Dict[Union[int, str], Dict[str, Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Additional responses to be shown in OpenAPI.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -226,8 +624,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                And in the
<span class="w"> </span>                [FastAPI docs for Bigger Applications](https://fastapi.tiangolo.com/tutorial/bigger-applications/#include-an-apirouter-with-a-custom-prefix-tags-responses-and-dependencies).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, callbacks: Annotated[Optional[List[BaseRoute]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        callbacks: Annotated[</span>
<span class="gi">+            Optional[List[BaseRoute]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                OpenAPI callbacks that should apply to all *path operations* in this
<span class="w"> </span>                router.

<span class="gu">@@ -236,8 +638,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for OpenAPI Callbacks](https://fastapi.tiangolo.com/advanced/openapi-callbacks/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, routes: Annotated[Optional[List[BaseRoute]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        routes: Annotated[</span>
<span class="gi">+            Optional[List[BaseRoute]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                **Note**: you probably shouldn&#39;t use this parameter, it is inherited
<span class="w"> </span>                from Starlette and supported for compatibility.

<span class="gu">@@ -245,51 +651,73 @@ class APIRouter(routing.Router):</span>

<span class="w"> </span>                A list of routes to serve incoming HTTP and WebSocket requests.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        ), deprecated(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+            deprecated(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                You normally wouldn&#39;t use this parameter with FastAPI, it is inherited
<span class="w"> </span>                from Starlette and supported for compatibility.

<span class="w"> </span>                In FastAPI, you normally would use the *path operation methods*,
<span class="w"> </span>                like `router.get()`, `router.post()`, etc.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, redirect_slashes: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        redirect_slashes: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Whether to detect and redirect slashes in URLs when the client doesn&#39;t
<span class="w"> </span>                use the same format.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, default: Annotated[Optional[ASGIApp], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        default: Annotated[</span>
<span class="gi">+            Optional[ASGIApp],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Default function handler for this router. Used to handle
<span class="w"> </span>                404 Not Found errors.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, dependency_overrides_provider: Annotated[Optional[Any],</span>
<span class="gd">-        Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        dependency_overrides_provider: Annotated[</span>
<span class="gi">+            Optional[Any],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Only used internally by FastAPI to handle dependency overrides.

<span class="w"> </span>                You shouldn&#39;t need to use it. It normally points to the `FastAPI` app
<span class="w"> </span>                object.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, route_class: Annotated[Type[APIRoute], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        route_class: Annotated[</span>
<span class="gi">+            Type[APIRoute],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Custom route (*path operation*) class to be used by this router.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Custom Request and APIRoute class](https://fastapi.tiangolo.com/how-to/custom-request-and-route/#custom-apiroute-class-in-a-router).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=APIRoute, on_startup: Annotated[Optional[Sequence[Callable[[],</span>
<span class="gd">-        Any]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = APIRoute,</span>
<span class="gi">+        on_startup: Annotated[</span>
<span class="gi">+            Optional[Sequence[Callable[[], Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of startup event handler functions.

<span class="w"> </span>                You should instead use the `lifespan` handlers.

<span class="w"> </span>                Read more in the [FastAPI docs for `lifespan`](https://fastapi.tiangolo.com/advanced/events/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, on_shutdown: Annotated[Optional[Sequence[Callable[[], Any]</span>
<span class="gd">-        ]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        on_shutdown: Annotated[</span>
<span class="gi">+            Optional[Sequence[Callable[[], Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of shutdown event handler functions.

<span class="w"> </span>                You should instead use the `lifespan` handlers.
<span class="gu">@@ -297,16 +725,26 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more in the
<span class="w"> </span>                [FastAPI docs for `lifespan`](https://fastapi.tiangolo.com/advanced/events/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, lifespan: Annotated[Optional[Lifespan[Any]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        # the generic to Lifespan[AppType] is the type of the top level application</span>
<span class="gi">+        # which the router cannot know statically, so we use typing.Any</span>
<span class="gi">+        lifespan: Annotated[</span>
<span class="gi">+            Optional[Lifespan[Any]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A `Lifespan` context manager handler. This replaces `startup` and
<span class="w"> </span>                `shutdown` functions with a single context manager.

<span class="w"> </span>                Read more in the
<span class="w"> </span>                [FastAPI docs for `lifespan`](https://fastapi.tiangolo.com/advanced/events/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, deprecated: Annotated[Optional[bool], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        deprecated: Annotated[</span>
<span class="gi">+            Optional[bool],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Mark all *path operations* in this router as deprecated.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -314,8 +752,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, include_in_schema: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        include_in_schema: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                To include (or not) all the *path operations* in this router in the
<span class="w"> </span>                generated OpenAPI.

<span class="gu">@@ -324,9 +766,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Query Parameters and String Validations](https://fastapi.tiangolo.com/tutorial/query-params-str-validations/#exclude-from-openapi).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, generate_unique_id_function: Annotated[Callable[[APIRoute],</span>
<span class="gd">-        str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        generate_unique_id_function: Annotated[</span>
<span class="gi">+            Callable[[APIRoute], str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Customize the function used to generate unique IDs for the *path
<span class="w"> </span>                operations* shown in the generated OpenAPI.

<span class="gu">@@ -336,14 +781,22 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(generate_unique_id)) -&gt;None:</span>
<span class="gd">-        super().__init__(routes=routes, redirect_slashes=redirect_slashes,</span>
<span class="gd">-            default=default, on_startup=on_startup, on_shutdown=on_shutdown,</span>
<span class="gd">-            lifespan=lifespan)</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(generate_unique_id),</span>
<span class="gi">+    ) -&gt; None:</span>
<span class="gi">+        super().__init__(</span>
<span class="gi">+            routes=routes,</span>
<span class="gi">+            redirect_slashes=redirect_slashes,</span>
<span class="gi">+            default=default,</span>
<span class="gi">+            on_startup=on_startup,</span>
<span class="gi">+            on_shutdown=on_shutdown,</span>
<span class="gi">+            lifespan=lifespan,</span>
<span class="gi">+        )</span>
<span class="w"> </span>        if prefix:
<span class="gd">-            assert prefix.startswith(&#39;/&#39;), &quot;A path prefix must start with &#39;/&#39;&quot;</span>
<span class="gd">-            assert not prefix.endswith(&#39;/&#39;</span>
<span class="gd">-                ), &quot;A path prefix must not end with &#39;/&#39;, as the routes will start with &#39;/&#39;&quot;</span>
<span class="gi">+            assert prefix.startswith(&quot;/&quot;), &quot;A path prefix must start with &#39;/&#39;&quot;</span>
<span class="gi">+            assert not prefix.endswith(</span>
<span class="gi">+                &quot;/&quot;</span>
<span class="gi">+            ), &quot;A path prefix must not end with &#39;/&#39;, as the routes will start with &#39;/&#39;&quot;</span>
<span class="w"> </span>        self.prefix = prefix
<span class="w"> </span>        self.tags: List[Union[str, Enum]] = tags or []
<span class="w"> </span>        self.dependencies = list(dependencies or [])
<span class="gu">@@ -356,24 +809,222 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>        self.default_response_class = default_response_class
<span class="w"> </span>        self.generate_unique_id_function = generate_unique_id_function

<span class="gd">-    def websocket(self, path: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def route(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: str,</span>
<span class="gi">+        methods: Optional[List[str]] = None,</span>
<span class="gi">+        name: Optional[str] = None,</span>
<span class="gi">+        include_in_schema: bool = True,</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="gi">+        def decorator(func: DecoratedCallable) -&gt; DecoratedCallable:</span>
<span class="gi">+            self.add_route(</span>
<span class="gi">+                path,</span>
<span class="gi">+                func,</span>
<span class="gi">+                methods=methods,</span>
<span class="gi">+                name=name,</span>
<span class="gi">+                include_in_schema=include_in_schema,</span>
<span class="gi">+            )</span>
<span class="gi">+            return func</span>
<span class="gi">+</span>
<span class="gi">+        return decorator</span>
<span class="gi">+</span>
<span class="gi">+    def add_api_route(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: str,</span>
<span class="gi">+        endpoint: Callable[..., Any],</span>
<span class="gi">+        *,</span>
<span class="gi">+        response_model: Any = Default(None),</span>
<span class="gi">+        status_code: Optional[int] = None,</span>
<span class="gi">+        tags: Optional[List[Union[str, Enum]]] = None,</span>
<span class="gi">+        dependencies: Optional[Sequence[params.Depends]] = None,</span>
<span class="gi">+        summary: Optional[str] = None,</span>
<span class="gi">+        description: Optional[str] = None,</span>
<span class="gi">+        response_description: str = &quot;Successful Response&quot;,</span>
<span class="gi">+        responses: Optional[Dict[Union[int, str], Dict[str, Any]]] = None,</span>
<span class="gi">+        deprecated: Optional[bool] = None,</span>
<span class="gi">+        methods: Optional[Union[Set[str], List[str]]] = None,</span>
<span class="gi">+        operation_id: Optional[str] = None,</span>
<span class="gi">+        response_model_include: Optional[IncEx] = None,</span>
<span class="gi">+        response_model_exclude: Optional[IncEx] = None,</span>
<span class="gi">+        response_model_by_alias: bool = True,</span>
<span class="gi">+        response_model_exclude_unset: bool = False,</span>
<span class="gi">+        response_model_exclude_defaults: bool = False,</span>
<span class="gi">+        response_model_exclude_none: bool = False,</span>
<span class="gi">+        include_in_schema: bool = True,</span>
<span class="gi">+        response_class: Union[Type[Response], DefaultPlaceholder] = Default(</span>
<span class="gi">+            JSONResponse</span>
<span class="gi">+        ),</span>
<span class="gi">+        name: Optional[str] = None,</span>
<span class="gi">+        route_class_override: Optional[Type[APIRoute]] = None,</span>
<span class="gi">+        callbacks: Optional[List[BaseRoute]] = None,</span>
<span class="gi">+        openapi_extra: Optional[Dict[str, Any]] = None,</span>
<span class="gi">+        generate_unique_id_function: Union[</span>
<span class="gi">+            Callable[[APIRoute], str], DefaultPlaceholder</span>
<span class="gi">+        ] = Default(generate_unique_id),</span>
<span class="gi">+    ) -&gt; None:</span>
<span class="gi">+        route_class = route_class_override or self.route_class</span>
<span class="gi">+        responses = responses or {}</span>
<span class="gi">+        combined_responses = {**self.responses, **responses}</span>
<span class="gi">+        current_response_class = get_value_or_default(</span>
<span class="gi">+            response_class, self.default_response_class</span>
<span class="gi">+        )</span>
<span class="gi">+        current_tags = self.tags.copy()</span>
<span class="gi">+        if tags:</span>
<span class="gi">+            current_tags.extend(tags)</span>
<span class="gi">+        current_dependencies = self.dependencies.copy()</span>
<span class="gi">+        if dependencies:</span>
<span class="gi">+            current_dependencies.extend(dependencies)</span>
<span class="gi">+        current_callbacks = self.callbacks.copy()</span>
<span class="gi">+        if callbacks:</span>
<span class="gi">+            current_callbacks.extend(callbacks)</span>
<span class="gi">+        current_generate_unique_id = get_value_or_default(</span>
<span class="gi">+            generate_unique_id_function, self.generate_unique_id_function</span>
<span class="gi">+        )</span>
<span class="gi">+        route = route_class(</span>
<span class="gi">+            self.prefix + path,</span>
<span class="gi">+            endpoint=endpoint,</span>
<span class="gi">+            response_model=response_model,</span>
<span class="gi">+            status_code=status_code,</span>
<span class="gi">+            tags=current_tags,</span>
<span class="gi">+            dependencies=current_dependencies,</span>
<span class="gi">+            summary=summary,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            response_description=response_description,</span>
<span class="gi">+            responses=combined_responses,</span>
<span class="gi">+            deprecated=deprecated or self.deprecated,</span>
<span class="gi">+            methods=methods,</span>
<span class="gi">+            operation_id=operation_id,</span>
<span class="gi">+            response_model_include=response_model_include,</span>
<span class="gi">+            response_model_exclude=response_model_exclude,</span>
<span class="gi">+            response_model_by_alias=response_model_by_alias,</span>
<span class="gi">+            response_model_exclude_unset=response_model_exclude_unset,</span>
<span class="gi">+            response_model_exclude_defaults=response_model_exclude_defaults,</span>
<span class="gi">+            response_model_exclude_none=response_model_exclude_none,</span>
<span class="gi">+            include_in_schema=include_in_schema and self.include_in_schema,</span>
<span class="gi">+            response_class=current_response_class,</span>
<span class="gi">+            name=name,</span>
<span class="gi">+            dependency_overrides_provider=self.dependency_overrides_provider,</span>
<span class="gi">+            callbacks=current_callbacks,</span>
<span class="gi">+            openapi_extra=openapi_extra,</span>
<span class="gi">+            generate_unique_id_function=current_generate_unique_id,</span>
<span class="gi">+        )</span>
<span class="gi">+        self.routes.append(route)</span>
<span class="gi">+</span>
<span class="gi">+    def api_route(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: str,</span>
<span class="gi">+        *,</span>
<span class="gi">+        response_model: Any = Default(None),</span>
<span class="gi">+        status_code: Optional[int] = None,</span>
<span class="gi">+        tags: Optional[List[Union[str, Enum]]] = None,</span>
<span class="gi">+        dependencies: Optional[Sequence[params.Depends]] = None,</span>
<span class="gi">+        summary: Optional[str] = None,</span>
<span class="gi">+        description: Optional[str] = None,</span>
<span class="gi">+        response_description: str = &quot;Successful Response&quot;,</span>
<span class="gi">+        responses: Optional[Dict[Union[int, str], Dict[str, Any]]] = None,</span>
<span class="gi">+        deprecated: Optional[bool] = None,</span>
<span class="gi">+        methods: Optional[List[str]] = None,</span>
<span class="gi">+        operation_id: Optional[str] = None,</span>
<span class="gi">+        response_model_include: Optional[IncEx] = None,</span>
<span class="gi">+        response_model_exclude: Optional[IncEx] = None,</span>
<span class="gi">+        response_model_by_alias: bool = True,</span>
<span class="gi">+        response_model_exclude_unset: bool = False,</span>
<span class="gi">+        response_model_exclude_defaults: bool = False,</span>
<span class="gi">+        response_model_exclude_none: bool = False,</span>
<span class="gi">+        include_in_schema: bool = True,</span>
<span class="gi">+        response_class: Type[Response] = Default(JSONResponse),</span>
<span class="gi">+        name: Optional[str] = None,</span>
<span class="gi">+        callbacks: Optional[List[BaseRoute]] = None,</span>
<span class="gi">+        openapi_extra: Optional[Dict[str, Any]] = None,</span>
<span class="gi">+        generate_unique_id_function: Callable[[APIRoute], str] = Default(</span>
<span class="gi">+            generate_unique_id</span>
<span class="gi">+        ),</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="gi">+        def decorator(func: DecoratedCallable) -&gt; DecoratedCallable:</span>
<span class="gi">+            self.add_api_route(</span>
<span class="gi">+                path,</span>
<span class="gi">+                func,</span>
<span class="gi">+                response_model=response_model,</span>
<span class="gi">+                status_code=status_code,</span>
<span class="gi">+                tags=tags,</span>
<span class="gi">+                dependencies=dependencies,</span>
<span class="gi">+                summary=summary,</span>
<span class="gi">+                description=description,</span>
<span class="gi">+                response_description=response_description,</span>
<span class="gi">+                responses=responses,</span>
<span class="gi">+                deprecated=deprecated,</span>
<span class="gi">+                methods=methods,</span>
<span class="gi">+                operation_id=operation_id,</span>
<span class="gi">+                response_model_include=response_model_include,</span>
<span class="gi">+                response_model_exclude=response_model_exclude,</span>
<span class="gi">+                response_model_by_alias=response_model_by_alias,</span>
<span class="gi">+                response_model_exclude_unset=response_model_exclude_unset,</span>
<span class="gi">+                response_model_exclude_defaults=response_model_exclude_defaults,</span>
<span class="gi">+                response_model_exclude_none=response_model_exclude_none,</span>
<span class="gi">+                include_in_schema=include_in_schema,</span>
<span class="gi">+                response_class=response_class,</span>
<span class="gi">+                name=name,</span>
<span class="gi">+                callbacks=callbacks,</span>
<span class="gi">+                openapi_extra=openapi_extra,</span>
<span class="gi">+                generate_unique_id_function=generate_unique_id_function,</span>
<span class="gi">+            )</span>
<span class="gi">+            return func</span>
<span class="gi">+</span>
<span class="gi">+        return decorator</span>
<span class="gi">+</span>
<span class="gi">+    def add_api_websocket_route(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: str,</span>
<span class="gi">+        endpoint: Callable[..., Any],</span>
<span class="gi">+        name: Optional[str] = None,</span>
<span class="gi">+        *,</span>
<span class="gi">+        dependencies: Optional[Sequence[params.Depends]] = None,</span>
<span class="gi">+    ) -&gt; None:</span>
<span class="gi">+        current_dependencies = self.dependencies.copy()</span>
<span class="gi">+        if dependencies:</span>
<span class="gi">+            current_dependencies.extend(dependencies)</span>
<span class="gi">+</span>
<span class="gi">+        route = APIWebSocketRoute(</span>
<span class="gi">+            self.prefix + path,</span>
<span class="gi">+            endpoint=endpoint,</span>
<span class="gi">+            name=name,</span>
<span class="gi">+            dependencies=current_dependencies,</span>
<span class="gi">+            dependency_overrides_provider=self.dependency_overrides_provider,</span>
<span class="gi">+        )</span>
<span class="gi">+        self.routes.append(route)</span>
<span class="gi">+</span>
<span class="gi">+    def websocket(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                WebSocket path.
<span class="gd">-                &quot;&quot;&quot;)], name:</span>
<span class="gd">-        Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A name for the WebSocket. Only used internally.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, *, dependencies: Annotated[Optional[Sequence[params.</span>
<span class="gd">-        Depends]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        *,</span>
<span class="gi">+        dependencies: Annotated[</span>
<span class="gi">+            Optional[Sequence[params.Depends]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of dependencies (using `Depends()`) to be used for this
<span class="w"> </span>                WebSocket.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for WebSockets](https://fastapi.tiangolo.com/advanced/websockets/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None) -&gt;Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Decorate a WebSocket function.

<span class="gu">@@ -400,13 +1051,33 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>        app.include_router(router)
<span class="w"> </span>        ```
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>

<span class="gd">-    def include_router(self, router: Annotated[&#39;APIRouter&#39;, Doc(</span>
<span class="gd">-        &#39;The `APIRouter` to include.&#39;)], *, prefix: Annotated[str, Doc(</span>
<span class="gd">-        &#39;An optional path prefix for the router.&#39;)]=&#39;&#39;, tags: Annotated[</span>
<span class="gd">-        Optional[List[Union[str, Enum]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+        def decorator(func: DecoratedCallable) -&gt; DecoratedCallable:</span>
<span class="gi">+            self.add_api_websocket_route(</span>
<span class="gi">+                path, func, name=name, dependencies=dependencies</span>
<span class="gi">+            )</span>
<span class="gi">+            return func</span>
<span class="gi">+</span>
<span class="gi">+        return decorator</span>
<span class="gi">+</span>
<span class="gi">+    def websocket_route(</span>
<span class="gi">+        self, path: str, name: Union[str, None] = None</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="gi">+        def decorator(func: DecoratedCallable) -&gt; DecoratedCallable:</span>
<span class="gi">+            self.add_websocket_route(path, func, name=name)</span>
<span class="gi">+            return func</span>
<span class="gi">+</span>
<span class="gi">+        return decorator</span>
<span class="gi">+</span>
<span class="gi">+    def include_router(</span>
<span class="gi">+        self,</span>
<span class="gi">+        router: Annotated[&quot;APIRouter&quot;, Doc(&quot;The `APIRouter` to include.&quot;)],</span>
<span class="gi">+        *,</span>
<span class="gi">+        prefix: Annotated[str, Doc(&quot;An optional path prefix for the router.&quot;)] = &quot;&quot;,</span>
<span class="gi">+        tags: Annotated[</span>
<span class="gi">+            Optional[List[Union[str, Enum]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of tags to be applied to all the *path operations* in this
<span class="w"> </span>                router.

<span class="gu">@@ -415,25 +1086,35 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, dependencies: Annotated[Optional[Sequence[params.Depends]],</span>
<span class="gd">-        Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        dependencies: Annotated[</span>
<span class="gi">+            Optional[Sequence[params.Depends]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of dependencies (using `Depends()`) to be applied to all the
<span class="w"> </span>                *path operations* in this router.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Bigger Applications - Multiple Files](https://fastapi.tiangolo.com/tutorial/bigger-applications/#include-an-apirouter-with-a-custom-prefix-tags-responses-and-dependencies).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, default_response_class: Annotated[Type[Response], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        default_response_class: Annotated[</span>
<span class="gi">+            Type[Response],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The default response class to be used.

<span class="w"> </span>                Read more in the
<span class="w"> </span>                [FastAPI docs for Custom Response - HTML, Stream, File, others](https://fastapi.tiangolo.com/advanced/custom-response/#default-response-class).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(JSONResponse), responses: Annotated[Optional[Dict[Union[</span>
<span class="gd">-        int, str], Dict[str, Any]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(JSONResponse),</span>
<span class="gi">+        responses: Annotated[</span>
<span class="gi">+            Optional[Dict[Union[int, str], Dict[str, Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Additional responses to be shown in OpenAPI.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -444,8 +1125,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                And in the
<span class="w"> </span>                [FastAPI docs for Bigger Applications](https://fastapi.tiangolo.com/tutorial/bigger-applications/#include-an-apirouter-with-a-custom-prefix-tags-responses-and-dependencies).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, callbacks: Annotated[Optional[List[BaseRoute]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        callbacks: Annotated[</span>
<span class="gi">+            Optional[List[BaseRoute]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                OpenAPI callbacks that should apply to all *path operations* in this
<span class="w"> </span>                router.

<span class="gu">@@ -454,8 +1139,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for OpenAPI Callbacks](https://fastapi.tiangolo.com/advanced/openapi-callbacks/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, deprecated: Annotated[Optional[bool], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        deprecated: Annotated[</span>
<span class="gi">+            Optional[bool],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Mark all *path operations* in this router as deprecated.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -463,16 +1152,23 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, include_in_schema: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        include_in_schema: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Include (or not) all the *path operations* in this router in the
<span class="w"> </span>                generated OpenAPI schema.

<span class="w"> </span>                This affects the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, generate_unique_id_function: Annotated[Callable[[APIRoute],</span>
<span class="gd">-        str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        generate_unique_id_function: Annotated[</span>
<span class="gi">+            Callable[[APIRoute], str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Customize the function used to generate unique IDs for the *path
<span class="w"> </span>                operations* shown in the generated OpenAPI.

<span class="gu">@@ -482,7 +1178,9 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(generate_unique_id)) -&gt;None:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(generate_unique_id),</span>
<span class="gi">+    ) -&gt; None:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Include another `APIRouter` in the same current `APIRouter`.

<span class="gu">@@ -506,16 +1204,128 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>        app.include_router(internal_router)
<span class="w"> </span>        ```
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gd">-</span>
<span class="gd">-    def get(self, path: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+        if prefix:</span>
<span class="gi">+            assert prefix.startswith(&quot;/&quot;), &quot;A path prefix must start with &#39;/&#39;&quot;</span>
<span class="gi">+            assert not prefix.endswith(</span>
<span class="gi">+                &quot;/&quot;</span>
<span class="gi">+            ), &quot;A path prefix must not end with &#39;/&#39;, as the routes will start with &#39;/&#39;&quot;</span>
<span class="gi">+        else:</span>
<span class="gi">+            for r in router.routes:</span>
<span class="gi">+                path = getattr(r, &quot;path&quot;)  # noqa: B009</span>
<span class="gi">+                name = getattr(r, &quot;name&quot;, &quot;unknown&quot;)</span>
<span class="gi">+                if path is not None and not path:</span>
<span class="gi">+                    raise FastAPIError(</span>
<span class="gi">+                        f&quot;Prefix and path cannot be both empty (path operation: {name})&quot;</span>
<span class="gi">+                    )</span>
<span class="gi">+        if responses is None:</span>
<span class="gi">+            responses = {}</span>
<span class="gi">+        for route in router.routes:</span>
<span class="gi">+            if isinstance(route, APIRoute):</span>
<span class="gi">+                combined_responses = {**responses, **route.responses}</span>
<span class="gi">+                use_response_class = get_value_or_default(</span>
<span class="gi">+                    route.response_class,</span>
<span class="gi">+                    router.default_response_class,</span>
<span class="gi">+                    default_response_class,</span>
<span class="gi">+                    self.default_response_class,</span>
<span class="gi">+                )</span>
<span class="gi">+                current_tags = []</span>
<span class="gi">+                if tags:</span>
<span class="gi">+                    current_tags.extend(tags)</span>
<span class="gi">+                if route.tags:</span>
<span class="gi">+                    current_tags.extend(route.tags)</span>
<span class="gi">+                current_dependencies: List[params.Depends] = []</span>
<span class="gi">+                if dependencies:</span>
<span class="gi">+                    current_dependencies.extend(dependencies)</span>
<span class="gi">+                if route.dependencies:</span>
<span class="gi">+                    current_dependencies.extend(route.dependencies)</span>
<span class="gi">+                current_callbacks = []</span>
<span class="gi">+                if callbacks:</span>
<span class="gi">+                    current_callbacks.extend(callbacks)</span>
<span class="gi">+                if route.callbacks:</span>
<span class="gi">+                    current_callbacks.extend(route.callbacks)</span>
<span class="gi">+                current_generate_unique_id = get_value_or_default(</span>
<span class="gi">+                    route.generate_unique_id_function,</span>
<span class="gi">+                    router.generate_unique_id_function,</span>
<span class="gi">+                    generate_unique_id_function,</span>
<span class="gi">+                    self.generate_unique_id_function,</span>
<span class="gi">+                )</span>
<span class="gi">+                self.add_api_route(</span>
<span class="gi">+                    prefix + route.path,</span>
<span class="gi">+                    route.endpoint,</span>
<span class="gi">+                    response_model=route.response_model,</span>
<span class="gi">+                    status_code=route.status_code,</span>
<span class="gi">+                    tags=current_tags,</span>
<span class="gi">+                    dependencies=current_dependencies,</span>
<span class="gi">+                    summary=route.summary,</span>
<span class="gi">+                    description=route.description,</span>
<span class="gi">+                    response_description=route.response_description,</span>
<span class="gi">+                    responses=combined_responses,</span>
<span class="gi">+                    deprecated=route.deprecated or deprecated or self.deprecated,</span>
<span class="gi">+                    methods=route.methods,</span>
<span class="gi">+                    operation_id=route.operation_id,</span>
<span class="gi">+                    response_model_include=route.response_model_include,</span>
<span class="gi">+                    response_model_exclude=route.response_model_exclude,</span>
<span class="gi">+                    response_model_by_alias=route.response_model_by_alias,</span>
<span class="gi">+                    response_model_exclude_unset=route.response_model_exclude_unset,</span>
<span class="gi">+                    response_model_exclude_defaults=route.response_model_exclude_defaults,</span>
<span class="gi">+                    response_model_exclude_none=route.response_model_exclude_none,</span>
<span class="gi">+                    include_in_schema=route.include_in_schema</span>
<span class="gi">+                    and self.include_in_schema</span>
<span class="gi">+                    and include_in_schema,</span>
<span class="gi">+                    response_class=use_response_class,</span>
<span class="gi">+                    name=route.name,</span>
<span class="gi">+                    route_class_override=type(route),</span>
<span class="gi">+                    callbacks=current_callbacks,</span>
<span class="gi">+                    openapi_extra=route.openapi_extra,</span>
<span class="gi">+                    generate_unique_id_function=current_generate_unique_id,</span>
<span class="gi">+                )</span>
<span class="gi">+            elif isinstance(route, routing.Route):</span>
<span class="gi">+                methods = list(route.methods or [])</span>
<span class="gi">+                self.add_route(</span>
<span class="gi">+                    prefix + route.path,</span>
<span class="gi">+                    route.endpoint,</span>
<span class="gi">+                    methods=methods,</span>
<span class="gi">+                    include_in_schema=route.include_in_schema,</span>
<span class="gi">+                    name=route.name,</span>
<span class="gi">+                )</span>
<span class="gi">+            elif isinstance(route, APIWebSocketRoute):</span>
<span class="gi">+                current_dependencies = []</span>
<span class="gi">+                if dependencies:</span>
<span class="gi">+                    current_dependencies.extend(dependencies)</span>
<span class="gi">+                if route.dependencies:</span>
<span class="gi">+                    current_dependencies.extend(route.dependencies)</span>
<span class="gi">+                self.add_api_websocket_route(</span>
<span class="gi">+                    prefix + route.path,</span>
<span class="gi">+                    route.endpoint,</span>
<span class="gi">+                    dependencies=current_dependencies,</span>
<span class="gi">+                    name=route.name,</span>
<span class="gi">+                )</span>
<span class="gi">+            elif isinstance(route, routing.WebSocketRoute):</span>
<span class="gi">+                self.add_websocket_route(</span>
<span class="gi">+                    prefix + route.path, route.endpoint, name=route.name</span>
<span class="gi">+                )</span>
<span class="gi">+        for handler in router.on_startup:</span>
<span class="gi">+            self.add_event_handler(&quot;startup&quot;, handler)</span>
<span class="gi">+        for handler in router.on_shutdown:</span>
<span class="gi">+            self.add_event_handler(&quot;shutdown&quot;, handler)</span>
<span class="gi">+</span>
<span class="gi">+    def get(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The URL path to be used for this *path operation*.

<span class="w"> </span>                For example, in `http://example.com/items`, the path is `/items`.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], *, response_model: Annotated[Any, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        *,</span>
<span class="gi">+        response_model: Annotated[</span>
<span class="gi">+            Any,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The type to use for the response.

<span class="w"> </span>                It could be any valid Pydantic *field* type. So, it doesn&#39;t have to
<span class="gu">@@ -544,8 +1354,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model](https://fastapi.tiangolo.com/tutorial/response-model/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(None), status_code: Annotated[Optional[int], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(None),</span>
<span class="gi">+        status_code: Annotated[</span>
<span class="gi">+            Optional[int],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The default status code to be used for the response.

<span class="w"> </span>                You could override the status code by returning a response directly.
<span class="gu">@@ -553,8 +1367,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Status Code](https://fastapi.tiangolo.com/tutorial/response-status-code/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, tags: Annotated[Optional[List[Union[str, Enum]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        tags: Annotated[</span>
<span class="gi">+            Optional[List[Union[str, Enum]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of tags to be applied to the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -562,17 +1380,24 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/#tags).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, dependencies: Annotated[Optional[Sequence[params.Depends]],</span>
<span class="gd">-        Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        dependencies: Annotated[</span>
<span class="gi">+            Optional[Sequence[params.Depends]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of dependencies (using `Depends()`) to be applied to the
<span class="w"> </span>                *path operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Dependencies in path operation decorators](https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-in-path-operation-decorators/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, summary: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        summary: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A summary for the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -580,8 +1405,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A description for the *path operation*.

<span class="w"> </span>                If not provided, it will be extracted automatically from the docstring
<span class="gu">@@ -594,27 +1423,42 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_description: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_description: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The description for the default response.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;Successful Response&#39;, responses: Annotated[Optional[Dict[Union[</span>
<span class="gd">-        int, str], Dict[str, Any]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;Successful Response&quot;,</span>
<span class="gi">+        responses: Annotated[</span>
<span class="gi">+            Optional[Dict[Union[int, str], Dict[str, Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Additional responses that could be returned by this *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, deprecated: Annotated[Optional[bool], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        deprecated: Annotated[</span>
<span class="gi">+            Optional[bool],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Mark this *path operation* as deprecated.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, operation_id: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        operation_id: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Custom operation ID to be used by this *path operation*.

<span class="w"> </span>                By default, it is generated automatically.
<span class="gu">@@ -629,32 +1473,48 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_include: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_include: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to include only certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_exclude: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_exclude: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to exclude certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_by_alias: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_by_alias: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response model
<span class="w"> </span>                should be serialized by alias when an alias is used.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_model_exclude_unset: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_model_exclude_unset: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that were not set and
<span class="w"> </span>                have their default values. This is different from
<span class="gu">@@ -667,8 +1527,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_defaults: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_defaults: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that have the same value
<span class="w"> </span>                as the default. This is different from `response_model_exclude_unset`
<span class="gu">@@ -680,8 +1544,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_none: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_none: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data should
<span class="w"> </span>                exclude fields set to `None`.

<span class="gu">@@ -693,8 +1561,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_exclude_none).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, include_in_schema: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        include_in_schema: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Include this *path operation* in the generated OpenAPI schema.

<span class="w"> </span>                This affects the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -702,8 +1574,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Query Parameters and String Validations](https://fastapi.tiangolo.com/tutorial/query-params-str-validations/#exclude-from-openapi).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_class: Annotated[Type[Response], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_class: Annotated[</span>
<span class="gi">+            Type[Response],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Response class to be used for this *path operation*.

<span class="w"> </span>                This will not be used if you return a response directly.
<span class="gu">@@ -711,12 +1587,20 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Custom Response - HTML, Stream, File, others](https://fastapi.tiangolo.com/advanced/custom-response/#redirectresponse).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(JSONResponse), name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(JSONResponse),</span>
<span class="gi">+        name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Name for this *path operation*. Only used internally.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, callbacks: Annotated[Optional[List[BaseRoute]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        callbacks: Annotated[</span>
<span class="gi">+            Optional[List[BaseRoute]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                List of *path operations* that will be used as OpenAPI callbacks.

<span class="w"> </span>                This is only for OpenAPI documentation, the callbacks won&#39;t be used
<span class="gu">@@ -727,17 +1611,24 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for OpenAPI Callbacks](https://fastapi.tiangolo.com/advanced/openapi-callbacks/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, openapi_extra: Annotated[Optional[Dict[str, Any]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        openapi_extra: Annotated[</span>
<span class="gi">+            Optional[Dict[str, Any]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Extra metadata to be included in the OpenAPI schema for this *path
<span class="w"> </span>                operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Advanced Configuration](https://fastapi.tiangolo.com/advanced/path-operation-advanced-configuration/#custom-openapi-path-operation-schema).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, generate_unique_id_function: Annotated[Callable[[APIRoute],</span>
<span class="gd">-        str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        generate_unique_id_function: Annotated[</span>
<span class="gi">+            Callable[[APIRoute], str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Customize the function used to generate unique IDs for the *path
<span class="w"> </span>                operations* shown in the generated OpenAPI.

<span class="gu">@@ -747,8 +1638,9 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(generate_unique_id)) -&gt;Callable[[DecoratedCallable],</span>
<span class="gd">-        DecoratedCallable]:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(generate_unique_id),</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Add a *path operation* using an HTTP GET operation.

<span class="gu">@@ -767,16 +1659,50 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>        app.include_router(router)
<span class="w"> </span>        ```
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self.api_route(</span>
<span class="gi">+            path=path,</span>
<span class="gi">+            response_model=response_model,</span>
<span class="gi">+            status_code=status_code,</span>
<span class="gi">+            tags=tags,</span>
<span class="gi">+            dependencies=dependencies,</span>
<span class="gi">+            summary=summary,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            response_description=response_description,</span>
<span class="gi">+            responses=responses,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            methods=[&quot;GET&quot;],</span>
<span class="gi">+            operation_id=operation_id,</span>
<span class="gi">+            response_model_include=response_model_include,</span>
<span class="gi">+            response_model_exclude=response_model_exclude,</span>
<span class="gi">+            response_model_by_alias=response_model_by_alias,</span>
<span class="gi">+            response_model_exclude_unset=response_model_exclude_unset,</span>
<span class="gi">+            response_model_exclude_defaults=response_model_exclude_defaults,</span>
<span class="gi">+            response_model_exclude_none=response_model_exclude_none,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            response_class=response_class,</span>
<span class="gi">+            name=name,</span>
<span class="gi">+            callbacks=callbacks,</span>
<span class="gi">+            openapi_extra=openapi_extra,</span>
<span class="gi">+            generate_unique_id_function=generate_unique_id_function,</span>
<span class="gi">+        )</span>

<span class="gd">-    def put(self, path: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def put(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The URL path to be used for this *path operation*.

<span class="w"> </span>                For example, in `http://example.com/items`, the path is `/items`.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], *, response_model: Annotated[Any, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        *,</span>
<span class="gi">+        response_model: Annotated[</span>
<span class="gi">+            Any,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The type to use for the response.

<span class="w"> </span>                It could be any valid Pydantic *field* type. So, it doesn&#39;t have to
<span class="gu">@@ -805,8 +1731,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model](https://fastapi.tiangolo.com/tutorial/response-model/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(None), status_code: Annotated[Optional[int], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(None),</span>
<span class="gi">+        status_code: Annotated[</span>
<span class="gi">+            Optional[int],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The default status code to be used for the response.

<span class="w"> </span>                You could override the status code by returning a response directly.
<span class="gu">@@ -814,8 +1744,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Status Code](https://fastapi.tiangolo.com/tutorial/response-status-code/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, tags: Annotated[Optional[List[Union[str, Enum]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        tags: Annotated[</span>
<span class="gi">+            Optional[List[Union[str, Enum]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of tags to be applied to the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -823,17 +1757,24 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/#tags).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, dependencies: Annotated[Optional[Sequence[params.Depends]],</span>
<span class="gd">-        Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        dependencies: Annotated[</span>
<span class="gi">+            Optional[Sequence[params.Depends]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of dependencies (using `Depends()`) to be applied to the
<span class="w"> </span>                *path operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Dependencies in path operation decorators](https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-in-path-operation-decorators/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, summary: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        summary: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A summary for the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -841,8 +1782,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A description for the *path operation*.

<span class="w"> </span>                If not provided, it will be extracted automatically from the docstring
<span class="gu">@@ -855,27 +1800,42 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_description: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_description: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The description for the default response.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;Successful Response&#39;, responses: Annotated[Optional[Dict[Union[</span>
<span class="gd">-        int, str], Dict[str, Any]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;Successful Response&quot;,</span>
<span class="gi">+        responses: Annotated[</span>
<span class="gi">+            Optional[Dict[Union[int, str], Dict[str, Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Additional responses that could be returned by this *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, deprecated: Annotated[Optional[bool], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        deprecated: Annotated[</span>
<span class="gi">+            Optional[bool],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Mark this *path operation* as deprecated.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, operation_id: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        operation_id: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Custom operation ID to be used by this *path operation*.

<span class="w"> </span>                By default, it is generated automatically.
<span class="gu">@@ -890,32 +1850,48 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_include: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_include: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to include only certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_exclude: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_exclude: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to exclude certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_by_alias: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_by_alias: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response model
<span class="w"> </span>                should be serialized by alias when an alias is used.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_model_exclude_unset: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_model_exclude_unset: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that were not set and
<span class="w"> </span>                have their default values. This is different from
<span class="gu">@@ -928,8 +1904,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_defaults: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_defaults: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that have the same value
<span class="w"> </span>                as the default. This is different from `response_model_exclude_unset`
<span class="gu">@@ -941,8 +1921,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_none: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_none: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data should
<span class="w"> </span>                exclude fields set to `None`.

<span class="gu">@@ -954,8 +1938,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_exclude_none).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, include_in_schema: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        include_in_schema: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Include this *path operation* in the generated OpenAPI schema.

<span class="w"> </span>                This affects the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -963,8 +1951,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Query Parameters and String Validations](https://fastapi.tiangolo.com/tutorial/query-params-str-validations/#exclude-from-openapi).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_class: Annotated[Type[Response], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_class: Annotated[</span>
<span class="gi">+            Type[Response],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Response class to be used for this *path operation*.

<span class="w"> </span>                This will not be used if you return a response directly.
<span class="gu">@@ -972,12 +1964,20 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Custom Response - HTML, Stream, File, others](https://fastapi.tiangolo.com/advanced/custom-response/#redirectresponse).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(JSONResponse), name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(JSONResponse),</span>
<span class="gi">+        name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Name for this *path operation*. Only used internally.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, callbacks: Annotated[Optional[List[BaseRoute]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        callbacks: Annotated[</span>
<span class="gi">+            Optional[List[BaseRoute]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                List of *path operations* that will be used as OpenAPI callbacks.

<span class="w"> </span>                This is only for OpenAPI documentation, the callbacks won&#39;t be used
<span class="gu">@@ -988,17 +1988,24 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for OpenAPI Callbacks](https://fastapi.tiangolo.com/advanced/openapi-callbacks/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, openapi_extra: Annotated[Optional[Dict[str, Any]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        openapi_extra: Annotated[</span>
<span class="gi">+            Optional[Dict[str, Any]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Extra metadata to be included in the OpenAPI schema for this *path
<span class="w"> </span>                operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Advanced Configuration](https://fastapi.tiangolo.com/advanced/path-operation-advanced-configuration/#custom-openapi-path-operation-schema).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, generate_unique_id_function: Annotated[Callable[[APIRoute],</span>
<span class="gd">-        str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        generate_unique_id_function: Annotated[</span>
<span class="gi">+            Callable[[APIRoute], str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Customize the function used to generate unique IDs for the *path
<span class="w"> </span>                operations* shown in the generated OpenAPI.

<span class="gu">@@ -1008,8 +2015,9 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(generate_unique_id)) -&gt;Callable[[DecoratedCallable],</span>
<span class="gd">-        DecoratedCallable]:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(generate_unique_id),</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Add a *path operation* using an HTTP PUT operation.

<span class="gu">@@ -1033,16 +2041,50 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>        app.include_router(router)
<span class="w"> </span>        ```
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self.api_route(</span>
<span class="gi">+            path=path,</span>
<span class="gi">+            response_model=response_model,</span>
<span class="gi">+            status_code=status_code,</span>
<span class="gi">+            tags=tags,</span>
<span class="gi">+            dependencies=dependencies,</span>
<span class="gi">+            summary=summary,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            response_description=response_description,</span>
<span class="gi">+            responses=responses,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            methods=[&quot;PUT&quot;],</span>
<span class="gi">+            operation_id=operation_id,</span>
<span class="gi">+            response_model_include=response_model_include,</span>
<span class="gi">+            response_model_exclude=response_model_exclude,</span>
<span class="gi">+            response_model_by_alias=response_model_by_alias,</span>
<span class="gi">+            response_model_exclude_unset=response_model_exclude_unset,</span>
<span class="gi">+            response_model_exclude_defaults=response_model_exclude_defaults,</span>
<span class="gi">+            response_model_exclude_none=response_model_exclude_none,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            response_class=response_class,</span>
<span class="gi">+            name=name,</span>
<span class="gi">+            callbacks=callbacks,</span>
<span class="gi">+            openapi_extra=openapi_extra,</span>
<span class="gi">+            generate_unique_id_function=generate_unique_id_function,</span>
<span class="gi">+        )</span>

<span class="gd">-    def post(self, path: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def post(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The URL path to be used for this *path operation*.

<span class="w"> </span>                For example, in `http://example.com/items`, the path is `/items`.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], *, response_model: Annotated[Any, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        *,</span>
<span class="gi">+        response_model: Annotated[</span>
<span class="gi">+            Any,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The type to use for the response.

<span class="w"> </span>                It could be any valid Pydantic *field* type. So, it doesn&#39;t have to
<span class="gu">@@ -1071,8 +2113,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model](https://fastapi.tiangolo.com/tutorial/response-model/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(None), status_code: Annotated[Optional[int], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(None),</span>
<span class="gi">+        status_code: Annotated[</span>
<span class="gi">+            Optional[int],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The default status code to be used for the response.

<span class="w"> </span>                You could override the status code by returning a response directly.
<span class="gu">@@ -1080,8 +2126,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Status Code](https://fastapi.tiangolo.com/tutorial/response-status-code/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, tags: Annotated[Optional[List[Union[str, Enum]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        tags: Annotated[</span>
<span class="gi">+            Optional[List[Union[str, Enum]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of tags to be applied to the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -1089,17 +2139,24 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/#tags).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, dependencies: Annotated[Optional[Sequence[params.Depends]],</span>
<span class="gd">-        Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        dependencies: Annotated[</span>
<span class="gi">+            Optional[Sequence[params.Depends]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of dependencies (using `Depends()`) to be applied to the
<span class="w"> </span>                *path operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Dependencies in path operation decorators](https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-in-path-operation-decorators/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, summary: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        summary: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A summary for the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -1107,8 +2164,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A description for the *path operation*.

<span class="w"> </span>                If not provided, it will be extracted automatically from the docstring
<span class="gu">@@ -1121,27 +2182,42 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_description: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_description: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The description for the default response.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;Successful Response&#39;, responses: Annotated[Optional[Dict[Union[</span>
<span class="gd">-        int, str], Dict[str, Any]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;Successful Response&quot;,</span>
<span class="gi">+        responses: Annotated[</span>
<span class="gi">+            Optional[Dict[Union[int, str], Dict[str, Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Additional responses that could be returned by this *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, deprecated: Annotated[Optional[bool], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        deprecated: Annotated[</span>
<span class="gi">+            Optional[bool],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Mark this *path operation* as deprecated.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, operation_id: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        operation_id: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Custom operation ID to be used by this *path operation*.

<span class="w"> </span>                By default, it is generated automatically.
<span class="gu">@@ -1156,32 +2232,48 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_include: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_include: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to include only certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_exclude: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_exclude: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to exclude certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_by_alias: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_by_alias: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response model
<span class="w"> </span>                should be serialized by alias when an alias is used.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_model_exclude_unset: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_model_exclude_unset: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that were not set and
<span class="w"> </span>                have their default values. This is different from
<span class="gu">@@ -1194,8 +2286,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_defaults: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_defaults: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that have the same value
<span class="w"> </span>                as the default. This is different from `response_model_exclude_unset`
<span class="gu">@@ -1207,8 +2303,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_none: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_none: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data should
<span class="w"> </span>                exclude fields set to `None`.

<span class="gu">@@ -1220,8 +2320,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_exclude_none).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, include_in_schema: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        include_in_schema: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Include this *path operation* in the generated OpenAPI schema.

<span class="w"> </span>                This affects the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -1229,8 +2333,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Query Parameters and String Validations](https://fastapi.tiangolo.com/tutorial/query-params-str-validations/#exclude-from-openapi).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_class: Annotated[Type[Response], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_class: Annotated[</span>
<span class="gi">+            Type[Response],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Response class to be used for this *path operation*.

<span class="w"> </span>                This will not be used if you return a response directly.
<span class="gu">@@ -1238,12 +2346,20 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Custom Response - HTML, Stream, File, others](https://fastapi.tiangolo.com/advanced/custom-response/#redirectresponse).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(JSONResponse), name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(JSONResponse),</span>
<span class="gi">+        name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Name for this *path operation*. Only used internally.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, callbacks: Annotated[Optional[List[BaseRoute]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        callbacks: Annotated[</span>
<span class="gi">+            Optional[List[BaseRoute]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                List of *path operations* that will be used as OpenAPI callbacks.

<span class="w"> </span>                This is only for OpenAPI documentation, the callbacks won&#39;t be used
<span class="gu">@@ -1254,17 +2370,24 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for OpenAPI Callbacks](https://fastapi.tiangolo.com/advanced/openapi-callbacks/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, openapi_extra: Annotated[Optional[Dict[str, Any]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        openapi_extra: Annotated[</span>
<span class="gi">+            Optional[Dict[str, Any]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Extra metadata to be included in the OpenAPI schema for this *path
<span class="w"> </span>                operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Advanced Configuration](https://fastapi.tiangolo.com/advanced/path-operation-advanced-configuration/#custom-openapi-path-operation-schema).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, generate_unique_id_function: Annotated[Callable[[APIRoute],</span>
<span class="gd">-        str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        generate_unique_id_function: Annotated[</span>
<span class="gi">+            Callable[[APIRoute], str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Customize the function used to generate unique IDs for the *path
<span class="w"> </span>                operations* shown in the generated OpenAPI.

<span class="gu">@@ -1274,8 +2397,9 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(generate_unique_id)) -&gt;Callable[[DecoratedCallable],</span>
<span class="gd">-        DecoratedCallable]:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(generate_unique_id),</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Add a *path operation* using an HTTP POST operation.

<span class="gu">@@ -1299,16 +2423,50 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>        app.include_router(router)
<span class="w"> </span>        ```
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self.api_route(</span>
<span class="gi">+            path=path,</span>
<span class="gi">+            response_model=response_model,</span>
<span class="gi">+            status_code=status_code,</span>
<span class="gi">+            tags=tags,</span>
<span class="gi">+            dependencies=dependencies,</span>
<span class="gi">+            summary=summary,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            response_description=response_description,</span>
<span class="gi">+            responses=responses,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            methods=[&quot;POST&quot;],</span>
<span class="gi">+            operation_id=operation_id,</span>
<span class="gi">+            response_model_include=response_model_include,</span>
<span class="gi">+            response_model_exclude=response_model_exclude,</span>
<span class="gi">+            response_model_by_alias=response_model_by_alias,</span>
<span class="gi">+            response_model_exclude_unset=response_model_exclude_unset,</span>
<span class="gi">+            response_model_exclude_defaults=response_model_exclude_defaults,</span>
<span class="gi">+            response_model_exclude_none=response_model_exclude_none,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            response_class=response_class,</span>
<span class="gi">+            name=name,</span>
<span class="gi">+            callbacks=callbacks,</span>
<span class="gi">+            openapi_extra=openapi_extra,</span>
<span class="gi">+            generate_unique_id_function=generate_unique_id_function,</span>
<span class="gi">+        )</span>

<span class="gd">-    def delete(self, path: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def delete(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The URL path to be used for this *path operation*.

<span class="w"> </span>                For example, in `http://example.com/items`, the path is `/items`.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], *, response_model: Annotated[Any, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        *,</span>
<span class="gi">+        response_model: Annotated[</span>
<span class="gi">+            Any,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The type to use for the response.

<span class="w"> </span>                It could be any valid Pydantic *field* type. So, it doesn&#39;t have to
<span class="gu">@@ -1337,8 +2495,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model](https://fastapi.tiangolo.com/tutorial/response-model/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(None), status_code: Annotated[Optional[int], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(None),</span>
<span class="gi">+        status_code: Annotated[</span>
<span class="gi">+            Optional[int],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The default status code to be used for the response.

<span class="w"> </span>                You could override the status code by returning a response directly.
<span class="gu">@@ -1346,8 +2508,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Status Code](https://fastapi.tiangolo.com/tutorial/response-status-code/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, tags: Annotated[Optional[List[Union[str, Enum]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        tags: Annotated[</span>
<span class="gi">+            Optional[List[Union[str, Enum]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of tags to be applied to the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -1355,17 +2521,24 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/#tags).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, dependencies: Annotated[Optional[Sequence[params.Depends]],</span>
<span class="gd">-        Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        dependencies: Annotated[</span>
<span class="gi">+            Optional[Sequence[params.Depends]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of dependencies (using `Depends()`) to be applied to the
<span class="w"> </span>                *path operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Dependencies in path operation decorators](https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-in-path-operation-decorators/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, summary: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        summary: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A summary for the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -1373,8 +2546,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A description for the *path operation*.

<span class="w"> </span>                If not provided, it will be extracted automatically from the docstring
<span class="gu">@@ -1387,27 +2564,42 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_description: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_description: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The description for the default response.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;Successful Response&#39;, responses: Annotated[Optional[Dict[Union[</span>
<span class="gd">-        int, str], Dict[str, Any]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;Successful Response&quot;,</span>
<span class="gi">+        responses: Annotated[</span>
<span class="gi">+            Optional[Dict[Union[int, str], Dict[str, Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Additional responses that could be returned by this *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, deprecated: Annotated[Optional[bool], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        deprecated: Annotated[</span>
<span class="gi">+            Optional[bool],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Mark this *path operation* as deprecated.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, operation_id: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        operation_id: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Custom operation ID to be used by this *path operation*.

<span class="w"> </span>                By default, it is generated automatically.
<span class="gu">@@ -1422,32 +2614,48 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_include: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_include: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to include only certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_exclude: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_exclude: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to exclude certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_by_alias: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_by_alias: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response model
<span class="w"> </span>                should be serialized by alias when an alias is used.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_model_exclude_unset: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_model_exclude_unset: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that were not set and
<span class="w"> </span>                have their default values. This is different from
<span class="gu">@@ -1460,8 +2668,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_defaults: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_defaults: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that have the same value
<span class="w"> </span>                as the default. This is different from `response_model_exclude_unset`
<span class="gu">@@ -1473,8 +2685,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_none: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_none: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data should
<span class="w"> </span>                exclude fields set to `None`.

<span class="gu">@@ -1486,8 +2702,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_exclude_none).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, include_in_schema: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        include_in_schema: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Include this *path operation* in the generated OpenAPI schema.

<span class="w"> </span>                This affects the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -1495,8 +2715,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Query Parameters and String Validations](https://fastapi.tiangolo.com/tutorial/query-params-str-validations/#exclude-from-openapi).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_class: Annotated[Type[Response], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_class: Annotated[</span>
<span class="gi">+            Type[Response],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Response class to be used for this *path operation*.

<span class="w"> </span>                This will not be used if you return a response directly.
<span class="gu">@@ -1504,12 +2728,20 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Custom Response - HTML, Stream, File, others](https://fastapi.tiangolo.com/advanced/custom-response/#redirectresponse).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(JSONResponse), name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(JSONResponse),</span>
<span class="gi">+        name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Name for this *path operation*. Only used internally.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, callbacks: Annotated[Optional[List[BaseRoute]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        callbacks: Annotated[</span>
<span class="gi">+            Optional[List[BaseRoute]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                List of *path operations* that will be used as OpenAPI callbacks.

<span class="w"> </span>                This is only for OpenAPI documentation, the callbacks won&#39;t be used
<span class="gu">@@ -1520,17 +2752,24 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for OpenAPI Callbacks](https://fastapi.tiangolo.com/advanced/openapi-callbacks/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, openapi_extra: Annotated[Optional[Dict[str, Any]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        openapi_extra: Annotated[</span>
<span class="gi">+            Optional[Dict[str, Any]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Extra metadata to be included in the OpenAPI schema for this *path
<span class="w"> </span>                operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Advanced Configuration](https://fastapi.tiangolo.com/advanced/path-operation-advanced-configuration/#custom-openapi-path-operation-schema).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, generate_unique_id_function: Annotated[Callable[[APIRoute],</span>
<span class="gd">-        str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        generate_unique_id_function: Annotated[</span>
<span class="gi">+            Callable[[APIRoute], str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Customize the function used to generate unique IDs for the *path
<span class="w"> </span>                operations* shown in the generated OpenAPI.

<span class="gu">@@ -1540,8 +2779,9 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(generate_unique_id)) -&gt;Callable[[DecoratedCallable],</span>
<span class="gd">-        DecoratedCallable]:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(generate_unique_id),</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Add a *path operation* using an HTTP DELETE operation.

<span class="gu">@@ -1560,16 +2800,50 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>        app.include_router(router)
<span class="w"> </span>        ```
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self.api_route(</span>
<span class="gi">+            path=path,</span>
<span class="gi">+            response_model=response_model,</span>
<span class="gi">+            status_code=status_code,</span>
<span class="gi">+            tags=tags,</span>
<span class="gi">+            dependencies=dependencies,</span>
<span class="gi">+            summary=summary,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            response_description=response_description,</span>
<span class="gi">+            responses=responses,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            methods=[&quot;DELETE&quot;],</span>
<span class="gi">+            operation_id=operation_id,</span>
<span class="gi">+            response_model_include=response_model_include,</span>
<span class="gi">+            response_model_exclude=response_model_exclude,</span>
<span class="gi">+            response_model_by_alias=response_model_by_alias,</span>
<span class="gi">+            response_model_exclude_unset=response_model_exclude_unset,</span>
<span class="gi">+            response_model_exclude_defaults=response_model_exclude_defaults,</span>
<span class="gi">+            response_model_exclude_none=response_model_exclude_none,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            response_class=response_class,</span>
<span class="gi">+            name=name,</span>
<span class="gi">+            callbacks=callbacks,</span>
<span class="gi">+            openapi_extra=openapi_extra,</span>
<span class="gi">+            generate_unique_id_function=generate_unique_id_function,</span>
<span class="gi">+        )</span>

<span class="gd">-    def options(self, path: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def options(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The URL path to be used for this *path operation*.

<span class="w"> </span>                For example, in `http://example.com/items`, the path is `/items`.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], *, response_model: Annotated[Any, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        *,</span>
<span class="gi">+        response_model: Annotated[</span>
<span class="gi">+            Any,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The type to use for the response.

<span class="w"> </span>                It could be any valid Pydantic *field* type. So, it doesn&#39;t have to
<span class="gu">@@ -1598,8 +2872,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model](https://fastapi.tiangolo.com/tutorial/response-model/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(None), status_code: Annotated[Optional[int], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(None),</span>
<span class="gi">+        status_code: Annotated[</span>
<span class="gi">+            Optional[int],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The default status code to be used for the response.

<span class="w"> </span>                You could override the status code by returning a response directly.
<span class="gu">@@ -1607,8 +2885,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Status Code](https://fastapi.tiangolo.com/tutorial/response-status-code/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, tags: Annotated[Optional[List[Union[str, Enum]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        tags: Annotated[</span>
<span class="gi">+            Optional[List[Union[str, Enum]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of tags to be applied to the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -1616,17 +2898,24 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/#tags).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, dependencies: Annotated[Optional[Sequence[params.Depends]],</span>
<span class="gd">-        Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        dependencies: Annotated[</span>
<span class="gi">+            Optional[Sequence[params.Depends]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of dependencies (using `Depends()`) to be applied to the
<span class="w"> </span>                *path operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Dependencies in path operation decorators](https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-in-path-operation-decorators/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, summary: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        summary: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A summary for the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -1634,8 +2923,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A description for the *path operation*.

<span class="w"> </span>                If not provided, it will be extracted automatically from the docstring
<span class="gu">@@ -1648,27 +2941,42 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_description: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_description: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The description for the default response.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;Successful Response&#39;, responses: Annotated[Optional[Dict[Union[</span>
<span class="gd">-        int, str], Dict[str, Any]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;Successful Response&quot;,</span>
<span class="gi">+        responses: Annotated[</span>
<span class="gi">+            Optional[Dict[Union[int, str], Dict[str, Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Additional responses that could be returned by this *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, deprecated: Annotated[Optional[bool], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        deprecated: Annotated[</span>
<span class="gi">+            Optional[bool],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Mark this *path operation* as deprecated.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, operation_id: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        operation_id: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Custom operation ID to be used by this *path operation*.

<span class="w"> </span>                By default, it is generated automatically.
<span class="gu">@@ -1683,32 +2991,48 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_include: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_include: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to include only certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_exclude: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_exclude: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to exclude certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_by_alias: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_by_alias: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response model
<span class="w"> </span>                should be serialized by alias when an alias is used.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_model_exclude_unset: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_model_exclude_unset: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that were not set and
<span class="w"> </span>                have their default values. This is different from
<span class="gu">@@ -1721,8 +3045,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_defaults: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_defaults: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that have the same value
<span class="w"> </span>                as the default. This is different from `response_model_exclude_unset`
<span class="gu">@@ -1734,8 +3062,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_none: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_none: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data should
<span class="w"> </span>                exclude fields set to `None`.

<span class="gu">@@ -1747,8 +3079,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_exclude_none).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, include_in_schema: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        include_in_schema: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Include this *path operation* in the generated OpenAPI schema.

<span class="w"> </span>                This affects the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -1756,8 +3092,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Query Parameters and String Validations](https://fastapi.tiangolo.com/tutorial/query-params-str-validations/#exclude-from-openapi).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_class: Annotated[Type[Response], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_class: Annotated[</span>
<span class="gi">+            Type[Response],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Response class to be used for this *path operation*.

<span class="w"> </span>                This will not be used if you return a response directly.
<span class="gu">@@ -1765,12 +3105,20 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Custom Response - HTML, Stream, File, others](https://fastapi.tiangolo.com/advanced/custom-response/#redirectresponse).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(JSONResponse), name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(JSONResponse),</span>
<span class="gi">+        name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Name for this *path operation*. Only used internally.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, callbacks: Annotated[Optional[List[BaseRoute]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        callbacks: Annotated[</span>
<span class="gi">+            Optional[List[BaseRoute]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                List of *path operations* that will be used as OpenAPI callbacks.

<span class="w"> </span>                This is only for OpenAPI documentation, the callbacks won&#39;t be used
<span class="gu">@@ -1781,17 +3129,24 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for OpenAPI Callbacks](https://fastapi.tiangolo.com/advanced/openapi-callbacks/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, openapi_extra: Annotated[Optional[Dict[str, Any]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        openapi_extra: Annotated[</span>
<span class="gi">+            Optional[Dict[str, Any]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Extra metadata to be included in the OpenAPI schema for this *path
<span class="w"> </span>                operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Advanced Configuration](https://fastapi.tiangolo.com/advanced/path-operation-advanced-configuration/#custom-openapi-path-operation-schema).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, generate_unique_id_function: Annotated[Callable[[APIRoute],</span>
<span class="gd">-        str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        generate_unique_id_function: Annotated[</span>
<span class="gi">+            Callable[[APIRoute], str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Customize the function used to generate unique IDs for the *path
<span class="w"> </span>                operations* shown in the generated OpenAPI.

<span class="gu">@@ -1801,8 +3156,9 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(generate_unique_id)) -&gt;Callable[[DecoratedCallable],</span>
<span class="gd">-        DecoratedCallable]:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(generate_unique_id),</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Add a *path operation* using an HTTP OPTIONS operation.

<span class="gu">@@ -1821,16 +3177,50 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>        app.include_router(router)
<span class="w"> </span>        ```
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self.api_route(</span>
<span class="gi">+            path=path,</span>
<span class="gi">+            response_model=response_model,</span>
<span class="gi">+            status_code=status_code,</span>
<span class="gi">+            tags=tags,</span>
<span class="gi">+            dependencies=dependencies,</span>
<span class="gi">+            summary=summary,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            response_description=response_description,</span>
<span class="gi">+            responses=responses,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            methods=[&quot;OPTIONS&quot;],</span>
<span class="gi">+            operation_id=operation_id,</span>
<span class="gi">+            response_model_include=response_model_include,</span>
<span class="gi">+            response_model_exclude=response_model_exclude,</span>
<span class="gi">+            response_model_by_alias=response_model_by_alias,</span>
<span class="gi">+            response_model_exclude_unset=response_model_exclude_unset,</span>
<span class="gi">+            response_model_exclude_defaults=response_model_exclude_defaults,</span>
<span class="gi">+            response_model_exclude_none=response_model_exclude_none,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            response_class=response_class,</span>
<span class="gi">+            name=name,</span>
<span class="gi">+            callbacks=callbacks,</span>
<span class="gi">+            openapi_extra=openapi_extra,</span>
<span class="gi">+            generate_unique_id_function=generate_unique_id_function,</span>
<span class="gi">+        )</span>

<span class="gd">-    def head(self, path: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def head(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The URL path to be used for this *path operation*.

<span class="w"> </span>                For example, in `http://example.com/items`, the path is `/items`.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], *, response_model: Annotated[Any, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        *,</span>
<span class="gi">+        response_model: Annotated[</span>
<span class="gi">+            Any,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The type to use for the response.

<span class="w"> </span>                It could be any valid Pydantic *field* type. So, it doesn&#39;t have to
<span class="gu">@@ -1859,8 +3249,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model](https://fastapi.tiangolo.com/tutorial/response-model/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(None), status_code: Annotated[Optional[int], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(None),</span>
<span class="gi">+        status_code: Annotated[</span>
<span class="gi">+            Optional[int],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The default status code to be used for the response.

<span class="w"> </span>                You could override the status code by returning a response directly.
<span class="gu">@@ -1868,8 +3262,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Status Code](https://fastapi.tiangolo.com/tutorial/response-status-code/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, tags: Annotated[Optional[List[Union[str, Enum]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        tags: Annotated[</span>
<span class="gi">+            Optional[List[Union[str, Enum]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of tags to be applied to the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -1877,17 +3275,24 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/#tags).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, dependencies: Annotated[Optional[Sequence[params.Depends]],</span>
<span class="gd">-        Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        dependencies: Annotated[</span>
<span class="gi">+            Optional[Sequence[params.Depends]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of dependencies (using `Depends()`) to be applied to the
<span class="w"> </span>                *path operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Dependencies in path operation decorators](https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-in-path-operation-decorators/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, summary: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        summary: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A summary for the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -1895,8 +3300,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A description for the *path operation*.

<span class="w"> </span>                If not provided, it will be extracted automatically from the docstring
<span class="gu">@@ -1909,27 +3318,42 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_description: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_description: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The description for the default response.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;Successful Response&#39;, responses: Annotated[Optional[Dict[Union[</span>
<span class="gd">-        int, str], Dict[str, Any]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;Successful Response&quot;,</span>
<span class="gi">+        responses: Annotated[</span>
<span class="gi">+            Optional[Dict[Union[int, str], Dict[str, Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Additional responses that could be returned by this *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, deprecated: Annotated[Optional[bool], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        deprecated: Annotated[</span>
<span class="gi">+            Optional[bool],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Mark this *path operation* as deprecated.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, operation_id: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        operation_id: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Custom operation ID to be used by this *path operation*.

<span class="w"> </span>                By default, it is generated automatically.
<span class="gu">@@ -1944,32 +3368,48 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_include: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_include: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to include only certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_exclude: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_exclude: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to exclude certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_by_alias: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_by_alias: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response model
<span class="w"> </span>                should be serialized by alias when an alias is used.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_model_exclude_unset: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_model_exclude_unset: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that were not set and
<span class="w"> </span>                have their default values. This is different from
<span class="gu">@@ -1982,8 +3422,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_defaults: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_defaults: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that have the same value
<span class="w"> </span>                as the default. This is different from `response_model_exclude_unset`
<span class="gu">@@ -1995,8 +3439,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_none: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_none: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data should
<span class="w"> </span>                exclude fields set to `None`.

<span class="gu">@@ -2008,8 +3456,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_exclude_none).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, include_in_schema: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        include_in_schema: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Include this *path operation* in the generated OpenAPI schema.

<span class="w"> </span>                This affects the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -2017,8 +3469,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Query Parameters and String Validations](https://fastapi.tiangolo.com/tutorial/query-params-str-validations/#exclude-from-openapi).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_class: Annotated[Type[Response], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_class: Annotated[</span>
<span class="gi">+            Type[Response],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Response class to be used for this *path operation*.

<span class="w"> </span>                This will not be used if you return a response directly.
<span class="gu">@@ -2026,12 +3482,20 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Custom Response - HTML, Stream, File, others](https://fastapi.tiangolo.com/advanced/custom-response/#redirectresponse).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(JSONResponse), name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(JSONResponse),</span>
<span class="gi">+        name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Name for this *path operation*. Only used internally.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, callbacks: Annotated[Optional[List[BaseRoute]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        callbacks: Annotated[</span>
<span class="gi">+            Optional[List[BaseRoute]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                List of *path operations* that will be used as OpenAPI callbacks.

<span class="w"> </span>                This is only for OpenAPI documentation, the callbacks won&#39;t be used
<span class="gu">@@ -2042,17 +3506,24 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for OpenAPI Callbacks](https://fastapi.tiangolo.com/advanced/openapi-callbacks/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, openapi_extra: Annotated[Optional[Dict[str, Any]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        openapi_extra: Annotated[</span>
<span class="gi">+            Optional[Dict[str, Any]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Extra metadata to be included in the OpenAPI schema for this *path
<span class="w"> </span>                operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Advanced Configuration](https://fastapi.tiangolo.com/advanced/path-operation-advanced-configuration/#custom-openapi-path-operation-schema).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, generate_unique_id_function: Annotated[Callable[[APIRoute],</span>
<span class="gd">-        str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        generate_unique_id_function: Annotated[</span>
<span class="gi">+            Callable[[APIRoute], str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Customize the function used to generate unique IDs for the *path
<span class="w"> </span>                operations* shown in the generated OpenAPI.

<span class="gu">@@ -2062,8 +3533,9 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(generate_unique_id)) -&gt;Callable[[DecoratedCallable],</span>
<span class="gd">-        DecoratedCallable]:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(generate_unique_id),</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Add a *path operation* using an HTTP HEAD operation.

<span class="gu">@@ -2087,16 +3559,50 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>        app.include_router(router)
<span class="w"> </span>        ```
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self.api_route(</span>
<span class="gi">+            path=path,</span>
<span class="gi">+            response_model=response_model,</span>
<span class="gi">+            status_code=status_code,</span>
<span class="gi">+            tags=tags,</span>
<span class="gi">+            dependencies=dependencies,</span>
<span class="gi">+            summary=summary,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            response_description=response_description,</span>
<span class="gi">+            responses=responses,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            methods=[&quot;HEAD&quot;],</span>
<span class="gi">+            operation_id=operation_id,</span>
<span class="gi">+            response_model_include=response_model_include,</span>
<span class="gi">+            response_model_exclude=response_model_exclude,</span>
<span class="gi">+            response_model_by_alias=response_model_by_alias,</span>
<span class="gi">+            response_model_exclude_unset=response_model_exclude_unset,</span>
<span class="gi">+            response_model_exclude_defaults=response_model_exclude_defaults,</span>
<span class="gi">+            response_model_exclude_none=response_model_exclude_none,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            response_class=response_class,</span>
<span class="gi">+            name=name,</span>
<span class="gi">+            callbacks=callbacks,</span>
<span class="gi">+            openapi_extra=openapi_extra,</span>
<span class="gi">+            generate_unique_id_function=generate_unique_id_function,</span>
<span class="gi">+        )</span>

<span class="gd">-    def patch(self, path: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def patch(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The URL path to be used for this *path operation*.

<span class="w"> </span>                For example, in `http://example.com/items`, the path is `/items`.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], *, response_model: Annotated[Any, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        *,</span>
<span class="gi">+        response_model: Annotated[</span>
<span class="gi">+            Any,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The type to use for the response.

<span class="w"> </span>                It could be any valid Pydantic *field* type. So, it doesn&#39;t have to
<span class="gu">@@ -2125,8 +3631,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model](https://fastapi.tiangolo.com/tutorial/response-model/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(None), status_code: Annotated[Optional[int], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(None),</span>
<span class="gi">+        status_code: Annotated[</span>
<span class="gi">+            Optional[int],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The default status code to be used for the response.

<span class="w"> </span>                You could override the status code by returning a response directly.
<span class="gu">@@ -2134,8 +3644,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Status Code](https://fastapi.tiangolo.com/tutorial/response-status-code/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, tags: Annotated[Optional[List[Union[str, Enum]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        tags: Annotated[</span>
<span class="gi">+            Optional[List[Union[str, Enum]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of tags to be applied to the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -2143,17 +3657,24 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/#tags).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, dependencies: Annotated[Optional[Sequence[params.Depends]],</span>
<span class="gd">-        Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        dependencies: Annotated[</span>
<span class="gi">+            Optional[Sequence[params.Depends]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of dependencies (using `Depends()`) to be applied to the
<span class="w"> </span>                *path operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Dependencies in path operation decorators](https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-in-path-operation-decorators/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, summary: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        summary: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A summary for the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -2161,8 +3682,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A description for the *path operation*.

<span class="w"> </span>                If not provided, it will be extracted automatically from the docstring
<span class="gu">@@ -2175,27 +3700,42 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_description: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_description: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The description for the default response.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;Successful Response&#39;, responses: Annotated[Optional[Dict[Union[</span>
<span class="gd">-        int, str], Dict[str, Any]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;Successful Response&quot;,</span>
<span class="gi">+        responses: Annotated[</span>
<span class="gi">+            Optional[Dict[Union[int, str], Dict[str, Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Additional responses that could be returned by this *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, deprecated: Annotated[Optional[bool], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        deprecated: Annotated[</span>
<span class="gi">+            Optional[bool],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Mark this *path operation* as deprecated.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, operation_id: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        operation_id: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Custom operation ID to be used by this *path operation*.

<span class="w"> </span>                By default, it is generated automatically.
<span class="gu">@@ -2210,32 +3750,48 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_include: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_include: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to include only certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_exclude: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_exclude: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to exclude certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_by_alias: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_by_alias: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response model
<span class="w"> </span>                should be serialized by alias when an alias is used.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_model_exclude_unset: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_model_exclude_unset: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that were not set and
<span class="w"> </span>                have their default values. This is different from
<span class="gu">@@ -2248,8 +3804,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_defaults: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_defaults: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that have the same value
<span class="w"> </span>                as the default. This is different from `response_model_exclude_unset`
<span class="gu">@@ -2261,8 +3821,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_none: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_none: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data should
<span class="w"> </span>                exclude fields set to `None`.

<span class="gu">@@ -2274,8 +3838,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_exclude_none).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, include_in_schema: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        include_in_schema: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Include this *path operation* in the generated OpenAPI schema.

<span class="w"> </span>                This affects the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -2283,8 +3851,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Query Parameters and String Validations](https://fastapi.tiangolo.com/tutorial/query-params-str-validations/#exclude-from-openapi).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_class: Annotated[Type[Response], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_class: Annotated[</span>
<span class="gi">+            Type[Response],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Response class to be used for this *path operation*.

<span class="w"> </span>                This will not be used if you return a response directly.
<span class="gu">@@ -2292,12 +3864,20 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Custom Response - HTML, Stream, File, others](https://fastapi.tiangolo.com/advanced/custom-response/#redirectresponse).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(JSONResponse), name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(JSONResponse),</span>
<span class="gi">+        name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Name for this *path operation*. Only used internally.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, callbacks: Annotated[Optional[List[BaseRoute]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        callbacks: Annotated[</span>
<span class="gi">+            Optional[List[BaseRoute]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                List of *path operations* that will be used as OpenAPI callbacks.

<span class="w"> </span>                This is only for OpenAPI documentation, the callbacks won&#39;t be used
<span class="gu">@@ -2308,17 +3888,24 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for OpenAPI Callbacks](https://fastapi.tiangolo.com/advanced/openapi-callbacks/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, openapi_extra: Annotated[Optional[Dict[str, Any]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        openapi_extra: Annotated[</span>
<span class="gi">+            Optional[Dict[str, Any]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Extra metadata to be included in the OpenAPI schema for this *path
<span class="w"> </span>                operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Advanced Configuration](https://fastapi.tiangolo.com/advanced/path-operation-advanced-configuration/#custom-openapi-path-operation-schema).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, generate_unique_id_function: Annotated[Callable[[APIRoute],</span>
<span class="gd">-        str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        generate_unique_id_function: Annotated[</span>
<span class="gi">+            Callable[[APIRoute], str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Customize the function used to generate unique IDs for the *path
<span class="w"> </span>                operations* shown in the generated OpenAPI.

<span class="gu">@@ -2328,8 +3915,9 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(generate_unique_id)) -&gt;Callable[[DecoratedCallable],</span>
<span class="gd">-        DecoratedCallable]:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(generate_unique_id),</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Add a *path operation* using an HTTP PATCH operation.

<span class="gu">@@ -2353,16 +3941,50 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>        app.include_router(router)
<span class="w"> </span>        ```
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self.api_route(</span>
<span class="gi">+            path=path,</span>
<span class="gi">+            response_model=response_model,</span>
<span class="gi">+            status_code=status_code,</span>
<span class="gi">+            tags=tags,</span>
<span class="gi">+            dependencies=dependencies,</span>
<span class="gi">+            summary=summary,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            response_description=response_description,</span>
<span class="gi">+            responses=responses,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            methods=[&quot;PATCH&quot;],</span>
<span class="gi">+            operation_id=operation_id,</span>
<span class="gi">+            response_model_include=response_model_include,</span>
<span class="gi">+            response_model_exclude=response_model_exclude,</span>
<span class="gi">+            response_model_by_alias=response_model_by_alias,</span>
<span class="gi">+            response_model_exclude_unset=response_model_exclude_unset,</span>
<span class="gi">+            response_model_exclude_defaults=response_model_exclude_defaults,</span>
<span class="gi">+            response_model_exclude_none=response_model_exclude_none,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            response_class=response_class,</span>
<span class="gi">+            name=name,</span>
<span class="gi">+            callbacks=callbacks,</span>
<span class="gi">+            openapi_extra=openapi_extra,</span>
<span class="gi">+            generate_unique_id_function=generate_unique_id_function,</span>
<span class="gi">+        )</span>

<span class="gd">-    def trace(self, path: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def trace(</span>
<span class="gi">+        self,</span>
<span class="gi">+        path: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The URL path to be used for this *path operation*.

<span class="w"> </span>                For example, in `http://example.com/items`, the path is `/items`.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], *, response_model: Annotated[Any, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        *,</span>
<span class="gi">+        response_model: Annotated[</span>
<span class="gi">+            Any,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The type to use for the response.

<span class="w"> </span>                It could be any valid Pydantic *field* type. So, it doesn&#39;t have to
<span class="gu">@@ -2391,8 +4013,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model](https://fastapi.tiangolo.com/tutorial/response-model/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(None), status_code: Annotated[Optional[int], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(None),</span>
<span class="gi">+        status_code: Annotated[</span>
<span class="gi">+            Optional[int],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The default status code to be used for the response.

<span class="w"> </span>                You could override the status code by returning a response directly.
<span class="gu">@@ -2400,8 +4026,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Status Code](https://fastapi.tiangolo.com/tutorial/response-status-code/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, tags: Annotated[Optional[List[Union[str, Enum]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        tags: Annotated[</span>
<span class="gi">+            Optional[List[Union[str, Enum]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of tags to be applied to the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -2409,17 +4039,24 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/#tags).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, dependencies: Annotated[Optional[Sequence[params.Depends]],</span>
<span class="gd">-        Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        dependencies: Annotated[</span>
<span class="gi">+            Optional[Sequence[params.Depends]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A list of dependencies (using `Depends()`) to be applied to the
<span class="w"> </span>                *path operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Dependencies in path operation decorators](https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-in-path-operation-decorators/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, summary: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        summary: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A summary for the *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -2427,8 +4064,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A description for the *path operation*.

<span class="w"> </span>                If not provided, it will be extracted automatically from the docstring
<span class="gu">@@ -2441,27 +4082,42 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Configuration](https://fastapi.tiangolo.com/tutorial/path-operation-configuration/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_description: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_description: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The description for the default response.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;Successful Response&#39;, responses: Annotated[Optional[Dict[Union[</span>
<span class="gd">-        int, str], Dict[str, Any]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;Successful Response&quot;,</span>
<span class="gi">+        responses: Annotated[</span>
<span class="gi">+            Optional[Dict[Union[int, str], Dict[str, Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Additional responses that could be returned by this *path operation*.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, deprecated: Annotated[Optional[bool], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        deprecated: Annotated[</span>
<span class="gi">+            Optional[bool],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Mark this *path operation* as deprecated.

<span class="w"> </span>                It will be added to the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, operation_id: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        operation_id: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Custom operation ID to be used by this *path operation*.

<span class="w"> </span>                By default, it is generated automatically.
<span class="gu">@@ -2476,32 +4132,48 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_include: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_include: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to include only certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_exclude: Annotated[Optional[IncEx], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_exclude: Annotated[</span>
<span class="gi">+            Optional[IncEx],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to exclude certain fields in the
<span class="w"> </span>                response data.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, response_model_by_alias: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        response_model_by_alias: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response model
<span class="w"> </span>                should be serialized by alias when an alias is used.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_include-and-response_model_exclude).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_model_exclude_unset: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_model_exclude_unset: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that were not set and
<span class="w"> </span>                have their default values. This is different from
<span class="gu">@@ -2514,8 +4186,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_defaults: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_defaults: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data
<span class="w"> </span>                should have all the fields, including the ones that have the same value
<span class="w"> </span>                as the default. This is different from `response_model_exclude_unset`
<span class="gu">@@ -2527,8 +4203,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#use-the-response_model_exclude_unset-parameter).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, response_model_exclude_none: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        response_model_exclude_none: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Configuration passed to Pydantic to define if the response data should
<span class="w"> </span>                exclude fields set to `None`.

<span class="gu">@@ -2540,8 +4220,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Response Model - Return Type](https://fastapi.tiangolo.com/tutorial/response-model/#response_model_exclude_none).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=False, include_in_schema: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = False,</span>
<span class="gi">+        include_in_schema: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Include this *path operation* in the generated OpenAPI schema.

<span class="w"> </span>                This affects the generated OpenAPI (e.g. visible at `/docs`).
<span class="gu">@@ -2549,8 +4233,12 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Query Parameters and String Validations](https://fastapi.tiangolo.com/tutorial/query-params-str-validations/#exclude-from-openapi).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True, response_class: Annotated[Type[Response], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+        response_class: Annotated[</span>
<span class="gi">+            Type[Response],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Response class to be used for this *path operation*.

<span class="w"> </span>                This will not be used if you return a response directly.
<span class="gu">@@ -2558,12 +4246,20 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Custom Response - HTML, Stream, File, others](https://fastapi.tiangolo.com/advanced/custom-response/#redirectresponse).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(JSONResponse), name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(JSONResponse),</span>
<span class="gi">+        name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Name for this *path operation*. Only used internally.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, callbacks: Annotated[Optional[List[BaseRoute]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        callbacks: Annotated[</span>
<span class="gi">+            Optional[List[BaseRoute]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                List of *path operations* that will be used as OpenAPI callbacks.

<span class="w"> </span>                This is only for OpenAPI documentation, the callbacks won&#39;t be used
<span class="gu">@@ -2574,17 +4270,24 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for OpenAPI Callbacks](https://fastapi.tiangolo.com/advanced/openapi-callbacks/).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, openapi_extra: Annotated[Optional[Dict[str, Any]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        openapi_extra: Annotated[</span>
<span class="gi">+            Optional[Dict[str, Any]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Extra metadata to be included in the OpenAPI schema for this *path
<span class="w"> </span>                operation*.

<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs for Path Operation Advanced Configuration](https://fastapi.tiangolo.com/advanced/path-operation-advanced-configuration/#custom-openapi-path-operation-schema).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, generate_unique_id_function: Annotated[Callable[[APIRoute],</span>
<span class="gd">-        str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        generate_unique_id_function: Annotated[</span>
<span class="gi">+            Callable[[APIRoute], str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Customize the function used to generate unique IDs for the *path
<span class="w"> </span>                operations* shown in the generated OpenAPI.

<span class="gu">@@ -2594,8 +4297,9 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>                Read more about it in the
<span class="w"> </span>                [FastAPI docs about how to Generate Clients](https://fastapi.tiangolo.com/advanced/generate-clients/#custom-generate-unique-id-function).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=Default(generate_unique_id)) -&gt;Callable[[DecoratedCallable],</span>
<span class="gd">-        DecoratedCallable]:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = Default(generate_unique_id),</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Add a *path operation* using an HTTP TRACE operation.

<span class="gu">@@ -2619,7 +4323,32 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>        app.include_router(router)
<span class="w"> </span>        ```
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+        return self.api_route(</span>
<span class="gi">+            path=path,</span>
<span class="gi">+            response_model=response_model,</span>
<span class="gi">+            status_code=status_code,</span>
<span class="gi">+            tags=tags,</span>
<span class="gi">+            dependencies=dependencies,</span>
<span class="gi">+            summary=summary,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            response_description=response_description,</span>
<span class="gi">+            responses=responses,</span>
<span class="gi">+            deprecated=deprecated,</span>
<span class="gi">+            methods=[&quot;TRACE&quot;],</span>
<span class="gi">+            operation_id=operation_id,</span>
<span class="gi">+            response_model_include=response_model_include,</span>
<span class="gi">+            response_model_exclude=response_model_exclude,</span>
<span class="gi">+            response_model_by_alias=response_model_by_alias,</span>
<span class="gi">+            response_model_exclude_unset=response_model_exclude_unset,</span>
<span class="gi">+            response_model_exclude_defaults=response_model_exclude_defaults,</span>
<span class="gi">+            response_model_exclude_none=response_model_exclude_none,</span>
<span class="gi">+            include_in_schema=include_in_schema,</span>
<span class="gi">+            response_class=response_class,</span>
<span class="gi">+            name=name,</span>
<span class="gi">+            callbacks=callbacks,</span>
<span class="gi">+            openapi_extra=openapi_extra,</span>
<span class="gi">+            generate_unique_id_function=generate_unique_id_function,</span>
<span class="gi">+        )</span>

<span class="w"> </span>    @deprecated(
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gu">@@ -2628,12 +4357,18 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>        Read more about it in the
<span class="w"> </span>        [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        )</span>
<span class="gd">-    def on_event(self, event_type: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    )</span>
<span class="gi">+    def on_event(</span>
<span class="gi">+        self,</span>
<span class="gi">+        event_type: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The type of event. `startup` or `shutdown`.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]) -&gt;Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+    ) -&gt; Callable[[DecoratedCallable], DecoratedCallable]:</span>
<span class="w"> </span>        &quot;&quot;&quot;
<span class="w"> </span>        Add an event handler for the router.

<span class="gu">@@ -2642,4 +4377,9 @@ class APIRouter(routing.Router):</span>
<span class="w"> </span>        Read more about it in the
<span class="w"> </span>        [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/#alternative-events-deprecated).
<span class="w"> </span>        &quot;&quot;&quot;
<span class="gd">-        pass</span>
<span class="gi">+</span>
<span class="gi">+        def decorator(func: DecoratedCallable) -&gt; DecoratedCallable:</span>
<span class="gi">+            self.add_event_handler(event_type, func)</span>
<span class="gi">+            return func</span>
<span class="gi">+</span>
<span class="gi">+        return decorator</span>
<span class="gh">diff --git a/fastapi/security/api_key.py b/fastapi/security/api_key.py</span>
<span class="gh">index 215e9cb9..d68bdb03 100644</span>
<span class="gd">--- a/fastapi/security/api_key.py</span>
<span class="gi">+++ b/fastapi/security/api_key.py</span>
<span class="gu">@@ -1,4 +1,5 @@</span>
<span class="w"> </span>from typing import Optional
<span class="gi">+</span>
<span class="w"> </span>from fastapi.openapi.models import APIKey, APIKeyIn
<span class="w"> </span>from fastapi.security.base import SecurityBase
<span class="w"> </span>from starlette.exceptions import HTTPException
<span class="gu">@@ -43,21 +44,37 @@ class APIKeyQuery(APIKeyBase):</span>
<span class="w"> </span>    ```
<span class="w"> </span>    &quot;&quot;&quot;

<span class="gd">-    def __init__(self, *, name: Annotated[str, Doc(&#39;Query parameter name.&#39;)</span>
<span class="gd">-        ], scheme_name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        *,</span>
<span class="gi">+        name: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(&quot;Query parameter name.&quot;),</span>
<span class="gi">+        ],</span>
<span class="gi">+        scheme_name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Security scheme name.

<span class="w"> </span>                It will be included in the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Security scheme description.

<span class="w"> </span>                It will be included in the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, auto_error: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        auto_error: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                By default, if the query parameter is not provided, `APIKeyQuery` will
<span class="w"> </span>                automatically cancel the request and send the client an error.

<span class="gu">@@ -71,18 +88,24 @@ class APIKeyQuery(APIKeyBase):</span>
<span class="w"> </span>                provided in one of multiple optional ways (for example, in a query
<span class="w"> </span>                parameter or in an HTTP Bearer token).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True):</span>
<span class="gd">-        self.model: APIKey = APIKey(**{&#39;in&#39;: APIKeyIn.query}, name=name,</span>
<span class="gd">-            description=description)</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+    ):</span>
<span class="gi">+        self.model: APIKey = APIKey(</span>
<span class="gi">+            **{&quot;in&quot;: APIKeyIn.query},  # type: ignore[arg-type]</span>
<span class="gi">+            name=name,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+        )</span>
<span class="w"> </span>        self.scheme_name = scheme_name or self.__class__.__name__
<span class="w"> </span>        self.auto_error = auto_error

<span class="gd">-    async def __call__(self, request: Request) -&gt;Optional[str]:</span>
<span class="gi">+    async def __call__(self, request: Request) -&gt; Optional[str]:</span>
<span class="w"> </span>        api_key = request.query_params.get(self.model.name)
<span class="w"> </span>        if not api_key:
<span class="w"> </span>            if self.auto_error:
<span class="gd">-                raise HTTPException(status_code=HTTP_403_FORBIDDEN, detail=</span>
<span class="gd">-                    &#39;Not authenticated&#39;)</span>
<span class="gi">+                raise HTTPException(</span>
<span class="gi">+                    status_code=HTTP_403_FORBIDDEN, detail=&quot;Not authenticated&quot;</span>
<span class="gi">+                )</span>
<span class="w"> </span>            else:
<span class="w"> </span>                return None
<span class="w"> </span>        return api_key
<span class="gu">@@ -120,21 +143,34 @@ class APIKeyHeader(APIKeyBase):</span>
<span class="w"> </span>    ```
<span class="w"> </span>    &quot;&quot;&quot;

<span class="gd">-    def __init__(self, *, name: Annotated[str, Doc(&#39;Header name.&#39;)],</span>
<span class="gd">-        scheme_name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        *,</span>
<span class="gi">+        name: Annotated[str, Doc(&quot;Header name.&quot;)],</span>
<span class="gi">+        scheme_name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Security scheme name.

<span class="w"> </span>                It will be included in the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Security scheme description.

<span class="w"> </span>                It will be included in the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, auto_error: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        auto_error: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                By default, if the header is not provided, `APIKeyHeader` will
<span class="w"> </span>                automatically cancel the request and send the client an error.

<span class="gu">@@ -147,18 +183,24 @@ class APIKeyHeader(APIKeyBase):</span>
<span class="w"> </span>                provided in one of multiple optional ways (for example, in a header or
<span class="w"> </span>                in an HTTP Bearer token).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True):</span>
<span class="gd">-        self.model: APIKey = APIKey(**{&#39;in&#39;: APIKeyIn.header}, name=name,</span>
<span class="gd">-            description=description)</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+    ):</span>
<span class="gi">+        self.model: APIKey = APIKey(</span>
<span class="gi">+            **{&quot;in&quot;: APIKeyIn.header},  # type: ignore[arg-type]</span>
<span class="gi">+            name=name,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+        )</span>
<span class="w"> </span>        self.scheme_name = scheme_name or self.__class__.__name__
<span class="w"> </span>        self.auto_error = auto_error

<span class="gd">-    async def __call__(self, request: Request) -&gt;Optional[str]:</span>
<span class="gi">+    async def __call__(self, request: Request) -&gt; Optional[str]:</span>
<span class="w"> </span>        api_key = request.headers.get(self.model.name)
<span class="w"> </span>        if not api_key:
<span class="w"> </span>            if self.auto_error:
<span class="gd">-                raise HTTPException(status_code=HTTP_403_FORBIDDEN, detail=</span>
<span class="gd">-                    &#39;Not authenticated&#39;)</span>
<span class="gi">+                raise HTTPException(</span>
<span class="gi">+                    status_code=HTTP_403_FORBIDDEN, detail=&quot;Not authenticated&quot;</span>
<span class="gi">+                )</span>
<span class="w"> </span>            else:
<span class="w"> </span>                return None
<span class="w"> </span>        return api_key
<span class="gu">@@ -196,21 +238,34 @@ class APIKeyCookie(APIKeyBase):</span>
<span class="w"> </span>    ```
<span class="w"> </span>    &quot;&quot;&quot;

<span class="gd">-    def __init__(self, *, name: Annotated[str, Doc(&#39;Cookie name.&#39;)],</span>
<span class="gd">-        scheme_name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        *,</span>
<span class="gi">+        name: Annotated[str, Doc(&quot;Cookie name.&quot;)],</span>
<span class="gi">+        scheme_name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Security scheme name.

<span class="w"> </span>                It will be included in the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Security scheme description.

<span class="w"> </span>                It will be included in the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, auto_error: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        auto_error: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                By default, if the cookie is not provided, `APIKeyCookie` will
<span class="w"> </span>                automatically cancel the request and send the client an error.

<span class="gu">@@ -223,18 +278,24 @@ class APIKeyCookie(APIKeyBase):</span>
<span class="w"> </span>                provided in one of multiple optional ways (for example, in a cookie or
<span class="w"> </span>                in an HTTP Bearer token).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True):</span>
<span class="gd">-        self.model: APIKey = APIKey(**{&#39;in&#39;: APIKeyIn.cookie}, name=name,</span>
<span class="gd">-            description=description)</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+    ):</span>
<span class="gi">+        self.model: APIKey = APIKey(</span>
<span class="gi">+            **{&quot;in&quot;: APIKeyIn.cookie},  # type: ignore[arg-type]</span>
<span class="gi">+            name=name,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+        )</span>
<span class="w"> </span>        self.scheme_name = scheme_name or self.__class__.__name__
<span class="w"> </span>        self.auto_error = auto_error

<span class="gd">-    async def __call__(self, request: Request) -&gt;Optional[str]:</span>
<span class="gi">+    async def __call__(self, request: Request) -&gt; Optional[str]:</span>
<span class="w"> </span>        api_key = request.cookies.get(self.model.name)
<span class="w"> </span>        if not api_key:
<span class="w"> </span>            if self.auto_error:
<span class="gd">-                raise HTTPException(status_code=HTTP_403_FORBIDDEN, detail=</span>
<span class="gd">-                    &#39;Not authenticated&#39;)</span>
<span class="gi">+                raise HTTPException(</span>
<span class="gi">+                    status_code=HTTP_403_FORBIDDEN, detail=&quot;Not authenticated&quot;</span>
<span class="gi">+                )</span>
<span class="w"> </span>            else:
<span class="w"> </span>                return None
<span class="w"> </span>        return api_key
<span class="gh">diff --git a/fastapi/security/http.py b/fastapi/security/http.py</span>
<span class="gh">index a202bb48..a142b135 100644</span>
<span class="gd">--- a/fastapi/security/http.py</span>
<span class="gi">+++ b/fastapi/security/http.py</span>
<span class="gu">@@ -1,6 +1,7 @@</span>
<span class="w"> </span>import binascii
<span class="w"> </span>from base64 import b64decode
<span class="w"> </span>from typing import Optional
<span class="gi">+</span>
<span class="w"> </span>from fastapi.exceptions import HTTPException
<span class="w"> </span>from fastapi.openapi.models import HTTPBase as HTTPBaseModel
<span class="w"> </span>from fastapi.openapi.models import HTTPBearer as HTTPBearerModel
<span class="gu">@@ -20,8 +21,9 @@ class HTTPBasicCredentials(BaseModel):</span>
<span class="w"> </span>    Read more about it in the
<span class="w"> </span>    [FastAPI docs for HTTP Basic Auth](https://fastapi.tiangolo.com/advanced/security/http-basic-auth/).
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    username: Annotated[str, Doc(&#39;The HTTP Basic username.&#39;)]</span>
<span class="gd">-    password: Annotated[str, Doc(&#39;The HTTP Basic password.&#39;)]</span>
<span class="gi">+</span>
<span class="gi">+    username: Annotated[str, Doc(&quot;The HTTP Basic username.&quot;)]</span>
<span class="gi">+    password: Annotated[str, Doc(&quot;The HTTP Basic password.&quot;)]</span>


<span class="w"> </span>class HTTPAuthorizationCredentials(BaseModel):
<span class="gu">@@ -45,38 +47,51 @@ class HTTPAuthorizationCredentials(BaseModel):</span>
<span class="w"> </span>    * `scheme` will have the value `&quot;Bearer&quot;`
<span class="w"> </span>    * `credentials` will have the value `&quot;deadbeef12346&quot;`
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    scheme: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+</span>
<span class="gi">+    scheme: Annotated[</span>
<span class="gi">+        str,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            The HTTP authorization scheme extracted from the header value.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-        )]</span>
<span class="gd">-    credentials: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+        ),</span>
<span class="gi">+    ]</span>
<span class="gi">+    credentials: Annotated[</span>
<span class="gi">+        str,</span>
<span class="gi">+        Doc(</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="w"> </span>            The HTTP authorization credentials extracted from the header value.
<span class="w"> </span>            &quot;&quot;&quot;
<span class="gd">-        )]</span>
<span class="gi">+        ),</span>
<span class="gi">+    ]</span>


<span class="w"> </span>class HTTPBase(SecurityBase):
<span class="gd">-</span>
<span class="gd">-    def __init__(self, *, scheme: str, scheme_name: Optional[str]=None,</span>
<span class="gd">-        description: Optional[str]=None, auto_error: bool=True):</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        *,</span>
<span class="gi">+        scheme: str,</span>
<span class="gi">+        scheme_name: Optional[str] = None,</span>
<span class="gi">+        description: Optional[str] = None,</span>
<span class="gi">+        auto_error: bool = True,</span>
<span class="gi">+    ):</span>
<span class="w"> </span>        self.model = HTTPBaseModel(scheme=scheme, description=description)
<span class="w"> </span>        self.scheme_name = scheme_name or self.__class__.__name__
<span class="w"> </span>        self.auto_error = auto_error

<span class="gd">-    async def __call__(self, request: Request) -&gt;Optional[</span>
<span class="gd">-        HTTPAuthorizationCredentials]:</span>
<span class="gd">-        authorization = request.headers.get(&#39;Authorization&#39;)</span>
<span class="gi">+    async def __call__(</span>
<span class="gi">+        self, request: Request</span>
<span class="gi">+    ) -&gt; Optional[HTTPAuthorizationCredentials]:</span>
<span class="gi">+        authorization = request.headers.get(&quot;Authorization&quot;)</span>
<span class="w"> </span>        scheme, credentials = get_authorization_scheme_param(authorization)
<span class="w"> </span>        if not (authorization and scheme and credentials):
<span class="w"> </span>            if self.auto_error:
<span class="gd">-                raise HTTPException(status_code=HTTP_403_FORBIDDEN, detail=</span>
<span class="gd">-                    &#39;Not authenticated&#39;)</span>
<span class="gi">+                raise HTTPException(</span>
<span class="gi">+                    status_code=HTTP_403_FORBIDDEN, detail=&quot;Not authenticated&quot;</span>
<span class="gi">+                )</span>
<span class="w"> </span>            else:
<span class="w"> </span>                return None
<span class="gd">-        return HTTPAuthorizationCredentials(scheme=scheme, credentials=</span>
<span class="gd">-            credentials)</span>
<span class="gi">+        return HTTPAuthorizationCredentials(scheme=scheme, credentials=credentials)</span>


<span class="w"> </span>class HTTPBasic(HTTPBase):
<span class="gu">@@ -112,24 +127,41 @@ class HTTPBasic(HTTPBase):</span>
<span class="w"> </span>    ```
<span class="w"> </span>    &quot;&quot;&quot;

<span class="gd">-    def __init__(self, *, scheme_name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        *,</span>
<span class="gi">+        scheme_name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Security scheme name.

<span class="w"> </span>                It will be included in the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, realm: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        realm: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                HTTP Basic authentication realm.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Security scheme description.

<span class="w"> </span>                It will be included in the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, auto_error: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        auto_error: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                By default, if the HTTP Basic authentication is not provided (a
<span class="w"> </span>                header), `HTTPBasic` will automatically cancel the request and send the
<span class="w"> </span>                client an error.
<span class="gu">@@ -144,35 +176,42 @@ class HTTPBasic(HTTPBase):</span>
<span class="w"> </span>                provided in one of multiple optional ways (for example, in HTTP Basic
<span class="w"> </span>                authentication or in an HTTP Bearer token).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True):</span>
<span class="gd">-        self.model = HTTPBaseModel(scheme=&#39;basic&#39;, description=description)</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+    ):</span>
<span class="gi">+        self.model = HTTPBaseModel(scheme=&quot;basic&quot;, description=description)</span>
<span class="w"> </span>        self.scheme_name = scheme_name or self.__class__.__name__
<span class="w"> </span>        self.realm = realm
<span class="w"> </span>        self.auto_error = auto_error

<span class="gd">-    async def __call__(self, request: Request) -&gt;Optional[HTTPBasicCredentials</span>
<span class="gd">-        ]:</span>
<span class="gd">-        authorization = request.headers.get(&#39;Authorization&#39;)</span>
<span class="gi">+    async def __call__(  # type: ignore</span>
<span class="gi">+        self, request: Request</span>
<span class="gi">+    ) -&gt; Optional[HTTPBasicCredentials]:</span>
<span class="gi">+        authorization = request.headers.get(&quot;Authorization&quot;)</span>
<span class="w"> </span>        scheme, param = get_authorization_scheme_param(authorization)
<span class="w"> </span>        if self.realm:
<span class="gd">-            unauthorized_headers = {&#39;WWW-Authenticate&#39;:</span>
<span class="gd">-                f&#39;Basic realm=&quot;{self.realm}&quot;&#39;}</span>
<span class="gi">+            unauthorized_headers = {&quot;WWW-Authenticate&quot;: f&#39;Basic realm=&quot;{self.realm}&quot;&#39;}</span>
<span class="w"> </span>        else:
<span class="gd">-            unauthorized_headers = {&#39;WWW-Authenticate&#39;: &#39;Basic&#39;}</span>
<span class="gd">-        if not authorization or scheme.lower() != &#39;basic&#39;:</span>
<span class="gi">+            unauthorized_headers = {&quot;WWW-Authenticate&quot;: &quot;Basic&quot;}</span>
<span class="gi">+        if not authorization or scheme.lower() != &quot;basic&quot;:</span>
<span class="w"> </span>            if self.auto_error:
<span class="gd">-                raise HTTPException(status_code=HTTP_401_UNAUTHORIZED,</span>
<span class="gd">-                    detail=&#39;Not authenticated&#39;, headers=unauthorized_headers)</span>
<span class="gi">+                raise HTTPException(</span>
<span class="gi">+                    status_code=HTTP_401_UNAUTHORIZED,</span>
<span class="gi">+                    detail=&quot;Not authenticated&quot;,</span>
<span class="gi">+                    headers=unauthorized_headers,</span>
<span class="gi">+                )</span>
<span class="w"> </span>            else:
<span class="w"> </span>                return None
<span class="gd">-        invalid_user_credentials_exc = HTTPException(status_code=</span>
<span class="gd">-            HTTP_401_UNAUTHORIZED, detail=</span>
<span class="gd">-            &#39;Invalid authentication credentials&#39;, headers=unauthorized_headers)</span>
<span class="gi">+        invalid_user_credentials_exc = HTTPException(</span>
<span class="gi">+            status_code=HTTP_401_UNAUTHORIZED,</span>
<span class="gi">+            detail=&quot;Invalid authentication credentials&quot;,</span>
<span class="gi">+            headers=unauthorized_headers,</span>
<span class="gi">+        )</span>
<span class="w"> </span>        try:
<span class="gd">-            data = b64decode(param).decode(&#39;ascii&#39;)</span>
<span class="gi">+            data = b64decode(param).decode(&quot;ascii&quot;)</span>
<span class="w"> </span>        except (ValueError, UnicodeDecodeError, binascii.Error):
<span class="gd">-            raise invalid_user_credentials_exc</span>
<span class="gd">-        username, separator, password = data.partition(&#39;:&#39;)</span>
<span class="gi">+            raise invalid_user_credentials_exc  # noqa: B904</span>
<span class="gi">+        username, separator, password = data.partition(&quot;:&quot;)</span>
<span class="w"> </span>        if not separator:
<span class="w"> </span>            raise invalid_user_credentials_exc
<span class="w"> </span>        return HTTPBasicCredentials(username=username, password=password)
<span class="gu">@@ -210,22 +249,34 @@ class HTTPBearer(HTTPBase):</span>
<span class="w"> </span>    ```
<span class="w"> </span>    &quot;&quot;&quot;

<span class="gd">-    def __init__(self, *, bearerFormat: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &#39;Bearer token format.&#39;)]=None, scheme_name: Annotated[Optional[str],</span>
<span class="gd">-        Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        *,</span>
<span class="gi">+        bearerFormat: Annotated[Optional[str], Doc(&quot;Bearer token format.&quot;)] = None,</span>
<span class="gi">+        scheme_name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Security scheme name.

<span class="w"> </span>                It will be included in the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Security scheme description.

<span class="w"> </span>                It will be included in the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, auto_error: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        auto_error: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                By default, if the HTTP Bearer token not provided (in an
<span class="w"> </span>                `Authorization` header), `HTTPBearer` will automatically cancel the
<span class="w"> </span>                request and send the client an error.
<span class="gu">@@ -240,30 +291,34 @@ class HTTPBearer(HTTPBase):</span>
<span class="w"> </span>                provided in one of multiple optional ways (for example, in an HTTP
<span class="w"> </span>                Bearer token or in a cookie).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True):</span>
<span class="gd">-        self.model = HTTPBearerModel(bearerFormat=bearerFormat, description</span>
<span class="gd">-            =description)</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+    ):</span>
<span class="gi">+        self.model = HTTPBearerModel(bearerFormat=bearerFormat, description=description)</span>
<span class="w"> </span>        self.scheme_name = scheme_name or self.__class__.__name__
<span class="w"> </span>        self.auto_error = auto_error

<span class="gd">-    async def __call__(self, request: Request) -&gt;Optional[</span>
<span class="gd">-        HTTPAuthorizationCredentials]:</span>
<span class="gd">-        authorization = request.headers.get(&#39;Authorization&#39;)</span>
<span class="gi">+    async def __call__(</span>
<span class="gi">+        self, request: Request</span>
<span class="gi">+    ) -&gt; Optional[HTTPAuthorizationCredentials]:</span>
<span class="gi">+        authorization = request.headers.get(&quot;Authorization&quot;)</span>
<span class="w"> </span>        scheme, credentials = get_authorization_scheme_param(authorization)
<span class="w"> </span>        if not (authorization and scheme and credentials):
<span class="w"> </span>            if self.auto_error:
<span class="gd">-                raise HTTPException(status_code=HTTP_403_FORBIDDEN, detail=</span>
<span class="gd">-                    &#39;Not authenticated&#39;)</span>
<span class="gi">+                raise HTTPException(</span>
<span class="gi">+                    status_code=HTTP_403_FORBIDDEN, detail=&quot;Not authenticated&quot;</span>
<span class="gi">+                )</span>
<span class="w"> </span>            else:
<span class="w"> </span>                return None
<span class="gd">-        if scheme.lower() != &#39;bearer&#39;:</span>
<span class="gi">+        if scheme.lower() != &quot;bearer&quot;:</span>
<span class="w"> </span>            if self.auto_error:
<span class="gd">-                raise HTTPException(status_code=HTTP_403_FORBIDDEN, detail=</span>
<span class="gd">-                    &#39;Invalid authentication credentials&#39;)</span>
<span class="gi">+                raise HTTPException(</span>
<span class="gi">+                    status_code=HTTP_403_FORBIDDEN,</span>
<span class="gi">+                    detail=&quot;Invalid authentication credentials&quot;,</span>
<span class="gi">+                )</span>
<span class="w"> </span>            else:
<span class="w"> </span>                return None
<span class="gd">-        return HTTPAuthorizationCredentials(scheme=scheme, credentials=</span>
<span class="gd">-            credentials)</span>
<span class="gi">+        return HTTPAuthorizationCredentials(scheme=scheme, credentials=credentials)</span>


<span class="w"> </span>class HTTPDigest(HTTPBase):
<span class="gu">@@ -298,20 +353,33 @@ class HTTPDigest(HTTPBase):</span>
<span class="w"> </span>    ```
<span class="w"> </span>    &quot;&quot;&quot;

<span class="gd">-    def __init__(self, *, scheme_name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        *,</span>
<span class="gi">+        scheme_name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Security scheme name.

<span class="w"> </span>                It will be included in the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Security scheme description.

<span class="w"> </span>                It will be included in the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, auto_error: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        auto_error: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                By default, if the HTTP Digest not provided, `HTTPDigest` will
<span class="w"> </span>                automatically cancel the request and send the client an error.

<span class="gu">@@ -325,23 +393,28 @@ class HTTPDigest(HTTPBase):</span>
<span class="w"> </span>                provided in one of multiple optional ways (for example, in HTTP
<span class="w"> </span>                Digest or in a cookie).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True):</span>
<span class="gd">-        self.model = HTTPBaseModel(scheme=&#39;digest&#39;, description=description)</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+    ):</span>
<span class="gi">+        self.model = HTTPBaseModel(scheme=&quot;digest&quot;, description=description)</span>
<span class="w"> </span>        self.scheme_name = scheme_name or self.__class__.__name__
<span class="w"> </span>        self.auto_error = auto_error

<span class="gd">-    async def __call__(self, request: Request) -&gt;Optional[</span>
<span class="gd">-        HTTPAuthorizationCredentials]:</span>
<span class="gd">-        authorization = request.headers.get(&#39;Authorization&#39;)</span>
<span class="gi">+    async def __call__(</span>
<span class="gi">+        self, request: Request</span>
<span class="gi">+    ) -&gt; Optional[HTTPAuthorizationCredentials]:</span>
<span class="gi">+        authorization = request.headers.get(&quot;Authorization&quot;)</span>
<span class="w"> </span>        scheme, credentials = get_authorization_scheme_param(authorization)
<span class="w"> </span>        if not (authorization and scheme and credentials):
<span class="w"> </span>            if self.auto_error:
<span class="gd">-                raise HTTPException(status_code=HTTP_403_FORBIDDEN, detail=</span>
<span class="gd">-                    &#39;Not authenticated&#39;)</span>
<span class="gi">+                raise HTTPException(</span>
<span class="gi">+                    status_code=HTTP_403_FORBIDDEN, detail=&quot;Not authenticated&quot;</span>
<span class="gi">+                )</span>
<span class="w"> </span>            else:
<span class="w"> </span>                return None
<span class="gd">-        if scheme.lower() != &#39;digest&#39;:</span>
<span class="gd">-            raise HTTPException(status_code=HTTP_403_FORBIDDEN, detail=</span>
<span class="gd">-                &#39;Invalid authentication credentials&#39;)</span>
<span class="gd">-        return HTTPAuthorizationCredentials(scheme=scheme, credentials=</span>
<span class="gd">-            credentials)</span>
<span class="gi">+        if scheme.lower() != &quot;digest&quot;:</span>
<span class="gi">+            raise HTTPException(</span>
<span class="gi">+                status_code=HTTP_403_FORBIDDEN,</span>
<span class="gi">+                detail=&quot;Invalid authentication credentials&quot;,</span>
<span class="gi">+            )</span>
<span class="gi">+        return HTTPAuthorizationCredentials(scheme=scheme, credentials=credentials)</span>
<span class="gh">diff --git a/fastapi/security/oauth2.py b/fastapi/security/oauth2.py</span>
<span class="gh">index cf99c823..9720cace 100644</span>
<span class="gd">--- a/fastapi/security/oauth2.py</span>
<span class="gi">+++ b/fastapi/security/oauth2.py</span>
<span class="gu">@@ -1,4 +1,5 @@</span>
<span class="w"> </span>from typing import Any, Dict, List, Optional, Union, cast
<span class="gi">+</span>
<span class="w"> </span>from fastapi.exceptions import HTTPException
<span class="w"> </span>from fastapi.openapi.models import OAuth2 as OAuth2Model
<span class="w"> </span>from fastapi.openapi.models import OAuthFlows as OAuthFlowsModel
<span class="gu">@@ -7,6 +8,8 @@ from fastapi.security.base import SecurityBase</span>
<span class="w"> </span>from fastapi.security.utils import get_authorization_scheme_param
<span class="w"> </span>from starlette.requests import Request
<span class="w"> </span>from starlette.status import HTTP_401_UNAUTHORIZED, HTTP_403_FORBIDDEN
<span class="gi">+</span>
<span class="gi">+# TODO: import from typing when deprecating Python 3.9</span>
<span class="w"> </span>from typing_extensions import Annotated, Doc


<span class="gu">@@ -55,26 +58,46 @@ class OAuth2PasswordRequestForm:</span>
<span class="w"> </span>    know that that it is application specific, it&#39;s not part of the specification.
<span class="w"> </span>    &quot;&quot;&quot;

<span class="gd">-    def __init__(self, *, grant_type: Annotated[Union[str, None], Form(</span>
<span class="gd">-        pattern=&#39;password&#39;), Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        *,</span>
<span class="gi">+        grant_type: Annotated[</span>
<span class="gi">+            Union[str, None],</span>
<span class="gi">+            Form(pattern=&quot;password&quot;),</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The OAuth2 spec says it is required and MUST be the fixed string
<span class="w"> </span>                &quot;password&quot;. Nevertheless, this dependency class is permissive and
<span class="w"> </span>                allows not passing it. If you want to enforce it, use instead the
<span class="w"> </span>                `OAuth2PasswordRequestFormStrict` dependency.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, username: Annotated[str, Form(), Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        username: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Form(),</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                `username` string. The OAuth2 spec requires the exact field name
<span class="w"> </span>                `username`.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], password: Annotated[str, Form(), Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        password: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Form(),</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                `password` string. The OAuth2 spec requires the exact field name
<span class="w"> </span>                `password&quot;.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], scope: Annotated[str, Form(), Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        scope: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Form(),</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A single string with actually several scopes separated by spaces. Each
<span class="w"> </span>                scope is also a string.

<span class="gu">@@ -92,20 +115,32 @@ class OAuth2PasswordRequestForm:</span>
<span class="w"> </span>                * `profile`
<span class="w"> </span>                * `openid`
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;&#39;, client_id: Annotated[Union[str, None], Form(), Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;&quot;,</span>
<span class="gi">+        client_id: Annotated[</span>
<span class="gi">+            Union[str, None],</span>
<span class="gi">+            Form(),</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                If there&#39;s a `client_id`, it can be sent as part of the form fields.
<span class="w"> </span>                But the OAuth2 specification recommends sending the `client_id` and
<span class="w"> </span>                `client_secret` (if any) using HTTP Basic auth.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, client_secret: Annotated[Union[str, None], Form(), Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        client_secret: Annotated[</span>
<span class="gi">+            Union[str, None],</span>
<span class="gi">+            Form(),</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                If there&#39;s a `client_password` (and a `client_id`), they can be sent
<span class="w"> </span>                as part of the form fields. But the OAuth2 specification recommends
<span class="w"> </span>                sending the `client_id` and `client_secret` (if any) using HTTP Basic
<span class="w"> </span>                auth.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None):</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+    ):</span>
<span class="w"> </span>        self.grant_type = grant_type
<span class="w"> </span>        self.username = username
<span class="w"> </span>        self.password = password
<span class="gu">@@ -178,26 +213,45 @@ class OAuth2PasswordRequestFormStrict(OAuth2PasswordRequestForm):</span>
<span class="w"> </span>        using HTTP Basic auth, as: client_id:client_secret
<span class="w"> </span>    &quot;&quot;&quot;

<span class="gd">-    def __init__(self, grant_type: Annotated[str, Form(pattern=&#39;password&#39;),</span>
<span class="gd">-        Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        grant_type: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Form(pattern=&quot;password&quot;),</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The OAuth2 spec says it is required and MUST be the fixed string
<span class="w"> </span>                &quot;password&quot;. This dependency is strict about it. If you want to be
<span class="w"> </span>                permissive, use instead the `OAuth2PasswordRequestForm` dependency
<span class="w"> </span>                class.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], username: Annotated[str, Form(), Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        username: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Form(),</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                `username` string. The OAuth2 spec requires the exact field name
<span class="w"> </span>                `username`.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], password: Annotated[str, Form(), Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        password: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Form(),</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                `password` string. The OAuth2 spec requires the exact field name
<span class="w"> </span>                `password&quot;.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], scope: Annotated[str, Form(), Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        scope: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Form(),</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                A single string with actually several scopes separated by spaces. Each
<span class="w"> </span>                scope is also a string.

<span class="gu">@@ -215,23 +269,40 @@ class OAuth2PasswordRequestFormStrict(OAuth2PasswordRequestForm):</span>
<span class="w"> </span>                * `profile`
<span class="w"> </span>                * `openid`
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=&#39;&#39;, client_id: Annotated[Union[str, None], Form(), Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot;&quot;,</span>
<span class="gi">+        client_id: Annotated[</span>
<span class="gi">+            Union[str, None],</span>
<span class="gi">+            Form(),</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                If there&#39;s a `client_id`, it can be sent as part of the form fields.
<span class="w"> </span>                But the OAuth2 specification recommends sending the `client_id` and
<span class="w"> </span>                `client_secret` (if any) using HTTP Basic auth.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, client_secret: Annotated[Union[str, None], Form(), Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        client_secret: Annotated[</span>
<span class="gi">+            Union[str, None],</span>
<span class="gi">+            Form(),</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                If there&#39;s a `client_password` (and a `client_id`), they can be sent
<span class="w"> </span>                as part of the form fields. But the OAuth2 specification recommends
<span class="w"> </span>                sending the `client_id` and `client_secret` (if any) using HTTP Basic
<span class="w"> </span>                auth.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None):</span>
<span class="gd">-        super().__init__(grant_type=grant_type, username=username, password</span>
<span class="gd">-            =password, scope=scope, client_id=client_id, client_secret=</span>
<span class="gd">-            client_secret)</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+    ):</span>
<span class="gi">+        super().__init__(</span>
<span class="gi">+            grant_type=grant_type,</span>
<span class="gi">+            username=username,</span>
<span class="gi">+            password=password,</span>
<span class="gi">+            scope=scope,</span>
<span class="gi">+            client_id=client_id,</span>
<span class="gi">+            client_secret=client_secret,</span>
<span class="gi">+        )</span>


<span class="w"> </span>class OAuth2(SecurityBase):
<span class="gu">@@ -247,25 +318,41 @@ class OAuth2(SecurityBase):</span>
<span class="w"> </span>    [FastAPI docs for Security](https://fastapi.tiangolo.com/tutorial/security/).
<span class="w"> </span>    &quot;&quot;&quot;

<span class="gd">-    def __init__(self, *, flows: Annotated[Union[OAuthFlowsModel, Dict[str,</span>
<span class="gd">-        Dict[str, Any]]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        *,</span>
<span class="gi">+        flows: Annotated[</span>
<span class="gi">+            Union[OAuthFlowsModel, Dict[str, Dict[str, Any]]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The dictionary of OAuth2 flows.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=OAuthFlowsModel(), scheme_name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = OAuthFlowsModel(),</span>
<span class="gi">+        scheme_name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Security scheme name.

<span class="w"> </span>                It will be included in the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Security scheme description.

<span class="w"> </span>                It will be included in the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, auto_error: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        auto_error: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                By default, if no HTTP Authorization header is provided, required for
<span class="w"> </span>                OAuth2 authentication, it will automatically cancel the request and
<span class="w"> </span>                send the client an error.
<span class="gu">@@ -280,18 +367,22 @@ class OAuth2(SecurityBase):</span>
<span class="w"> </span>                provided in one of multiple optional ways (for example, with OAuth2
<span class="w"> </span>                or in a cookie).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True):</span>
<span class="gd">-        self.model = OAuth2Model(flows=cast(OAuthFlowsModel, flows),</span>
<span class="gd">-            description=description)</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+    ):</span>
<span class="gi">+        self.model = OAuth2Model(</span>
<span class="gi">+            flows=cast(OAuthFlowsModel, flows), description=description</span>
<span class="gi">+        )</span>
<span class="w"> </span>        self.scheme_name = scheme_name or self.__class__.__name__
<span class="w"> </span>        self.auto_error = auto_error

<span class="gd">-    async def __call__(self, request: Request) -&gt;Optional[str]:</span>
<span class="gd">-        authorization = request.headers.get(&#39;Authorization&#39;)</span>
<span class="gi">+    async def __call__(self, request: Request) -&gt; Optional[str]:</span>
<span class="gi">+        authorization = request.headers.get(&quot;Authorization&quot;)</span>
<span class="w"> </span>        if not authorization:
<span class="w"> </span>            if self.auto_error:
<span class="gd">-                raise HTTPException(status_code=HTTP_403_FORBIDDEN, detail=</span>
<span class="gd">-                    &#39;Not authenticated&#39;)</span>
<span class="gi">+                raise HTTPException(</span>
<span class="gi">+                    status_code=HTTP_403_FORBIDDEN, detail=&quot;Not authenticated&quot;</span>
<span class="gi">+                )</span>
<span class="w"> </span>            else:
<span class="w"> </span>                return None
<span class="w"> </span>        return authorization
<span class="gu">@@ -306,30 +397,50 @@ class OAuth2PasswordBearer(OAuth2):</span>
<span class="w"> </span>    [FastAPI docs for Simple OAuth2 with Password and Bearer](https://fastapi.tiangolo.com/tutorial/security/simple-oauth2/).
<span class="w"> </span>    &quot;&quot;&quot;

<span class="gd">-    def __init__(self, tokenUrl: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        tokenUrl: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The URL to obtain the OAuth2 token. This would be the *path operation*
<span class="w"> </span>                that has `OAuth2PasswordRequestForm` as a dependency.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], scheme_name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        scheme_name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Security scheme name.

<span class="w"> </span>                It will be included in the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, scopes: Annotated[Optional[Dict[str, str]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        scopes: Annotated[</span>
<span class="gi">+            Optional[Dict[str, str]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The OAuth2 scopes that would be required by the *path operations* that
<span class="w"> </span>                use this dependency.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Security scheme description.

<span class="w"> </span>                It will be included in the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, auto_error: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        auto_error: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                By default, if no HTTP Authorization header is provided, required for
<span class="w"> </span>                OAuth2 authentication, it will automatically cancel the request and
<span class="w"> </span>                send the client an error.
<span class="gu">@@ -344,22 +455,31 @@ class OAuth2PasswordBearer(OAuth2):</span>
<span class="w"> </span>                provided in one of multiple optional ways (for example, with OAuth2
<span class="w"> </span>                or in a cookie).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True):</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+    ):</span>
<span class="w"> </span>        if not scopes:
<span class="w"> </span>            scopes = {}
<span class="gd">-        flows = OAuthFlowsModel(password=cast(Any, {&#39;tokenUrl&#39;: tokenUrl,</span>
<span class="gd">-            &#39;scopes&#39;: scopes}))</span>
<span class="gd">-        super().__init__(flows=flows, scheme_name=scheme_name, description=</span>
<span class="gd">-            description, auto_error=auto_error)</span>
<span class="gd">-</span>
<span class="gd">-    async def __call__(self, request: Request) -&gt;Optional[str]:</span>
<span class="gd">-        authorization = request.headers.get(&#39;Authorization&#39;)</span>
<span class="gi">+        flows = OAuthFlowsModel(</span>
<span class="gi">+            password=cast(Any, {&quot;tokenUrl&quot;: tokenUrl, &quot;scopes&quot;: scopes})</span>
<span class="gi">+        )</span>
<span class="gi">+        super().__init__(</span>
<span class="gi">+            flows=flows,</span>
<span class="gi">+            scheme_name=scheme_name,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            auto_error=auto_error,</span>
<span class="gi">+        )</span>
<span class="gi">+</span>
<span class="gi">+    async def __call__(self, request: Request) -&gt; Optional[str]:</span>
<span class="gi">+        authorization = request.headers.get(&quot;Authorization&quot;)</span>
<span class="w"> </span>        scheme, param = get_authorization_scheme_param(authorization)
<span class="gd">-        if not authorization or scheme.lower() != &#39;bearer&#39;:</span>
<span class="gi">+        if not authorization or scheme.lower() != &quot;bearer&quot;:</span>
<span class="w"> </span>            if self.auto_error:
<span class="gd">-                raise HTTPException(status_code=HTTP_401_UNAUTHORIZED,</span>
<span class="gd">-                    detail=&#39;Not authenticated&#39;, headers={&#39;WWW-Authenticate&#39;:</span>
<span class="gd">-                    &#39;Bearer&#39;})</span>
<span class="gi">+                raise HTTPException(</span>
<span class="gi">+                    status_code=HTTP_401_UNAUTHORIZED,</span>
<span class="gi">+                    detail=&quot;Not authenticated&quot;,</span>
<span class="gi">+                    headers={&quot;WWW-Authenticate&quot;: &quot;Bearer&quot;},</span>
<span class="gi">+                )</span>
<span class="w"> </span>            else:
<span class="w"> </span>                return None
<span class="w"> </span>        return param
<span class="gu">@@ -371,33 +491,58 @@ class OAuth2AuthorizationCodeBearer(OAuth2):</span>
<span class="w"> </span>    flow. An instance of it would be used as a dependency.
<span class="w"> </span>    &quot;&quot;&quot;

<span class="gd">-    def __init__(self, authorizationUrl: str, tokenUrl: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        authorizationUrl: str,</span>
<span class="gi">+        tokenUrl: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The URL to obtain the OAuth2 token.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )], refreshUrl: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        refreshUrl: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The URL to refresh the token and obtain a new one.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, scheme_name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        scheme_name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Security scheme name.

<span class="w"> </span>                It will be included in the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, scopes: Annotated[Optional[Dict[str, str]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        scopes: Annotated[</span>
<span class="gi">+            Optional[Dict[str, str]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The OAuth2 scopes that would be required by the *path operations* that
<span class="w"> </span>                use this dependency.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Security scheme description.

<span class="w"> </span>                It will be included in the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, auto_error: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        auto_error: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                By default, if no HTTP Authorization header is provided, required for
<span class="w"> </span>                OAuth2 authentication, it will automatically cancel the request and
<span class="w"> </span>                send the client an error.
<span class="gu">@@ -412,25 +557,41 @@ class OAuth2AuthorizationCodeBearer(OAuth2):</span>
<span class="w"> </span>                provided in one of multiple optional ways (for example, with OAuth2
<span class="w"> </span>                or in a cookie).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True):</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+    ):</span>
<span class="w"> </span>        if not scopes:
<span class="w"> </span>            scopes = {}
<span class="gd">-        flows = OAuthFlowsModel(authorizationCode=cast(Any, {</span>
<span class="gd">-            &#39;authorizationUrl&#39;: authorizationUrl, &#39;tokenUrl&#39;: tokenUrl,</span>
<span class="gd">-            &#39;refreshUrl&#39;: refreshUrl, &#39;scopes&#39;: scopes}))</span>
<span class="gd">-        super().__init__(flows=flows, scheme_name=scheme_name, description=</span>
<span class="gd">-            description, auto_error=auto_error)</span>
<span class="gd">-</span>
<span class="gd">-    async def __call__(self, request: Request) -&gt;Optional[str]:</span>
<span class="gd">-        authorization = request.headers.get(&#39;Authorization&#39;)</span>
<span class="gi">+        flows = OAuthFlowsModel(</span>
<span class="gi">+            authorizationCode=cast(</span>
<span class="gi">+                Any,</span>
<span class="gi">+                {</span>
<span class="gi">+                    &quot;authorizationUrl&quot;: authorizationUrl,</span>
<span class="gi">+                    &quot;tokenUrl&quot;: tokenUrl,</span>
<span class="gi">+                    &quot;refreshUrl&quot;: refreshUrl,</span>
<span class="gi">+                    &quot;scopes&quot;: scopes,</span>
<span class="gi">+                },</span>
<span class="gi">+            )</span>
<span class="gi">+        )</span>
<span class="gi">+        super().__init__(</span>
<span class="gi">+            flows=flows,</span>
<span class="gi">+            scheme_name=scheme_name,</span>
<span class="gi">+            description=description,</span>
<span class="gi">+            auto_error=auto_error,</span>
<span class="gi">+        )</span>
<span class="gi">+</span>
<span class="gi">+    async def __call__(self, request: Request) -&gt; Optional[str]:</span>
<span class="gi">+        authorization = request.headers.get(&quot;Authorization&quot;)</span>
<span class="w"> </span>        scheme, param = get_authorization_scheme_param(authorization)
<span class="gd">-        if not authorization or scheme.lower() != &#39;bearer&#39;:</span>
<span class="gi">+        if not authorization or scheme.lower() != &quot;bearer&quot;:</span>
<span class="w"> </span>            if self.auto_error:
<span class="gd">-                raise HTTPException(status_code=HTTP_401_UNAUTHORIZED,</span>
<span class="gd">-                    detail=&#39;Not authenticated&#39;, headers={&#39;WWW-Authenticate&#39;:</span>
<span class="gd">-                    &#39;Bearer&#39;})</span>
<span class="gi">+                raise HTTPException(</span>
<span class="gi">+                    status_code=HTTP_401_UNAUTHORIZED,</span>
<span class="gi">+                    detail=&quot;Not authenticated&quot;,</span>
<span class="gi">+                    headers={&quot;WWW-Authenticate&quot;: &quot;Bearer&quot;},</span>
<span class="gi">+                )</span>
<span class="w"> </span>            else:
<span class="gd">-                return None</span>
<span class="gi">+                return None  # pragma: nocover</span>
<span class="w"> </span>        return param


<span class="gu">@@ -447,19 +608,31 @@ class SecurityScopes:</span>
<span class="w"> </span>    [FastAPI docs for OAuth2 scopes](https://fastapi.tiangolo.com/advanced/security/oauth2-scopes/).
<span class="w"> </span>    &quot;&quot;&quot;

<span class="gd">-    def __init__(self, scopes: Annotated[Optional[List[str]], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        scopes: Annotated[</span>
<span class="gi">+            Optional[List[str]],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                This will be filled by FastAPI.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None):</span>
<span class="gd">-        self.scopes: Annotated[List[str], Doc(</span>
<span class="gd">-            &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+    ):</span>
<span class="gi">+        self.scopes: Annotated[</span>
<span class="gi">+            List[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                The list of all the scopes required by dependencies.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-            )] = scopes or []</span>
<span class="gd">-        self.scope_str: Annotated[str, Doc(</span>
<span class="gd">-            &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = scopes or []</span>
<span class="gi">+        self.scope_str: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                All the scopes required by all the dependencies in a single string
<span class="w"> </span>                separated by spaces, as defined in the OAuth2 specification.
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-            )] = &#39; &#39;.join(self.scopes)</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = &quot; &quot;.join(self.scopes)</span>
<span class="gh">diff --git a/fastapi/security/open_id_connect_url.py b/fastapi/security/open_id_connect_url.py</span>
<span class="gh">index 0df340e6..c8cceb91 100644</span>
<span class="gd">--- a/fastapi/security/open_id_connect_url.py</span>
<span class="gi">+++ b/fastapi/security/open_id_connect_url.py</span>
<span class="gu">@@ -1,4 +1,5 @@</span>
<span class="w"> </span>from typing import Optional
<span class="gi">+</span>
<span class="w"> </span>from fastapi.openapi.models import OpenIdConnect as OpenIdConnectModel
<span class="w"> </span>from fastapi.security.base import SecurityBase
<span class="w"> </span>from starlette.exceptions import HTTPException
<span class="gu">@@ -13,24 +14,41 @@ class OpenIdConnect(SecurityBase):</span>
<span class="w"> </span>    dependency.
<span class="w"> </span>    &quot;&quot;&quot;

<span class="gd">-    def __init__(self, *, openIdConnectUrl: Annotated[str, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+    def __init__(</span>
<span class="gi">+        self,</span>
<span class="gi">+        *,</span>
<span class="gi">+        openIdConnectUrl: Annotated[</span>
<span class="gi">+            str,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>            The OpenID Connect URL.
<span class="gd">-            &quot;&quot;&quot;)],</span>
<span class="gd">-        scheme_name: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ],</span>
<span class="gi">+        scheme_name: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Security scheme name.

<span class="w"> </span>                It will be included in the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, description: Annotated[Optional[str], Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        description: Annotated[</span>
<span class="gi">+            Optional[str],</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                Security scheme description.

<span class="w"> </span>                It will be included in the generated OpenAPI (e.g. visible at `/docs`).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=None, auto_error: Annotated[bool, Doc(</span>
<span class="gd">-        &quot;&quot;&quot;</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = None,</span>
<span class="gi">+        auto_error: Annotated[</span>
<span class="gi">+            bool,</span>
<span class="gi">+            Doc(</span>
<span class="gi">+                &quot;&quot;&quot;</span>
<span class="w"> </span>                By default, if no HTTP Authorization header is provided, required for
<span class="w"> </span>                OpenID Connect authentication, it will automatically cancel the request
<span class="w"> </span>                and send the client an error.
<span class="gu">@@ -45,18 +63,22 @@ class OpenIdConnect(SecurityBase):</span>
<span class="w"> </span>                provided in one of multiple optional ways (for example, with OpenID
<span class="w"> </span>                Connect or in a cookie).
<span class="w"> </span>                &quot;&quot;&quot;
<span class="gd">-        )]=True):</span>
<span class="gd">-        self.model = OpenIdConnectModel(openIdConnectUrl=openIdConnectUrl,</span>
<span class="gd">-            description=description)</span>
<span class="gi">+            ),</span>
<span class="gi">+        ] = True,</span>
<span class="gi">+    ):</span>
<span class="gi">+        self.model = OpenIdConnectModel(</span>
<span class="gi">+            openIdConnectUrl=openIdConnectUrl, description=description</span>
<span class="gi">+        )</span>
<span class="w"> </span>        self.scheme_name = scheme_name or self.__class__.__name__
<span class="w"> </span>        self.auto_error = auto_error

<span class="gd">-    async def __call__(self, request: Request) -&gt;Optional[str]:</span>
<span class="gd">-        authorization = request.headers.get(&#39;Authorization&#39;)</span>
<span class="gi">+    async def __call__(self, request: Request) -&gt; Optional[str]:</span>
<span class="gi">+        authorization = request.headers.get(&quot;Authorization&quot;)</span>
<span class="w"> </span>        if not authorization:
<span class="w"> </span>            if self.auto_error:
<span class="gd">-                raise HTTPException(status_code=HTTP_403_FORBIDDEN, detail=</span>
<span class="gd">-                    &#39;Not authenticated&#39;)</span>
<span class="gi">+                raise HTTPException(</span>
<span class="gi">+                    status_code=HTTP_403_FORBIDDEN, detail=&quot;Not authenticated&quot;</span>
<span class="gi">+                )</span>
<span class="w"> </span>            else:
<span class="w"> </span>                return None
<span class="w"> </span>        return authorization
<span class="gh">diff --git a/fastapi/security/utils.py b/fastapi/security/utils.py</span>
<span class="gh">index 8d6471c1..fa7a450b 100644</span>
<span class="gd">--- a/fastapi/security/utils.py</span>
<span class="gi">+++ b/fastapi/security/utils.py</span>
<span class="gu">@@ -1 +1,10 @@</span>
<span class="w"> </span>from typing import Optional, Tuple
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def get_authorization_scheme_param(</span>
<span class="gi">+    authorization_header_value: Optional[str],</span>
<span class="gi">+) -&gt; Tuple[str, str]:</span>
<span class="gi">+    if not authorization_header_value:</span>
<span class="gi">+        return &quot;&quot;, &quot;&quot;</span>
<span class="gi">+    scheme, _, param = authorization_header_value.partition(&quot; &quot;)</span>
<span class="gi">+    return scheme, param</span>
<span class="gh">diff --git a/fastapi/staticfiles.py b/fastapi/staticfiles.py</span>
<span class="gh">index c2a29a70..299015d4 100644</span>
<span class="gd">--- a/fastapi/staticfiles.py</span>
<span class="gi">+++ b/fastapi/staticfiles.py</span>
<span class="gu">@@ -1 +1 @@</span>
<span class="gd">-from starlette.staticfiles import StaticFiles as StaticFiles</span>
<span class="gi">+from starlette.staticfiles import StaticFiles as StaticFiles  # noqa</span>
<span class="gh">diff --git a/fastapi/templating.py b/fastapi/templating.py</span>
<span class="gh">index 9070b3a7..0cb86848 100644</span>
<span class="gd">--- a/fastapi/templating.py</span>
<span class="gi">+++ b/fastapi/templating.py</span>
<span class="gu">@@ -1 +1 @@</span>
<span class="gd">-from starlette.templating import Jinja2Templates as Jinja2Templates</span>
<span class="gi">+from starlette.templating import Jinja2Templates as Jinja2Templates  # noqa</span>
<span class="gh">diff --git a/fastapi/testclient.py b/fastapi/testclient.py</span>
<span class="gh">index 8005456e..4012406a 100644</span>
<span class="gd">--- a/fastapi/testclient.py</span>
<span class="gi">+++ b/fastapi/testclient.py</span>
<span class="gu">@@ -1 +1 @@</span>
<span class="gd">-from starlette.testclient import TestClient as TestClient</span>
<span class="gi">+from starlette.testclient import TestClient as TestClient  # noqa</span>
<span class="gh">diff --git a/fastapi/types.py b/fastapi/types.py</span>
<span class="gh">index 5efdb0b3..3205654c 100644</span>
<span class="gd">--- a/fastapi/types.py</span>
<span class="gi">+++ b/fastapi/types.py</span>
<span class="gu">@@ -1,8 +1,10 @@</span>
<span class="w"> </span>import types
<span class="w"> </span>from enum import Enum
<span class="w"> </span>from typing import Any, Callable, Dict, Set, Type, TypeVar, Union
<span class="gi">+</span>
<span class="w"> </span>from pydantic import BaseModel
<span class="gd">-DecoratedCallable = TypeVar(&#39;DecoratedCallable&#39;, bound=Callable[..., Any])</span>
<span class="gd">-UnionType = getattr(types, &#39;UnionType&#39;, Union)</span>
<span class="gi">+</span>
<span class="gi">+DecoratedCallable = TypeVar(&quot;DecoratedCallable&quot;, bound=Callable[..., Any])</span>
<span class="gi">+UnionType = getattr(types, &quot;UnionType&quot;, Union)</span>
<span class="w"> </span>ModelNameMap = Dict[Union[Type[BaseModel], Type[Enum]], str]
<span class="w"> </span>IncEx = Union[Set[int], Set[str], Dict[int, Any], Dict[str, Any]]
<span class="gh">diff --git a/fastapi/utils.py b/fastapi/utils.py</span>
<span class="gh">index a742b860..dfda4e67 100644</span>
<span class="gd">--- a/fastapi/utils.py</span>
<span class="gi">+++ b/fastapi/utils.py</span>
<span class="gu">@@ -1,35 +1,214 @@</span>
<span class="w"> </span>import re
<span class="w"> </span>import warnings
<span class="w"> </span>from dataclasses import is_dataclass
<span class="gd">-from typing import TYPE_CHECKING, Any, Dict, MutableMapping, Optional, Set, Type, Union, cast</span>
<span class="gi">+from typing import (</span>
<span class="gi">+    TYPE_CHECKING,</span>
<span class="gi">+    Any,</span>
<span class="gi">+    Dict,</span>
<span class="gi">+    MutableMapping,</span>
<span class="gi">+    Optional,</span>
<span class="gi">+    Set,</span>
<span class="gi">+    Type,</span>
<span class="gi">+    Union,</span>
<span class="gi">+    cast,</span>
<span class="gi">+)</span>
<span class="w"> </span>from weakref import WeakKeyDictionary
<span class="gi">+</span>
<span class="w"> </span>import fastapi
<span class="gd">-from fastapi._compat import PYDANTIC_V2, BaseConfig, ModelField, PydanticSchemaGenerationError, Undefined, UndefinedType, Validator, lenient_issubclass</span>
<span class="gi">+from fastapi._compat import (</span>
<span class="gi">+    PYDANTIC_V2,</span>
<span class="gi">+    BaseConfig,</span>
<span class="gi">+    ModelField,</span>
<span class="gi">+    PydanticSchemaGenerationError,</span>
<span class="gi">+    Undefined,</span>
<span class="gi">+    UndefinedType,</span>
<span class="gi">+    Validator,</span>
<span class="gi">+    lenient_issubclass,</span>
<span class="gi">+)</span>
<span class="w"> </span>from fastapi.datastructures import DefaultPlaceholder, DefaultType
<span class="w"> </span>from pydantic import BaseModel, create_model
<span class="w"> </span>from pydantic.fields import FieldInfo
<span class="w"> </span>from typing_extensions import Literal
<span class="gd">-if TYPE_CHECKING:</span>
<span class="gi">+</span>
<span class="gi">+if TYPE_CHECKING:  # pragma: nocover</span>
<span class="w"> </span>    from .routing import APIRoute
<span class="gd">-_CLONED_TYPES_CACHE: MutableMapping[Type[BaseModel], Type[BaseModel]</span>
<span class="gd">-    ] = WeakKeyDictionary()</span>

<span class="gi">+# Cache for `create_cloned_field`</span>
<span class="gi">+_CLONED_TYPES_CACHE: MutableMapping[</span>
<span class="gi">+    Type[BaseModel], Type[BaseModel]</span>
<span class="gi">+] = WeakKeyDictionary()</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def is_body_allowed_for_status_code(status_code: Union[int, str, None]) -&gt; bool:</span>
<span class="gi">+    if status_code is None:</span>
<span class="gi">+        return True</span>
<span class="gi">+    # Ref: https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.1.0.md#patterned-fields-1</span>
<span class="gi">+    if status_code in {</span>
<span class="gi">+        &quot;default&quot;,</span>
<span class="gi">+        &quot;1XX&quot;,</span>
<span class="gi">+        &quot;2XX&quot;,</span>
<span class="gi">+        &quot;3XX&quot;,</span>
<span class="gi">+        &quot;4XX&quot;,</span>
<span class="gi">+        &quot;5XX&quot;,</span>
<span class="gi">+    }:</span>
<span class="gi">+        return True</span>
<span class="gi">+    current_status_code = int(status_code)</span>
<span class="gi">+    return not (current_status_code &lt; 200 or current_status_code in {204, 205, 304})</span>

<span class="gd">-def create_response_field(name: str, type_: Type[Any], class_validators:</span>
<span class="gd">-    Optional[Dict[str, Validator]]=None, default: Optional[Any]=Undefined,</span>
<span class="gd">-    required: Union[bool, UndefinedType]=Undefined, model_config: Type[</span>
<span class="gd">-    BaseConfig]=BaseConfig, field_info: Optional[FieldInfo]=None, alias:</span>
<span class="gd">-    Optional[str]=None, mode: Literal[&#39;validation&#39;, &#39;serialization&#39;]=</span>
<span class="gd">-    &#39;validation&#39;) -&gt;ModelField:</span>
<span class="gi">+</span>
<span class="gi">+def get_path_param_names(path: str) -&gt; Set[str]:</span>
<span class="gi">+    return set(re.findall(&quot;{(.*?)}&quot;, path))</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def create_response_field(</span>
<span class="gi">+    name: str,</span>
<span class="gi">+    type_: Type[Any],</span>
<span class="gi">+    class_validators: Optional[Dict[str, Validator]] = None,</span>
<span class="gi">+    default: Optional[Any] = Undefined,</span>
<span class="gi">+    required: Union[bool, UndefinedType] = Undefined,</span>
<span class="gi">+    model_config: Type[BaseConfig] = BaseConfig,</span>
<span class="gi">+    field_info: Optional[FieldInfo] = None,</span>
<span class="gi">+    alias: Optional[str] = None,</span>
<span class="gi">+    mode: Literal[&quot;validation&quot;, &quot;serialization&quot;] = &quot;validation&quot;,</span>
<span class="gi">+) -&gt; ModelField:</span>
<span class="w"> </span>    &quot;&quot;&quot;
<span class="w"> </span>    Create a new response field. Raises if type_ is invalid.
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    class_validators = class_validators or {}</span>
<span class="gi">+    if PYDANTIC_V2:</span>
<span class="gi">+        field_info = field_info or FieldInfo(</span>
<span class="gi">+            annotation=type_, default=default, alias=alias</span>
<span class="gi">+        )</span>
<span class="gi">+    else:</span>
<span class="gi">+        field_info = field_info or FieldInfo()</span>
<span class="gi">+    kwargs = {&quot;name&quot;: name, &quot;field_info&quot;: field_info}</span>
<span class="gi">+    if PYDANTIC_V2:</span>
<span class="gi">+        kwargs.update({&quot;mode&quot;: mode})</span>
<span class="gi">+    else:</span>
<span class="gi">+        kwargs.update(</span>
<span class="gi">+            {</span>
<span class="gi">+                &quot;type_&quot;: type_,</span>
<span class="gi">+                &quot;class_validators&quot;: class_validators,</span>
<span class="gi">+                &quot;default&quot;: default,</span>
<span class="gi">+                &quot;required&quot;: required,</span>
<span class="gi">+                &quot;model_config&quot;: model_config,</span>
<span class="gi">+                &quot;alias&quot;: alias,</span>
<span class="gi">+            }</span>
<span class="gi">+        )</span>
<span class="gi">+    try:</span>
<span class="gi">+        return ModelField(**kwargs)  # type: ignore[arg-type]</span>
<span class="gi">+    except (RuntimeError, PydanticSchemaGenerationError):</span>
<span class="gi">+        raise fastapi.exceptions.FastAPIError(</span>
<span class="gi">+            &quot;Invalid args for response field! Hint: &quot;</span>
<span class="gi">+            f&quot;check that {type_} is a valid Pydantic field type. &quot;</span>
<span class="gi">+            &quot;If you are using a return type annotation that is not a valid Pydantic &quot;</span>
<span class="gi">+            &quot;field (e.g. Union[Response, dict, None]) you can disable generating the &quot;</span>
<span class="gi">+            &quot;response model from the type annotation with the path operation decorator &quot;</span>
<span class="gi">+            &quot;parameter response_model=None. Read more: &quot;</span>
<span class="gi">+            &quot;https://fastapi.tiangolo.com/tutorial/response-model/&quot;</span>
<span class="gi">+        ) from None</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def create_cloned_field(</span>
<span class="gi">+    field: ModelField,</span>
<span class="gi">+    *,</span>
<span class="gi">+    cloned_types: Optional[MutableMapping[Type[BaseModel], Type[BaseModel]]] = None,</span>
<span class="gi">+) -&gt; ModelField:</span>
<span class="gi">+    if PYDANTIC_V2:</span>
<span class="gi">+        return field</span>
<span class="gi">+    # cloned_types caches already cloned types to support recursive models and improve</span>
<span class="gi">+    # performance by avoiding unnecessary cloning</span>
<span class="gi">+    if cloned_types is None:</span>
<span class="gi">+        cloned_types = _CLONED_TYPES_CACHE</span>
<span class="gi">+</span>
<span class="gi">+    original_type = field.type_</span>
<span class="gi">+    if is_dataclass(original_type) and hasattr(original_type, &quot;__pydantic_model__&quot;):</span>
<span class="gi">+        original_type = original_type.__pydantic_model__</span>
<span class="gi">+    use_type = original_type</span>
<span class="gi">+    if lenient_issubclass(original_type, BaseModel):</span>
<span class="gi">+        original_type = cast(Type[BaseModel], original_type)</span>
<span class="gi">+        use_type = cloned_types.get(original_type)</span>
<span class="gi">+        if use_type is None:</span>
<span class="gi">+            use_type = create_model(original_type.__name__, __base__=original_type)</span>
<span class="gi">+            cloned_types[original_type] = use_type</span>
<span class="gi">+            for f in original_type.__fields__.values():</span>
<span class="gi">+                use_type.__fields__[f.name] = create_cloned_field(</span>
<span class="gi">+                    f, cloned_types=cloned_types</span>
<span class="gi">+                )</span>
<span class="gi">+    new_field = create_response_field(name=field.name, type_=use_type)</span>
<span class="gi">+    new_field.has_alias = field.has_alias  # type: ignore[attr-defined]</span>
<span class="gi">+    new_field.alias = field.alias  # type: ignore[misc]</span>
<span class="gi">+    new_field.class_validators = field.class_validators  # type: ignore[attr-defined]</span>
<span class="gi">+    new_field.default = field.default  # type: ignore[misc]</span>
<span class="gi">+    new_field.required = field.required  # type: ignore[misc]</span>
<span class="gi">+    new_field.model_config = field.model_config  # type: ignore[attr-defined]</span>
<span class="gi">+    new_field.field_info = field.field_info</span>
<span class="gi">+    new_field.allow_none = field.allow_none  # type: ignore[attr-defined]</span>
<span class="gi">+    new_field.validate_always = field.validate_always  # type: ignore[attr-defined]</span>
<span class="gi">+    if field.sub_fields:  # type: ignore[attr-defined]</span>
<span class="gi">+        new_field.sub_fields = [  # type: ignore[attr-defined]</span>
<span class="gi">+            create_cloned_field(sub_field, cloned_types=cloned_types)</span>
<span class="gi">+            for sub_field in field.sub_fields  # type: ignore[attr-defined]</span>
<span class="gi">+        ]</span>
<span class="gi">+    if field.key_field:  # type: ignore[attr-defined]</span>
<span class="gi">+        new_field.key_field = create_cloned_field(  # type: ignore[attr-defined]</span>
<span class="gi">+            field.key_field,  # type: ignore[attr-defined]</span>
<span class="gi">+            cloned_types=cloned_types,</span>
<span class="gi">+        )</span>
<span class="gi">+    new_field.validators = field.validators  # type: ignore[attr-defined]</span>
<span class="gi">+    new_field.pre_validators = field.pre_validators  # type: ignore[attr-defined]</span>
<span class="gi">+    new_field.post_validators = field.post_validators  # type: ignore[attr-defined]</span>
<span class="gi">+    new_field.parse_json = field.parse_json  # type: ignore[attr-defined]</span>
<span class="gi">+    new_field.shape = field.shape  # type: ignore[attr-defined]</span>
<span class="gi">+    new_field.populate_validators()  # type: ignore[attr-defined]</span>
<span class="gi">+    return new_field</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def generate_operation_id_for_path(</span>
<span class="gi">+    *, name: str, path: str, method: str</span>
<span class="gi">+) -&gt; str:  # pragma: nocover</span>
<span class="gi">+    warnings.warn(</span>
<span class="gi">+        &quot;fastapi.utils.generate_operation_id_for_path() was deprecated, &quot;</span>
<span class="gi">+        &quot;it is not used internally, and will be removed soon&quot;,</span>
<span class="gi">+        DeprecationWarning,</span>
<span class="gi">+        stacklevel=2,</span>
<span class="gi">+    )</span>
<span class="gi">+    operation_id = f&quot;{name}{path}&quot;</span>
<span class="gi">+    operation_id = re.sub(r&quot;\W&quot;, &quot;_&quot;, operation_id)</span>
<span class="gi">+    operation_id = f&quot;{operation_id}_{method.lower()}&quot;</span>
<span class="gi">+    return operation_id</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def generate_unique_id(route: &quot;APIRoute&quot;) -&gt; str:</span>
<span class="gi">+    operation_id = f&quot;{route.name}{route.path_format}&quot;</span>
<span class="gi">+    operation_id = re.sub(r&quot;\W&quot;, &quot;_&quot;, operation_id)</span>
<span class="gi">+    assert route.methods</span>
<span class="gi">+    operation_id = f&quot;{operation_id}_{list(route.methods)[0].lower()}&quot;</span>
<span class="gi">+    return operation_id</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+def deep_dict_update(main_dict: Dict[Any, Any], update_dict: Dict[Any, Any]) -&gt; None:</span>
<span class="gi">+    for key, value in update_dict.items():</span>
<span class="gi">+        if (</span>
<span class="gi">+            key in main_dict</span>
<span class="gi">+            and isinstance(main_dict[key], dict)</span>
<span class="gi">+            and isinstance(value, dict)</span>
<span class="gi">+        ):</span>
<span class="gi">+            deep_dict_update(main_dict[key], value)</span>
<span class="gi">+        elif (</span>
<span class="gi">+            key in main_dict</span>
<span class="gi">+            and isinstance(main_dict[key], list)</span>
<span class="gi">+            and isinstance(update_dict[key], list)</span>
<span class="gi">+        ):</span>
<span class="gi">+            main_dict[key] = main_dict[key] + update_dict[key]</span>
<span class="gi">+        else:</span>
<span class="gi">+            main_dict[key] = value</span>


<span class="gd">-def get_value_or_default(first_item: Union[DefaultPlaceholder, DefaultType],</span>
<span class="gd">-    *extra_items: Union[DefaultPlaceholder, DefaultType]) -&gt;Union[</span>
<span class="gd">-    DefaultPlaceholder, DefaultType]:</span>
<span class="gi">+def get_value_or_default(</span>
<span class="gi">+    first_item: Union[DefaultPlaceholder, DefaultType],</span>
<span class="gi">+    *extra_items: Union[DefaultPlaceholder, DefaultType],</span>
<span class="gi">+) -&gt; Union[DefaultPlaceholder, DefaultType]:</span>
<span class="w"> </span>    &quot;&quot;&quot;
<span class="w"> </span>    Pass items or `DefaultPlaceholder`s by descending priority.

<span class="gu">@@ -37,4 +216,8 @@ def get_value_or_default(first_item: Union[DefaultPlaceholder, DefaultType],</span>

<span class="w"> </span>    Otherwise, the first item (a `DefaultPlaceholder`) will be returned.
<span class="w"> </span>    &quot;&quot;&quot;
<span class="gd">-    pass</span>
<span class="gi">+    items = (first_item,) + extra_items</span>
<span class="gi">+    for item in items:</span>
<span class="gi">+        if not isinstance(item, DefaultPlaceholder):</span>
<span class="gi">+            return item</span>
<span class="gi">+    return first_item</span>
<span class="gh">diff --git a/fastapi/websockets.py b/fastapi/websockets.py</span>
<span class="gh">index b246ce86..55a4ac4a 100644</span>
<span class="gd">--- a/fastapi/websockets.py</span>
<span class="gi">+++ b/fastapi/websockets.py</span>
<span class="gu">@@ -1,3 +1,3 @@</span>
<span class="gd">-from starlette.websockets import WebSocket as WebSocket</span>
<span class="gd">-from starlette.websockets import WebSocketDisconnect as WebSocketDisconnect</span>
<span class="gd">-from starlette.websockets import WebSocketState as WebSocketState</span>
<span class="gi">+from starlette.websockets import WebSocket as WebSocket  # noqa</span>
<span class="gi">+from starlette.websockets import WebSocketDisconnect as WebSocketDisconnect  # noqa</span>
<span class="gi">+from starlette.websockets import WebSocketState as WebSocketState  # noqa</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d6f25eb3.min.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../javascripts/tablesort.js"></script>
      
        <script src="../javascripts/tablesort.number.js"></script>
      
    
  </body>
</html>